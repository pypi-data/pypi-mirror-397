import{j as e}from"./@radix-DGuLZ9Nd.js";import{c as C}from"./helper-BOgrUHnZ.js";import{F as S,G as T,H as k,p as g,J as j,K as _,B as f,L as w,N as A,O as R,Q as E,R as O,U as I,V as m,W as B,X as F,r as d,Y as L,Z as $,_ as z,$ as M,a0 as G,a1 as h,T as Q,a2 as q,a3 as H,a4 as K,e as x}from"./index-DHfBZI1k.js";import{c as U,b as J}from"./@tanstack-B6Lqf40n.js";import{u as V}from"./bulk-delete-qYbQtEY6.js";import{S as W}from"./refresh-DNxZUtB4.js";import{P as X}from"./Pagination-2lWLXiuP.js";import{S as Y}from"./SearchField-DS1lx7M6.js";import{S as Z}from"./alert-triangle-DTrw87FZ.js";import{S as v}from"./trash-Dp8wQrEE.js";import{D,a as P}from"./DeleteAlertDialog-DdUiWXzk.js";import{a as y}from"./@monaco-editor-CuNQBT0l.js";import{A as ee}from"./action-cell-Biol8Lia.js";import{L as u,f as te}from"./@react-router-edahAHd8.js";import{z as l}from"./@zod-2qqdh1cM.js";import"./@elkjs-CmhuJAjY.js";import"./@reactflow-BVD3Tc7O.js";import"./chevron-right-double-DLhLU36B.js";async function se({pipelineId:t}){const s=S(k.pipelines.detail(t)),n=await fetch(s,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const a=await n.json().then(i=>i.detail).catch(()=>`Failed to delete pipeline ${t}`);throw new T({status:n.status,statusText:n.statusText,message:a})}return n.json()}function ne(t){return U({mutationFn:se,...t})}const{ContextProvider:ae,useContext:o}=C();function b(){const{setRowSelection:t}=o(),{mutateAsync:s}=ne();async function n(a){await s({pipelineId:a})}return V({deleteFn:n,queryKeyToInvalidate:g.all,setRowSelection:t})}function ie(){const[t,s]=y.useState(!1),{selectedRowCount:n,selectedRowIDs:a}=o(),{bulkDelete:i}=b();async function c(){await i(a),s(!1)}const r=w(n,"Pipeline"),N=`Delete ${r}`;return e.jsxs(j,{open:t,onOpenChange:s,children:[e.jsx(_,{asChild:!0,children:e.jsxs(f,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(v,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(D,{title:N,handleDelete:c,children:e.jsxs(P,{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]}),e.jsx("div",{className:"space-y-3 rounded-md border border-warning-300 bg-warning-50 px-2 py-1 text-warning-900",children:e.jsxs("div",{className:"flex items-center gap-2 text-text-sm",children:[e.jsx(Z,{width:24,height:24,className:"shrink-0 fill-warning-700"}),e.jsxs("p",{children:["This will also delete all runs and snapshots associated with the ",r,"."]})]})})]})})]})}function re(){const{selectedRowCount:t}=o(),s=w(t,"Pipeline");return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${t} ${s} selected`}),e.jsx(ie,{})]})}function le({id:t}){const[s,n]=y.useState(!1),{bulkDelete:a}=b();async function i(){await a([t]),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(j,{open:s,onOpenChange:n,children:e.jsx(D,{title:"Delete Pipeline",handleDelete:i,children:e.jsxs(P,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}),e.jsxs(A,{children:[e.jsx(R,{asChild:!0,children:e.jsx(E,{children:e.jsx("span",{className:"sr-only",children:"Open pipeline actions"})})}),e.jsx(O,{align:"end",sideOffset:7,children:e.jsx(I,{onSelect:()=>n(!0),icon:e.jsx(v,{}),children:"Delete"})})]})]})}function oe(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(m,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(m,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Pipeline",cell:({row:t})=>e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(B,{className:`h-5 w-5 shrink-0 ${F(t.original.resources?.latest_run_status)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{to:d.projects.pipelines.detail.runs(t.original.id),className:"grid grid-cols-1 items-center gap-1",children:e.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:t.original.name})}),e.jsx(L,{children:e.jsxs($,{children:[e.jsx(z,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(M,{status:t.original.resources?.latest_run_status})}),e.jsx(G,{className:"z-20 capitalize",children:t.original.resources?.latest_run_status})]})}),e.jsx(h,{copyText:t.original.name})]}),e.jsxs(u,{to:d.projects.pipelines.detail.runs(t.original.id),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:t.original.id.split("-")[0]}),e.jsx(h,{copyText:t.original.id})]})]})]})},{id:"latest-run",header:"Latest Run",accessorFn:t=>({status:t.resources?.latest_run_status,runId:t.resources?.latest_run_id}),cell:({getValue:t})=>{const{runId:s,status:n}=t();return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(u,{to:d.projects.runs.detail(s),children:e.jsxs(Q,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:q(n),children:[e.jsx(H,{className:"h-3 w-3 fill-current"}),s?.split("-")[0]]})})}},{id:"admin_actions",header:"",meta:{width:"5%"},cell:({row:t})=>e.jsx(ee,{children:e.jsx(le,{id:t.original.id})})}]}const p=1,ce=l.object({page:l.coerce.number().min(p).optional().default(p).catch(p),name:l.string().optional(),operator:l.enum(["and","or"]).optional()});function de(){const[t]=te(),{page:s,name:n,operator:a}=ce.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:n,logical_operator:a}}function ue(){const t=de(),{selectedRowCount:s,rowSelection:n,setRowSelection:a}=o(),{data:i,refetch:c}=J({...g.pipelineList({...t,sort_by:"desc:latest_run"}),throwOnError:!0});return e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[s?e.jsx(re,{}):e.jsx(Y,{searchParams:t}),e.jsx("div",{className:"flex justify-between",children:e.jsxs(f,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>c(),children:[e.jsx(W,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(K,{rowSelection:n,onRowSelectionChange:a,getRowId:r=>r.id,columns:oe(),data:i.items}):e.jsx(x,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(X,{searchParams:t,paginate:i}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})}function _e(){return e.jsx(ae,{children:e.jsx(ue,{})})}export{_e as default};
