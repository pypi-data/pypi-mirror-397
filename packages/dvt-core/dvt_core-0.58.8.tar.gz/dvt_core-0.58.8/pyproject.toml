[tool.setuptools]
package-dir = {"" = "."}
include-package-data = true
zip-safe = false

[tool.setuptools.packages.find]
where = ["."]
include = [
    "dbt",
    "dbt.*",
    "dvt_cli",  # Standalone entry point package
]

# this needs to match MANIFEST.in for the wheels
[tool.setuptools.package-data]
"dbt" = [
    "include/**/*.py",
    "include/**/*.sql",
    "include/**/*.yml",
    "include/**/*.html",
    "include/**/*.md",
    "include/**/*.csv",
    "include/**/*.duckdb",
    "include/**/.gitkeep",
    "include/**/.gitignore",
    "task/docs/**/*.html",
    "jsonschemas/**/*.json",
    "py.typed",
]

[project]
name = "dvt-core"
version = "0.58.8"
description = "DVT (Data Virtualization Tool) - Multi-source data federation and transformation with Spark-unified compute layer."
readme = "README.md"
requires-python = ">=3.10"
license = "Apache-2.0"
keywords = [
    "data",
    "virtualization",
    "federation",
    "multi-source",
    "dbt",
    "analytics",
    "transform",
    "spark",
    "jdbc",
    "databricks",
]
authors = [
    { name = "DVT Contributors" },
]
maintainers = [
    { name = "DVT Contributors" },
]
classifiers = [
    "Development Status :: 4 - Beta",
    # NOTE: Windows support removed in v0.52.0 (closed-source binary distribution)
    "Operating System :: MacOS :: MacOS X",
    "Operating System :: POSIX :: Linux",
    "Programming Language :: Python",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: Implementation :: CPython",
    # NOTE: PyPy removed - Cython binaries are CPython-specific
]
dependencies = [
    # ----
    # dbt-core uses these packages deeply, throughout the codebase, and there have been breaking changes in past patch releases (even though these are major-version-one).
    # Pin to the patch or minor version, and bump in each new minor version of dbt-core.
    "agate>=1.7.0,<1.10",
    "Jinja2>=3.1.3,<4",
    "mashumaro[msgpack]>=3.9,<3.15",
    # ----
    # dbt-core uses these packages in standard ways. Pin to the major version, and check compatibility
    # with major versions in each new minor version of dbt-core.
    "click>=8.0.2,<9.0",
    "jsonschema>=4.19.1,<5.0",
    "networkx>=2.3,<4.0",
    "protobuf>=6.0,<7.0",
    "requests<3.0.0",  # should match dbt-common
    "snowplow-tracker>=1.0.2,<2.0",
    # ----
    # These packages are major-version-0. Keep upper bounds on upcoming minor versions (which could have breaking changes)
    # and check compatibility / bump in each new minor version of dbt-core.
    "pathspec>=0.9,<0.13",
    "sqlparse>=0.5.0,<0.6.0",
    # ----
    # These are major-version-0 packages also maintained by dbt-labs.
    # Accept patches but avoid automatically updating past a set minor version range.
    "dbt-extractor>=0.5.0,<=0.6",
    "dbt-semantic-interfaces>=0.9.0,<0.10",
    # Minor versions for these are expected to be backwards-compatible
    "dbt-common>=1.27.0,<2.0",
    "dbt-adapters>=1.15.5,<2.0",
    "dbt-protos>=1.0.375,<2.0",
    # NOTE: dbt-core is NOT listed as a dependency because dvt-core IS a fork
    # of dbt-core and provides the complete 'dbt' namespace package itself.
    # Installing both would cause namespace conflicts.
    "pydantic<3",
    # ----
    # Expect compatibility with all new versions of these packages, so lower bounds only.
    "packaging>20.9",
    "pytz>=2015.7",
    "pyyaml>=6.0",
    "daff>=1.3.46",
    "typing-extensions>=4.4",
    # ----
    # DVT v0.5.91: Minimal adapter set - users run `dvt target sync` to install
    # adapters based on their profiles.yml connections
    "dbt-postgres>=1.9.0,<2.0",      # PostgreSQL (reference adapter)
    # ----
    # DVT-specific dependencies for compute layer and data federation
    "pyspark>=3.5.0,<5.0.0",  # Spark 3.5+ or 4.0 (both supported)
    "duckdb>=0.9.0",  # DuckDB for metadata store and profiling
    "rich>=13.0.0",  # Rich terminal formatting for beautiful CLI output
]

[project.optional-dependencies]
# Databricks connectivity (large dependency, opt-in)
databricks = ["databricks-connect>=13.0.0"]

[project.urls]
Homepage = "https://github.com/dvt-core/dvt-core"
Documentation = "https://github.com/dvt-core/dvt-core#readme"
Repository = "https://github.com/dvt-core/dvt-core.git"
Issues = "https://github.com/dvt-core/dvt-core/issues"

[project.scripts]
# Use dvt_cli package (standalone, not in dbt namespace) which ensures
# DVT's dbt package takes precedence over any dbt-core installation
# (dbt-core comes as a transitive dependency from dbt adapters)
#
# NOTE: We only provide 'dvt' command - users who want 'dbt' alias can:
#   - Use shell alias: alias dbt=dvt
#   - Or simply use 'dvt' which is the preferred command
# We don't provide 'dbt' entry point to avoid conflicts with dbt-core
# which gets installed as a dependency of dbt adapters.
dvt = "dvt_cli:dvt_cli"

[build-system]
requires = [
    "setuptools>=61",
    "wheel",
    "cython>=3.0.0",  # DVT v0.52.0: Required for binary compilation
]
build-backend = "setuptools.build_meta"

# DVT v0.52.0: Closed-source binary distribution
# See closed_source_user_actions/ for documentation
