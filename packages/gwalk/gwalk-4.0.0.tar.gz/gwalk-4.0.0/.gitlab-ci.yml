image: debian:latest

before_script:
    - apt update
    - apt --assume-yes install libsuitesparse-dev
    - apt --assume-yes install pkg-config
    - apt update
    - apt --assume-yes install libhdf5-dev
    - apt --assume-yes install python3
    - apt --assume-yes install python3-pip
    - apt --assume-yes install python3-venv
    - apt --assume-yes install git

stages:
#    - test
    - test
#    - load

#tox:
#    stage: test
#    script:
#        - tox -p all
#    artifacts:
#        paths:
#        - .tox/py39-numpy121/log
#        when: always
#        expire_in: 4 week

example:
    stage: test
    script:
        - python3 -m venv gwalk
        - source gwalk/bin/activate; python3 -m pip install tox pytest pytest-cov build numpy setuptools h5py
        - source gwalk/bin/activate; make unit_tests
    only:
        - master
        - merge_requests
    artifacts:
        paths:
        - ./example_out.txt

#aligned3d_source:
#    stage: load
#    script:
#        - python3 ./tests/test_aligned3d_source.py | tee ./aligned3d_source_best_fits.txt
#    only:
#        - master
#        - merge_requests
#    artifacts:
#        paths:
#        - ./aligned3d_source_best_fits.txt
#

after_script:
    - echo "All CI tasks run"
