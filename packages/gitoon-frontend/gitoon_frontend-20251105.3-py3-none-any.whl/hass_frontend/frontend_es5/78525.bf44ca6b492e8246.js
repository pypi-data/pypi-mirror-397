"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["78525"],{72010:function(e,t,i){i.d(t,{A:function(){return r}});i(46852),i(98522),i(67579),i(30500);var a=e=>{var t=parseFloat(e);if(isNaN(t))throw new Error(`${e} is not a number`);return t};function r(e){if(!e)return null;try{if(e.endsWith("%"))return{w:100,h:a(e.slice(0,-1))};var t=e.replace(":","x").split("x");return 0===t.length?null:1===t.length?{w:a(t[0]),h:1}:{w:a(t[0]),h:a(t[1])}}catch(i){}return null}},65954:function(e,t,i){var a,r,s,o=i(98735),n=i(88486),l=i(62020),d=i(31802),c=i(21101),h=i(23180),_=i(87426),u=(i(38606),i(69868)),p=i(84922),v=i(11991),y=i(33055),m=i(48893),g=i(65940),f=i(72652),b=i(70816),k=i(63375),w=(i(51257),i(79827),i(99342),i(65315),i(22416),i(45519),i(30536),i(13802)),I=i(44017),C=(i(94124),e=>e),S=function(e){function t(){var e;(0,l.A)(this,t);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=(0,c.A)(this,t,[].concat(a))).controls=!1,e.muted=!1,e.autoPlay=!1,e.playsInline=!1,e._candidatesList=[],e._handleVisibilityChange=()=>{document.hidden?e._cleanUp():e._startWebRtc()},e._startNegotiation=(0,n.A)((0,o.A)().m(function t(){var i,a,r,s,n;return(0,o.A)().w(function(t){for(;;)switch(t.n){case 0:if(e._peerConnection){t.n=1;break}return t.a(2);case 1:return i={offerToReceiveAudio:!0,offerToReceiveVideo:!0},e._logEvent("start createOffer",i),t.n=2,e._peerConnection.createOffer(i);case 2:if(a=t.v,e._peerConnection){t.n=3;break}return t.a(2);case 3:return e._logEvent("end createOffer",a),e._logEvent("start setLocalDescription"),t.n=4,e._peerConnection.setLocalDescription(a);case 4:if(e._peerConnection&&e.entityid){t.n=5;break}return t.a(2);case 5:for(e._logEvent("end setLocalDescription"),r="";e._candidatesList.length;)(s=e._candidatesList.pop())&&(r+=`a=${s}\r\n`);n=a.sdp+r,e._logEvent("start webRtcOffer",n);try{e._unsub=(0,k.w8)(e.hass,e.entityid,n,t=>e._handleOfferEvent(t))}catch(o){e._error="Failed to start WebRTC stream: "+o.message,e._cleanUp()}case 6:return t.a(2)}},t)})),e._iceConnectionStateChanged=()=>{var t,i;e._logEvent("ice connection state change",null===(t=e._peerConnection)||void 0===t?void 0:t.iceConnectionState),"failed"===(null===(i=e._peerConnection)||void 0===i?void 0:i.iceConnectionState)&&e._peerConnection.restartIce()},e._handleIceCandidate=t=>{var i,a,r;e.entityid&&null!==(i=t.candidate)&&void 0!==i&&i.candidate&&(e._logEvent("local ice candidate",null===(a=t.candidate)||void 0===a?void 0:a.candidate,null===(r=t.candidate)||void 0===r?void 0:r.sdpMLineIndex),e._sessionId?(0,k.UC)(e.hass,e.entityid,e._sessionId,t.candidate.toJSON()):e._candidatesList.push(t.candidate))},e._addTrack=function(){var t=(0,n.A)((0,o.A)().m(function t(i){return(0,o.A)().w(function(t){for(;;)switch(t.n){case 0:if(e._remoteStream){t.n=1;break}return t.a(2);case 1:if("audio"!==i.track.kind||!e.muted){t.n=2;break}return t.a(2);case 2:if(e._remoteStream.addTrack(i.track),e.hasUpdated){t.n=3;break}return t.n=3,e.updateComplete;case 3:e._videoEl.srcObject=e._remoteStream;case 4:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),e}return(0,h.A)(t,e),(0,d.A)(t,[{key:"render",value:function(){return this._error?(0,p.qy)(a||(a=C`<ha-alert alert-type="error">${0}</ha-alert>`),this._error):(0,p.qy)(r||(r=C` <video id="remote-stream" ?autoplay="${0}" .muted="${0}" ?playsinline="${0}" ?controls="${0}" poster="${0}" @loadeddata="${0}" style="${0}"></video> `),this.autoPlay,this.muted,this.playsInline,this.controls,(0,w.J)(this.posterUrl),this._loadedData,(0,m.W)({height:null==this.aspectRatio?"100%":"auto",aspectRatio:this.aspectRatio,objectFit:this.fitMode}))}},{key:"connectedCallback",value:function(){(0,_.A)(t,"connectedCallback",this,3)([]),this.hasUpdated&&this.entityid&&this._startWebRtc(),document.addEventListener("visibilitychange",this._handleVisibilityChange)}},{key:"disconnectedCallback",value:function(){(0,_.A)(t,"disconnectedCallback",this,3)([]),document.removeEventListener("visibilitychange",this._handleVisibilityChange),this._cleanUp()}},{key:"willUpdate",value:function(e){(0,_.A)(t,"willUpdate",this,3)([e]),e.has("entityid")&&this._startWebRtc()}},{key:"_startWebRtc",value:(u=(0,n.A)((0,o.A)().m(function e(){return(0,o.A)().w(function(e){for(;;)switch(e.n){case 0:if(this._cleanUp(),"undefined"!=typeof RTCPeerConnection){e.n=1;break}return this._error="WebRTC is not supported in this browser",(0,I.r)(this,"streams",{hasAudio:!1,hasVideo:!1}),e.a(2);case 1:if(this.hass&&this.entityid){e.n=2;break}return e.a(2);case 2:return this._error=void 0,this._startTimer(),this._logEvent("start clientConfig"),e.n=3,(0,k.bT)(this.hass,this.entityid);case 3:this._clientConfig=e.v,this._logEvent("end clientConfig",this._clientConfig),this._peerConnection=new RTCPeerConnection(this._clientConfig.configuration),this._clientConfig.dataChannel&&this._peerConnection.createDataChannel(this._clientConfig.dataChannel),this._peerConnection.onnegotiationneeded=this._startNegotiation,this._peerConnection.onicecandidate=this._handleIceCandidate,this._peerConnection.oniceconnectionstatechange=this._iceConnectionStateChanged,this._peerConnection.onsignalingstatechange=e=>{"stable"===e.target.signalingState?this._logEvent("ICE negotiation complete"):this._logEvent("Signaling state changed",e.target.signalingState)},this._remoteStream=new MediaStream,this._peerConnection.ontrack=this._addTrack,this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),this._peerConnection.addTransceiver("video",{direction:"recvonly"});case 4:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})},{key:"_handleOfferEvent",value:(s=(0,n.A)((0,o.A)().m(function e(t){var i,a,r;return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.entityid){e.n=1;break}return e.a(2);case 1:if("session"===t.type&&(this._sessionId=t.session_id,this._candidatesList.forEach(e=>(0,k.UC)(this.hass,this.entityid,t.session_id,e.toJSON())),this._candidatesList=[]),"answer"===t.type&&(this._logEvent("answer",t.answer),this._handleAnswer(t)),"candidate"!==t.type){e.n=5;break}return this._logEvent("remote ice candidate",t.candidate),e.p=2,a=t.candidate.sdpMid||null!=t.candidate.sdpMLineIndex?new RTCIceCandidate(t.candidate):new RTCIceCandidate({candidate:t.candidate.candidate,sdpMid:"0"}),e.n=3,null===(i=this._peerConnection)||void 0===i?void 0:i.addIceCandidate(a);case 3:e.n=5;break;case 4:e.p=4,r=e.v,console.error(r);case 5:"error"===t.type&&(this._error="Failed to start WebRTC stream: "+t.message,this._cleanUp());case 6:return e.a(2)}},e,this,[[2,4]])})),function(e){return s.apply(this,arguments)})},{key:"_handleAnswer",value:(i=(0,n.A)((0,o.A)().m(function e(t){var i,a,r;return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==(i=this._peerConnection)&&void 0!==i&&i.signalingState&&!["stable","closed"].includes(this._peerConnection.signalingState)){e.n=1;break}return e.a(2);case 1:return a=new RTCSessionDescription({type:"answer",sdp:t.answer}),e.p=2,this._logEvent("start setRemoteDescription",a),e.n=3,this._peerConnection.setRemoteDescription(a);case 3:e.n=5;break;case 4:e.p=4,r=e.v,this._error="Failed to connect WebRTC stream: "+r.message,this._cleanUp();case 5:this._logEvent("end setRemoteDescription");case 6:return e.a(2)}},e,this,[[2,4]])})),function(e){return i.apply(this,arguments)})},{key:"_cleanUp",value:function(){var e;this._remoteStream&&(this._remoteStream.getTracks().forEach(e=>{e.stop()}),this._remoteStream=void 0);var t=this._videoEl;t&&(t.removeAttribute("src"),t.load()),this._peerConnection&&(this._peerConnection.close(),this._peerConnection.onnegotiationneeded=null,this._peerConnection.onicecandidate=null,this._peerConnection.oniceconnectionstatechange=null,this._peerConnection.onicegatheringstatechange=null,this._peerConnection.ontrack=null,this._peerConnection.onsignalingstatechange=null,this._peerConnection=void 0,this._logEvent("stopped"),this._stopTimer()),null===(e=this._unsub)||void 0===e||e.then(e=>e()),this._unsub=void 0,this._sessionId=void 0,this._candidatesList=[]}},{key:"_loadedData",value:function(){var e=this._videoEl.srcObject,t={hasAudio:Boolean(null==e?void 0:e.getAudioTracks().length),hasVideo:Boolean(null==e?void 0:e.getVideoTracks().length)};(0,I.r)(this,"load"),(0,I.r)(this,"streams",t),this._logEvent("loadedData",t),this._stopTimer()}},{key:"_startTimer",value:function(){}},{key:"_stopTimer",value:function(){}},{key:"_logEvent",value:function(e){}}]);var i,s,u}(p.WF);S.styles=(0,p.AH)(s||(s=C`:host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}`)),(0,u.__decorate)([(0,v.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,u.__decorate)([(0,v.MZ)()],S.prototype,"entityid",void 0),(0,u.__decorate)([(0,v.MZ)({attribute:!1})],S.prototype,"aspectRatio",void 0),(0,u.__decorate)([(0,v.MZ)({attribute:!1})],S.prototype,"fitMode",void 0),(0,u.__decorate)([(0,v.MZ)({type:Boolean,attribute:"controls"})],S.prototype,"controls",void 0),(0,u.__decorate)([(0,v.MZ)({type:Boolean,attribute:"muted"})],S.prototype,"muted",void 0),(0,u.__decorate)([(0,v.MZ)({type:Boolean,attribute:"autoplay"})],S.prototype,"autoPlay",void 0),(0,u.__decorate)([(0,v.MZ)({type:Boolean,attribute:"playsinline"})],S.prototype,"playsInline",void 0),(0,u.__decorate)([(0,v.MZ)({attribute:"poster-url"})],S.prototype,"posterUrl",void 0),(0,u.__decorate)([(0,v.wk)()],S.prototype,"_error",void 0),(0,u.__decorate)([(0,v.P)("#remote-stream")],S.prototype,"_videoEl",void 0),S=(0,u.__decorate)([(0,v.EM)("ha-web-rtc-player")],S);var E,A,M,$,R,U=e=>e,O="mjpeg",x=function(e){function t(){var e;(0,l.A)(this,t);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=(0,c.A)(this,t,[].concat(a))).controls=!1,e.muted=!1,e.allowExoPlayer=!1,e._connected=!1,e._streams=(0,g.A)((e,t,i,a)=>{if(!e)return[];if(0===e.length)return[{type:O,visible:!0}];if(1===e.length)return e[0]===k.Ub&&!1===(null==t?void 0:t.hasVideo)||e[0]===k.zS&&!1===(null==i?void 0:i.hasVideo)?[{type:O,visible:!0}]:[{type:e[0],visible:!0}];if(t&&i)return t.hasVideo&&t.hasAudio&&!i.hasAudio&&!a?[{type:k.Ub,visible:!0}]:i.hasVideo?[{type:k.zS,visible:!0}]:[{type:O,visible:!0}];if((null==t?void 0:t.hasVideo)!==(null==i?void 0:i.hasVideo)){if(null!=t&&t.hasVideo)return[{type:k.Ub,visible:!0},{type:k.zS,visible:!1}];if(!1===(null==t?void 0:t.hasVideo))return[{type:k.zS,visible:!0}];if(null!=i&&i.hasVideo)return[{type:k.zS,visible:!0},{type:k.Ub,visible:!1}];if(!1===(null==i?void 0:i.hasVideo))return[{type:k.Ub,visible:!0}]}return[{type:k.Ub,visible:!0},{type:k.zS,visible:!1}]}),e}return(0,h.A)(t,e),(0,d.A)(t,[{key:"willUpdate",value:function(e){var t;e.has("stateObj")&&this.stateObj&&(null===(t=e.get("stateObj"))||void 0===t?void 0:t.entity_id)!==this.stateObj.entity_id&&(this._getCapabilities(),this._getPosterUrl())}},{key:"connectedCallback",value:function(){(0,_.A)(t,"connectedCallback",this,3)([]),this._connected=!0}},{key:"disconnectedCallback",value:function(){(0,_.A)(t,"disconnectedCallback",this,3)([]),this._connected=!1}},{key:"render",value:function(){var e;if(!this.stateObj)return p.s6;var t=this._streams(null===(e=this._capabilities)||void 0===e?void 0:e.frontend_stream_types,this._hlsStreams,this._webRtcStreams,this.muted);return(0,p.qy)(E||(E=U`${0}`),(0,y.u)(t,e=>e.type+this.stateObj.entity_id,e=>this._renderStream(e)))}},{key:"_renderStream",value:function(e){return this.stateObj?e.type===O?(0,p.qy)(A||(A=U`<img .src="${0}" style="${0}" alt="${0}">`),this._connected?(0,k.CK)(this.stateObj):this._posterUrl||"",(0,m.W)({aspectRatio:this.aspectRatio,objectFit:this.fitMode}),`Preview of the ${(0,f.u)(this.stateObj)} camera.`):e.type===k.Ub?(0,p.qy)(M||(M=U`<ha-hls-player autoplay playsinline .allowExoPlayer="${0}" .muted="${0}" .controls="${0}" .hass="${0}" .entityid="${0}" .posterUrl="${0}" @streams="${0}" class="${0}" .aspectRatio="${0}" .fitMode="${0}"></ha-hls-player>`),this.allowExoPlayer,this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleHlsStreams,e.visible?"":"hidden",this.aspectRatio,this.fitMode):e.type===k.zS?(0,p.qy)($||($=U`<ha-web-rtc-player autoplay playsinline .muted="${0}" .controls="${0}" .hass="${0}" .entityid="${0}" .posterUrl="${0}" @streams="${0}" class="${0}" .aspectRatio="${0}" .fitMode="${0}"></ha-web-rtc-player>`),this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl,this._handleWebRtcStreams,e.visible?"":"hidden",this.aspectRatio,this.fitMode):p.s6:p.s6}},{key:"_getCapabilities",value:(a=(0,n.A)((0,o.A)().m(function e(){return(0,o.A)().w(function(e){for(;;)switch(e.n){case 0:if(this._capabilities=void 0,this._hlsStreams=void 0,this._webRtcStreams=void 0,(0,b.$)(this.stateObj,k.JT)){e.n=1;break}return this._capabilities={frontend_stream_types:[]},e.a(2);case 1:return e.n=2,(0,k._Z)(this.hass,this.stateObj.entity_id);case 2:this._capabilities=e.v;case 3:return e.a(2)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"_getPosterUrl",value:(i=(0,n.A)((0,o.A)().m(function e(){return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,k.C4)(this.hass,this.stateObj.entity_id,this.clientWidth,this.clientHeight);case 1:this._posterUrl=e.v,e.n=3;break;case 2:e.p=2,e.v,this._posterUrl=void 0;case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return i.apply(this,arguments)})},{key:"_handleHlsStreams",value:function(e){this._hlsStreams=e.detail}},{key:"_handleWebRtcStreams",value:function(e){this._webRtcStreams=e.detail}}]);var i,a}(p.WF);x.styles=(0,p.AH)(R||(R=U`:host,img{display:block}img{width:100%}ha-web-rtc-player{width:100%;height:100%}ha-hls-player{width:100%;height:100%}.hidden{display:none}`)),(0,u.__decorate)([(0,v.MZ)({attribute:!1})],x.prototype,"hass",void 0),(0,u.__decorate)([(0,v.MZ)({attribute:!1})],x.prototype,"stateObj",void 0),(0,u.__decorate)([(0,v.MZ)({attribute:!1})],x.prototype,"aspectRatio",void 0),(0,u.__decorate)([(0,v.MZ)({attribute:!1})],x.prototype,"fitMode",void 0),(0,u.__decorate)([(0,v.MZ)({type:Boolean,attribute:"controls"})],x.prototype,"controls",void 0),(0,u.__decorate)([(0,v.MZ)({type:Boolean,attribute:"muted"})],x.prototype,"muted",void 0),(0,u.__decorate)([(0,v.MZ)({type:Boolean,attribute:"allow-exoplayer"})],x.prototype,"allowExoPlayer",void 0),(0,u.__decorate)([(0,v.wk)()],x.prototype,"_posterUrl",void 0),(0,u.__decorate)([(0,v.wk)()],x.prototype,"_connected",void 0),(0,u.__decorate)([(0,v.wk)()],x.prototype,"_capabilities",void 0),(0,u.__decorate)([(0,v.wk)()],x.prototype,"_hlsStreams",void 0),(0,u.__decorate)([(0,v.wk)()],x.prototype,"_webRtcStreams",void 0),x=(0,u.__decorate)([(0,v.EM)("ha-camera-stream")],x)},51257:function(e,t,i){var a,r,s,o,n=i(98735),l=i(88486),d=i(62020),c=i(31802),h=i(21101),_=i(23180),u=i(87426),p=(i(38606),i(79827),i(35748),i(45519),i(5934),i(67579),i(95013),i(45460),i(18332),i(13484),i(81071),i(92714),i(55885),i(69868)),v=i(84922),y=i(11991),m=i(48893),g=i(26946),f=i(44017),b=i(54337),k=i(63375),w=(i(94124),e=>e),I=function(e){function t(){var e;(0,d.A)(this,t);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=(0,h.A)(this,t,[].concat(a))).controls=!1,e.muted=!1,e.autoPlay=!1,e.playsInline=!1,e.allowExoPlayer=!1,e._errorIsFatal=!1,e._exoPlayer=!1,e._handleVisibilityChange=()=>{document.hidden?e._cleanUp():(e._resetError(),e._startHls())},e._resizeExoPlayer=()=>{if(e._videoEl){var t=e._videoEl.getBoundingClientRect();e.hass.auth.external.fireMessage({type:"exoplayer/resize",payload:{left:t.left,top:t.top,right:t.right,bottom:t.bottom}})}},e}return(0,_.A)(t,e),(0,c.A)(t,[{key:"connectedCallback",value:function(){(0,u.A)(t,"connectedCallback",this,3)([]),t.streamCount+=1,this.hasUpdated&&(this._resetError(),this._startHls()),document.addEventListener("visibilitychange",this._handleVisibilityChange)}},{key:"disconnectedCallback",value:function(){(0,u.A)(t,"disconnectedCallback",this,3)([]),document.removeEventListener("visibilitychange",this._handleVisibilityChange),t.streamCount-=1,this._cleanUp()}},{key:"render",value:function(){return(0,v.qy)(a||(a=w` ${0} ${0} `),this._error?(0,v.qy)(r||(r=w`<ha-alert alert-type="error" class="${0}"> ${0} </ha-alert>`),this._errorIsFatal?"fatal":"retry",this._error):"",this._errorIsFatal?"":(0,v.qy)(s||(s=w`<video .poster="${0}" ?autoplay="${0}" .muted="${0}" ?playsinline="${0}" ?controls="${0}" @loadeddata="${0}" style="${0}"></video>`),this.posterUrl,this.autoPlay,this.muted,this.playsInline,this.controls,this._loadedData,(0,m.W)({height:null==this.aspectRatio?"100%":"auto",aspectRatio:this.aspectRatio,objectFit:this.fitMode})))}},{key:"updated",value:function(e){(0,u.A)(t,"updated",this,3)([e]);var i=e.has("entityid"),a=e.has("url");i?this._getStreamUrlFromEntityId():a&&this.url&&(this._cleanUp(),this._resetError(),this._url=this.url,this._startHls())}},{key:"_getStreamUrlFromEntityId",value:(C=(0,l.A)((0,n.A)().m(function e(){var t,i,a;return(0,n.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this._cleanUp(),this._resetError(),(0,g.x)(this.hass,"stream")){e.n=1;break}return this._setFatalError("Streaming component is not loaded."),e.a(2);case 1:if(this.entityid){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,(0,k.wv)(this.hass,this.entityid);case 3:t=e.v,i=t.url,this._url=this.hass.hassUrl(i),this._cleanUp(),this._resetError(),this._startHls(),e.n=5;break;case 4:e.p=4,a=e.v,console.error(a),(0,f.r)(this,"streams",{hasAudio:!1,hasVideo:!1});case 5:return e.a(2)}},e,this,[[2,4]])})),function(){return C.apply(this,arguments)})},{key:"_startHls",value:(I=(0,l.A)((0,n.A)().m(function e(){var t,a,r,s,o,l,d,c,h,_,u;return(0,n.A)().w(function(e){for(;;)switch(e.n){case 0:return a=fetch(this._url),e.n=1,i.e("50705").then(i.bind(i,62664));case 1:if(r=e.v.default,this.isConnected){e.n=2;break}return e.a(2);case 2:if((s=r.isSupported())||(s=""!==this._videoEl.canPlayType("application/vnd.apple.mpegurl")),s){e.n=3;break}return this._setFatalError(this.hass.localize("ui.components.media-browser.video_not_supported")),e.a(2);case 3:return o=this.allowExoPlayer&&(null===(t=this.hass.auth.external)||void 0===t?void 0:t.config.hasExoPlayer),e.n=4,a;case 4:return e.n=5,e.v.text();case 5:if(l=e.v,this.isConnected){e.n=6;break}return e.a(2);case 6:c=(d=/#EXT-X-STREAM-INF:.*?(?:CODECS=".*?([^.]*)?\..*?,([^.]*)?\..*?".*?)?(?:\n|\r\n)(.+)/g).exec(l),h=d.exec(l),_=null!==c&&null===h?new URL(c[3],this._url).href:this._url,u=c?`${c[1]},${c[2]}`:void 0,this._reportStreams(u),o&&(null!=u&&u.includes("hevc")||null!=u&&u.includes("hev1"))?this._renderHLSExoPlayer(_):r.isSupported()?this._renderHLSPolyfill(this._videoEl,r,_):this._renderHLSNative(this._videoEl,_);case 7:return e.a(2)}},e,this)})),function(){return I.apply(this,arguments)})},{key:"_renderHLSExoPlayer",value:(y=(0,l.A)((0,n.A)().m(function e(t){return(0,n.A)().w(function(e){for(;;)switch(e.n){case 0:return this._exoPlayer=!0,window.addEventListener("resize",this._resizeExoPlayer),this.updateComplete.then(()=>(0,b.E)()).then(this._resizeExoPlayer),this._videoEl.style.visibility="hidden",e.n=1,this.hass.auth.external.fireMessage({type:"exoplayer/play_hls",payload:{url:t,muted:this.muted}});case 1:return e.a(2)}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"_isLLHLSSupported",value:function(){if(t.streamCount<=2)return!0;if(!("performance"in window)||0===performance.getEntriesByType("resource").length)return!1;var e=performance.getEntriesByType("resource")[0];return"nextHopProtocol"in e&&"h2"===e.nextHopProtocol}},{key:"_renderHLSPolyfill",value:(p=(0,l.A)((0,n.A)().m(function e(t,i,a){var r;return(0,n.A)().w(function(e){for(;;)switch(e.n){case 0:r=new i({backBufferLength:60,fragLoadingTimeOut:3e4,manifestLoadingTimeOut:3e4,levelLoadingTimeOut:3e4,maxLiveSyncPlaybackRate:2,lowLatencyMode:this._isLLHLSSupported()}),this._hlsPolyfillInstance=r,r.attachMedia(t),r.on(i.Events.MEDIA_ATTACHED,()=>{this._resetError(),r.loadSource(a)}),r.on(i.Events.FRAG_LOADED,(e,t)=>{this._resetError()}),r.on(i.Events.ERROR,(e,t)=>{if(t.fatal)if(t.type===i.ErrorTypes.NETWORK_ERROR){switch(t.details){case i.ErrorDetails.MANIFEST_LOAD_ERROR:var a="Error starting stream, see logs for details";void 0!==t.response&&void 0!==t.response.code&&(t.response.code>=500?a+=" (Server failure)":t.response.code>=400?a+=" (Stream never started)":a+=` (${t.response.code})`),this._setRetryableError(a);break;case i.ErrorDetails.MANIFEST_LOAD_TIMEOUT:this._setRetryableError("Timeout while starting stream");break;default:this._setRetryableError("Stream network error")}r.startLoad()}else t.type===i.ErrorTypes.MEDIA_ERROR?(this._setRetryableError("Error with media stream contents"),r.recoverMediaError()):this._setFatalError("Error playing stream")});case 1:return e.a(2)}},e,this)})),function(e,t,i){return p.apply(this,arguments)})},{key:"_renderHLSNative",value:(o=(0,l.A)((0,n.A)().m(function e(t,i){return(0,n.A)().w(function(e){for(;;)switch(e.n){case 0:t.src=i,t.addEventListener("loadedmetadata",()=>{t.play()});case 1:return e.a(2)}},e)})),function(e,t){return o.apply(this,arguments)})},{key:"_cleanUp",value:function(){this._hlsPolyfillInstance&&(this._hlsPolyfillInstance.destroy(),this._hlsPolyfillInstance=void 0),this._exoPlayer&&(window.removeEventListener("resize",this._resizeExoPlayer),this.hass.auth.external.fireMessage({type:"exoplayer/stop"}),this._exoPlayer=!1),this._videoEl&&(this._videoEl.removeAttribute("src"),this._videoEl.load())}},{key:"_resetError",value:function(){this._error=void 0,this._errorIsFatal=!1}},{key:"_setFatalError",value:function(e){this._error=e,this._errorIsFatal=!0,(0,f.r)(this,"streams",{hasAudio:!1,hasVideo:!1})}},{key:"_setRetryableError",value:function(e){this._error=e,this._errorIsFatal=!1,(0,f.r)(this,"streams",{hasAudio:!1,hasVideo:!1})}},{key:"_reportStreams",value:function(e){var t,i=null==e?void 0:e.split(",");(0,f.r)(this,"streams",{hasAudio:null!==(t=null==i?void 0:i.includes("mp4a"))&&void 0!==t&&t,hasVideo:null!=i&&i.includes("mp4a")?(null==i?void 0:i.length)>1:Boolean(null==i?void 0:i.length)})}},{key:"_loadedData",value:function(){(0,f.r)(this,"load")}}]);var o,p,y,I,C}(v.WF);I.streamCount=0,I.styles=(0,v.AH)(o||(o=w`:host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}.fatal{display:block;padding:100px 16px}.retry{display:block}`)),(0,p.__decorate)([(0,y.MZ)({attribute:!1})],I.prototype,"hass",void 0),(0,p.__decorate)([(0,y.MZ)()],I.prototype,"entityid",void 0),(0,p.__decorate)([(0,y.MZ)()],I.prototype,"url",void 0),(0,p.__decorate)([(0,y.MZ)({attribute:"poster-url"})],I.prototype,"posterUrl",void 0),(0,p.__decorate)([(0,y.MZ)({attribute:!1})],I.prototype,"aspectRatio",void 0),(0,p.__decorate)([(0,y.MZ)({attribute:!1})],I.prototype,"fitMode",void 0),(0,p.__decorate)([(0,y.MZ)({type:Boolean,attribute:"controls"})],I.prototype,"controls",void 0),(0,p.__decorate)([(0,y.MZ)({type:Boolean,attribute:"muted"})],I.prototype,"muted",void 0),(0,p.__decorate)([(0,y.MZ)({type:Boolean,attribute:"autoplay"})],I.prototype,"autoPlay",void 0),(0,p.__decorate)([(0,y.MZ)({type:Boolean,attribute:"playsinline"})],I.prototype,"playsInline",void 0),(0,p.__decorate)([(0,y.MZ)({type:Boolean,attribute:"allow-exoplayer"})],I.prototype,"allowExoPlayer",void 0),(0,p.__decorate)([(0,y.P)("video")],I.prototype,"_videoEl",void 0),(0,p.__decorate)([(0,y.wk)()],I.prototype,"_error",void 0),(0,p.__decorate)([(0,y.wk)()],I.prototype,"_errorIsFatal",void 0),(0,p.__decorate)([(0,y.wk)()],I.prototype,"_url",void 0),I=(0,p.__decorate)([(0,y.EM)("ha-hls-player")],I)},73275:function(e,t,i){i.d(t,{e:function(){return a}});var a=e=>`/api/image_proxy/${e.entity_id}?token=${e.attributes.access_token}&state=${e.state}`},25100:function(e,t,i){i.a(e,async function(e,t){try{var a=i(98735),r=i(88486),s=i(62020),o=i(31802),n=i(21101),l=i(23180),d=i(87426),c=(i(38606),i(96956),i(79827),i(65315),i(837),i(22416),i(29726),i(45519),i(30536),i(69868)),h=i(84922),_=i(11991),u=i(75907),p=i(48893),v=i(23800),y=i(88341),m=i(72010),g=(i(65954),i(96635)),f=i(63375),b=i(14523),k=i(73275),w=i(84432),I=e([g]);g=(I.then?(await I)():I)[0];var C,S,E,A,M,$,R=e=>e,U=function(e){function t(){var e;(0,s.A)(this,t);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=(0,n.A)(this,t,[].concat(a)))._imageVisible=!1,e._resolvedStateImages={},e._ratio=null,e}return(0,l.A)(t,e),(0,o.A)(t,[{key:"connectedCallback",value:function(){(0,d.A)(t,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=1),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{key:"disconnectedCallback",value:function(){(0,d.A)(t,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{key:"handleIntersectionCallback",value:function(e){this._imageVisible=e[0].isIntersecting}},{key:"willUpdate",value:function(e){if(e.has("hass")){var t=e.get("hass");this._shouldStartCameraUpdates(t)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=1,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}e.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),e.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,m.A)(this.aspectRatio):null),1!==this._loadState||this.cameraImage||(this._loadState=2);var i=e.has("hass")&&!e.get("hass");this.hass&&(e.has("image")||i)&&(this.image&&(0,w.St)(this.image)?(0,w.A1)(this.hass,this.image).then(e=>{this._resolvedImageSrc=e.url}):this._resolvedImageSrc=this.image),this.hass&&(e.has("darkModeImage")||i)&&(this.darkModeImage&&(0,w.St)(this.darkModeImage)?(0,w.A1)(this.hass,this.darkModeImage).then(e=>{this._resolvedDarkModeImageSrc=e.url}):this._resolvedDarkModeImageSrc=this.darkModeImage),(e.has("stateImage")||i)&&(this._resolvedStateImages={},Object.entries(this.stateImage||{}).forEach(e=>{var t=e[0],i=e[1],a="object"==typeof i&&i.media_content_id||i;(0,w.St)(a)?(0,w.A1)(this.hass,a).then(e=>{this._resolvedStateImages=Object.assign(Object.assign({},this._resolvedStateImages),{},{[t]:e.url})}):this._resolvedStateImages[t]=a}))}},{key:"render",value:function(){if(!this.hass)return h.s6;var e,t,i=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),a=this.entity?this.hass.states[this.entity]:void 0,r=a?a.state:b.Hh,s=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?t=this.hass.states[this.cameraImage]:e=this._cameraImageSrc;else if(this.stateImage){var o=this._resolvedStateImages[r];o?e=o:(e=this._resolvedImageSrc,s=!0)}else e=this.darkModeImage&&this.hass.themes.darkMode?this._resolvedDarkModeImageSrc:a&&"image"===(0,y.m)(a.entity_id)?(0,k.e)(a):this._resolvedImageSrc;e&&(e=this.hass.hassUrl(e));var n=this.filter||"";(this.hass.themes.darkMode&&this.darkModeFilter&&(n+=this.darkModeFilter),this.stateFilter&&this.stateFilter[r]&&(n+=this.stateFilter[r]),!n&&this.entity)&&(n=(!a||v.jj.includes(r))&&s?"grayscale(100%)":"");return(0,h.qy)(C||(C=R` <div style="${0}" class="container ${0}"> ${0} ${0} </div> `),(0,p.W)({paddingBottom:i?`${(100*this._ratio.h/this._ratio.w).toFixed(2)}%`:void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:i&&this._loadedImageSrc?`url("${this._loadedImageSrc}")`:void 0,filter:2===this._loadState||"live"===this.cameraView?n:void 0}),(0,u.H)({ratio:i||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode}),this.cameraImage&&"live"===this.cameraView?(0,h.qy)(S||(S=R` <ha-camera-stream muted .hass="${0}" .stateObj="${0}" .fitMode="${0}" .aspectRatio="${0}" @load="${0}"></ha-camera-stream> `),this.hass,t,this.fitMode,this._ratio?this._ratio.w/this._ratio.h:void 0,this._onVideoLoad):void 0===e?h.s6:(0,h.qy)(E||(E=R` <img id="image" src="${0}" alt="${0}" @error="${0}" @load="${0}" style="${0}"> `),e,this.entity||"",this._onImageError,this._onImageLoad,(0,p.W)({display:i||2===this._loadState?"block":"none"})),3===this._loadState?(0,h.qy)(A||(A=R`<div id="brokenImage" style="${0}"></div>`),(0,p.W)({height:i?void 0:`${this._lastImageHeight}px`||"100%"})):"live"===this.cameraView||void 0!==e&&1!==this._loadState?"":(0,h.qy)(M||(M=R`<div class="progress-container" style="${0}"> <ha-spinner class="render-spinner" size="small"></ha-spinner> </div>`),(0,p.W)({height:i?void 0:`${this._lastImageHeight}px`||"100%"})))}},{key:"_shouldStartCameraUpdates",value:function(e){return!(e&&e.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{key:"_startUpdateCameraInterval",value:function(){this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval(()=>this._updateCameraImageSrcAtInterval(),1e4))}},{key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{key:"_onImageError",value:function(){this._loadState=3}},{key:"_onImageLoad",value:(g=(0,r.A)((0,a.A)().m(function e(t){var i;return(0,a.A)().w(function(e){for(;;)switch(e.n){case 0:return this._loadState=2,i=t.target,this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=i.src),e.n=1,this.updateComplete;case 1:this._lastImageHeight=i.offsetHeight;case 2:return e.a(2)}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"_onVideoLoad",value:(_=(0,r.A)((0,a.A)().m(function e(t){var i;return(0,a.A)().w(function(e){for(;;)switch(e.n){case 0:return this._loadState=2,i=t.currentTarget,e.n=1,this.updateComplete;case 1:this._lastImageHeight=i.offsetHeight;case 2:return e.a(2)}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"_updateCameraImageSrcAtInterval",value:(c=(0,r.A)((0,a.A)().m(function e(){return(0,a.A)().w(function(e){for(;;)if(0===e.n)return 1===this._loadState&&this._onImageError(),e.a(2,this._updateCameraImageSrc())},e,this)})),function(){return c.apply(this,arguments)})},{key:"_updateCameraImageSrc",value:(i=(0,r.A)((0,a.A)().m(function e(){var t,i,r;return(0,a.A)().w(function(e){for(;;)switch(e.n){case 0:if(this.hass&&this.cameraImage){e.n=1;break}return e.a(2);case 1:if(this.hass.states[this.cameraImage]){e.n=2;break}return this._onImageError(),e.a(2);case 2:return t=this.clientWidth||640,i=Math.ceil(t*devicePixelRatio),this._lastImageHeight?r=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?r=Math.ceil(i*(this._ratio.h/this._ratio.w)):(i*=2,r=Math.ceil(.5625*i)),e.n=3,(0,f.C4)(this.hass,this.cameraImage,i,r);case 3:this._cameraImageSrc=e.v,void 0===this._cameraImageSrc&&this._onImageError();case 4:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})}]);var i,c,_,g}(h.WF);U.styles=(0,h.AH)($||($=R`:host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}ha-camera-stream{display:block;height:100%;width:100%}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}`)),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"hass",void 0),(0,c.__decorate)([(0,_.MZ)()],U.prototype,"entity",void 0),(0,c.__decorate)([(0,_.MZ)()],U.prototype,"image",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"stateImage",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"cameraImage",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"cameraView",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"aspectRatio",void 0),(0,c.__decorate)([(0,_.MZ)()],U.prototype,"filter",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"stateFilter",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"darkModeImage",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:!1})],U.prototype,"darkModeFilter",void 0),(0,c.__decorate)([(0,_.MZ)({attribute:"fit-mode",type:String})],U.prototype,"fitMode",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_imageVisible",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_loadState",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_cameraImageSrc",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_loadedImageSrc",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_resolvedImageSrc",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_resolvedDarkModeImageSrc",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_resolvedStateImages",void 0),(0,c.__decorate)([(0,_.wk)()],U.prototype,"_lastImageHeight",void 0),U=(0,c.__decorate)([(0,_.EM)("hui-image")],U),t()}catch(O){t(O)}})}}]);
//# sourceMappingURL=78525.bf44ca6b492e8246.js.map