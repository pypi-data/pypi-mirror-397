"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["61389"],{8795:function(e,t,o){o.d(t,{i:function(){return r}});var n=o(35297),r=(e,t)=>(e=>{switch(e){case"de":case"lb":return!0;default:return!1}})(t)?(0,n.Z)(e):e.toLocaleLowerCase(t)},13725:function(e,t,o){o.a(e,async function(e,n){try{o.d(t,{$O:function(){return f},a$:function(){return y},cj:function(){return g},dG:function(){return m},gM:function(){return k},gd:function(){return p},rc:function(){return w}});var r=o(98735),i=o(88486),s=(o(79827),o(45519),o(5934),o(67579),o(47849),o(30500),o(23800)),a=o(88341),c=o(12275),u=o(8795),l=o(14523),_=o(69006),d=e([_]);_=(d.then?(await d)():d)[0];var h="ui.components.logbook.messages",g=["counter","proximity"],b={triggered_by_numeric_state_of:"numeric state of",triggered_by_state_of:"state of",triggered_by_event:"event",triggered_by_time_pattern:"time pattern",triggered_by_time:"time",triggered_by_homeassistant_stopping:"GiToon stopping",triggered_by_homeassistant_starting:"GiToon starting"},p=59509==o.j?($=(0,i.A)((0,r.A)().m(function e(t,o,n){return(0,r.A)().w(function(e){for(;;)if(0===e.n)return e.a(2,v(t,o,void 0,void 0,n))},e)})),function(e,t,o){return $.apply(this,arguments)}):null,v=(e,t,o,n,r,i)=>{if((n||i)&&(!n||0===n.length)&&(!i||0===i.length))return Promise.resolve([]);var s={type:"logbook/get_events",start_time:t};return o&&(s.end_time=o),null!=n&&n.length&&(s.entity_ids=n),null!=i&&i.length&&(s.device_ids=i),r&&(s.context_id=r),e.callWS(s)},k=(e,t,o,n,r,i,s)=>{if((i||s)&&(!i||0===i.length)&&(!s||0===s.length))return Promise.reject("No entities or devices");var a={type:"logbook/event_stream",start_time:o,end_time:n};return null!=i&&i.length&&(a.entity_ids=i),null!=s&&s.length&&(a.device_ids=s),e.connection.subscribeMessage(e=>t(e,r),a)},m=(e,t)=>({entity_id:e.entity_id,state:t,attributes:{device_class:null==e?void 0:e.attributes.device_class,source_type:null==e?void 0:e.attributes.source_type,has_date:null==e?void 0:e.attributes.has_date,has_time:null==e?void 0:e.attributes.has_time,entity_picture_local:s.oL.has((0,a.m)(e.entity_id))||null==e?void 0:e.attributes.entity_picture_local,entity_picture:s.oL.has((0,a.m)(e.entity_id))||null==e?void 0:e.attributes.entity_picture}}),f=(e,t)=>{for(var o=0,n=Object.keys(b);o<n.length;o++){var r=n[o],i=b[r];if(t.startsWith(i))return t.replace(i,`${e(`ui.components.logbook.${r}`)}`)}return t},y=(e,t,o,n,r)=>{switch(r){case"device_tracker":case"person":return"not_home"===o?t(`${h}.was_away`):"home"===o?t(`${h}.was_at_home`):t(`${h}.was_at_state`,{state:o});case"sun":return t("above_horizon"===o?`${h}.rose`:`${h}.set`);case"binary_sensor":var i=o===s.Or,a=o===s.qg,c=n.attributes.device_class;if(c&&(i||a))return t(`${h}.${i?"detected_device_classes":"cleared_device_classes"}.${c}`,{device_class:(0,u.i)(t(`component.binary_sensor.entity_component.${c}.name`)||c,e.language)})||t(`${h}.${i?"detected_device_class":"cleared_device_class"}`,{device_class:(0,u.i)(t(`component.binary_sensor.entity_component.${c}.name`)||c,e.language)});break;case"cover":switch(o){case"open":return t(`${h}.was_opened`);case"opening":return t(`${h}.is_opening`);case"closing":return t(`${h}.is_closing`);case"closed":return t(`${h}.was_closed`)}break;case"event":return t(`${h}.detected_event_no_type`);case"lock":switch(o){case"unlocked":return t(`${h}.was_unlocked`);case"locking":return t(`${h}.is_locking`);case"unlocking":return t(`${h}.is_unlocking`);case"opening":return t(`${h}.is_opening`);case"open":return t(`${h}.is_opened`);case"locked":return t(`${h}.was_locked`);case"jammed":return t(`${h}.is_jammed`)}}return o===s.Or?t(`${h}.turned_on`):o===s.qg?t(`${h}.turned_off`):o===l.HV?t(`${h}.became_unknown`):o===l.Hh?t(`${h}.became_unavailable`):e.localize(`${h}.changed_to_state`,{state:n?e.formatEntityState(n,o):o})},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=(0,c.t)(e);return!(g.includes(o)||"sensor"===o&&(0,_.Fp)(o,e,void 0,t))};n()}catch(E){n(E)}var $})},3676:function(e,t,o){o.a(e,async function(e,t){try{var n=o(18202),r=o(98735),i=o(88486),s=o(73983),a=o(62020),c=o(31802),u=o(21101),l=o(23180),_=o(87426),d=(o(46852),o(38606),o(96956),o(79827),o(99342),o(89958),o(35058),o(65315),o(837),o(22416),o(59023),o(45519),o(74774),o(30536),o(69868)),h=o(84922),g=o(11991),b=o(26946),p=o(12275),v=o(65298),k=o(96635),m=o(13725),f=o(26399),y=o(73779),w=o(94806),$=o(47225),E=e([k,w,m]);[k,w,m]=E.then?(await E)():E;var A,L,I,M,T,S=e=>e,x=(e,t)=>new Date(e.getTime()-1e3*t).getTime()/1e3,C=(e,t)=>(void 0!==e||void 0!==t)&&(!e||!t||e.length!==t.length||e.some(e=>!t.includes(e))||t.some(t=>!e.includes(t))),B=function(e){function t(){var e;(0,a.A)(this,t);for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];return(e=(0,u.A)(this,t,[].concat(c))).narrow=!1,e.virtualize=!1,e.noIcon=!1,e.noName=!1,e.showIndicator=!1,e.relativeTime=!1,e.showMoreLink=!0,e._traceContexts={},e._userIdToName={},e._liveUpdatesEnabled=!0,e._pendingStreamMessages=[],e._throttleGetLogbookEntries=(0,v.n)(()=>e._getLogBookData(),1e3),e._logbookSubscriptionId=0,e._nonExpiredRecords=t=>e._logbookEntries?t?e._logbookEntries.filter(e=>e.when>t):e._logbookEntries:[],e._processOrQueueStreamMessage=t=>{e._liveUpdatesEnabled?e._processStreamMessage(t):e._pendingStreamMessages.push(t)},e._processStreamMessage=t=>{var o="recent"in e.time?x(new Date,e.time.recent):void 0,n=(0,s.A)(t.events).reverse();if(e._logbookEntries&&e._logbookEntries.length){if(n.length){var r=e._nonExpiredRecords(o);r.length?n[n.length-1].when>r[0].when?e._logbookEntries=n.concat(r):r[r.length-1].when>n[0].when?e._logbookEntries=r.concat(n):e._logbookEntries=r.concat(n).sort((e,t)=>t.when-e.when):e._logbookEntries=n}}else e._logbookEntries=n},e._updateTraceContexts=(0,v.n)((0,i.A)((0,r.A)().m(function t(){return(0,r.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,f.gq)(e.hass);case 1:e._traceContexts=t.v;case 2:return t.a(2)}},t)})),6e4),e._updateUsers=(0,v.n)((0,i.A)((0,r.A)().m(function t(){var o,i,s,a,c,u,l,_,d;return(0,r.A)().w(function(t){for(;;)switch(t.n){case 0:for(o={},i=(0,$.fe)(e.hass)&&(0,y.hU)(e.hass),s=0,a=Object.values(e.hass.states);s<a.length;s++)(c=a[s]).attributes.user_id&&"person"===(0,p.t)(c)&&(o[c.attributes.user_id]=c.attributes.friendly_name);if(!i){t.n=2;break}return t.n=1,i;case 1:u=t.v,l=(0,n.A)(u);try{for(l.s();!(_=l.n()).done;)(d=_.value).id in o||(o[d.id]=d.name)}catch(r){l.e(r)}finally{l.f()}case 2:e._userIdToName=o;case 3:return t.a(2)}},t)})),6e4),e}return(0,l.A)(t,e),(0,c.A)(t,[{key:"render",value:function(){return(0,b.x)(this.hass,"logbook")?this._error?(0,h.qy)(A||(A=S`<div class="no-entries"> ${0} </div>`),`${this.hass.localize("ui.components.logbook.retrieval_error")}: ${this._error}`):void 0===this._logbookEntries?(0,h.qy)(L||(L=S` <div class="progress-wrapper"> <ha-spinner></ha-spinner> </div> `)):0===this._logbookEntries.length?(0,h.qy)(I||(I=S`<div class="no-entries"> ${0} </div>`),this.hass.localize("ui.components.logbook.entries_not_found")):(0,h.qy)(M||(M=S` <ha-logbook-renderer .hass="${0}" .narrow="${0}" .virtualize="${0}" .noIcon="${0}" .noName="${0}" .showIndicator="${0}" .relativeTime="${0}" .entries="${0}" .traceContexts="${0}" .userIdToName="${0}" @hass-logbook-live="${0}"></ha-logbook-renderer> `),this.hass,this.narrow,this.virtualize,this.noIcon,this.noName,this.showIndicator,this.relativeTime,this._logbookEntries,this._traceContexts,this._userIdToName,this._handleLogbookLive):h.s6}},{key:"refresh",value:(g=(0,i.A)((0,r.A)().m(function e(){var t,o=arguments;return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:if((t=o.length>0&&void 0!==o[0]&&o[0])||!this._unsubLogbook&&void 0!==this._logbookEntries){e.n=1;break}return e.a(2);case 1:this._throttleGetLogbookEntries.cancel(),this._updateTraceContexts.cancel(),this._updateUsers.cancel(),this._unsubscribe(!0),this._liveUpdatesEnabled=!0,t?this._getLogBookData():this._throttleGetLogbookEntries();case 2:return e.a(2)}},e,this)})),function(){return g.apply(this,arguments)})},{key:"shouldUpdate",value:function(e){if(1!==e.size||!e.has("hass"))return!0;var t=e.get("hass");return!t||t.localize!==this.hass.localize}},{key:"willUpdate",value:function(e){for(var t=e.has("time"),o=0,n=["entityIds","deviceIds"];o<n.length;o++){var r=n[o];if(e.has(r)){var i=e.get(r),s=this[r];if(C(i,s)){t=!0;break}}}t&&this.refresh(!0)}},{key:"_handleLogbookLive",value:function(e){e.detail.enable&&!this._liveUpdatesEnabled&&(this._pendingStreamMessages.forEach(e=>this._processStreamMessage(e)),this._pendingStreamMessages=[]),this._liveUpdatesEnabled=e.detail.enable}},{key:"_filterAlwaysEmptyResults",get:function(){var e=this.entityIds,t=this.deviceIds;return Boolean(e||t)&&(!e||0===e.length)&&(!t||0===t.length)}},{key:"_unsubscribe",value:function(e){this._unsubLogbook&&(this._unsubLogbook.then(e=>e()),this._unsubLogbook=void 0,this._logbookEntries=e?void 0:[],this._pendingStreamMessages=[])}},{key:"connectedCallback",value:function(){(0,_.A)(t,"connectedCallback",this,3)([]),this.hasUpdated&&this._subscribeLogbookPeriod(this._calculateLogbookPeriod())}},{key:"disconnectedCallback",value:function(){(0,_.A)(t,"disconnectedCallback",this,3)([]),this._unsubscribe(!0)}},{key:"_calculateLogbookPeriod",value:function(){var e=new Date;if("range"in this.time)return{now:e,startTime:this.time.range[0],endTime:this.time.range[1],purgeBeforePythonTime:void 0};if("recent"in this.time){var t=x(e,this.time.recent);return{now:e,startTime:new Date(1e3*t),endTime:new Date(e.getTime()+31536e6),purgeBeforePythonTime:x(e,this.time.recent)}}throw new Error("Unexpected time specified")}},{key:"_subscribeLogbookPeriod",value:(d=(0,i.A)((0,r.A)().m(function e(t){var o;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this._unsubLogbook){e.n=1;break}return e.a(2);case 1:return e.p=1,this._logbookSubscriptionId++,this._unsubLogbook=(0,m.gM)(this.hass,(e,t)=>{t===this._logbookSubscriptionId&&this._processOrQueueStreamMessage(e)},t.startTime.toISOString(),t.endTime.toISOString(),this._logbookSubscriptionId,this.entityIds,this.deviceIds),e.n=2,this._unsubLogbook;case 2:e.n=4;break;case 3:e.p=3,o=e.v,this._unsubLogbook=void 0,this._error=o;case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return d.apply(this,arguments)})},{key:"_getLogBookData",value:(o=(0,i.A)((0,r.A)().m(function e(){var t;return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:if(this._error=void 0,!this._filterAlwaysEmptyResults){e.n=1;break}return this._unsubscribe(!1),e.a(2);case 1:if(!((t=this._calculateLogbookPeriod()).startTime>t.now)){e.n=2;break}return this._unsubscribe(!1),e.a(2);case 2:this._updateUsers(),(0,$.fe)(this.hass)&&this._updateTraceContexts(),this._subscribeLogbookPeriod(t);case 3:return e.a(2)}},e,this)})),function(){return o.apply(this,arguments)})}],[{key:"styles",get:function(){return[(0,h.AH)(T||(T=S`:host{display:block}:host([virtualize]){height:100%}.no-entries{text-align:center;padding:16px;color:var(--secondary-text-color)}.progress-wrapper{display:flex;justify-content:center;height:100%;align-items:center}`))]}}]);var o,d,g}(h.WF);(0,d.__decorate)([(0,g.MZ)({attribute:!1})],B.prototype,"hass",void 0),(0,d.__decorate)([(0,g.MZ)({attribute:!1})],B.prototype,"time",void 0),(0,d.__decorate)([(0,g.MZ)({attribute:!1})],B.prototype,"entityIds",void 0),(0,d.__decorate)([(0,g.MZ)({attribute:!1})],B.prototype,"deviceIds",void 0),(0,d.__decorate)([(0,g.MZ)({type:Boolean})],B.prototype,"narrow",void 0),(0,d.__decorate)([(0,g.MZ)({type:Boolean,reflect:!0})],B.prototype,"virtualize",void 0),(0,d.__decorate)([(0,g.MZ)({type:Boolean,attribute:"no-icon"})],B.prototype,"noIcon",void 0),(0,d.__decorate)([(0,g.MZ)({type:Boolean,attribute:"no-name"})],B.prototype,"noName",void 0),(0,d.__decorate)([(0,g.MZ)({type:Boolean,attribute:"show-indicator"})],B.prototype,"showIndicator",void 0),(0,d.__decorate)([(0,g.MZ)({type:Boolean,attribute:"relative-time"})],B.prototype,"relativeTime",void 0),(0,d.__decorate)([(0,g.MZ)({attribute:"show-more-link",type:Boolean})],B.prototype,"showMoreLink",void 0),(0,d.__decorate)([(0,g.wk)()],B.prototype,"_logbookEntries",void 0),(0,d.__decorate)([(0,g.wk)()],B.prototype,"_traceContexts",void 0),(0,d.__decorate)([(0,g.wk)()],B.prototype,"_userIdToName",void 0),(0,d.__decorate)([(0,g.wk)()],B.prototype,"_error",void 0),B=(0,d.__decorate)([(0,g.EM)("ha-logbook")],B),t()}catch(U){t(U)}})}}]);
//# sourceMappingURL=61389.6aefbd455789634c.js.map