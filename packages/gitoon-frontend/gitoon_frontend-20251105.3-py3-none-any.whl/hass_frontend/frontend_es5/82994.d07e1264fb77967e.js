"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["82994"],{73097:function(t,i,e){e.a(t,async function(t,s){try{e.r(i),e.d(i,{DEFAULT_DAYS_TO_SHOW:function(){return C},HuiStatisticsGraphCard:function(){return I}});var n=e(98735),a=e(88486),r=e(62020),h=e(31802),o=e(21101),c=e(23180),_=e(87426),d=(e(46852),e(38606),e(44941),e(35748),e(80178),e(65315),e(84136),e(22416),e(37089),e(45519),e(74774),e(5934),e(30536),e(95013),e(69868)),u=e(41484),l=e(4494),g=e(84922),y=e(11991),f=e(75907),v=(e(70490),e(43716)),p=e(63002),m=e(87916),b=e(44630),k=e(8510),w=e(38177),S=e(36886),E=t([v,S,p]);[v,S,p]=E.then?(await E)():E;var A,$,T,x=t=>t,C=30,I=function(t){function i(){var t;(0,r.A)(this,i);for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return(t=(0,o.A)(this,i,[].concat(s)))._entities=[],t._entityIds=[],t._names={},t}return(0,c.A)(i,t),(0,h.A)(i,[{key:"disconnectedCallback",value:function(){(0,_.A)(i,"disconnectedCallback",this,3)([]),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}},{key:"connectedCallback",value:function(){var t;(0,_.A)(i,"connectedCallback",this,3)([]),this.hasUpdated&&(null!==(t=this._config)&&void 0!==t&&t.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}},{key:"_subscribeEnergy",value:function(){var t;this._energySub||(this._energySub=(0,v.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()}))}},{key:"_unsubscribeEnergy",value:function(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}},{key:"getCardSize",value:function(){var t,i,e;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(i=this._config)&&void 0!==i&&i.hide_legend?0:(null===(e=this._entities)||void 0===e?void 0:e.length)||0)}},{key:"getGridOptions",value:function(){return{columns:12,min_columns:6,min_rows:3}}},{key:"setConfig",value:function(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");this._entities=t.entities?(0,w.L)(t.entities,!1):[],this._entityIds=this._entities.map(t=>t.entity),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t,this._computeNames()}},{key:"_computeNames",value:function(){this.hass&&this._config&&(this._names={},this._entities.forEach(t=>{var i=this.hass.states[t.entity];this._names[t.entity]=(0,m.v)(this.hass,i,t.name)||t.entity}))}},{key:"shouldUpdate",value:function(t){return(0,k.pY)(this,t)||t.size>1||!t.has("hass")}},{key:"willUpdate",value:function(t){if((0,_.A)(i,"willUpdate",this,3)([t]),this._config&&t.has("_config")){var e=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&(null==e?void 0:e.collection_key)!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("hass")&&this._computeNames(),t.has("_config")&&(null==e?void 0:e.entities)!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||(null==e?void 0:e.stat_types)===this._config.stat_types&&(null==e?void 0:e.days_to_show)===this._config.days_to_show&&(null==e?void 0:e.period)===this._config.period&&(null==e?void 0:e.unit)===this._config.unit||this._setFetchStatisticsTimer()}}},{key:"_setFetchStatisticsTimer",value:(E=(0,a.A)((0,n.A)().m(function t(){var i,e,s=arguments;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:if(e=s.length>0&&void 0!==s[0]&&s[0],clearInterval(this._interval),this._interval=0,!e){t.n=1;break}return t.n=1,this._getStatisticsMetaData(this._entityIds);case 1:return t.n=2,this._getStatistics();case 2:null!==(i=this._config)&&void 0!==i&&i.energy_date_selection||(this._interval=window.setInterval(()=>this._getStatistics(),this._intervalTimeout));case 3:return t.a(2)}},t,this)})),function(){return E.apply(this,arguments)})},{key:"_period",get:function(){var t,i;return null!==(t=null===(i=this._config)||void 0===i?void 0:i.period)&&void 0!==t?t:this._energyStart&&this._energyEnd?(0,S.TI)((0,u.c)(this._energyEnd,this._energyStart)):void 0}},{key:"render",value:function(){var t,i;if(!this.hass||!this._config)return g.s6;var e="number"==typeof(null===(t=this._config.grid_options)||void 0===t?void 0:t.rows);return(0,g.qy)(A||(A=x` <ha-card> ${0} <div class="content ${0}"> <statistics-chart .hass="${0}" .isLoadingData="${0}" .statisticsData="${0}" .metadata="${0}" .period="${0}" .chartType="${0}" .statTypes="${0}" .names="${0}" .unit="${0}" .minYAxis="${0}" .maxYAxis="${0}" .startTime="${0}" .endTime="${0}" .fitYData="${0}" .hideLegend="${0}" .logarithmicScale="${0}" .daysToShow="${0}" .height="${0}" .expandLegend="${0}"></statistics-chart> </div> </ha-card> `),this._config.title?(0,g.qy)($||($=x`<h1 class="card-header">${0}</h1>`),this._config.title):g.s6,(0,f.H)({"has-header":!!this._config.title,"has-rows":!(null===(i=this._config.grid_options)||void 0===i||!i.rows)}),this.hass,!this._statistics,this._statistics,this._metadata,this._period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._energyStart,this._energyEnd&&this._energyStart?(0,S.Gs)((0,u.c)(this._energyEnd,this._energyStart),this._energyEnd):void 0,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1,this._energyStart&&this._energyEnd?(0,u.c)(this._energyEnd,this._energyStart):this._config.days_to_show||C,e?"100%":void 0,this._config.expand_legend)}},{key:"_intervalTimeout",get:function(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}},{key:"_getStatisticsMetaData",value:(y=(0,a.A)((0,n.A)().m(function t(i){var e,s;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,p.Wr)(this.hass,i);case 1:e=t.v,s={},e.forEach(t=>{s[t.statistic_id]=t}),this._metadata=s;case 2:return t.a(2)}},t,this)})),function(t){return y.apply(this,arguments)})},{key:"_getStatistics",value:(d=(0,a.A)((0,n.A)().m(function t(){var i,e,s,a,r,h,o,c;return(0,n.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:return e=null!==(i=this._energyStart)&&void 0!==i?i:(0,l.O)(new Date,24*(this._config.days_to_show||C)+1),s=this._energyEnd,t.p=1,this._config.unit&&this._metadata&&(r=Object.values(this._metadata).find(t=>(0,p.JE)(this.hass,null==t?void 0:t.statistic_id,t)===this._config.unit))&&(a=r.unit_class,this._unit=this._config.unit),!a&&this._metadata&&(h=this._metadata[this._entityIds[0]],a=null==h?void 0:h.unit_class,this._unit=a&&(0,p.JE)(this.hass,h.statistic_id,h)||void 0),o=a?{[a]:this._unit}:void 0,t.n=2,(0,p.sz)(this.hass,e,s,this._entityIds,this._period,o,this._statTypes);case 2:c=t.v,this._statistics={},this._entities.forEach(t=>{var i=t.entity;i in c&&(this._statistics[i]=c[i])}),t.n=4;break;case 3:t.p=3,t.v,this._statistics=void 0;case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return d.apply(this,arguments)})}],[{key:"getConfigElement",value:(s=(0,a.A)((0,n.A)().m(function t(){return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Promise.all([e.e("42153"),e.e("30199"),e.e("37620"),e.e("11015"),e.e("37563"),e.e("61717"),e.e("55038"),e.e("18983"),e.e("12183"),e.e("70175")]).then(e.bind(e,39788));case 1:return t.a(2,document.createElement("hui-statistics-graph-card-editor"))}},t)})),function(){return s.apply(this,arguments)})},{key:"getStubConfig",value:function(t,i,e){var s=(0,b.B)(t,1,i,e,["sensor"],t=>"state_class"in t.attributes);return{type:"statistics-graph",entities:s.length?[s[0]]:[]}}}]);var s,d,y,E}(g.WF);I.styles=(0,g.AH)(T||(T=x`ha-card{display:flex;flex-direction:column;height:100%}.card-header{padding-bottom:0}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}`)),(0,d.__decorate)([(0,y.MZ)({attribute:!1})],I.prototype,"hass",void 0),(0,d.__decorate)([(0,y.wk)()],I.prototype,"_config",void 0),(0,d.__decorate)([(0,y.wk)()],I.prototype,"_statistics",void 0),(0,d.__decorate)([(0,y.wk)()],I.prototype,"_metadata",void 0),(0,d.__decorate)([(0,y.wk)()],I.prototype,"_unit",void 0),(0,d.__decorate)([(0,y.wk)()],I.prototype,"_energyStart",void 0),(0,d.__decorate)([(0,y.wk)()],I.prototype,"_energyEnd",void 0),I=(0,d.__decorate)([(0,y.EM)("hui-statistics-graph-card")],I),s()}catch(D){s(D)}})}}]);
//# sourceMappingURL=82994.d07e1264fb77967e.js.map