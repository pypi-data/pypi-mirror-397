"use strict";(self.webpackChunkgitoon_frontend=self.webpackChunkgitoon_frontend||[]).push([["19348"],{94327:function(e,t,a){a.d(t,{Vy:function(){return o},fI:function(){return s},ux:function(){return l}});a(80178),a(45519);var r=a(65940),i=a(83510),n=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function o(e){return n[e%n.length]}function s(e,t){var a=t.getPropertyValue(`--graph-color-${e+1}`)||o(e);return(0,i.RQ)(a)}var l=(0,r.A)(e=>n.map((t,a)=>s(a,e)),(e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1"))},37382:function(e,t,a){a.d(t,{D:function(){return n}});var r=a(10416),i=a.n(r),n=e=>i()(e,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},80475:function(e,t,a){a.a(e,async function(e,t){try{var r=a(73983),i=a(62020),n=a(31802),o=a(97750),s=a(21101),l=a(23180),d=(a(38606),a(96956),a(44941),a(74048),a(91949),a(35748),a(80178),a(99342),a(9724),a(35058),a(41846),a(65315),a(837),a(84136),a(22416),a(37089),a(48169),a(34285),a(45519),a(64587),a(88238),a(34536),a(16257),a(20152),a(44711),a(72108),a(77030),a(30536),a(95013),a(69868)),u=a(11991),c=a(84922),h=a(65940),v=a(88006),f=a(8147),p=a(35083),g=a(37382),y=a(68717),_=a(83034),b=(a(94124),e([y,v]));[y,v]=b.then?(await b)():b;var m,x,k=e=>e,z=function(e){function t(){var e;(0,i.A)(this,t);for(var a=arguments.length,n=new Array(a),l=0;l<a;l++)n[l]=arguments[l];return(e=(0,s.A)(this,t,[].concat(n))).data={nodes:[],links:[]},e.vertical=!1,e._sizeController=new v.P((0,o.A)(e),{callback:e=>{var t;return null===(t=e[0])||void 0===t?void 0:t.contentRect}}),e._renderTooltip=t=>{var a=t.data,r=e.valueFormatter?e.valueFormatter(a.value):a.value;if(a.id){var i,n=e.data.nodes.find(e=>e.id===a.id);return`${t.marker} ${(0,g.D)(null!==(i=null==n?void 0:n.label)&&void 0!==i?i:a.id)}<br>${r}`}if(a.source&&a.target){var o,s,l=e.data.nodes.find(e=>e.id===a.source),d=e.data.nodes.find(e=>e.id===a.target);return`${(0,g.D)(null!==(o=null==l?void 0:l.label)&&void 0!==o?o:a.source)} → ${(0,g.D)(null!==(s=null==d?void 0:d.label)&&void 0!==s?s:a.target)}<br>${r}`}return null},e._createData=(0,h.A)(function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=t.nodes.filter(e=>e.value>0),n=(0,r.A)(new Set(i.map(e=>e.index))).sort(),o=new Map,s=[];n.forEach((a,r)=>{o.set(a,r);var n=i.filter(e=>e.index===a);n.length>0&&s.push(s.length>0?n.sort((a,r)=>{var i=e._findParentIndex(a.id,t.links,s),n=e._findParentIndex(r.id,t.links,s);return i===n?0:-1===i?1:-1===n?-1:i-n}):n)});var l=e._processLinks(i,t.links),d=a/n.length-_.hD-5;return{id:"sankey",type:"sankey",nodes:s.flat().map(e=>({id:e.id,value:e.value,itemStyle:{color:e.color},depth:o.get(e.index)})),links:l,draggable:!1,orient:e.vertical?"vertical":"horizontal",nodeWidth:15,nodeGap:6,lineStyle:{color:"gradient",opacity:.4,curveness:.5},layoutIterations:0,label:{formatter:e=>{var a,r;return null!==(a=null===(r=t.nodes.find(t=>t.id===e.data.id))||void 0===r?void 0:r.label)&&void 0!==a?a:e.data.id},position:e.vertical?"bottom":"right",distance:5,minMargin:5,overflow:"break"},labelLayout:t=>{if(e.vertical){var a=t.text.split(" ").reduce((e,t)=>e.length>t.length?e:t,""),r=(0,p.W)(a,12),i=t.rect.width+6,n=Math.min(12,i/r*12);return{fontSize:n>1?n:0,width:i,align:"center",dy:-2}}var o=t.rect.height+8,s=Math.min(o/t.labelRect.height*12,12);return{fontSize:s,lineHeight:s,width:d,height:t.rect.height}},top:e.vertical?0:5,bottom:e.vertical?25:5,left:e.vertical?5:0,right:e.vertical?5:d+5,emphasis:{focus:"adjacency"}}}),e}return(0,l.A)(t,e),(0,n.A)(t,[{key:"render",value:function(){var e,t={grid:{top:0,bottom:0,left:0,right:0},tooltip:{trigger:"item",formatter:this._renderTooltip,appendTo:document.body}};return(0,c.qy)(m||(m=k`<ha-chart-base .data="${0}" .options="${0}" height="100%" .extraComponents="${0}"></ha-chart-base>`),this._createData(this.data,null===(e=this._sizeController.value)||void 0===e?void 0:e.width),t,[f.A])}},{key:"_processLinks",value:function(e,t){var a=new Map,r=new Map,i=[];return t.forEach(t=>{var n,o=e.find(e=>e.id===t.source),s=e.find(e=>e.id===t.target);if(o&&s){var l=r.get(o.id)||0,d=a.get(s.id)||0,u=o.value-l,c=s.value-d,h=Math.min(null!==(n=t.value)&&void 0!==n?n:u,u,c);a.set(s.id,d+h),r.set(o.id,l+h),h>0&&i.push(Object.assign(Object.assign({},t),{},{value:h}))}}),i}},{key:"_findParentIndex",value:function(e,t,a){var r,i=null===(r=t.find(t=>t.target===e))||void 0===r?void 0:r.source;if(!i)return-1;for(var n=0,o=a.length-1;o>=0;o--){var s=a[o],l=s.findIndex(e=>e.id===i);if(-1!==l)return n+l;n+=s.length}return-1}}])}(c.WF);z.styles=(0,c.AH)(x||(x=k`:host{display:block;flex:1;background:var(--ha-card-background,var(--card-background-color))}ha-chart-base{width:100%;height:100%}`)),(0,d.__decorate)([(0,u.MZ)({attribute:!1})],z.prototype,"hass",void 0),(0,d.__decorate)([(0,u.MZ)({attribute:!1})],z.prototype,"data",void 0),(0,d.__decorate)([(0,u.MZ)({type:Boolean})],z.prototype,"vertical",void 0),(0,d.__decorate)([(0,u.MZ)({type:String,attribute:!1})],z.prototype,"valueFormatter",void 0),(0,d.__decorate)([(0,u.wk)()],z.prototype,"_sizeController",void 0),z=(0,d.__decorate)([(0,u.EM)("ha-sankey-chart")],z),t()}catch(S){t(S)}})},71770:function(e,t,a){var r,i,n,o,s=a(62020),l=a(31802),d=a(21101),u=a(23180),c=a(87426),h=(a(38606),a(69868)),v=a(30103),f=a(86811),p=a(49377),g=a(34800),y=a(84922),_=a(11991),b=e=>e,m=function(e){function t(){var e;(0,s.A)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=(0,d.A)(this,t,[].concat(r))).filled=!1,e.active=!1,e}return(0,u.A)(t,e),(0,l.A)(t,[{key:"renderOutline",value:function(){return this.filled?(0,y.qy)(r||(r=b`<span class="filled"></span>`)):(0,c.A)(t,"renderOutline",this,3)([])}},{key:"getContainerClasses",value:function(){return Object.assign(Object.assign({},(0,c.A)(t,"getContainerClasses",this,3)([])),{},{active:this.active})}},{key:"renderPrimaryContent",value:function(){return(0,y.qy)(i||(i=b` <span class="leading icon" aria-hidden="true"> ${0} </span> <span class="label">${0}</span> <span class="touch"></span> <span class="trailing leading icon" aria-hidden="true"> ${0} </span> `),this.renderLeadingIcon(),this.label,this.renderTrailingIcon())}},{key:"renderTrailingIcon",value:function(){return(0,y.qy)(n||(n=b`<slot name="trailing-icon"></slot>`))}}])}(v.k);m.styles=[p.R,g.R,f.R,(0,y.AH)(o||(o=b`:host{--md-sys-color-primary:var(--primary-text-color);--md-sys-color-on-surface:var(--primary-text-color);--md-assist-chip-container-shape:var(
          --ha-assist-chip-container-shape,
          16px
        );--md-assist-chip-outline-color:var(--outline-color);--md-assist-chip-label-text-weight:400}.filled{display:flex;pointer-events:none;border-radius:inherit;inset:0;position:absolute;background-color:var(--ha-assist-chip-filled-container-color)}::slotted([slot=icon]),::slotted([slot=trailing-icon]){display:flex;--mdc-icon-size:var(--md-input-chip-icon-size, 18px);font-size:var(--_label-text-size)!important}.trailing.icon ::slotted(*),.trailing.icon svg{margin-inline-end:unset;margin-inline-start:var(--_icon-label-space)}::before{background:var(--ha-assist-chip-container-color,transparent);opacity:var(--ha-assist-chip-container-opacity, 1)}:where(.active)::before{background:var(--ha-assist-chip-active-container-color);opacity:var(--ha-assist-chip-active-container-opacity)}.label{font-family:var(--ha-font-family-body)}`))],(0,h.__decorate)([(0,_.MZ)({type:Boolean,reflect:!0})],m.prototype,"filled",void 0),(0,h.__decorate)([(0,_.MZ)({type:Boolean})],m.prototype,"active",void 0),m=(0,h.__decorate)([(0,_.EM)("ha-assist-chip")],m)},83034:function(e,t,a){a.d(t,{Es:function(){return r},dc:function(){return n},hD:function(){return i}});var r=10,i=30,n=20},63002:function(e,t,a){a.a(e,async function(e,r){try{a.d(t,{$3:function(){return _},$O:function(){return w},$j:function(){return b},ED:function(){return l},JE:function(){return E},OQ:function(){return I},PU:function(){return M},Ph:function(){return g},Uf:function(){return A},W1:function(){return y},Wr:function(){return v},Z:function(){return c},gF:function(){return m},iY:function(){return x},jU:function(){return d},nN:function(){return S},p3:function(){return h},pJ:function(){return p},r_:function(){return u},sz:function(){return f}});var i=a(18202),n=(a(79827),a(65315),a(59023),a(45519),a(72652)),o=a(50654),s=e([o]);o=(s.then?(await s)():s)[0];var l=function(e){return e[e.NONE=0]="NONE",e[e.ARITHMETIC=1]="ARITHMETIC",e[e.CIRCULAR=2]="CIRCULAR",e}({}),d=59509==a.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,u=["L","gal","ft³","m³","CCF","MCF"],c=e=>e.sendMessagePromise({type:"recorder/info"}),h=(e,t)=>e.callWS({type:"recorder/list_statistic_ids",statistic_type:t}),v=(e,t)=>e.callWS({type:"recorder/get_statistics_metadata",statistic_ids:t}),f=function(e,t,a,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"hour",n=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return e.callWS({type:"recorder/statistics_during_period",start_time:t.toISOString(),end_time:null==a?void 0:a.toISOString(),statistic_ids:r,period:i,units:n,types:o})},p=(e,t,a,r)=>e.callWS({type:"recorder/statistic_during_period",statistic_id:t,units:r,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar?Object.assign(Object.assign({},"week"===a.calendar.period?{first_weekday:(0,o.DD)(e.locale).substring(0,3)}:{}),a.calendar):void 0,rolling_window:a.rolling_window}),g=e=>e.callWS({type:"recorder/validate_statistics"}),y=(e,t,a,r)=>e.callWS({type:"recorder/update_statistics_metadata",statistic_id:t,unit_of_measurement:a,unit_class:r}),_=(e,t)=>e.callWS({type:"recorder/clear_statistics",statistic_ids:t}),b=e=>{var t=null;if(!e)return null;var a,r=(0,i.A)(e);try{for(r.s();!(a=r.n()).done;){var n=a.value;null!==n.change&&void 0!==n.change&&(null===t?t=n.change:t+=n.change)}}catch(o){r.e(o)}finally{r.f()}return t},m=(e,t)=>{var a,r=null,n=(0,i.A)(t);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(o in e){var s=b(e[o]);null!==s&&(null===r?r=s:r+=s)}}}catch(l){n.e(l)}finally{n.f()}return r},x=(e,t)=>e.some(e=>void 0!==e[t]&&null!==e[t]),k=["mean","min","max"],z=["sum","state","change"],S=(e,t)=>!(!k.includes(t)||0===e.mean_type)||!(!z.includes(t)||!e.has_sum),A=(e,t,a,r,i)=>{var n=new Date(a).toISOString();return e.callWS({type:"recorder/adjust_sum_statistics",statistic_id:t,start_time:n,adjustment:r,adjustment_unit_of_measurement:i})},w=(e,t,a)=>{var r=e.states[t];return r?(0,n.u)(r):(null==a?void 0:a.name)||t},E=(e,t,a)=>{var r,i;t&&(r=null===(i=e.states[t])||void 0===i?void 0:i.attributes.unit_of_measurement);return void 0===r?null==a?void 0:a.statistics_unit_of_measurement:r},I=e=>e.includes(":"),M=e=>e.callWS({type:"recorder/update_statistics_issues"});r()}catch(C){r(C)}})},75335:function(e,t,a){a.d(t,{Q:function(){return h}});var r=a(62020),i=a(31802),n=a(21101),o=a(23180),s=a(87426),l=(a(38606),a(69868)),d=a(11991),u=a(48125),c=a(32211),h=e=>{var t=function(e){function t(){var e;(0,r.A)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=(0,n.A)(this,t,[].concat(i)))._isMobileSize=!1,e._isMobileClient=u.M,e}return(0,o.A)(t,e),(0,i.A)(t,[{key:"connectedCallback",value:function(){(0,s.A)(t,"connectedCallback",this,3)([]),this._unsubMql=(0,c.m)("all and (max-width: 450px), all and (max-height: 500px)",e=>{this._isMobileSize=e})}},{key:"disconnectedCallback",value:function(){var e;(0,s.A)(t,"disconnectedCallback",this,3)([]),null===(e=this._unsubMql)||void 0===e||e.call(this),this._unsubMql=void 0}}])}(e);return(0,l.__decorate)([(0,d.wk)()],t.prototype,"_isMobileSize",void 0),t}},41970:function(e,t,a){a.a(e,async function(e,r){try{a.r(t);var i=a(73983),n=a(15243),o=a(62020),s=a(31802),l=a(21101),d=a(23180),u=(a(38606),a(96956),a(79827),a(99342),a(35058),a(86149),a(65315),a(22416),a(29726),a(45519),a(74774),a(39118),a(30536),a(69868)),c=a(84922),h=a(11991),v=(a(70490),a(86160),a(43716)),f=a(63002),p=a(40328),g=a(80475),y=a(94327),_=a(8868),b=a(73941),m=a(75335),x=e([g,_,v,f]);[g,_,v,f]=x.then?(await x)():x;var k,z,S,A,w,E=e=>e,I={group_by_floor:!0,group_by_area:!0},M=function(e){function t(){var e;(0,o.A)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=(0,l.A)(this,t,[].concat(r))).hassSubscribeRequiredHostProps=["_config"],e._valueFormatter=t=>`${(0,_.ZV)(t,e.hass.locale,t<.1?{maximumFractionDigits:3}:void 0)} kWh`,e}return(0,d.A)(t,e),(0,s.A)(t,[{key:"setConfig",value:function(e){this._config=Object.assign(Object.assign({},I),e)}},{key:"hassSubscribe",value:function(){var e;return[(0,v.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe(e=>{this._data=e})]}},{key:"getCardSize",value:function(){return 5}},{key:"getGridOptions",value:function(){return{columns:12,min_columns:6,rows:6,min_rows:2}}},{key:"shouldUpdate",value:function(e){return e.has("_config")||e.has("_data")||e.has("_isMobileSize")}},{key:"render",value:function(){if(!this._config)return c.s6;if(!this._data)return(0,c.qy)(k||(k=E`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));var e=this._data.prefs,t=(0,v.E$)(e),a=(0,v.gv)(this._data),r=a.summedData,i=(a.compareSummedData,(0,v.DR)(r,void 0)),n=i.consumption,o=(i.compareConsumption,getComputedStyle(this)),s=[],l=[],d={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:Math.max(0,n.total.used_total),color:o.getPropertyValue("--primary-color").trim(),index:1};if(s.push(d),t.battery){var u,h,p=null!==(u=r.total.from_battery)&&void 0!==u?u:0,g=null!==(h=r.total.to_battery)&&void 0!==h?h:0;s.push({id:"battery",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:p,color:o.getPropertyValue("--energy-battery-out-color").trim(),index:0}),l.push({source:"battery",target:"home",value:n.total.used_battery}),s.push({id:"battery_in",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:g,color:o.getPropertyValue("--energy-battery-in-color").trim(),index:1}),n.total.grid_to_battery>0&&l.push({source:"grid",target:"battery_in",value:n.total.grid_to_battery}),n.total.solar_to_battery>0&&l.push({source:"solar",target:"battery_in",value:n.total.solar_to_battery})}if(t.grid){var _,b=null!==(_=r.total.from_grid)&&void 0!==_?_:0;s.push({id:"grid",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:b,color:o.getPropertyValue("--energy-grid-consumption-color").trim(),index:0}),l.push({source:"grid",target:"home",value:n.total.used_grid})}if(t.solar){var m,x=null!==(m=r.total.solar)&&void 0!==m?m:0;s.push({id:"solar",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.solar"),value:x,color:o.getPropertyValue("--energy-solar-color").trim(),index:0}),l.push({source:"solar",target:"home",value:n.total.used_solar})}if(t.grid&&t.grid[0].flow_to){var w,I=null!==(w=r.total.to_grid)&&void 0!==w?w:0;s.push({id:"grid_return",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:I,color:o.getPropertyValue("--energy-grid-return-color").trim(),index:1}),n.total.battery_to_grid>0&&l.push({source:"battery",target:"grid_return",value:n.total.battery_to_grid}),n.total.solar_to_grid>0&&l.push({source:"solar",target:"grid_return",value:n.total.solar_to_grid})}var M=d.value,C=[],$={};e.device_consumption.forEach((e,t)=>{var a=e.stat_consumption in this._data.stats&&(0,f.$j)(this._data.stats[e.stat_consumption])||0;if(!(a<.01)){var r={id:e.stat_consumption,label:e.name||(0,f.$O)(this.hass,e.stat_consumption,this._data.statsMetadata[e.stat_consumption]),value:a,color:(0,y.fI)(t,o),index:4,parent:e.included_in_stat};r.parent?($[r.id]=r.parent,l.push({source:r.parent,target:r.id})):M-=a,C.push(r)}});var D=C.filter(e=>!$[e.id]),T=this._config,O=T.group_by_area,L=T.group_by_floor;if(O||L){var R=this._groupByFloorAndArea(D),j=R.areas,P=R.floors;Object.keys(P).sort((e,t)=>{var a,r,i,n;return(null!==(a=null===(r=this.hass.floors[t])||void 0===r?void 0:r.level)&&void 0!==a?a:-1/0)-(null!==(i=null===(n=this.hass.floors[e])||void 0===n?void 0:n.level)&&void 0!==i?i:-1/0)}).forEach(e=>{var t=`floor_${e}`;"no_floor"!==e&&L?(s.push({id:t,label:this.hass.floors[e].name,value:P[e].value,index:2,color:o.getPropertyValue("--primary-color").trim()}),l.push({source:"home",target:t})):t="home",P[e].areas.forEach(e=>{var a;if("no_area"!==e&&O){var r=`area_${e}`;s.push({id:r,label:this.hass.areas[e].name,value:j[e].value,index:3,color:o.getPropertyValue("--primary-color").trim()}),l.push({source:t,target:r,value:j[e].value}),a=r}else a=t;j[e].devices.forEach(e=>{l.push({source:a,target:e.id,value:e.value})})})})}else D.forEach(e=>{l.push({source:"home",target:e.id,value:e.value})});var V=this._getDeviceSections($,C);V.forEach((e,t)=>{e.forEach(e=>{s.push(Object.assign(Object.assign({},e),{},{index:4+t}))})}),M>0&&(s.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:M,color:o.getPropertyValue("--state-unavailable-color").trim(),index:3+V.length}),l.push({source:"home",target:"untracked",value:M}));var W=s.some(e=>e.value>0),F="vertical"===this._config.layout||"horizontal"!==this._config.layout&&this._isMobileSize;return(0,c.qy)(z||(z=E` <ha-card .header="${0}"> <div class="card-content"> ${0} </div> </ha-card> `),this._config.title,W?(0,c.qy)(S||(S=E`<ha-sankey-chart .data="${0}" .vertical="${0}" .valueFormatter="${0}"></ha-sankey-chart>`),{nodes:s,links:l},F,this._valueFormatter):(0,c.qy)(A||(A=E`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")))}},{key:"_groupByFloorAndArea",value:function(e){var t={no_area:{value:0,devices:[]}},a={no_floor:{value:0,areas:["no_area"]}};return e.forEach(e=>{var r=this.hass.states[e.id],i=r?(0,b.l)(r,this.hass.entities,this.hass.devices,this.hass.areas,this.hass.floors):{area:null,floor:null},n=i.area,o=i.floor;n?(n.area_id in t?(t[n.area_id].value+=e.value,t[n.area_id].devices.push(e)):t[n.area_id]={value:e.value,devices:[e]},o?o.floor_id in a?(a[o.floor_id].value+=e.value,a[o.floor_id].areas.includes(n.area_id)||a[o.floor_id].areas.push(n.area_id)):a[o.floor_id]={value:e.value,areas:[n.area_id]}:(a.no_floor.value+=e.value,a.no_floor.areas.includes(n.area_id)||a.no_floor.areas.unshift(n.area_id))):(t.no_area.value+=e.value,t.no_area.devices.push(e))}),{areas:t,floors:a}}},{key:"_getDeviceSections",value:function(e,t){var a=[],r=[],o=Object.values(e),s={};return t.forEach(t=>{var i=t.id in e;o.includes(t.id)&&!i?a.push(t):r.push(t)}),Object.entries(e).forEach(e=>{var t=(0,n.A)(e,2),r=t[0],i=t[1];a.some(e=>e.id===i)||(s[r]=i)}),a.length>0?[a].concat((0,i.A)(this._getDeviceSections(s,r))):[t]}}])}((0,p.E)((0,m.Q)(c.WF)));M.styles=(0,c.AH)(w||(w=E`:host{display:block;height:calc(var(--row-size,8) * (var(--row-height,50px) + var(--row-gap,0px)) - var(--row-gap,0px))}ha-card{height:100%;display:flex;flex-direction:column}.card-content{flex:1;display:flex}`)),(0,u.__decorate)([(0,h.MZ)({attribute:!1})],M.prototype,"hass",void 0),(0,u.__decorate)([(0,h.wk)()],M.prototype,"_config",void 0),(0,u.__decorate)([(0,h.wk)()],M.prototype,"_data",void 0),M=(0,u.__decorate)([(0,h.EM)("hui-energy-sankey-card")],M),r()}catch(C){r(C)}})},8147:function(e,t,a){a.d(t,{A:function(){return _}});var r=a(50291),i=a(73983),n=(a(38606),a(96956),a(44941),a(74048),a(43114),a(35748),a(80178),a(99342),a(9724),a(98522),a(35058),a(93225),a(65315),a(837),a(84136),a(12791),a(22416),a(37089),a(48169),a(45519),a(64587),a(88238),a(34536),a(16257),a(20152),a(44711),a(72108),a(77030),a(30536),a(95013),a(41160));function o(e){return"passThrough"in e}var s=1;function l(e,t){e.eachSeriesByType("sankey",e=>{if("justify"===e.get("nodeAlign")){var a=e.get("nodeWidth"),r=e.get("nodeGap"),l=(0,n.Lj)(e,t).refContainer,c=l.width,h=l.height,v=e.getGraph();!function(e,t,a,r,n,l,c){var h=e.filter(e=>e.getLayout().value>0),v=(0,i.A)(new Set(h.map(e=>e.hostGraph.data.getRawDataItem(e.dataIndex).depth||0))).sort(),f=function(e,t){var a=[];return t.forEach(t=>{var r=function(e,t,a){if(0===e.getLayout().value)return[];var r=d(e.node1,t),i=d(e.node2,t),n=function(e){var t=e.hostGraph.edgeData.getRawDataItem(e.dataIndex);return t.value}(e),o=function(e,t,a){return a.slice(e+1,t)}(r.depthIndex,i.depthIndex,t),s=e.node1.hostGraph.data.getRawDataItem(e.node1.dataIndex),l=e.node2.hostGraph.data.getRawDataItem(e.node2.dataIndex),u=o.map(e=>{var t=function(e,t,a,r){return{passThrough:!0,id:`${e}-${t}-${a}`,value:r,depth:a}}(s.id,l.id,e,n);return a.push(t),t.id});return u}(t,e,a);t.passThroughNodeIds=r}),a}(v,t),p=function(e,t,a,r,i,n,l){var d=function(e,t,a,r,i){var n=("vertical"===e?t:a)-2*i,o="vertical"===e?a/r.length:t/r.length;return{sectionSize:n,sectionDepthSize:o}}(n,r,i,a,l),c=d.sectionSize,h=d.sectionDepthSize,v=function(e,t){var a={};return e.forEach(e=>{var t=e.getLayout().depth;a[t]?a[t].push(e):a[t]=[e]}),t.forEach(e=>{a[e.depth]?a[e.depth].push(e):a[e.depth]=[e]}),a}(e,t),f=0,p=a.map(e=>{var t=function(e){return e.map(e=>({node:e,id:e.id,value:o(e)?e.value:e.getLayout().value,x:0,y:0,dx:0,dy:0,size:0}))}(v[e]||[]),a=c-(t.length+1)*l,r=t.reduce((e,t)=>e+t.value,0),i=u(t,a,r,f),n=i.nodes,s=i.valueToSizeRatio;return s>f&&(f=s),{nodes:n,depth:e,totalValue:r,valueToSizeRatio:s}});return p.forEach((e,t)=>{!function(e,t,a,r,i,n){var o=0;e.valueToSizeRatio!==i?e.nodes.forEach(e=>{var t=Math.max(s,Math.floor(e.value/i));o+=t,e.size=t}):o=e.nodes.reduce((e,t)=>e+t.size,0);var l=a-o,d=l/(e.nodes.length+1);e.nodes.forEach(a=>{"vertical"===n?(a.x=d,a.y=t*r):(a.x=t*r,a.y=d),d+=a.size+l/(e.nodes.length+1)})}(e,t,c,h,f,n)}),p.flatMap(e=>e.nodes)}(h,f,v,n,l,c,r);!function(e,t,a){var r=function(e){return"vertical"===e?{breadth:"x",depth:"y",breadthSize:"dx",depthSize:"dy"}:{breadth:"y",depth:"x",breadthSize:"dy",depthSize:"dx"}}(a),n="vertical"===a?"curveVertical":"curveHorizontal";(function(e,t,a){e.forEach(e=>{e[a.breadthSize]=e.size,e[a.depthSize]=t,o(e.node)||e.node.setLayout({x:e.x,y:e.y,dx:e.dx,dy:e.dy},!0)})})(e,t,r),function(e,t){e.forEach(e=>{o(e.node)||e.node.outEdges.forEach(a=>{var r=a.hostGraph.edgeData.getRawDataItem(a.dataIndex).value/e.value*e.size;a.setLayout({[t.breadthSize]:r,[t.depthSize]:0},!0)})})}(e,r),function(e,t){e.forEach(e=>{o(e.node)||(e.node.outEdges.sort((e,a)=>e.node2.getLayout()[t.breadth]-a.node2.getLayout()[t.breadth]),e.node.inEdges.sort((e,a)=>e.node1.getLayout()[t.breadth]-a.node1.getLayout()[t.breadth]))})}(e,r),e.forEach(t=>{o(t.node)||(function(e,t,a){if(o(e.node))return;var r=0;e.node.outEdges.forEach(i=>{i.setLayout({x:"vertical"===t?e.x+r:e.x+e.dx,y:"vertical"===t?e.y+e.dy:e.y+r},!0),r+=i.getLayout()[a.breadthSize]})}(t,a,r),function(e,t,a,r,n){if(o(e.node))return;var s=0;e.node.inEdges.forEach(o=>{var l=function(e,t,a,r){var i=[];return e.passThroughNodeIds.forEach(e=>{var n=t.find(t=>t.id===e);i.push({x:n.x,y:n.y,type:r}),"vertical"===a?i.push({x:n.x,y:n.y+n.dy,type:"line"}):i.push({x:n.x+n.dx,y:n.y,type:"line"})}),i}(o,t,a,n);o.setLayout({targets:[].concat((0,i.A)(l),[{x:"vertical"===a?e.x+s:e.x,y:"vertical"===a?e.y:e.y+s,type:n}])},!0),s+=o.getLayout()[r.breadthSize]})}(t,e,a,r,n))})}(p,a,c)}(v.nodes,v.edges,a,r,c,h,e.get("orient"))}})}function d(e,t){var a=e.hostGraph.data.getRawDataItem(e.dataIndex).depth||0,r=t.findIndex(e=>e===a);return{depth:a,depthIndex:r}}function u(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=a/t;i<r&&(i=r);var n=0,o=e.map(e=>{if(e.size===s)return e;var t=Math.floor(e.value/i);return t<s&&(n+=s-t,t=s),Object.assign(Object.assign({},e),{},{size:t})});return n>0?u(o,t-n,a,i):{nodes:o,valueToSizeRatio:i}}var c=a(62020),h=a(31802),v=a(21101),f=a(87426),p=a(23180);var g=function(e){function t(){return(0,c.A)(this,t),(0,v.A)(this,t,arguments)}return(0,p.A)(t,e),(0,h.A)(t,[{key:"render",value:function(e,a,r){(0,f.A)(t,"render",this,3)([e,a,r]);var n=e.getData("edge");e.getGraph().eachEdge(e=>{var t=e.getLayout(),a=e.getModel().getModel("lineStyle").get("curveness"),r=n.getItemGraphicEl(e.dataIndex);r.buildPath=e=>function(e,t,a){var r;if(null!==(r=t.targets)&&void 0!==r&&r.length){e.moveTo(t.x,t.y);for(var n=t.targets[t.targets.length-1],o=[{x:t.x,y:t.y,type:n.type}].concat((0,i.A)(t.targets)),s=1;s<o.length;s++){var l=o[s],d=o[s-1];"curveHorizontal"===l.type?e.bezierCurveTo(d.x*(1-a)+l.x*a,d.y,l.x*(1-a)+d.x*a,l.y,l.x,l.y):"curveVertical"===l.type?e.bezierCurveTo(d.x,d.y*(1-a)+l.y*a,l.x,l.y*(1-a)+d.y*a,l.x,l.y):e.lineTo(l.x,l.y)}e.lineTo(n.x+t.dx,n.y+t.dy);for(var u=o.length-2;u>=0;u--){var c={x:o[u+1].x+t.dx,y:o[u+1].y+t.dy,type:o[u+1].type},h={x:o[u].x+t.dx,y:o[u].y+t.dy,type:c.type};"curveHorizontal"===h.type?e.bezierCurveTo(c.x*(1-a)+h.x*a,c.y,h.x*(1-a)+c.x*a,h.y,h.x,h.y):"curveVertical"===h.type?e.bezierCurveTo(c.x,c.y*(1-a)+h.y*a,h.x,h.y*(1-a)+c.y*a,h.x,h.y):e.lineTo(h.x,h.y)}e.closePath()}}(e,t,a),r.dirtyShape()})}}])}(a(68730).A),y=g;function _(e){(0,r.a)(e),e.registerLayout(l),e.registerChartView(y)}},48125:function(e,t,a){a.d(t,{M:function(){return r}});a(67579),a(41190);var r=/(?:iphone|android|ipad)/i.test(navigator.userAgent)},35083:function(e,t,a){var r;function i(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Roboto, Noto, sans-serif";r||(r=document.createElement("canvas"));var i=r.getContext("2d");if(!i)return 0;i.font=`${t}px ${a}`;var n=i.measureText(e);return Math.ceil(Math.max(n.actualBoundingBoxRight+n.actualBoundingBoxLeft,n.width))}a.d(t,{W:function(){return i}})}}]);
//# sourceMappingURL=19348.0bf677ceb32b3e76.js.map