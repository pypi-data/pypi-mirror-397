# AGENTS.md

## Code style

- Don't use too many comments.
- Don't remove TODO comments unless they become out of date since you have added that to the feature. 
- Use comments sparingly, don't add comments about idiomatic code. Only add comments to explain WHY something uncommon or unconventional is being done, not what typical code is doing.
- Use Australian English in comments (colour not color)
- DO NOT hard code API keys, passwords and secrets into scripts - these should be loaded from environment variables, `.env` or configuration files.
- Follow the existing code style for capitalisation and punctuation for variable, function, class and method names
- If you need clarification on any part of a task, ask for more information before proceeding with the implemention.

## .env files (12 factor app)

This applies to web services in particular.

- Use a .env file for web services and provide a .env.example
- When new environment variables are added to the codebase, ensure they are also added to .env.example
- Ensure .env is added to .gitignore
- NEVER delete the existing .env file, even if you cannot see it

## Git and version control

- DO NOT include attribution to Claude or any other AI tool in the commit message or co-author attribution. NEVER include "Generated by Claude" or any co-author information.
- DO NOT include emojis in the commit message (unless the message specifically relates to a Unicode emoji)
- The first line of the commit message should be short, concise and to the point. Further detail can be added after a blank line - use dot points.

## CHANGELOG.md

If there is a CHANGELOG.md file, update it with any notable features or bug fixes once these have been successfully implemented.
- When updating the `CHANGELOG.md`, add notable features and fixes, with the following categories:
  - `Added` for new features.
  - `Changed` for changes in existing functionality.
  - `Deprecated` for soon-to-be removed features.
  - `Removed` for now removed features.
  - `Fixed` for any bug fixes.
  - `Security` in case of vulnerabilities.
- For [Unreleased], we don't need to maintain a history of every intermediate change if a change was reverted or overrides a previous unreleased change (eg 'changed to use packageX version 1, then changed to use packageX version 2') - just document the changes relative to the last versioned release to the current state. You may update or remove text from the [Unreleased] section as required - you don't always need to append only.

## PR checklist

- Update `README.md` where required
- Update `.env.example` when env vars change
- Update `CHANGELOG.md`, condensing and summarizing `[Unreleased]` changes where required.

## Python

- When writing Python code, include type hints where practical.
- For pure Python projects, prefer using uv venv over conda environments or pip.
- Prefer `pyproject.toml` over `setup.py`. 	
- `pyproject.toml` and `requirements.txt` can coexist.
  - Use `pyproject.toml` for unpinned dependencies (or major version pinned) 
  - Use `requirements.txt` for exact version pinned dependencies
- Order Python imports with most common built-in packages first (typing, logging, sys, os, time, datetime), followed by most common external packages (numpy as np, pandas as pd, requests), followed by other external packages grouped, and finally internal package imports (eg from .utils import foo).
- Include all required imports, both for typing and other parts of the code. 
- For commandline Python scripts, add `#!/usr/bin/env python` and use `if __name__ == "__main__":`.
- Use argparse to make key variables sensible commandline arguments, UNLESS you are told to use typer (https://typer.tiangolo.com/tutorial/)
- Use the logging package writing to stderr for status messages and errors. 
- Follow common conventions for modern Unix commandline tools. 
	- If there is an output file option (-o / --output), allow `-` to indicate printing to stdout. Use io.StringIO, not pd.compat.StringIO.
- For Python projects that might require significant non-Python dependencies (eg bioinformatics projects with additional commandline software), we may use conda.
  - Use -y for conda install and create.
  - Use the conda-forge and bioconda channels
  - If installing conda from scratch, prefer the miniforge3 distribution instead of miniconda3.

## FastAPI and SQLAlchemy

- Use async where possible
- Use alembic for migrations when using Postgres
- When modifying models, also ensure to update any associated Pydantic schema and the alembic migrations
- Modifying alembic migrations may involve providing the request alembic command to run. In early non-production development we may instead modify the initial migrations and provide SQL to update the dev database (to prevent unnessecary bloat of migration versions). Ask what would be preferred.

## Vue.js

- When writing `.vue` components, the order is `<template>`, `<script>`, `<style>`.
- For simple projects that use Vue from a CDN, use Javascript.
- For larger projects use `pnpm`, and `vite` with Typescript.
- Preferred UI toolkits:
  - PrimeVue: https://primevue.org/cdn/
  - shadcn/vue: https://github.com/unovue/shadcn-vue (docs: https://www.shadcn-vue.com/docs/installation/vite.html)

## Docker

- Use `docker compose` not `docker-compose`. 
- Don't include a "version" at the top of docker-compose files. 
- If using apt-get in a Dockerfile, include ENV `DEBIAN_FRONTEND=noninteractive`, and use best-practises to clean `/var/lib/apt/lists/`
- When using `pip install`, include `--no-cache-dir` and the environment variable `ENV PIP_BREAK_SYSTEM_PACKAGES=1`

