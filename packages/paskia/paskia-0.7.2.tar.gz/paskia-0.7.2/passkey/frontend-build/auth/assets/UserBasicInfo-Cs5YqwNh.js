import{G as H,r as T,H as J,I as rt,J as D,K,L as it,M as ct,N as lt,z as ut,O as ft,c as Q,w as ht,P as dt,Q as yt,B as gt,R as mt,S as wt,d as j,i as I,u as O,e as N,f as l,t as g,n as St,_ as bt}from"./_plugin-vue_export-helper-DBJ1JH0N.js";import{f as $}from"./helpers-CU0-cyzg.js";let G;const x=t=>G=t,X=Symbol();function A(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var R;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(R||(R={}));function Bt(){const t=H(!0),s=t.run(()=>T({}));let e=[],n=[];const i=J({install(c){x(i),i._a=c,c.provide(X,i),c.config.globalProperties.$pinia=i,n.forEach(o=>e.push(o)),n=[]},use(c){return this._a?e.push(c):n.push(c),this},_p:e,_a:null,_e:t,_s:new Map,state:s});return i}const Y=()=>{};function F(t,s,e,n=Y){t.add(s);const i=()=>{t.delete(s)&&n()};return!e&&ct()&&lt(i),i}function k(t,...s){t.forEach(e=>{e(...s)})}const pt=t=>t(),z=Symbol(),q=Symbol();function B(t,s){t instanceof Map&&s instanceof Map?s.forEach((e,n)=>t.set(n,e)):t instanceof Set&&s instanceof Set&&s.forEach(t.add,t);for(const e in s){if(!s.hasOwnProperty(e))continue;const n=s[e],i=t[e];A(i)&&A(n)&&t.hasOwnProperty(e)&&!D(n)&&!K(n)?t[e]=B(i,n):t[e]=n}return t}const vt=Symbol();function Et(t){return!A(t)||!Object.prototype.hasOwnProperty.call(t,vt)}const{assign:d}=Object;function _t(t){return!!(D(t)&&t.effect)}function kt(t,s,e,n){const{state:i,actions:c,getters:o}=s,m=e.state.value[t];let w;function y(){m||(e.state.value[t]=i?i():{});const S=ft(e.state.value[t]);return d(S,c,Object.keys(o||{}).reduce((b,p)=>(b[p]=J(Q(()=>{x(e);const v=e._s.get(t);return o[p].call(v,v)})),b),{}))}return w=Z(t,y,s,e,n,!0),w}function Z(t,s,e={},n,i,c){let o;const m=d({actions:{}},e),w={deep:!0};let y,S,b=new Set,p=new Set,v;const E=n.state.value[t];!c&&!E&&(n.state.value[t]={}),T({});let M;function U(r){let a;y=S=!1,typeof r=="function"?(r(n.state.value[t]),a={type:R.patchFunction,storeId:t,events:v}):(B(n.state.value[t],r),a={type:R.patchObject,payload:r,storeId:t,events:v});const u=M=Symbol();ut().then(()=>{M===u&&(y=!0)}),S=!0,k(b,a,n.state.value[t])}const et=c?function(){const{state:a}=e,u=a?a():{};this.$patch(_=>{d(_,u)})}:Y;function st(){o.stop(),b.clear(),p.clear(),n._s.delete(t)}const W=(r,a="")=>{if(z in r)return r[q]=a,r;const u=function(){x(n);const _=Array.from(arguments),L=new Set,V=new Set;function ot(f){L.add(f)}function at(f){V.add(f)}k(p,{args:_,name:u[q],store:h,after:ot,onError:at});let P;try{P=r.apply(this&&this.$id===t?this:h,_)}catch(f){throw k(V,f),f}return P instanceof Promise?P.then(f=>(k(L,f),f)).catch(f=>(k(V,f),Promise.reject(f))):(k(L,P),P)};return u[z]=!0,u[q]=a,u},nt={_p:n,$id:t,$onAction:F.bind(null,p),$patch:U,$reset:et,$subscribe(r,a={}){const u=F(b,r,a.detached,()=>_()),_=o.run(()=>ht(()=>n.state.value[t],L=>{(a.flush==="sync"?S:y)&&r({storeId:t,type:R.direct,events:v},L)},d({},w,a)));return u},$dispose:st},h=rt(nt);n._s.set(t,h);const C=(n._a&&n._a.runWithContext||pt)(()=>n._e.run(()=>(o=H()).run(()=>s({action:W}))));for(const r in C){const a=C[r];if(D(a)&&!_t(a)||K(a))c||(E&&Et(a)&&(D(a)?a.value=E[r]:B(a,E[r])),n.state.value[t][r]=a);else if(typeof a=="function"){const u=W(a,r);C[r]=u,m.actions[r]=a}}return d(h,C),d(it(h),C),Object.defineProperty(h,"$state",{get:()=>n.state.value[t],set:r=>{U(a=>{d(a,r)})}}),n._p.forEach(r=>{d(h,o.run(()=>r({store:h,app:n._a,pinia:n,options:m})))}),E&&c&&e.hydrate&&e.hydrate(h.$state,E),y=!0,S=!0,h}function jt(t,s,e){let n;const i=typeof s=="function";n=i?e:s;function c(o,m){const w=yt();return o=o||(w?dt(X,null):null),o&&x(o),o=G,o._s.has(t)||(i?Z(t,s,n,o):kt(t,n,o)),o._s.get(t)}return c.$id=t,c}const tt=jt("auth",{state:()=>({userInfo:null,isLoading:!1,authRequired:!1,settings:null,currentView:"login",status:{message:"",type:"info",show:!1}}),getters:{},actions:{setLoading(t){this.isLoading=!!t},clearAuthRequired(){this.authRequired=!1},showMessage(t,s="info",e=3e3){this.status={message:t,type:s,show:!0},e>0&&setTimeout(()=>{this.status.show=!1},e)},async setSessionCookie(t){const e=await(await fetch("/auth/api/set-session",{method:"POST",headers:{Authorization:`Bearer ${t}`}})).json();if(e.detail)throw new Error(e.detail);return e},async register(){this.isLoading=!0;try{const t=await wt();return await this.setSessionCookie(t.session_token),await this.loadUserInfo(),this.selectView(),t}finally{this.isLoading=!1}},async authenticate(){this.isLoading=!0;try{const t=await mt();return await this.setSessionCookie(t.session_token),await this.loadUserInfo(),this.selectView(),t}finally{this.isLoading=!1}},selectView(){this.userInfo?this.currentView="profile":this.currentView="login"},async loadSettings(){this.settings=await gt()},async loadUserInfo(){const t=await fetch("/auth/api/user-info",{method:"POST"});let s=null;try{s=await t.json()}catch{}if(t.status===401)throw this.authRequired=!0,new Error(s?.detail||"Authentication required");if(s?.detail)throw this.showMessage(s.detail,"error",5e3),new Error(s.detail);this.userInfo=s,console.log("User info loaded:",s)},async deleteCredential(t){const s=await fetch(`/auth/api/user/credential/${t}`,{method:"Delete"});if(s.status===401)throw this.authRequired=!0,new Error("Authentication required");const e=await s.json();if(e.detail)throw new Error(e.detail);await this.loadUserInfo()},async terminateSession(t){try{const s=await fetch(`/auth/api/user/session/${t}`,{method:"DELETE"});if(s.status===401)throw this.authRequired=!0,new Error("Authentication required");let e=null;try{e=await s.json()}catch{}if(!s.ok||e?.detail){const n=e?.detail||"Failed to terminate session";throw new Error(n)}if(e?.current_session_terminated){sessionStorage.clear(),location.reload();return}await this.loadUserInfo(),this.showMessage("Session terminated","success",2500)}catch(s){throw console.error("Terminate session error:",s),s}},async logout(){try{const t=await fetch("/auth/api/logout",{method:"POST"});if(!t.ok){let s="Logout failed";try{const e=await t.json();e?.detail&&(s=e.detail)}catch{}throw new Error(s)}sessionStorage.clear(),location.reload()}catch(t){console.error("Logout error:",t),this.showMessage(t.message,"error")}},async logoutEverywhere(){try{const t=await fetch("/auth/api/user/logout-all",{method:"POST"});if(!t.ok){let s="Logout failed";try{const e=await t.json();e?.detail&&(s=e.detail)}catch{}throw new Error(s)}sessionStorage.clear(),location.reload()}catch(t){console.error("Logout-all error:",t),this.showMessage(t.message,"error")}}}}),It={key:0,class:"global-status",style:{display:"block"}},Mt={__name:"StatusMessage",setup(t){const s=tt();return(e,n)=>O(s).status.show?(N(),j("div",It,[l("div",{class:St(["status",O(s).status.type])},g(O(s).status.message),3)])):I("",!0)}},Nt={key:0,class:"user-info"},Ct={class:"user-name-heading"},Lt={class:"user-name-row"},Pt=["title"],Ot={key:0,class:"org-role-sub"},Rt={key:0,class:"org-line"},Dt={key:1,class:"role-line"},xt={__name:"UserBasicInfo",props:{name:{type:String,required:!0},visits:{type:[Number,String],default:0},createdAt:{type:[String,Number,Date],default:null},lastSeen:{type:[String,Number,Date],default:null},updateEndpoint:{type:String,default:null},canEdit:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},orgDisplayName:{type:String,default:""},roleName:{type:String,default:""}},emits:["saved","editName"],setup(t,{emit:s}){const e=t,n=s;tt();const i=Q(()=>!!e.name);return(c,o)=>i.value?(N(),j("div",Nt,[l("h3",Ct,[o[1]||(o[1]=l("span",{class:"icon"},"üë§",-1)),l("span",Lt,[l("span",{class:"display-name",title:t.name},g(t.name),9,Pt),t.canEdit&&t.updateEndpoint?(N(),j("button",{key:0,class:"mini-btn",onClick:o[0]||(o[0]=m=>n("editName")),title:"Edit name"},"‚úèÔ∏è")):I("",!0)])]),t.orgDisplayName||t.roleName?(N(),j("div",Ot,[t.orgDisplayName?(N(),j("div",Rt,g(t.orgDisplayName),1)):I("",!0),t.roleName?(N(),j("div",Dt,g(t.roleName),1)):I("",!0)])):I("",!0),o[2]||(o[2]=l("span",null,[l("strong",null,"Visits:")],-1)),l("span",null,g(t.visits||0),1),o[3]||(o[3]=l("span",null,[l("strong",null,"Registered:")],-1)),l("span",null,g(O($)(t.createdAt)),1),o[4]||(o[4]=l("span",null,[l("strong",null,"Last seen:")],-1)),l("span",null,g(O($)(t.lastSeen)),1)])):I("",!0)}},Ut=bt(xt,[["__scopeId","data-v-2994268a"]]);export{Ut as U,Mt as _,Bt as c,tt as u};
