import{_ as A,O as F,r as i,c as m,a4 as b,o as N,b as c,d as u,f as U,e as t,t as h,g as $,h as E,v as I,L as K,m as V,H as x,a5 as z,a6 as D,G as O,J as H,K as J}from"./_plugin-vue_export-helper-rKFEraYH.js";const L={class:"app-shell"},j={key:0,class:"global-status",style:{display:"block"}},G={class:"view-root"},Y={class:"surface surface--tight",style:{"max-width":"560px",margin:"0 auto",width:"100%"}},q={class:"view-header",style:{"text-align":"center"}},Q={class:"view-lede"},W={key:0,class:"section-block"},X={key:1,class:"section-block"},Z={key:2,class:"section-block"},ee={class:"section-body"},se={class:"name-edit"},te=["disabled"],ae=["disabled"],ne={__name:"ResetApp",setup(ie){const o=F({show:!1,message:"",type:"info"}),d=i(!0),n=i(!1),r=i(""),P=i(null),g=i(null),f=i(""),y=i("");let p=null;const R=m(()=>g.value?.session_type||"your enrollment"),T=m(()=>d.value?"Preparing your secure enrollmentâ€¦":v.value?`Finish up ${R.value}. You may edit the name below if needed, and it will be saved to your passkey.`:"This authentication link is no longer valid.");m(()=>b());const v=m(()=>!!(r.value&&g.value));function l(e,s="info",a=3e3){o.show=!0,o.message=e,o.type=s,p&&clearTimeout(p),a>0&&(p=setTimeout(()=>{o.show=!1},a))}async function S(){try{const e=await V();P.value=e,e?.rp_name&&(document.title=`${e.rp_name} Â· Passkey Setup`)}catch(e){console.warn("Unable to load settings",e)}}async function B(){if(r.value)try{g.value=await x(`/auth/api/user-info?reset=${encodeURIComponent(r.value)}`,{method:"POST"}),f.value=g.value?.user?.user_name||""}catch(e){console.error("Failed to load user info",e);const s=e instanceof z?e.data?.detail||"The authentication link is invalid or expired.":D(e);y.value=s}}async function _(){if(!v.value||n.value)return;n.value=!0,l("Starting passkey registrationâ€¦","info");let e;try{const s=f.value.trim()||null;e=await O.register(r.value,s)}catch(s){n.value=!1;const a=s?.message||"Passkey registration cancelled",k=a==="Passkey registration cancelled";l(k?a:`Registration failed: ${a}`,k?"info":"error",4e3);return}try{await C(e)}catch(s){n.value=!1;const a=s?.message||"Failed to establish session";l(a,"error",4e3);return}l("Passkey registered successfully!","success",800),setTimeout(()=>{n.value=!1,w()},800)}async function C(e){if(!e?.session_token)throw new Error("Registration response missing session_token");return await x("/auth/api/set-session",{method:"POST",headers:{Authorization:`Bearer ${e.session_token}`}})}function w(){const e=b.value||"/auth/";window.location.pathname!==e&&history.replaceState(null,"",e),window.location.reload()}function M(){const e=window.location.pathname.split("/").filter(Boolean);if(!e.length)return"";const s=e[e.length-1],a=e.slice(0,-1);return a.length>1||a.length===1&&a[0]!=="auth"||!s.includes(".")?"":s}return N(async()=>{if(r.value=M(),await S(),!r.value){const e="Reset link is missing or malformed.";y.value=e,l(e,"error",0),d.value=!1;return}await B(),d.value=!1}),(e,s)=>(u(),c("div",L,[o.show?(u(),c("div",j,[t("div",{class:$(["status",o.type])},h(o.message),3)])):U("",!0),t("main",G,[t("div",Y,[t("header",q,[s[1]||(s[1]=t("h1",null,"ðŸ”‘ Registration",-1)),t("p",Q,h(T.value),1)]),d.value?(u(),c("section",W,[...s[2]||(s[2]=[t("div",{class:"section-body center"},[t("p",null,"Loading reset detailsâ€¦")],-1)])])):v.value?(u(),c("section",Z,[t("div",ee,[t("label",se,[s[3]||(s[3]=t("span",null,"ðŸ‘¤ Name",-1)),E(t("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>f.value=a),disabled:n.value,maxlength:"64",onKeyup:K(_,["enter"])},null,40,te),[[I,f.value]])]),t("button",{class:"btn-primary",disabled:n.value,onClick:_},h(n.value?"Registeringâ€¦":"Register Passkey"),9,ae)])])):(u(),c("section",X,[t("div",{class:"section-body center"},[t("div",{class:"button-row center",style:{"justify-content":"center"}},[t("button",{class:"btn-secondary",onClick:w},"Return to sign-in")])])]))])])]))}},oe=A(ne,[["__scopeId","data-v-aea97fd3"]]);H(oe).mount("#app");J();
