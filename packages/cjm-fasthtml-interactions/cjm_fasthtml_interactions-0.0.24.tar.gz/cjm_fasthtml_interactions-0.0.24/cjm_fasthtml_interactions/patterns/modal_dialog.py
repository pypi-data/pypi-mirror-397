"""Pattern for modal dialogs with customizable content, sizes, and actions"""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/patterns/modal_dialog.ipynb.

# %% auto 0
__all__ = ['ModalSize', 'ModalDialog', 'ModalTriggerButton']

# %% ../../nbs/patterns/modal_dialog.ipynb 3
from typing import Optional, Any, Union, List
from enum import Enum
from fasthtml.common import *

from ..core.html_ids import InteractionHtmlIds
from cjm_fasthtml_daisyui.components.actions.modal import modal, modal_box, modal_backdrop
from cjm_fasthtml_daisyui.components.actions.button import btn, btn_sizes, btn_styles, btn_modifiers
from cjm_fasthtml_tailwind.utilities.spacing import p
from cjm_fasthtml_tailwind.utilities.sizing import w, h, max_w
from cjm_fasthtml_tailwind.utilities.layout import position, right, top
from cjm_fasthtml_tailwind.core.base import combine_classes

# %% ../../nbs/patterns/modal_dialog.ipynb 5
class ModalSize(Enum):
    """Predefined size options for modal dialogs."""
    SMALL = "sm"      # max-w-md (28rem / 448px)
    MEDIUM = "md"     # max-w-lg (32rem / 512px)
    LARGE = "lg"      # max-w-2xl (42rem / 672px)
    XLARGE = "xl"     # max-w-4xl (56rem / 896px)
    FULL = "full"     # w-11/12 h-11/12 (near full screen)
    CUSTOM = "custom" # Use custom width/height

# %% ../../nbs/patterns/modal_dialog.ipynb 7
def ModalDialog(
    modal_id: str,  # Unique identifier for the modal
    content: Any,  # Content to display in the modal
    size: Union[ModalSize, str] = ModalSize.MEDIUM,  # Size preset or custom size
    show_close_button: bool = True,  # Whether to show X close button in top-right
    close_on_backdrop: bool = True,  # Whether clicking backdrop closes modal
    auto_show: bool = False,  # Whether to show modal immediately on render
    content_id: Optional[str] = None,  # Optional ID for content area (for HTMX targeting)
    custom_width: Optional[str] = None,  # Custom width class (e.g., "w-96")
    custom_height: Optional[str] = None,  # Custom height class (e.g., "h-screen")
    box_cls: Optional[str] = None,  # Additional classes for modal box
    **kwargs  # Additional attributes for the dialog element
) -> FT:  # Dialog element with modal dialog configured
    """Create a modal dialog using native HTML dialog element with DaisyUI styling."""
    # Generate modal dialog ID
    dialog_id = InteractionHtmlIds.modal_dialog(modal_id)
    
    # Generate content ID if not provided
    if content_id is None:
        content_id = InteractionHtmlIds.modal_dialog_content(modal_id)
    
    # Build modal box size classes
    size_classes = []
    
    # Handle size parameter
    if isinstance(size, ModalSize):
        if size == ModalSize.SMALL:
            size_classes.extend([max_w.md])
        elif size == ModalSize.MEDIUM:
            size_classes.extend([max_w.lg])
        elif size == ModalSize.LARGE:
            size_classes.extend([max_w._2xl])
        elif size == ModalSize.XLARGE:
            size_classes.extend([max_w._4xl])
        elif size == ModalSize.FULL:
            size_classes.extend([w("11/12"), h("11/12")])
        elif size == ModalSize.CUSTOM:
            if custom_width:
                size_classes.append(custom_width)
            if custom_height:
                size_classes.append(custom_height)
    else:
        # If size is a string, treat it as a custom class
        size_classes.append(size)
    
    # Build modal box classes
    box_classes = [modal_box] + size_classes
    if box_cls:
        box_classes.append(box_cls)
    
    # Build modal content
    modal_content_parts = []
    
    # Add close button if requested
    if show_close_button:
        close_btn = Form(
            Button(
                "âœ•",
                cls=combine_classes(
                    btn,
                    btn_sizes.sm,
                    btn_modifiers.circle,
                    btn_styles.ghost,
                    position.absolute,
                    right(2),
                    top(2)
                )
            ),
            method="dialog"
        )
        modal_content_parts.append(close_btn)
    
    # Add main content with optional ID
    if isinstance(content, (list, tuple)):
        # If content is a list/tuple, wrap it
        content_wrapper = Div(*content, id=content_id)
    elif hasattr(content, 'attrs') and 'id' in content.attrs:
        # Content already has an ID, use it as-is
        content_wrapper = content
    else:
        # Wrap content with ID
        content_wrapper = Div(content, id=content_id)
    
    modal_content_parts.append(content_wrapper)
    
    # Build modal box
    modal_box_element = Div(
        *modal_content_parts,
        cls=combine_classes(*box_classes)
    )
    
    # Build dialog parts
    dialog_parts = [modal_box_element]
    
    # Add backdrop if requested
    if close_on_backdrop:
        backdrop = Form(
            Button("close"),
            method="dialog",
            cls=str(modal_backdrop)
        )
        dialog_parts.append(backdrop)
    
    # Create the dialog element
    dialog = Dialog(
        *dialog_parts,
        id=dialog_id,
        cls=str(modal),
        **kwargs
    )
    
    # Add auto-show script if requested
    if auto_show:
        show_script = Script(f"""
            (function() {{
                const modal = document.getElementById('{dialog_id}');
                if (modal && typeof modal.showModal === 'function') {{
                    // Use requestAnimationFrame to ensure DOM is ready
                    requestAnimationFrame(() => modal.showModal());
                }}
            }})();
        """)
        return Div(dialog, show_script)
    
    return dialog

# %% ../../nbs/patterns/modal_dialog.ipynb 9
def ModalTriggerButton(
    modal_id: str,  # ID of the modal to trigger
    label: str,  # Button label text
    button_cls: Optional[str] = None,  # Additional button classes
    **kwargs  # Additional button attributes
) -> FT:  # Button element that triggers modal
    """Create a button that opens a modal dialog."""
    dialog_id = InteractionHtmlIds.modal_dialog(modal_id)
    
    button_classes = [btn]
    if button_cls:
        button_classes.append(button_cls)
    
    return Button(
        label,
        onclick=f"document.getElementById('{dialog_id}').showModal()",
        cls=combine_classes(*button_classes) if len(button_classes) > 1 else str(btn),
        **kwargs
    )
