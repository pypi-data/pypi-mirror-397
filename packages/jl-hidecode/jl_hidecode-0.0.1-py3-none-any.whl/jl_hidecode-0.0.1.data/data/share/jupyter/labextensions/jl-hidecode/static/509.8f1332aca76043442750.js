"use strict";(self.webpackChunkjl_hidecode=self.webpackChunkjl_hidecode||[]).push([[509],{509:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var o,d=n(827),l=n(389),c=n(223),i=n(262);!function(e){e.toggleActiveCell="jl-hidecode:toggle-active-cell",e.applyHideTag="jl-hidecode:apply-hide-tag"}(o||(o={}));const a={autoHideTaggedCells:!0,hideTag:"hide_input"},s="jupyterlabHideCode",r="jp-jl-hidecode-locked",u="jp-jupyterlab-run-button",p="jp-jupyterlab-run-button-running",g=new WeakMap,v="JupyterLab Hide Code",h={id:"jl-hidecode:plugin",description:"Hide/show notebook inputs and surface JupyterLab Hide Code-style parameter widgets in JupyterLab.",autoStart:!0,requires:[l.INotebookTracker,d.ICommandPalette],optional:[c.ISettingRegistry],activate:(e,t,n,c)=>{console.log("JupyterLab extension jl-hidecode is activated!");let m={...a};const b=e=>{var n;var o;o=null!==(n=null==e?void 0:e.composite)&&void 0!==n?n:{},m={...a,...null!=o?o:{}},t.forEach(e=>E(e))};c&&c.load(h.id).then(e=>{b(e),e.changed.connect(()=>b(e))}).catch(e=>{console.error("Failed to load settings for jl-hidecode.",e)});const y=e=>void 0!==e&&i.JSONExt.isObject(e)?i.JSONExt.deepCopy(e):{},C=e=>{const t=e.model.getMetadata(s);return{locked:!0===y(t).locked}},f=(e,t)=>{t.locked?(e.model.setMetadata(s,t),e.node.classList.add(r)):(e.model.deleteMetadata(s),e.node.classList.remove(r))},w=e=>!0===C(e).locked,j=(e,t)=>{const n=e.model.getMetadata("jupyter"),o=y(n);o.source_hidden=t,e.model.setMetadata("jupyter",o)},k=(e,t,n)=>{var o;if(e.inputHidden===t)return j(e,t),void(void 0!==n&&f(e,{locked:n}));e.inputHidden=t,j(e,t);const d=null!==(o=null!=n?n:C(e).locked)&&void 0!==o&&o;f(e,{locked:d})},L=(e,t)=>{const n=t.node.querySelector(".jp-InputCollapser");if(!n){if(!g.has(t)&&!t.isDisposed){const n=new MutationObserver(()=>{if(t.isDisposed)return n.disconnect(),void g.delete(t);t.node.querySelector(".jp-InputCollapser")&&(n.disconnect(),g.delete(t),L(e,t))});n.observe(t.node,{childList:!0,subtree:!0}),g.set(t,n),t.disposed.connect(()=>{n.disconnect(),g.delete(t)})}return}const o=n.querySelector(`.${u}`),d=null!=o?o:document.createElement("button");if(!o){d.type="button",d.classList.add(u),d.setAttribute("aria-label","Run hidden cell");const o=document.createElement("span");o.classList.add(`${u}-icon`),o.innerHTML="<svg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M8 5v14l11-7z'></path></svg>",d.appendChild(o),d.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),(async()=>{try{d.classList.add(p),d.disabled=!0,await(async(e,t)=>{const n=e.content,o=n.widgets.indexOf(t);if(-1===o)return;const d=n.activeCellIndex;n.activeCellIndex=o;try{await e.sessionContext.ready,await l.NotebookActions.run(n,e.sessionContext)}finally{d!==o&&d>=0&&(n.activeCellIndex=d)}})(e,t)}catch(e){console.error("Failed to run hidden cell",e)}finally{d.classList.remove(p),d.disabled=!1,I(e,t)}})()}),n.appendChild(d)}d.style.display=w(t)?"flex":"none"},H=e=>{const n=null!=e?e:t.currentWidget,o=null==n?void 0:n.content,d=null==o?void 0:o.activeCell;if(!n||!d)return;const l=!d.inputHidden;k(d,l,l),L(n,d),n.content.update()},x=(e,t=!0)=>{const n=m.hideTag;n&&(e.content.widgets.forEach(o=>{const d=o.model.getMetadata("tags");(Array.isArray(d)?d:[]).includes(n)&&(k(o,t,!0),L(e,o))}),e.content.update())},E=e=>{m.autoHideTaggedCells&&x(e,!0)},I=(e,t)=>{w(t)?k(t,!0,!0):t.inputHidden||t.node.classList.remove(r),L(e,t)};e.commands.addCommand(o.toggleActiveCell,{label:"Toggle active cell input visibility",caption:"Collapse or expand the current cell input area",execute:()=>H()}),n.addItem({category:v,command:o.toggleActiveCell}),e.commands.addCommand(o.applyHideTag,{label:"Hide cells tagged for hiding",caption:"Collapse all cells that contain the configured hide tag",execute:()=>{const e=t.currentWidget;e&&x(e)}}),n.addItem({category:v,command:o.applyHideTag}),t.widgetAdded.connect((e,t)=>{var n,o;const l=new d.ToolbarButton({label:"Show/Hide code",className:"jp-jupyterlab-show-code-button",tooltip:"JupyterLab Hide Code: hide/show active cell input",onClick:()=>H(t)});t.toolbar.insertItem(10,"jupyterlabHideInput",l);const c=()=>{const e=t.content.activeCell;e&&I(t,e)},i=()=>{t.content.widgets.forEach(e=>I(t,e))},a=()=>{t.content.widgets.forEach(e=>L(t,e))};t.content.activeCellChanged.connect(c);const s=null!==(o=null===(n=t.content.model)||void 0===n?void 0:n.cells)&&void 0!==o?o:null;let r=null;s&&(r=()=>{requestAnimationFrame(()=>{i(),a()})},s.changed.connect(r));const p=(e=>{const t=t=>{const n=t.target;if(!n)return;if(n.closest(`.${u}`))return;if(!n.closest(".jp-InputPlaceholder")&&!n.closest(".jp-Collapser"))return;const o=n.closest(".jp-Cell");if(!o)return;const d=e.content.widgets.find(e=>e.node===o);d&&w(d)&&requestAnimationFrame(()=>I(e,d))};return e.content.node.addEventListener("mousedown",t,!0),e.content.node.addEventListener("click",t,!0),e.content.node.addEventListener("dblclick",t,!0),()=>{e.content.node.removeEventListener("mousedown",t,!0),e.content.node.removeEventListener("click",t,!0),e.content.node.removeEventListener("dblclick",t,!0)}})(t),g=new MutationObserver(()=>{a()});g.observe(t.content.node,{childList:!0,subtree:!0}),t.disposed.connect(()=>{l.dispose(),t.content.activeCellChanged.disconnect(c),s&&r&&s.changed.disconnect(r),p(),g.disconnect()}),t.context.ready.then(()=>{E(t),i(),a()})})}},m=h}}]);