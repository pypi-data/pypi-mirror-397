# Nexus Demo Configuration
# Configuration for docker-compose demo environment with GCS connector

# Deployment mode (embedded = single-process server with local backends)
mode: embedded

# Database path (for TokenManager and other components that need DB access)
db_path: postgresql://postgres:nexus@postgres:5432/nexus

# Server settings
server:
  host: 0.0.0.0
  port: 8080
  workers: 4
  log_level: info

# Database configuration (uses PostgreSQL from docker-compose)
database:
  url: postgresql://postgres:nexus@postgres:5432/nexus
  pool_size: 10
  max_overflow: 20
  echo: false

# Multi-backend storage configuration
# These backends will be automatically mounted on server startup
backends:
  # Default root backend (local storage)
  - type: local
    mount_point: /
    config:
      root_path: /app/data
    priority: 0
    readonly: false

  # GCS Connector backend for external bucket access
  # This provides direct path mapping to a GCS bucket, allowing external tools
  # to browse the bucket as if it were a local filesystem.
  - type: gcs_connector
    mount_point: /mnt/gcs_demo
    config:
      bucket: nexus-connector-test-1763281655
      project_id: nexi-lab-888
      prefix: nexus-demo
    priority: 10
    readonly: false
    description: "GCS test bucket for Nexus connector demo"

  # AWS S3 Connector backend for external bucket access
  # This provides direct path mapping to an S3 bucket, allowing external tools
  # to browse the bucket as if it were a local filesystem.
  # Uncomment and configure to enable S3 backend:
  # - type: s3_connector
  #   mount_point: /mnt/s3_demo
  #   config:
  #     bucket: nexus-s3-test-bucket
  #     region_name: us-east-1
  #     prefix: nexus-demo
  #   priority: 10
  #   readonly: false
  #   description: "S3 test bucket for Nexus connector demo"

  # Google Drive Connector backend with OAuth authentication
  # Provides access to Google Drive folders as a mounted filesystem
  # - type: gdrive_connector
  #   mount_point: /mnt/gdrive/joezhoujinjing@gmail.com
  #   config:
  #     token_manager_db: postgresql://postgres:nexus@postgres:5432/nexus
  #     user_email: joezhoujinjing@gmail.com
  #     root_folder: pentest
  #     use_shared_drives: false
  #     provider: google
  #   priority: 10
  #   readonly: false
  #   description: "Google Drive for joezhoujinjing@gmail.com"

  # Gmail Connector backend with OAuth authentication
  # Provides read-only access to Gmail messages organized by priority folders
  # Structure: /SENT/, /STARRED/, /IMPORTANT/, /INBOX/ (each with thread folders)
  # Each email appears in exactly ONE folder based on highest priority label match
  # - type: gmail_connector
  #   mount_point: /mnt/gmail/joezhoujinjing@gmail.com
  #   config:
  #     token_manager_db: postgresql://postgres:nexus@postgres:5432/nexus
  #     user_email: joezhoujinjing@gmail.com
  #     provider: gmail
  #     max_message_per_label: 50  # Maximum emails to fetch per folder (SENT, STARRED, IMPORTANT, INBOX)
  #   priority: 10
  #   readonly: true
  #   description: "Gmail messages for joezhoujinjing@gmail.com organized by priority folders"

# Cache configuration
cache:
  type: memory
  ttl: 3600
  max_size_mb: 100

# Authentication
auth:
  jwt_secret: ${JWT_SECRET:-demo-secret-change-in-production}
  jwt_algorithm: HS256
  token_expiry_hours: 24
  api_key_expiry_days: 365

# Features
features:
  semantic_search: false  # Disabled for demo
  llm_read: false         # Disabled for demo
  agent_memory: true
  job_system: false       # Disabled for demo
  mcp_server: true

# Monitoring
monitoring:
  logging:
    level: info
    format: text

# Docker sandbox configuration with inline Dockerfile templates
docker:
  default_image: nexus-sandbox:latest

  templates:
    # Use existing base image
    base:
      image: nexus-sandbox:latest

    # ML/AI heavy template with PyTorch, TensorFlow, and transformers
    ml-heavy:
      image: nexus-sandbox-ml:latest
      dockerfile_override: |
        FROM nexus-sandbox:latest
        USER root

        RUN apt-get update && apt-get install -y \
            ffmpeg graphviz \
            && rm -rf /var/lib/apt/lists/*

        RUN pip install --no-cache-dir \
            torch>=2.0.0 \
            tensorflow>=2.13.0 \
            transformers

        USER nexus
        WORKDIR /home/nexus/workspace

    # Web development template with FastAPI and database tools
    web-dev:
      image: nexus-sandbox-web:latest
      dockerfile_override: |
        FROM nexus-sandbox:latest
        USER root

        RUN apt-get update && apt-get install -y \
            postgresql-client redis-tools \
            && rm -rf /var/lib/apt/lists/*

        RUN pip install --no-cache-dir \
            fastapi 'uvicorn[standard]' sqlalchemy

        USER nexus
        WORKDIR /home/nexus/workspace
