when:
  - event: tag
    branch: main
steps:
  publish_pypi:
    image: ghcr.io/astral-sh/uv:python3.11-alpine
    commands:
      - uv sync --frozen
      - uv build
      - uv publish --token  $PYPI_API_KEY
    environment:
      PYPI_API_KEY:
        from_secret: pypi_api_key
  check_available:
    image: ghcr.io/astral-sh/uv:python3.11-alpine
    commands:
      - uv sync --frozen
      - apk add curl
      - ./resources/check_on_pypi.sh
