import{r,E as x,_ as b,V as Yt,z as h,k as Jt,cn as E,co as yt,l as I,j as a,P as xt,az as A,aA as bt,a2 as $,b as Qt,B as Zt,a0 as Et,bR as te,g as ee,f as re,b2 as oe,cp as ne,i as Y,bM as vt,bN as ae}from"./index.CQ-Kx4vm.js";import{I as ie,g as Ct,F as O,E as St,b as le,s as se,u as ce,a as de}from"./FileHelper.CjivnkwE.js";import{u as ue}from"./useWaveformController.DybOTo2V.js";import{I as pe}from"./InputInstructions.CeNY4qw5.js";import{u as ge,T as fe}from"./useTextInputAutoExpand.Ch-Ymd6C.js";import{i as he}from"./inputUtils.CptNuJwn.js";import{T as me}from"./TableChart.esm.BQEo-8Sl.js";import{E as we}from"./ErrorOutline.esm.CkLLBTP_.js";import{U as zt}from"./UploadFileInfo.Dr-zDST7.js";import"./base-input.BhxUuaS8.js";var It=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),r.createElement("path",{d:"M14 17H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"}))});It.displayName="Article";var Vt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"}))});Vt.displayName="Code";var Rt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M8 16h8v2H8zm0-4h8v2H8zm6-10H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"}))});Rt.displayName="Description";var At=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M9.17 6l2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}))});At.displayName="Folder";var Dt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"}))});Dt.displayName="Image";var Mt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M12 3l.01 10.55c-.59-.34-1.27-.55-2-.55a4.001 4.001 0 100 8c2.22 0 3.99-1.79 3.99-4V7h4V3h-6zm-1.99 16c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"}))});Mt.displayName="MusicNote";var kt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M15 8v8H5V8h10m1-2H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4V7c0-.55-.45-1-1-1z"}))});kt.displayName="Videocam";var Ft=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z"}))});Ft.displayName="Add";var Ut=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M13 19V7.83l4.88 4.88c.39.39 1.03.39 1.42 0a.996.996 0 000-1.41l-6.59-6.59a.996.996 0 00-1.41 0l-6.6 6.58a.996.996 0 101.41 1.41L11 7.83V19c0 .55.45 1 1 1s1-.45 1-1z"}))});Ut.displayName="ArrowUpward";var Ht=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm4.29 12.89a.996.996 0 11-1.41 1.41L12 13.41 9.11 16.3a.996.996 0 11-1.41-1.41L10.59 12 7.71 9.11A.996.996 0 119.12 7.7L12 10.59l2.89-2.89a.996.996 0 111.41 1.41L13.41 12l2.88 2.89z"}))});Ht.displayName="Cancel";var Tt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M18 6.7l-8.48 8.48-3.54-3.54a.996.996 0 10-1.41 1.41l4.24 4.24c.39.39 1.02.39 1.41 0l9.18-9.18a.999.999 0 00-.01-1.42c-.37-.38-1-.38-1.39.01z"}))});Tt.displayName="Check";var Nt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M18.3 5.71a.996.996 0 00-1.41 0L12 10.59 7.11 5.7A.996.996 0 105.7 7.11L10.59 12 5.7 16.89a.996.996 0 101.41 1.41L12 13.41l4.89 4.89a.996.996 0 101.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"}))});Nt.displayName="Close";var Bt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 11c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1zm0 4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"}))});Bt.displayName="ErrorOutline";var Lt=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(x,b({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),r.createElement("path",{d:"M17.91 11c-.49 0-.9.36-.98.85C16.52 14.21 14.47 16 12 16s-4.52-1.79-4.93-4.15a.998.998 0 00-.98-.85c-.61 0-1.09.54-1 1.14.49 3 2.89 5.34 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.44 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"}))});Lt.displayName="Mic";const P=Yt.getLogger("ChatInput"),ve=h("div",{target:"e1048hwn0"})({position:"relative",display:"flex",flexDirection:"column"}),Ce=h("div",{target:"e1048hwn1"})(({theme:t})=>({backgroundColor:t.colors.secondaryBg,border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.widgetBorderColor??t.colors.transparent,position:"relative",display:"flex",flexDirection:"column",alignItems:"stretch",padding:t.spacing.lg,gap:t.spacing.lg,borderRadius:t.radii.default,boxSizing:"border-box",":focus-within":{borderColor:t.colors.primary}})),ye=h("div",{target:"e1048hwn2"})(({theme:t})=>({position:"relative",display:"flex",flexDirection:"column",gap:t.spacing.sm})),xe=h("div",{target:"e1048hwn3"})({position:"relative",display:"flex",flexDirection:"column"}),be=h("div",{target:"e1048hwn4"})(({theme:t})=>({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%",gap:t.spacing.sm})),Ee=h("div",{target:"e1048hwn5"})(({theme:t})=>({display:"flex",flexDirection:"row",flex:"1 0 0",gap:t.spacing.sm,alignItems:"center"})),Se=h("div",{target:"e1048hwn6"})(({theme:t})=>({display:"flex",flexDirection:"row",gap:t.spacing.sm,alignItems:"center",position:"relative"})),ze=h("div",{target:"e1048hwn7"})(({theme:t})=>({position:"absolute",top:t.spacing.sm,right:t.spacing.lg,color:t.colors.fadedText60,fontSize:t.fontSizes.twoSm,textAlign:"right",whiteSpace:"nowrap",pointerEvents:"auto",cursor:"text",zIndex:t.zIndices.priority,"& .stChatInputInstructions":{position:"static"}})),H=h("button",{target:"e1048hwn8"})(({theme:t,disabled:e,hasError:o,primary:s})=>{if(s)return{border:"none",backgroundColor:e?t.colors.darkenedBgMix15:t.colors.primary,borderRadius:t.radii.button,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:t.lineHeights.none,margin:t.spacing.none,padding:t.spacing.xs,width:t.sizes.minElementHeight,height:t.sizes.minElementHeight,color:e?t.colors.fadedText40:t.colors.white,cursor:e?"not-allowed":"pointer",transition:"background-color 200ms ease","&:focus":{outline:"none"},":focus":{outline:"none"},"&:hover":{backgroundColor:e?t.colors.darkenedBgMix15:t.colors.primary}};const c=Jt(t),[p,d]=c?[t.colors.gray60,t.colors.gray80]:[t.colors.gray80,t.colors.gray40],w=()=>o?t.colors.redTextColor:e?p:d;return{border:"none",backgroundColor:t.colors.transparent,borderRadius:t.radii.default,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:t.lineHeights.none,margin:t.spacing.none,padding:t.spacing.none,color:w(),pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:c?t.colors.gray10:t.colors.gray90},"&:hover":{color:o?t.colors.red70:t.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:t.colors.transparent,borderColor:t.colors.transparent,color:t.colors.gray60,cursor:"not-allowed"},"& svg":{width:t.iconSizes.lg,height:t.iconSizes.lg}}}),Ie=h("div",{target:"e1048hwn9"})(({isRecording:t})=>({display:t?"flex":"none",flex:1,alignItems:"center",minWidth:0})),Ve=h("div",{target:"e1048hwn10"})(({theme:t})=>({position:"relative",width:"100%",minHeight:t.sizes.minElementHeight,borderRadius:t.radii.default,overflow:"hidden","& > div":{position:"absolute",inset:0}})),Wt=(t,e)=>e===E.Directory?{...t,webkitdirectory:"",multiple:!0}:t,Re=(t,e)=>{if(!e||e.length===0)return!0;const o=t.name.toLowerCase(),s=o.lastIndexOf(".");if(s===-1||s===o.length-1)return e.some(d=>d===""||d===".");const c=o.substring(s),p=o.substring(s+1);return e.some(d=>{const w=d.toLowerCase();return w.startsWith(".")?c===w:p===w})},Ae=(t,e)=>Re(t,e)?{isValid:!0}:{isValid:!1,errorMessage:`${t.type||"This type of"} files are not allowed.`},Z=t=>{switch(t){case E.None:return"a file";case E.Single:return"a file";case E.Multiple:return"files";case E.Directory:return"a directory";default:return yt(t),"a file"}},De=h("div",{target:"efarq9u0"})(({theme:t})=>({backgroundColor:t.colors.transparent,position:"absolute",inset:0,zIndex:t.zIndices.priority,borderRadius:t.radii.chatInput})),Me=h("div",{target:"efarq9u1"})(({theme:t})=>({position:"absolute",inset:0,border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.primary,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,color:t.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:t.fontWeights.bold,pointerEvents:"none",zIndex:t.zIndices.priority})),ke=h("div",{target:"efarq9u2"})(({disabled:t})=>({pointerEvents:t?"none":"auto"})),Fe=h("div",{target:"efarq9u3"})(({theme:t})=>({lineHeight:t.lineHeights.tight})),Ue=h("div",{target:"efarq9u4"})(({theme:t})=>({display:"flex",flexWrap:"wrap",gap:t.spacing.sm})),He=h("div",{target:"efarq9u5"})({flex:"0 0 auto",maxWidth:"100%"}),Te=h("div",{target:"efarq9u6"})(({theme:t,isError:e,isClickable:o})=>({position:"relative",display:"inline-flex",alignItems:"center",width:"fit-content",minWidth:"9rem",maxWidth:"100%",backgroundColor:e?t.colors.redBackgroundColor:t.colors.bgColor,padding:t.spacing.twoXS,paddingRight:t.spacing.twoXL,borderRadius:t.radii.default,gap:t.spacing.sm,cursor:o?"pointer":"default"})),Ne=h("div",{target:"efarq9u7"})({display:"flex",flexDirection:"column",minWidth:0}),Be=h("div",{target:"efarq9u8"})(({theme:t,fileStatus:e})=>({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.radii.md,width:t.sizes.chatInputFileIconSize,height:t.sizes.chatInputFileIconSize,flexShrink:0,...e==="uploaded"&&{backgroundColor:t.colors.bodyText,color:t.colors.bgColor},...e==="uploading"&&{backgroundColor:t.colors.fadedText10,color:t.colors.fadedText60},...e==="error"&&{backgroundColor:t.colors.redBackgroundColor,color:t.colors.redTextColor}})),Le=h("div",{target:"efarq9u9"})(({theme:t,fileStatus:e})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:e.type==="uploading"?t.colors.fadedText60:t.colors.bodyText})),We=h("div",{target:"efarq9u10"})(({theme:t})=>({color:t.colors.fadedText60,fontSize:t.fontSizes.sm})),Pe=h("div",{target:"efarq9u11"})(({theme:t})=>({color:t.colors.redTextColor,fontSize:t.fontSizes.sm})),$e=h("small",{target:"efarq9u12"})(({theme:t})=>({position:"absolute",top:t.spacing.twoXS,right:t.spacing.twoXS,display:"flex",alignItems:"center",justifyContent:"center",lineHeight:0,"& button":{display:"flex",alignItems:"center",justifyContent:"center",width:"fit-content",height:"fit-content",minHeight:"unset",minWidth:"unset",maxHeight:"unset",maxWidth:"unset",borderRadius:"50%",backgroundColor:"transparent",color:t.colors.fadedText20,padding:0,overflow:"hidden",boxSizing:"border-box",lineHeight:0,"&:hover":{backgroundColor:"transparent",color:t.colors.fadedText40}}})),Oe=({getRootProps:t,getInputProps:e,acceptFile:o,disabled:s})=>{const c=Wt(e(),o);return I(ke,{"data-testid":"stChatInputFileUploadButton",disabled:s,...t(),children:[a("input",{...c}),a(bt,{content:`Upload or drag and drop ${Z(o)}`,placement:xt.TOP,onMouseEnterDelay:500,children:a(H,{disabled:s,"aria-label":`Upload ${Z(o)}`,children:a(A,{content:Ft,size:"xl",color:"inherit"})})})]})},Xe=r.memo(Oe),qe=({getRootProps:t,getInputProps:e,acceptFile:o})=>{const s=Wt(e(),o);return I($,{children:[a(De,{...t(),children:a("input",{...s})}),a(Me,{children:`Drag and drop ${Z(o)} here`})]})},je=r.memo(qe),_e=new Set(["jpg","jpeg","png","gif","webp","svg","bmp"]),Ke=new Set(["pdf"]),Ge=new Set(["csv","tsv","xlsx","xls"]),Ye=new Set(["txt","md","json","xml","yaml","yml"]),Je=new Set(["py","js","ts","jsx","tsx","css","html","java","cpp","c","go","rs","rb","php","swift","kt","scala","sh","bash","sql"]),Qe=new Set(["mp3","wav","m4a","ogg","flac","aac"]),Ze=new Set(["mp4","webm","mov","avi","mkv","wmv"]),tr=new Set(["zip","tar","gz","rar","7z","bz2"]);function er(t){const e=t.lastIndexOf(".");return e===-1||e===t.length-1?"":t.slice(e+1).toLowerCase()}function rr(t){const e=er(t);return _e.has(e)?Dt:Ke.has(e)?It:Ge.has(e)?me:Ye.has(e)?Rt:Je.has(e)?Vt:Qe.has(e)?Mt:Ze.has(e)?kt:tr.has(e)?At:ie}const or=36;function nr(t,e=or){if(t.length<=e)return t;const o=t.lastIndexOf(".");if(!(o>0&&o<t.length-1)){const g=Math.floor((e-3)/2),m=g>0?t.slice(-g):"";return`${t.slice(0,g)}...${m}`}const c=t.slice(o),p=t.slice(0,o),d=e-c.length-3;if(d<=0){const g=Math.floor((e-3)/2),m=g>0?t.slice(-g):"";return`${t.slice(0,g)}...${m}`}const w=Math.ceil(d/2),y=Math.floor(d/2),v=y>0?p.slice(-y):"";return`${p.slice(0,w)}...${v}${c}`}const ar=({fileInfo:t})=>{const{type:e}=t.status;switch(e){case"uploading":return a(Et,{iconValue:"spinner",testid:"stChatInputFileIconSpinner",size:"lg"});case"error":return a(A,{content:we,size:"lg",testid:"stChatInputFileIconError"});case"uploaded":return a(A,{content:rr(t.name),size:"lg"});default:return yt(e),null}},ir=({fileInfo:t,onDelete:e,onRetry:o})=>{const s=t.status.type,c=s==="error",p=s==="uploading",d=c&&o!==void 0&&t.file!==void 0,w=t.status.type==="error"?t.status.errorMessage:"Upload failed",y=r.useCallback(()=>{d&&o(t)},[d,o,t]),v=r.useCallback(V=>{d&&(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),o(t))},[d,o,t]),g=r.useCallback(V=>{V.stopPropagation(),e(t.id)},[e,t.id]),m=p?`Cancel upload of ${t.name}`:`Remove ${t.name}`,f=Ct(t.size,O.Byte),C=c?`${t.name}, ${w}`:`${t.name}, ${f}`;return I(Te,{className:"stChatInputFile","data-testid":"stChatInputFile",isError:c,isClickable:d,onClick:d?y:void 0,onKeyDown:d?v:void 0,title:d?"Click to retry upload":void 0,role:d?"button":void 0,tabIndex:d?0:void 0,"aria-label":C,children:[a(Be,{fileStatus:s,children:a(ar,{fileInfo:t})}),I(Ne,{children:[a(Le,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:t.name,fileStatus:t.status,children:nr(t.name)}),c?a(Pe,{"data-testid":"stChatInputFileError",children:w}):a(We,{children:Ct(t.size,O.Byte)})]}),a($e,{"data-testid":"stChatInputDeleteBtn",children:a(Qt,{onClick:g,kind:Zt.MINIMAL,"aria-label":m,children:a(A,{content:Ht,size:"md"})})})]})},lr=r.memo(ir),sr=({items:t,onDelete:e,onRetry:o})=>a(Fe,{"data-testid":"stChatUploadedFiles",children:a(Ue,{children:t.map(s=>a(He,{children:a(lr,{fileInfo:s,onDelete:e,onRetry:o})},s.id))})}),cr=r.memo(sr),dr=(t,e)=>{const o=[],s=[];return t.forEach(c=>{const p=Ae(c,e.fileType);p.isValid?o.push(c):s.push({file:c,errors:[{code:St.FileInvalidType,message:p.errorMessage||"File type not allowed."}]})}),{accepted:o,rejected:s}},ur=({acceptMultipleFiles:t,acceptDirectoryFiles:e,maxFileSize:o,uploadClient:s,uploadFile:c,addFiles:p,getNextLocalFileId:d,deleteExistingFiles:w,onUploadComplete:y,element:v})=>(g,m)=>{if(e&&g.length>0){const{accepted:f,rejected:C}=dr(g,v);g=f,m=[...m,...C]}if(!t&&g.length===0&&m.length>1){const f=m.findIndex(C=>C.errors?.[0].code===St.TooManyFiles);f>=0&&(g.push(m[f].file),m.splice(f,1))}if(!t&&g.length>0&&w(),s.fetchFileURLs(g).then(f=>{te(f,g).forEach(([C,V])=>{c(C,V)})}).catch(f=>{p(g.map(C=>new zt(C.name,C.size,d(),{type:"error",errorMessage:f},C)))}),m.length>0){const f=m.map(C=>le(C,d(),o));p(f)}y()},pr=({getNextLocalFileId:t,addFiles:e,updateFile:o,uploadClient:s,element:c,onUploadProgress:p,onUploadComplete:d})=>(w,y)=>{const v=y.webkitRelativePath||y.name,g=new AbortController,m=new zt(v,y.size,t(),{type:"uploading",abortController:g,progress:1},y);e([m]),s.uploadFile({formId:"",...c},w.uploadUrl,y,f=>p(f,m.id),g.signal).then(()=>d(m.id,w)).catch(f=>{f instanceof DOMException&&f.name==="AbortError"||o(m.id,m.setStatus({type:"error",errorMessage:f?f.toString():"Unknown error"}))})},J=(t,e,o)=>o.map(s=>s.id===t?e:s),Q=(t,e)=>e.find(o=>o.id===t);function gr({disabled:t,element:e,widgetMgr:o,fragmentId:s,uploadClient:c}){const p=ee(),{placeholder:d,maxChars:w}=e,y=r.useRef(0),v=r.useRef(null),g=r.useRef(!1),m=r.useRef(null),f=r.useRef(null),{width:C,elementRef:V}=re(),{innerWidth:tt,innerHeight:et}=oe(),[F,X]=r.useState(e.default),[D,M]=r.useState([]),[T,q]=r.useState(!1),[N,rt]=r.useState(!1),[j,B]=r.useState(null),_=e.acceptAudio??!1;r.useEffect(()=>()=>{f.current&&f.current.abort()},[]);const U=ge({textareaRef:v,dependencies:[d]}),L=r.useMemo(()=>D.some(n=>n.status.type==="uploading")?!1:F!==""||D.length>0,[D,F]),z=ne(e.acceptFile),ot=se(e.maxUploadSizeMb,O.Megabyte,O.Byte),nt=r.useCallback(n=>M(l=>[...l,...n]),[]),at=r.useCallback(n=>{n.status.type==="uploading"&&n.status.abortController.abort(),n.status.type==="uploaded"&&n.status.fileUrls.deleteUrl&&c.deleteFile(n.status.fileUrls.deleteUrl).catch(l=>{P.error("Failed to delete file from server:",l)})},[c]),it=r.useCallback(n=>{M(l=>{const u=Q(n,l);return Y(u)?l:(at(u),l.filter(i=>i.id!==n))})},[at]),K=r.useRef(null),Pt=r.useCallback(n=>{!n.file||n.status.type!=="error"||(M(l=>l.filter(u=>u.id!==n.id)),K.current&&K.current([n.file],[]))},[]),lt=r.useCallback(()=>{const n=D.filter(l=>l.status.type==="uploaded").map(l=>{const{name:u,size:i,status:S}=l,{fileId:G,fileUrls:Gt}=S;return new vt({fileId:G,fileUrls:Gt,name:u,size:i})});return new ae({uploadedFileInfo:n})},[D]),st=()=>y.current++,ct=ur({acceptMultipleFiles:z===E.Multiple||z===E.Directory,acceptDirectoryFiles:z===E.Directory,maxFileSize:ot,uploadClient:c,uploadFile:pr({getNextLocalFileId:st,addFiles:nt,updateFile:(n,l)=>{M(u=>J(n,l,u))},uploadClient:c,element:e,onUploadProgress:(n,l)=>{M(u=>{const i=Q(l,u);if(Y(i)||i.status.type!=="uploading")return u;const S=Math.round(n.loaded*100/n.total);return i.status.progress===S?u:J(l,i.setStatus({type:"uploading",abortController:i.status.abortController,progress:S}),u)})},onUploadComplete:(n,l)=>{M(u=>{const i=Q(n,u);return Y(i)||i.status.type!=="uploading"?u:J(i.id,i.setStatus({type:"uploaded",fileId:l.fileId,fileUrls:l}),u)})}}),addFiles:nt,getNextLocalFileId:st,deleteExistingFiles:()=>D.forEach(n=>it(n.id)),onUploadComplete:()=>{v.current&&v.current.focus()},element:e});K.current=ct;const{getRootProps:dt,getInputProps:ut}=ce({onDrop:ct,multiple:z===E.Multiple||z===E.Directory,accept:de(e.fileType),maxSize:ot}),W=r.useCallback(n=>{if(v.current&&v.current.focus(),!L&&!n||t)return;const l=lt(),u={data:F,fileUploaderState:l,audioFileInfo:n};o.setChatInputValue(e,u,{fromUi:!0},s),M([]),X(""),U.clearScrollHeight()},[L,t,F,lt,o,e,s,U]),pt=r.useCallback(async n=>{const l=new Date().toISOString().replace(/[:.]/g,"-"),u=new File([n],`audio-${l}.wav`,{type:"audio/wav"});try{rt(!0);const i=await c.fetchFileURLs([u]);if(i.length===0)throw new Error("Failed to get upload URL for audio file");const S=i[0];f.current=new AbortController,await c.uploadFile({formId:"",...e},S.uploadUrl,u,()=>{},f.current.signal);const G=new vt({fileId:S.fileId,fileUrls:S,name:u.name,size:u.size});W(G)}catch(i){const S="Recording failed";P.error("Audio upload failed:",i),B(S),v.current&&v.current.focus()}finally{rt(!1)}},[c,e,W]),$t=r.useMemo(()=>({onApprove:pt,onPermissionDenied:()=>{const n="Microphone access denied";B(n),P.error("Permission denied:",n)},onError:n=>{B("Recording failed"),P.error("Recording error:",n)},onRecordStart:()=>{B(null)}}),[pt]),R=ue({containerRef:m,sampleRate:e.audioSampleRate??void 0,events:$t}),gt=r.useCallback(()=>{W()},[W]),Ot=n=>{const{metaKey:l,ctrlKey:u,shiftKey:i}=n;he(n)&&!i&&!u&&!l&&(n.preventDefault(),gt())},Xt=n=>{const{value:l}=n.target;w!==0&&l.length>w||(X(l),U.updateScrollHeight(),j&&B(null))},ft=r.useCallback(async n=>{n.preventDefault(),n.stopPropagation(),!(!_||t||R.state==="recording")&&await R.start()},[_,t,R]),qt=r.useCallback(()=>{R.cancel(),v.current&&v.current.focus()},[R]),ht=r.useCallback(async()=>{const{blob:n}=await R.stop();await R.approve(n)},[R]),mt=r.useCallback(n=>{ft(n)},[ft]),jt=r.useCallback(()=>{ht()},[ht]),_t=r.useCallback(()=>{v.current&&v.current.focus()},[]);r.useEffect(()=>{if(e.setValue&&!g.current){g.current=!0;const n=e.value||"";X(n)}},[e.setValue,e.value]),r.useEffect(()=>{g.current=!1},[e]),r.useEffect(()=>{const n=i=>{i.preventDefault(),i.stopPropagation(),!T&&i.dataTransfer?.types.includes("Files")&&q(!0)},l=i=>{i.preventDefault(),i.stopPropagation(),T&&(i.clientX<=0&&i.clientY<=0||i.clientX>=tt&&i.clientY>=et)&&q(!1)},u=i=>{i.preventDefault(),i.stopPropagation(),T&&q(!1)};return window.addEventListener("dragover",n),window.addEventListener("drop",u),window.addEventListener("dragleave",l),()=>{window.removeEventListener("dragover",n),window.removeEventListener("drop",u),window.removeEventListener("dragleave",l)}},[T,tt,et]);const Kt=z!==E.None&&T,k=R.state==="recording",wt=!k&&C>p.breakpoints.hideWidgetDetails&&w>0;return a(ve,{className:"stChatInput","data-testid":"stChatInput",ref:V,children:I(Ce,{extended:U.isExtended||k,children:[wt&&a(ze,{onClick:_t,id:"stChatInputInstructions",children:a(pe,{dirty:L,value:F,maxLength:w,type:"chat",inForm:!1,className:"stChatInputInstructions"})}),I(ye,{children:[Kt&&a(je,{getRootProps:dt,getInputProps:ut,acceptFile:z}),z!==E.None&&D.length>0&&a(cr,{items:[...D],onDelete:it,onRetry:Pt}),I(xe,{children:[a(Ie,{isRecording:k,children:a(Ve,{ref:m})}),!k&&a($,{children:a(fe,{inputRef:v,value:F,placeholder:d,onChange:Xt,onKeyDown:Ot,"aria-label":d,disabled:t,rows:1,"aria-describedby":wt?"stChatInputInstructions":void 0,overrides:{Root:{style:{minHeight:p.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0",width:"100%"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{fontWeight:p.fontWeights.normal,lineHeight:p.lineHeights.inputWidget,"::placeholder":{color:p.colors.fadedText60},height:U.height,maxHeight:U.maxHeight,overflowY:"auto",paddingLeft:p.spacing.none,paddingRight:p.spacing.none,paddingBottom:p.spacing.sm,paddingTop:p.spacing.sm,width:"100%"}}}})})]})]}),I(be,{children:[I(Ee,{children:[z!==E.None&&!k&&a(Xe,{getRootProps:dt,getInputProps:ut,acceptFile:z,disabled:t}),_&&!k&&a($,{children:j?a(bt,{content:j,placement:xt.TOP,error:!0,children:a(H,{onClick:mt,disabled:t||N,hasError:!0,"data-testid":"stChatInputMicButton","aria-label":"Start recording",children:a(A,{content:Bt,size:"xl",color:"inherit"})})}):a(H,{onClick:mt,disabled:t||N,"data-testid":"stChatInputMicButton","aria-label":"Start recording",children:a(A,{content:Lt,size:"xl",color:"inherit"})})})]}),a(Se,{children:k?I($,{children:[a(H,{onClick:qt,disabled:t,"data-testid":"stChatInputCancelButton","aria-label":"Cancel recording",children:a(A,{content:Nt,size:"lg",color:"inherit"})}),a(H,{onClick:jt,disabled:t||N,"data-testid":"stChatInputApproveButton","aria-label":"Submit recording",children:N?a(Et,{size:"lg",iconValue:"spinner"}):a(A,{content:Tt,size:"lg",color:"inherit"})})]}):a(H,{onClick:gt,disabled:!L||t||N,"data-testid":"stChatInputSubmitButton","aria-label":"Send message",primary:!0,children:a(A,{content:Ut,size:"lg",color:"inherit"})})})]})]})})}const Sr=r.memo(gr);export{Sr as default};
