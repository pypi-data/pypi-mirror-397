import{r as a,E as k,_ as A,aX as o,k as W,t as H,z as c,aY as P,aC as v,g as G,f as X,l as f,j as i,m as F,o as h,T as U,P as Y,p as q,az as j,aZ as Z,aN as J}from"./index.CQ-Kx4vm.js";import{e as K,S as Q,a as ee,b as re}from"./embed.DsLO4l2l.js";import{i as L,f as oe}from"./formatNumber.BX_kK_kt.js";import"./threshold.CUNQbqMA.js";import"./value.DaKxGC7O.js";import"./timer.BZio6gjG.js";import"./numbro.B9_PXfzp.js";import"./sprintf.DpPCfzXw.js";var z=a.forwardRef(function(e,r){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return a.createElement(k,A({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:r}),a.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),a.createElement("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}))});z.displayName="ArrowDownward";var b=a.forwardRef(function(e,r){var t={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return a.createElement(k,A({iconAttrs:t,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:r}),a.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),a.createElement("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"}))});b.displayName="ArrowUpward";function R(e,r){switch(r){case o.MetricColor.RED:return e.colors.redColor;case o.MetricColor.GREEN:return e.colors.greenColor;case o.MetricColor.ORANGE:return e.colors.orangeColor;case o.MetricColor.YELLOW:return e.colors.yellowColor;case o.MetricColor.BLUE:return e.colors.blueColor;case o.MetricColor.VIOLET:return e.colors.violetColor;case o.MetricColor.PRIMARY:return e.colors.primary;default:return e.colors.grayColor}}function V(e,r){const t=W(e);switch(r){case o.MetricColor.RED:return e.colors.redBackgroundColor;case o.MetricColor.GREEN:return e.colors.greenBackgroundColor;case o.MetricColor.ORANGE:return e.colors.orangeBackgroundColor;case o.MetricColor.YELLOW:return e.colors.yellowBackgroundColor;case o.MetricColor.BLUE:return e.colors.blueBackgroundColor;case o.MetricColor.VIOLET:return e.colors.violetBackgroundColor;case o.MetricColor.PRIMARY:return H(e.colors.primary,t?.9:.7);default:return e.colors.grayBackgroundColor}}function te(e,r){switch(r){case o.MetricColor.RED:return e.colors.redTextColor;case o.MetricColor.GREEN:return e.colors.greenTextColor;case o.MetricColor.ORANGE:return e.colors.orangeTextColor;case o.MetricColor.YELLOW:return e.colors.yellowTextColor;case o.MetricColor.BLUE:return e.colors.blueTextColor;case o.MetricColor.VIOLET:return e.colors.violetTextColor;case o.MetricColor.PRIMARY:return e.colors.primary;default:return e.colors.grayTextColor}}const ie=c("div",{target:"enc5gi0"})(({theme:e,showBorder:r})=>({height:"100%",...r&&{border:`${e.sizes.borderWidth} solid ${e.colors.borderColor}`,borderRadius:e.radii.default,overflow:"hidden"}})),ae=c("div",{target:"enc5gi1"})(({theme:e,showBorder:r})=>({...r&&{padding:`calc(${e.spacing.lg} - ${e.sizes.borderWidth})`}})),le=c("div",{target:"enc5gi2"})(({theme:e,showBorder:r})=>({marginTop:r?void 0:e.spacing.lg,marginBottom:r?e.spacing.twoXL:void 0})),x=c("div",{target:"enc5gi3"})(({theme:e})=>({overflowWrap:"normal",textOverflow:"ellipsis",width:"100%",overflow:"hidden",whiteSpace:"nowrap",fontFamily:e.genericFonts.bodyFont,lineHeight:"normal",verticalAlign:"middle","& > div":{overflow:"hidden","& > p":{textOverflow:"ellipsis",overflow:"hidden"}}})),ne=c(P,{target:"enc5gi4"})(({visibility:e})=>({marginBottom:0,display:e===v.Collapsed?"none":"grid",gridTemplateColumns:e===v.Collapsed?"initial":"auto 1fr",visibility:e===v.Hidden?"hidden":"visible"})),se=c("div",{target:"enc5gi5"})(({theme:e})=>({fontSize:e.fontSizes.threeXL,color:e.colors.bodyText,paddingBottom:e.spacing.twoXS})),ce=c("div",{target:"enc5gi6"})(({theme:e,metricColor:r,showArrow:t})=>({color:te(e,r),backgroundColor:V(e,r),fontSize:e.fontSizes.sm,display:"inline-flex",flexDirection:"row",alignItems:"center",fontWeight:e.fontWeights.normal,borderRadius:e.radii.full,maxWidth:"100%",padding:`${e.spacing.threeXS} ${e.spacing.xs} ${e.spacing.threeXS} ${e.spacing.xs}`,...t&&{paddingLeft:e.spacing.twoXS}})),de=1e3;function S(e,r){try{return oe(Number(e),r)}catch{return e}}function ue(e,r,t,l,g){const n=`metric_chart_${Math.random().toString(36).slice(2,10)}`,y=e.length===1?[e[0],e[0]]:e,s={$schema:"https://vega.github.io/schema/vega-lite/v5.json",width:Math.round(t),height:Math.round(J("3.5rem")),data:{values:y.map((M,p)=>({x:p,y:M}))},layer:[{name:`${n}_mark`,mark:{type:"line",...r===o.ChartType.LINE&&{type:"line",strokeCap:"round",strokeWidth:2},...r===o.ChartType.BAR&&{type:"bar",cornerRadius:parseFloat(l.radii.full)},...r===o.ChartType.AREA&&{type:"area",color:V(l,g),opacity:1,line:{color:R(l,g),opacity:1,strokeWidth:2,strokeCap:"round"}}},encoding:{x:{field:"x",type:"quantitative",axis:null,scale:{zero:!1,nice:!1}},y:{field:"y",type:"quantitative",axis:null,scale:{zero:!1,nice:!1}}}},{name:`${n}_points`,mark:{type:"point",opacity:0},encoding:{x:{field:"x",type:"quantitative",axis:null,scale:{zero:!1,nice:!1}},y:{field:"y",type:"quantitative",axis:null,scale:{zero:!1,nice:!1}}},params:[{name:`${n}_hover_selection`,select:{type:"point",encodings:["x"],nearest:!0,on:e.length>de?"mousemove{16}":"mousemove",clear:"mouseleave"}}]},{name:`${n}_highlighted_points`,transform:[{filter:{param:`${n}_hover_selection`,empty:!1}}],mark:{type:"point",filled:!0,size:65,tooltip:!0},encoding:{x:{field:"x",type:"quantitative",axis:null,scale:{zero:!1,nice:!1}},y:{field:"y",type:"quantitative",axis:null,scale:{zero:!1,nice:!1}}}}],config:{view:{stroke:null},padding:{left:-3,right:-3,top:2,bottom:2},...r===o.ChartType.BAR&&{padding:{left:0,right:0,top:2,bottom:2}},mark:{tooltip:{content:"encoding"},color:R(l,g)}}};return s.config=ee(s.config,l),s}function ge({element:e}){const r=G(),t=a.useRef(null),{width:l,elementRef:g}=X(),{MetricDirection:C}=o,{body:n,label:y,delta:s,direction:M,color:p,labelVisibility:B,help:E,showBorder:w,chartData:d,chartType:T,format:m}=e,N=m&&L(n)?S(n,m):n,I=m&&s&&L(s)?S(s,m):s;let u=null;switch(M){case C.DOWN:u=z;break;case C.UP:u=b;break;case C.NONE:break}const $="0 threeXS 0 0",O=s!=="";return a.useEffect(()=>{if(d&&d.length>0&&t.current&&l>0){const _=ue(d,T,l,r,p);K(t.current,_,{actions:!1,renderer:"svg",ast:!0,expr:re,tooltip:{theme:"custom",formatTooltip:D=>`${D.y}`}})}},[d,p,r,l,T,t]),f(ie,{className:"stMetric","data-testid":"stMetric",showBorder:w,children:[f(ae,{showBorder:w,children:[f(ne,{"data-testid":"stMetricLabel",visibility:F(B?.value),children:[i(x,{children:i(h,{source:y,allowHTML:!1,isLabel:!0})}),E&&i(q,{children:i(U,{content:E,placement:Y.TOP_RIGHT})})]}),i(se,{"data-testid":"stMetricValue",children:i(x,{children:i(h,{source:N,allowHTML:!1,isLabel:!0,inheritFont:!0})})}),O&&f(ce,{"data-testid":"stMetricDelta",metricColor:p,showArrow:u!==null,children:[u&&i(j,{testid:u===b?"stMetricDeltaIcon-Up":"stMetricDeltaIcon-Down",content:u,size:"md",margin:$}),i(x,{children:i(h,{source:I,allowHTML:!1,isLabel:!0,inheritFont:!0})})]})]}),d&&d.length>0&&f("div",{ref:g,children:[i(Z,{styles:[Q]}),i(le,{ref:t,"data-testid":"stMetricChart",showBorder:w})]})]})}const he=a.memo(ge);export{he as default};
