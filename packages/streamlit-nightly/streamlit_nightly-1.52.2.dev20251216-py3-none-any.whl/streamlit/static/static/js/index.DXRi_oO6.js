import{r as n,E as L,_ as k,z as p,aN as be,l as S,j as s,az as I,b as V,c as ve,B as M,h as Ue,a2 as ze,f as Ce,al as ee,bd as Ie,i as D,bR as Ee,m as Be,ad as De,T as Le,P as ke,ae as Ve,bM as Me,bN as Pe}from"./index.CQ-Kx4vm.js";import{u as Re}from"./FormClearHelper.BmlA5tFH.js";import{g as ne,F as P,a as Ne,D as Te,I as Ae,s as We,b as He}from"./FileHelper.CjivnkwE.js";import{S as $e,P as je}from"./ProgressBar.BZQXMaVR.js";import{U as j}from"./UploadFileInfo.Dr-zDST7.js";const Xe=e=>{const t=n.useRef();return n.useEffect(()=>{t.current=e},[e]),t.current};var oe=n.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(L,k({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),n.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),n.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l4.58-4.59z"}))});oe.displayName="ChevronLeft";var ae=n.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(L,k({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),n.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),n.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6-6-6z"}))});ae.displayName="ChevronRight";var le=n.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(L,k({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),n.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),n.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"}))});le.displayName="Clear";var se=n.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(L,k({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),n.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),n.createElement("path",{d:"M19.35 10.04A7.49 7.49 0 0012 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 000 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95A5.469 5.469 0 0112 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11A2.98 2.98 0 0122 15c0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}))});se.displayName="CloudUpload";var ie=n.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(L,k({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),n.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))});ie.displayName="Error";const re=p("section",{target:"e16n7gab0"})(({isDisabled:e,theme:t})=>({display:"flex",gap:t.spacing.lg,alignItems:"center",padding:t.spacing.lg,backgroundColor:t.colors.secondaryBg,borderRadius:t.radii.default,border:t.colors.widgetBorderColor?`${t.sizes.borderWidth} solid ${t.colors.widgetBorderColor}`:void 0,height:t.sizes.largestElementHeight,":focus":{outline:"none"},":focus-visible":{boxShadow:`0 0 0 1px ${t.colors.primary}`},cursor:e?"not-allowed":"pointer"})),Oe=p("div",{target:"e16n7gab1"})(({theme:e})=>({marginRight:"auto",alignItems:"center",display:"flex",gap:e.spacing.lg,minWidth:0,width:"100%"})),ce=p("span",{target:"e16n7gab2"})(({theme:e})=>({color:e.colors.darkenedBgMix100})),de=p("span",{target:"e16n7gab3"})(({theme:e,disabled:t})=>({color:t?e.colors.fadedText40:e.colors.bodyText})),_e=p("span",{target:"e16n7gab4"})(({theme:e,disabled:t})=>({fontSize:e.fontSizes.sm,color:t?e.colors.fadedText40:e.colors.fadedText60,display:"block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%"})),qe=p("div",{target:"e16n7gab5"})({display:"flex",flexDirection:"column",minWidth:0,maxWidth:"100%"}),Ge=p("span",{target:"e16n7gab6"})({whiteSpace:"nowrap"}),pe=p("div",{target:"e16n7gab7"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg})),Ke=p("ul",{target:"e16n7gab8"})(({theme:e})=>({listStyleType:"none",margin:e.spacing.none,padding:e.spacing.none})),ue=p("li",{target:"e16n7gab9"})(({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none})),ge=p("div",{target:"e16n7gab10"})(({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"})),fe=p("div",{target:"e16n7gab11"})(({theme:e,disabled:t})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t?e.colors.fadedText40:e.colors.bodyText})),he=p("div",{target:"e16n7gab12"})(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS})),Ye=p("span",{target:"e16n7gab13"})(({theme:e})=>({marginRight:e.spacing.twoXS})),Je=p("div",{target:"e16n7gab14"})(({theme:e,disabled:t})=>({display:"flex",padding:e.spacing.twoXS,color:t?e.colors.fadedText40:e.colors.darkenedBgMix100})),me=p("small",{target:"e16n7gab15"})(({theme:e})=>({color:e.colors.redTextColor,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"})),Fe=p("span",{target:"e16n7gab16"})({}),Qe=e=>({[re]:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"auto",gap:e.spacing.sm},[ce]:{display:"none"},[de]:{marginBottom:e.spacing.twoXS},[pe]:{paddingRight:e.spacing.lg},[he]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[fe]:{width:e.sizes.full},[ge]:{flexDirection:"column"},[me]:{height:"auto",whiteSpace:"initial"},[Fe]:{display:"none"},[ue]:{margin:e.spacing.none,padding:e.spacing.none}}),Ze=p("div",{target:"e16n7gab17"})(({theme:e,width:t})=>{if(t<be("23rem"))return Qe(e)}),et=({multiple:e,acceptedExtensions:t,maxSizeBytes:o,acceptDirectory:i=!1,disabled:d})=>{const x=()=>i?"directories":e?"files":"file",c=()=>t.length?` â€¢ ${t.map(y=>y.replace(/^\./,"").toUpperCase()).join(", ")}`:null,m=()=>`Limit ${ne(o,P.Byte,0)} per file`;return S(Oe,{"data-testid":"stFileUploaderDropzoneInstructions",children:[s(ce,{children:s(I,{content:se,size:"threeXL"})}),S(qe,{children:[S(de,{disabled:d,children:["Drag and drop ",x()," here"]}),S(_e,{disabled:d,children:[m(),c()]})]})]})},tt=n.memo(et),nt=({onDrop:e,multiple:t,acceptedExtensions:o,maxSizeBytes:i,disabled:d,label:x,acceptDirectory:c=!1})=>s(Te,{onDrop:e,multiple:t,accept:Ne(o),maxSize:i,disabled:d,useFsAccessApi:!1,children:({getRootProps:m,getInputProps:y})=>{const v=y({multiple:t||!!c});return S(re,{...m(),"data-testid":"stFileUploaderDropzone",isDisabled:d,"aria-label":x,"aria-disabled":d,children:[s("input",{"data-testid":"stFileUploaderDropzoneInput",...v,...c&&{webkitdirectory:""}}),s(tt,{multiple:t,acceptedExtensions:o,maxSizeBytes:i,acceptDirectory:c,disabled:d}),s(Ge,{children:s(V,{kind:M.SECONDARY,disabled:d,size:ve.SMALL,children:c?"Browse directories":"Browse files"})})]})}}),ot=n.memo(nt),ye=p("small",{target:"ek5bcwe0"})(({kind:e,disabled:t,theme:o})=>{const{redTextColor:i,fadedText60:d,fadedText40:x}=o.colors;let c=d;return t&&(c=x),e==="danger"&&(c=i),{color:c,fontSize:o.fontSizes.sm,lineHeight:o.lineHeights.tight}}),at=({fileInfo:e,disabled:t})=>e.status.type==="uploading"?s(je,{value:e.status.progress,size:$e.SMALL}):e.status.type==="error"?S(me,{children:[s(Ye,{"data-testid":"stFileUploaderFileErrorMessage",children:e.status.errorMessage}),s(Fe,{children:s(I,{content:ie,size:"lg"})})]}):e.status.type==="uploaded"?s(ye,{disabled:t,children:ne(e.size,P.Byte)}):null,lt=({fileInfo:e,onDelete:t,disabled:o})=>S(he,{className:"stFileUploaderFile","data-testid":"stFileUploaderFile",children:[s(Je,{disabled:o,children:s(I,{content:Ae,size:"twoXL"})}),S(ge,{className:"stFileUploaderFileData",children:[s(fe,{className:"stFileUploaderFileName","data-testid":"stFileUploaderFileName",title:e.name,disabled:o,children:e.name}),s(at,{fileInfo:e,disabled:o})]}),s("div",{"data-testid":"stFileUploaderDeleteBtn",children:s(V,{onClick:()=>t(e.id),kind:M.MINIMAL,disabled:o,"aria-label":`Remove ${e.name}`,children:s(I,{content:le,size:"lg"})})})]}),st=n.memo(lt),it=p("div",{target:"egc9vxm0"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS})),rt=p("div",{target:"egc9vxm1"})(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40})),ct=({currentPage:e,totalPages:t,onNext:o,onPrevious:i})=>S(it,{"data-testid":"stFileUploaderPagination",children:[s(ye,{children:`Showing page ${e} of ${t}`}),S(rt,{children:[s(V,{onClick:i,kind:M.MINIMAL,children:s(I,{content:oe,size:"xl"})}),s(V,{onClick:o,kind:M.MINIMAL,children:s(I,{content:ae,size:"xl"})})]})]}),dt=n.memo(ct),te=(e,t)=>Math.ceil(e.length/t),pt=e=>Ue(({pageSize:o,items:i,resetOnAdd:d,...x})=>{const[c,m]=n.useState(0),[y,v]=n.useState(()=>te(i,o)),u=Xe(i);n.useEffect(()=>{u&&u.length!==i.length&&v(te(i,o)),u&&u.length<i.length?d&&m(0):c+1>=y&&m(y-1)},[i,c,o,u,d,y]);const E=()=>{m(Math.min(c+1,y-1))},U=()=>{m(Math.max(0,c-1))},R=i.slice(c*o,c*o+o);return S(ze,{children:[s(e,{items:R,...x}),i.length>o?s(dt,{pageSize:o,totalPages:y,currentPage:c+1,onNext:E,onPrevious:U}):null]})},e),ut=({items:e,onDelete:t,disabled:o})=>s(Ke,{children:e.map(i=>s(ue,{children:s(st,{fileInfo:i,onDelete:t,disabled:o})},i.id))}),gt=pt(ut),ft=e=>s(pe,{children:s(gt,{...e})}),ht=n.memo(ft),mt=(e,t)=>{const o=t.getFileUploaderStateValue(e);if(D(o))return{files:[],nextLocalId:1};const{uploadedFileInfo:i}=o;if(D(i)||i.length===0)return{files:[],nextLocalId:1};let d=1;return{files:i.map(c=>{const m=c.name,y=c.size,v=c.fileId,u=c.fileUrls,E=new j(m,y,d,{type:"uploaded",fileId:v,fileUrls:u});return d+=1,E}),nextLocalId:d}},$=e=>{const t=e.filter(o=>o.status.type==="uploaded").map(o=>{const{name:i,size:d,status:x}=o,{fileId:c,fileUrls:m}=x;return new Me({fileId:c,fileUrls:m,name:i,size:d})});return new Pe({uploadedFileInfo:t})},Ft=({disabled:e,element:t,widgetMgr:o,uploadClient:i,fragmentId:d})=>{const{width:x,elementRef:c}=Ce(),{files:m,nextLocalId:y}=n.useMemo(()=>mt(t,o),[t,o]),v=n.useRef(y),[u,E]=n.useState(()=>m),U=n.useRef(u);n.useEffect(()=>{U.current=u},[u]);const[R,X]=n.useState(!1),B=n.useCallback(()=>{const a=v.current;return v.current+=1,a},[]),N=n.useMemo(()=>{const a=t.maxUploadSizeMb;return We(a,P.Megabyte,P.Byte)},[t.maxUploadSizeMb]),b=n.useCallback(a=>{ee.flushSync(()=>{E(l=>{const r=typeof a=="function"?a(l):a;return U.current=r,r})})},[]),T=n.useCallback(a=>{ee.flushSync(()=>{X(a)})},[X]),O=n.useCallback(a=>{b(l=>[...l,a])},[b]),A=n.useCallback(a=>{a.length!==0&&b(l=>[...l,...a])},[b]),_=n.useCallback(a=>{b(l=>l.filter(r=>r.id!==a))},[b]),z=n.useCallback((a,l)=>{b(r=>r.map(g=>g.id===a?l:g))},[b]),C=n.useCallback(a=>U.current.find(l=>l.id===a),[]),q=u.some(a=>a.status.type==="uploading")||R?"updating":"ready";n.useEffect(()=>{o.getFileUploaderStateValue(t)===void 0&&o.setFileUploaderStateValue(t,$(U.current),{fromUi:!1},d)},[o,t,d]),n.useEffect(()=>{if(q!=="ready")return;const a=$(u),l=o.getFileUploaderStateValue(t);Ie(a,l)||o.setFileUploaderStateValue(t,a,{fromUi:!0},d)},[q,u,o,t,d]);const xe=n.useCallback(()=>{b(()=>[]);const a=$([]);o.setFileUploaderStateValue(t,a,{fromUi:!0},d)},[t,d,b,o]);Re({element:t,widgetMgr:o,onFormCleared:xe});const G=n.useCallback(a=>{const l=t.type;if(!l||l.length===0)return!0;const r=a.name.toLowerCase();return l.some(g=>r.endsWith(g.toLowerCase()))},[t.type]),K=n.useCallback(a=>{const l=[],r=[];return a.forEach(g=>{G(g)?l.push(g):r.push({file:g,errors:[{code:"file-invalid-type",message:`${g.type} files are not allowed.`}]})}),{accepted:l,rejected:r}},[G]),Y=n.useCallback((a,l)=>{const r=C(a);D(r)||r.status.type!=="uploading"||z(r.id,r.setStatus({type:"uploaded",fileId:l.fileId,fileUrls:l}))},[C,z]),J=n.useCallback((a,l)=>{const r=C(l);if(D(r)||r.status.type!=="uploading")return;const g=Math.round(a.loaded*100/a.total);r.status.progress!==g&&z(l,r.setStatus({type:"uploading",abortController:r.status.abortController,progress:g}))},[C,z]),Q=n.useCallback((a,l)=>{const r=new AbortController,g=l.webkitRelativePath||l.name,f=new j(g,l.size,B(),{type:"uploading",abortController:r,progress:1});O(f),i.uploadFile(t,a.uploadUrl,l,h=>J(h,f.id),r.signal).then(()=>Y(f.id,a)).catch(h=>{h instanceof DOMException&&h.name==="AbortError"||z(f.id,f.setStatus({type:"error",errorMessage:h?h.toString():"Unknown error"}))})},[O,t,B,Y,J,z,i]),W=n.useCallback(a=>{if(e)return;const l=C(a);D(l)||(l.status.type==="uploading"&&l.status.abortController.abort(),l.status.type==="uploaded"&&l.status.fileUrls.deleteUrl&&i.deleteFile(l.status.fileUrls.deleteUrl),_(a))},[e,C,_,i]),Se=n.useCallback((a,l)=>{const{multipleFiles:r}=t,g=!!t.acceptDirectory;let f=[...a],h=[...l];if(g&&f.length>0){const{accepted:w,rejected:F}=K(f);f=w,h=[...h,...F]}if(!r&&f.length===0&&h.length>1){const w=h.findIndex(F=>F.errors.length===1&&F.errors[0].code==="too-many-files");w>=0&&(f.push(h[w].file),h.splice(w,1))}if(i.fetchFileURLs(f).then(w=>{if(!r&&f.length>0){const F=U.current.find(H=>H.status.type!=="error");if(F){T(!0);try{W(F.id)}finally{T(!1)}}}Ee(w,f).forEach(([F,H])=>{Q(F,H)})}).catch(w=>{A(f.map(F=>new j(F.name,F.size,B(),{type:"error",errorMessage:w})))}),h.length>0){const w=h.map(F=>He(F,B(),N));A(w)}},[A,W,t,K,N,B,i,Q,T]),Z=n.useMemo(()=>u.slice().reverse(),[u]),we=t.type;return S(Ze,{className:"stFileUploader","data-testid":"stFileUploader",width:x,ref:c,children:[s(Ve,{label:t.label,disabled:e,labelVisibility:Be(t.labelVisibility?.value),children:t.help&&s(De,{children:s(Le,{content:t.help,placement:ke.TOP_RIGHT})})}),s(ot,{onDrop:Se,multiple:t.multipleFiles,acceptedExtensions:we,maxSizeBytes:N,label:t.label,disabled:e,acceptDirectory:!!t.acceptDirectory}),Z.length>0&&s(ht,{items:Z,pageSize:3,onDelete:W,resetOnAdd:!0,disabled:e})]})},vt=n.memo(Ft);export{vt as default};
