import{r as n,E as H,_ as D,z as _,t as ge,l as P,j as U,aA as me,P as re,b as ve,B as Se,az as q,bK as ie,an as be,ai as ye,bc as Ce,g as Ue,bL as we,f as Me,al as xe,i as L,V as Ee,bd as Ie,m as Fe,ad as Re,T as _e,ae as Oe,a2 as Pe,bM as ke,bN as Te}from"./index.CQ-Kx4vm.js";import{U as oe}from"./UploadFileInfo.Dr-zDST7.js";import{u as ze}from"./FormClearHelper.BmlA5tFH.js";import{P as Le,S as We}from"./ProgressBar.BZQXMaVR.js";import{b as Ve}from"./urls.BwSlolu9.js";var ne=n.forwardRef(function(e,a){var d={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(H,D({iconAttrs:d,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:a}),n.createElement("rect",{width:24,height:24,fill:"none"}),n.createElement("path",{d:"M20 5h-3.17l-1.24-1.35A1.99 1.99 0 0014.12 3H9.88c-.56 0-1.1.24-1.48.65L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-1.35 8.35l-2.79 2.79c-.32.32-.86.1-.86-.35v-1.75H9v1.75c0 .45-.54.67-.85.35l-2.79-2.79c-.2-.2-.2-.51 0-.71l2.79-2.79a.5.5 0 01.85.36v1.83h6v-1.83c0-.45.54-.67.85-.35l2.79 2.79c.2.19.2.51.01.7z"}))});ne.displayName="SwitchCamera";var ae=n.forwardRef(function(e,a){var d={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(H,D({iconAttrs:d,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},e,{ref:a}),n.createElement("path",{d:"M.5 1c-.28 0-.5.23-.5.5v4c0 .28.23.5.5.5h5c.28 0 .5-.22.5-.5V4l1 1h1V2H7L6 3V1.5c0-.28-.22-.5-.5-.5h-5z"}))});ae.displayName="Video";var se=n.forwardRef(function(e,a){var d={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return n.createElement(H,D({iconAttrs:d,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},e,{ref:a}),n.createElement("path",{d:"M1.41 0L0 1.41l.72.72L2.5 3.94.72 5.72 0 6.41l1.41 1.44.72-.72 1.81-1.81 1.78 1.81.69.72 1.44-1.44-.72-.69-1.81-1.78 1.81-1.81.72-.72L6.41 0l-.69.72L3.94 2.5 2.13.72 1.41 0z"}))});se.displayName="X";function je(e,a){switch(e){case"xsmall":return{padding:`${a.spacing.twoXS} ${a.spacing.sm}`,fontSize:a.fontSizes.sm};case"small":return{padding:`${a.spacing.twoXS} ${a.spacing.md}`};case"large":return{padding:`${a.spacing.md} ${a.spacing.md}`};default:return{padding:`${a.spacing.xs} ${a.spacing.md}`}}}const le=_("div",{target:"etzmx8d0"})({position:"relative",overflow:"hidden",width:"100%",objectFit:"contain"}),G=_("div",{target:"etzmx8d1"})(({theme:e,width:a})=>({backgroundColor:e.colors.secondaryBg,borderRadius:`${e.radii.default} ${e.radii.default} 0 0`,width:"100%",height:a*9/16,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"})),Be=_("p",{target:"etzmx8d2"})(({theme:e})=>({marginTop:e.spacing.sm,textAlign:"center"})),Ae=_("img",{target:"etzmx8d3"})(({theme:e,opacity:a})=>({borderRadius:`${e.radii.default} ${e.radii.default} 0 0`,objectFit:"contain",opacity:a})),$e=_("a",{target:"etzmx8d4"})(({theme:e})=>({color:e.colors.link,textDecoration:e.linkUnderline?"underline":"none",display:"block"})),Ne=_("span",{target:"etzmx8d5"})({display:"flex",alignItems:"center"}),He=_("div",{target:"etzmx8d6"})(({theme:e})=>({position:"absolute",top:e.spacing.lg,right:e.spacing.lg,zIndex:e.zIndices.priority,color:e.colors.fadedText40,mixBlendMode:"difference",opacity:.6})),De=_("div",{target:"etzmx8d8"})({height:"fit-content",width:"100%",position:"absolute",bottom:0}),qe=_("button",{target:"etzmx8d9"})(({theme:e})=>({position:"relative",display:"inline-flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:e.colors.lightenedBg05,border:`${e.sizes.borderWidth} solid ${e.colors.borderColor}`,borderRadius:`0 0 ${e.radii.default} ${e.radii.default}`,"&:hover":{borderColor:e.colors.primary,color:e.colors.primary},"&:active":{color:e.colors.white,borderColor:e.colors.primary,backgroundColor:e.colors.primary},"&:focus:not(:active)":{borderColor:e.colors.primary,color:e.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{color:e.colors.fadedText40,borderColor:e.colors.borderColor,backgroundColor:e.colors.lightenedBg05,cursor:"not-allowed"},fontWeight:e.fontWeights.normal,padding:`${e.spacing.xs} ${e.spacing.md}`,margin:e.spacing.none,lineHeight:e.lineHeights.base,color:"inherit",width:"100%",userSelect:"none","&:focus":{outline:"none"},"&:focus-visible":{boxShadow:`0 0 0 0.2rem ${ge(e.colors.primary,.5)}`},...je("medium",e)}));function Ge({disabled:e,onClick:a,children:d,progress:g}){return P(qe,{disabled:e||!1,onClick:a||(()=>{}),progress:g||null,"data-testid":"stCameraInputButton",children:[d,g?U(De,{children:U(Le,{value:g,size:We.EXTRASMALL,overrides:{Bar:{style:{borderTopLeftRadius:0,borderTopRightRadius:0}},BarProgress:{style:{borderTopLeftRadius:0,borderTopRightRadius:0}},BarContainer:{style:{borderTopLeftRadius:0,borderTopRightRadius:0}}}})}):null]})}const ce=n.memo(Ge);var j=(function(e){return e.USER="user",e.ENVIRONMENT="environment",e})({});const Xe=({switchFacingMode:e})=>U(He,{"data-testid":"stCameraInputSwitchButton",children:U(me,{content:"Switch camera",placement:re.TOP_RIGHT,children:U(ve,{kind:Se.MINIMAL,onClick:e,children:U(q,{content:ne,size:"twoXL",color:ie.white})})})}),Qe=n.memo(Xe);var B={exports:{}},Je=B.exports,te;function Ke(){return te||(te=1,(function(e,a){(function(g,m){e.exports=m(be())})(Je,function(d){return(function(g){var m={};function p(o){if(m[o])return m[o].exports;var f=m[o]={i:o,l:!1,exports:{}};return g[o].call(f.exports,f,f.exports,p),f.l=!0,f.exports}return p.m=g,p.c=m,p.d=function(o,f,v){p.o(o,f)||Object.defineProperty(o,f,{enumerable:!0,get:v})},p.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},p.t=function(o,f){if(f&1&&(o=p(o)),f&8||f&4&&typeof o=="object"&&o&&o.__esModule)return o;var v=Object.create(null);if(p.r(v),Object.defineProperty(v,"default",{enumerable:!0,value:o}),f&2&&typeof o!="string")for(var F in o)p.d(v,F,(function(I){return o[I]}).bind(null,F));return v},p.n=function(o){var f=o&&o.__esModule?function(){return o.default}:function(){return o};return p.d(f,"a",f),f},p.o=function(o,f){return Object.prototype.hasOwnProperty.call(o,f)},p.p="",p(p.s="./src/react-webcam.tsx")})({"./src/react-webcam.tsx":(function(g,m,p){p.r(m);var o=p("react"),f=(function(){var b=function(i,t){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var l in s)s.hasOwnProperty(l)&&(r[l]=s[l])},b(i,t)};return function(i,t){b(i,t);function r(){this.constructor=i}i.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),v=function(){return v=Object.assign||function(b){for(var i,t=1,r=arguments.length;t<r;t++){i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(b[s]=i[s])}return b},v.apply(this,arguments)},F=function(b,i){var t={};for(var r in b)Object.prototype.hasOwnProperty.call(b,r)&&i.indexOf(r)<0&&(t[r]=b[r]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(b);s<r.length;s++)i.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(b,r[s])&&(t[r[s]]=b[r[s]]);return t};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(i){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(r,s){t.call(navigator,i,r,s)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function I(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var R=(function(b){f(i,b);function i(t){var r=b.call(this,t)||this;return r.canvas=null,r.ctx=null,r.requestUserMediaId=0,r.unmounted=!1,r.state={hasUserMedia:!1},r}return i.prototype.componentDidMount=function(){var t=this,r=t.state,s=t.props;if(this.unmounted=!1,!I()){s.onUserMediaError("getUserMedia not supported");return}r.hasUserMedia||this.requestUserMedia(),s.children&&typeof s.children!="function"&&console.warn("children must be a function")},i.prototype.componentDidUpdate=function(t){var r=this.props;if(!I()){r.onUserMediaError("getUserMedia not supported");return}var s=JSON.stringify(t.audioConstraints)!==JSON.stringify(r.audioConstraints),l=JSON.stringify(t.videoConstraints)!==JSON.stringify(r.videoConstraints),M=t.minScreenshotWidth!==r.minScreenshotWidth,y=t.minScreenshotHeight!==r.minScreenshotHeight;(l||M||y)&&(this.canvas=null,this.ctx=null),(s||l)&&(this.stopAndCleanup(),this.requestUserMedia())},i.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},i.stopMediaStream=function(t){t&&(t.getVideoTracks&&t.getAudioTracks?(t.getVideoTracks().map(function(r){t.removeTrack(r),r.stop()}),t.getAudioTracks().map(function(r){t.removeTrack(r),r.stop()})):t.stop())},i.prototype.stopAndCleanup=function(){var t=this.state;t.hasUserMedia&&(i.stopMediaStream(this.stream),t.src&&window.URL.revokeObjectURL(t.src))},i.prototype.getScreenshot=function(t){var r=this,s=r.state,l=r.props;if(!s.hasUserMedia)return null;var M=this.getCanvas(t);return M&&M.toDataURL(l.screenshotFormat,l.screenshotQuality)},i.prototype.getCanvas=function(t){var r=this,s=r.state,l=r.props;if(!this.video||!s.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var M=this.video.videoWidth,y=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var C=M/y;M=l.minScreenshotWidth||this.video.clientWidth,y=M/C,l.minScreenshotHeight&&y<l.minScreenshotHeight&&(y=l.minScreenshotHeight,M=y*C)}this.canvas=document.createElement("canvas"),this.canvas.width=t?.width||M,this.canvas.height=t?.height||y,this.ctx=this.canvas.getContext("2d")}var E=this,w=E.ctx,S=E.canvas;return w&&S&&(S.width=t?.width||S.width,S.height=t?.height||S.height,l.mirrored&&(w.translate(S.width,0),w.scale(-1,1)),w.imageSmoothingEnabled=l.imageSmoothing,w.drawImage(this.video,0,0,t?.width||S.width,t?.height||S.height),l.mirrored&&(w.scale(-1,1),w.translate(-S.width,0))),S},i.prototype.requestUserMedia=function(){var t=this,r=this.props,s=function(y,C){var E={video:typeof C<"u"?C:!0};r.audio&&(E.audio=typeof y<"u"?y:!0),t.requestUserMediaId++;var w=t.requestUserMediaId;navigator.mediaDevices.getUserMedia(E).then(function(S){t.unmounted||w!==t.requestUserMediaId?i.stopMediaStream(S):t.handleUserMedia(null,S)}).catch(function(S){t.handleUserMedia(S)})};if("mediaDevices"in navigator)s(r.audioConstraints,r.videoConstraints);else{var l=function(y){return{optional:[{sourceId:y}]}},M=function(y){var C=y.deviceId;return typeof C=="string"?C:Array.isArray(C)&&C.length>0?C[0]:typeof C=="object"&&C.ideal?C.ideal:null};MediaStreamTrack.getSources(function(y){var C=null,E=null;y.forEach(function(O){O.kind==="audio"?C=O.id:O.kind==="video"&&(E=O.id)});var w=M(r.audioConstraints);w&&(C=w);var S=M(r.videoConstraints);S&&(E=S),s(l(C),l(E))})}},i.prototype.handleUserMedia=function(t,r){var s=this.props;if(t||!r){this.setState({hasUserMedia:!1}),s.onUserMediaError(t);return}this.stream=r;try{this.video&&(this.video.srcObject=r),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(r)})}s.onUserMedia(r)},i.prototype.render=function(){var t=this,r=this,s=r.state,l=r.props,M=l.audio;l.forceScreenshotSourceSize;var y=l.disablePictureInPicture;l.onUserMedia,l.onUserMediaError,l.screenshotFormat,l.screenshotQuality,l.minScreenshotWidth,l.minScreenshotHeight,l.audioConstraints,l.videoConstraints,l.imageSmoothing;var C=l.mirrored,E=l.style,w=E===void 0?{}:E,S=l.children,O=F(l,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),A=C?v(v({},w),{transform:(w.transform||"")+" scaleX(-1)"}):w,W={getScreenshot:this.getScreenshot.bind(this)};return o.createElement(o.Fragment,null,o.createElement("video",v({autoPlay:!0,disablePictureInPicture:y,src:s.src,muted:!M,playsInline:!0,ref:function(V){t.video=V},style:A},O)),S&&S(W))},i.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},i})(o.Component);m.default=R}),react:(function(g,m){g.exports=d})}).default})})(B)),B.exports}var Ye=Ke();const Ze=ye(Ye),et=({width:e})=>P(G,{width:e,children:[U(q,{size:"threeXL",color:ie.gray60,content:ae}),P(Be,{children:["This app would like to use your camera.",U($e,{href:Ve,rel:"noopener noreferrer",target:"_blank",children:"Learn how to allow access."})]})]}),tt=({handleCapture:e,width:a,disabled:d,clearPhotoInProgress:g,setClearPhotoInProgress:m,facingMode:p,setFacingMode:o,testOverride:f})=>{const[v,F]=n.useState(f||"pending"),I=n.useRef(null),[R,b]=n.useState(a),i=n.useCallback(Ce(1e3,b),[]);n.useEffect(()=>{i(a)},[a,i]);function t(){if(I.current!==null){const s=I.current.getScreenshot();e(s)}}const r=Ue();return P(le,{"data-testid":"stCameraInputWebcamComponent",children:[v!=="success"&&!d&&!g?U(et,{width:R}):we()&&U(Qe,{switchFacingMode:o}),U(G,{"data-testid":"stCameraInputWebcamStyledBox",hidden:v!=="success"&&!d&&!g,width:R,children:!d&&U(Ze,{audio:!1,ref:I,screenshotFormat:"image/jpeg",screenshotQuality:1,width:R,height:R*9/16,style:{borderRadius:`${r.radii.default} ${r.radii.default} 0 0`},onUserMediaError:()=>{F("error")},onUserMedia:()=>{F("success"),m(!1)},videoConstraints:{width:{ideal:R},facingMode:p}})}),U(ce,{onClick:t,disabled:v!=="success"||d||g,children:"Take Photo"})]})},rt=n.memo(tt),de="RESTORED_FROM_WIDGET",it=150,ot=Ee.getLogger("CameraInput"),N=e=>{const a=e.filter(d=>d.status.type==="uploaded").map(d=>{const{name:g,size:m,status:p}=d,{fileId:o,fileUrls:f}=p;return new ke({fileId:o,fileUrls:f,name:g,size:m})});return new Te({uploadedFileInfo:a})},nt=(e,a)=>{const d=a.getFileUploaderStateValue(e);if(L(d))return{files:[],nextLocalId:1,imgSrc:null};const{uploadedFileInfo:g}=d;if(L(g)||g.length===0)return{files:[],nextLocalId:1,imgSrc:null};let m=1;const p=g.map(o=>{const f=o.name,v=o.size,F=o.fileId,I=o.fileUrls,R=new oe(f,v,m,{type:"uploaded",fileId:F,fileUrls:I});return m+=1,R});return{files:p,nextLocalId:m,imgSrc:p.length>0?de:null}};function at(e,a){return fetch(e).then(d=>d.arrayBuffer()).then(d=>new File([d],a,{type:"image/jpeg"}))}const st=({element:e,widgetMgr:a,uploadClient:d,disabled:g,fragmentId:m,testOverride:p})=>{const{width:o,elementRef:f}=Me(),v=n.useRef(null);v.current===null&&(v.current=nt(e,a));const{files:F,nextLocalId:I,imgSrc:R}=v.current,b=n.useRef(I),[i,t]=n.useState(()=>F),r=n.useRef(i);n.useLayoutEffect(()=>{r.current=i},[i]);const[s,l]=n.useState(()=>R),[M,y]=n.useState(!1),[C,E]=n.useState(!0),[w,S]=n.useState(!1),[O,A]=n.useState(j.USER),W=n.useCallback(()=>{const c=b.current;return b.current+=1,c},[]),V=n.useMemo(()=>{const c=u=>u.status.type==="uploading";return i.some(c)?"updating":"ready"},[i]),$=n.useMemo(()=>{if(i.length>0&&i[i.length-1].status.type==="uploading")return i[i.length-1].status.progress},[i]),ue=n.useCallback(()=>{A(c=>c===j.USER?j.ENVIRONMENT:j.USER)},[]),k=n.useCallback(c=>r.current.find(u=>u.id===c),[]),X=n.useCallback(c=>{xe.flushSync(()=>{t(u=>[...u,c])})},[]),Q=n.useCallback(c=>{t(u=>u.filter(h=>h.id!==c))},[]),T=n.useCallback((c,u)=>{t(h=>h.map(x=>x.id===c?u:x))},[]),J=n.useCallback((c,u)=>{y(!1);const h=k(c);L(h)||h.status.type!=="uploading"||T(h.id,h.setStatus({type:"uploaded",fileId:u.fileId,fileUrls:u}))},[k,T]),K=n.useCallback((c,u)=>{const h=k(u);if(L(h)||h.status.type!=="uploading")return;const x=Math.round(c.loaded*100/c.total);h.status.progress!==x&&T(u,h.setStatus({type:"uploading",abortController:h.status.abortController,progress:x}))},[k,T]),Y=n.useCallback((c,u)=>{const h=new AbortController,x=new oe(u.name,u.size,W(),{type:"uploading",abortController:h,progress:1});X(x),d.uploadFile(e,c.uploadUrl,u,z=>K(z,x.id),h.signal).then(()=>J(x.id,c)).catch(z=>{z instanceof DOMException&&z.name==="AbortError"||T(x.id,x.setStatus({type:"error",errorMessage:z?z.toString():"Unknown error"}))})},[X,e,W,J,K,T,d]),Z=n.useCallback(c=>{const u=k(c);L(u)||(u.status.type==="uploading"&&u.status.abortController.abort(),u.status.type==="uploaded"&&u.status.fileUrls.deleteUrl&&d.deleteFile(u.status.fileUrls.deleteUrl),Q(c))},[k,Q,d]),ee=n.useCallback(c=>{if(c===null)return Promise.resolve();l(c),y(!0),E(!1);const u=h=>new Promise(x=>setTimeout(x,h));return at(c,`camera-input-${new Date().toISOString().replace(/:/g,"_")}.jpg`).then(h=>d.fetchFileURLs([h]).then(x=>({file:h,fileUrls:x[0]}))).then(({file:h,fileUrls:x})=>Y(x,h)).then(()=>u(it)).then(()=>{E(!0)}).catch(h=>{ot.error(h)})},[d,Y]),fe=n.useCallback(c=>{ee(c)},[ee]),pe=n.useCallback(()=>{i.length!==0&&(i.forEach(c=>Z(c.id)),l(null),S(!0))},[i,Z]);n.useEffect(()=>{a.getFileUploaderStateValue(e)===void 0&&a.setFileUploaderStateValue(e,N(i),{fromUi:!1},m)},[]),n.useEffect(()=>{if(V!=="ready")return;const c=N(i),u=a.getFileUploaderStateValue(e);Ie(c,u)||a.setFileUploaderStateValue(e,c,{fromUi:!0},m)},[V,i,a,e,m]);const he=n.useCallback(()=>{t([]),l(null);const c=N([]);a.setFileUploaderStateValue(e,c,{fromUi:!0},m)},[e,m,a]);return ze({element:e,widgetMgr:a,onFormCleared:he}),P(le,{className:"stCameraInput","data-testid":"stCameraInput",ref:f,children:[U(Oe,{label:e.label,disabled:g,labelVisibility:Fe(e.labelVisibility?.value),children:e.help&&U(Re,{children:U(_e,{content:e.help,placement:re.TOP_RIGHT})})}),s?P(Pe,{children:[U(G,{width:o,children:s!==de&&U(Ae,{src:s,alt:"Snapshot",opacity:M||!C?"50%":"100%",width:o,height:o*9/16})}),U(ce,{onClick:pe,progress:$,disabled:!!$||g,children:$?"Uploading...":P(Ne,{children:[U(q,{content:se,margin:"0 xs 0 0",size:"sm"})," Clear photo"]})})]}):U(rt,{handleCapture:fe,width:o,disabled:g,clearPhotoInProgress:w,setClearPhotoInProgress:S,facingMode:O,setFacingMode:ue,testOverride:p})]})},pt=n.memo(st);export{pt as default};
