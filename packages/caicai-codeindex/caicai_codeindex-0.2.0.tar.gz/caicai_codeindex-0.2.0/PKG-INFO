Metadata-Version: 2.4
Name: caicai-codeindex
Version: 0.2.0
Summary: CodeIndex Python SDK - Direct SQLite database access
Author-email: CodeIndex <opensource@example.com>
License: MIT
Project-URL: Homepage, https://github.com/LydiaCai1203/codeindex
Project-URL: Repository, https://github.com/LydiaCai1203/codeindex
Project-URL: Issues, https://github.com/LydiaCai1203/codeindex/issues
Keywords: codeindex,ast,code-index,tree-sitter,code-intelligence,semantic-search,sqlite
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.24.0
Provides-Extra: dev
Requires-Dist: pytest; extra == "dev"
Requires-Dist: mypy; extra == "dev"
Requires-Dist: black; extra == "dev"

# CodeIndex Python SDK

ç›´æ¥è®¿é—® CodeIndex SQLite æ•°æ®åº“çš„ Python SDKï¼Œæ— éœ€ Node.js è¿è¡Œæ—¶ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- âœ… **æ— éœ€ Node.js**ï¼šç›´æ¥è¯»å– SQLite æ•°æ®åº“ï¼Œæ— éœ€å¯åŠ¨ Node.js è¿›ç¨‹
- âœ… **æ€§èƒ½æ›´å¥½**ï¼šæ— è¿›ç¨‹é—´é€šä¿¡å¼€é”€ï¼ŒæŸ¥è¯¢å»¶è¿Ÿä» 50-100ms é™è‡³ 1-5ms
- âœ… **ç®€å•æ˜“ç”¨**ï¼šAPI æ¸…æ™°ç›´è§‚ï¼Œä¿æŒå‘åå…¼å®¹
- âœ… **ç±»å‹æç¤º**ï¼šå®Œæ•´çš„ç±»å‹å®šä¹‰ï¼ŒIDE å‹å¥½
- âœ… **è½»é‡çº§**ï¼šä»…ä¾èµ– numpyï¼Œæ— å…¶ä»–é‡å‹ä¾èµ–

## ğŸ“¦ å®‰è£…

### ä» PyPI å®‰è£…ï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºï¼ˆæ¨èï¼Œé€Ÿåº¦æ›´å¿«ï¼‰
pip install -i https://mirrors.aliyun.com/pypi/simple/ lydiacai-codeindex-sdk

# æˆ–ä½¿ç”¨å®˜æ–¹ PyPI æº
pip install lydiacai-codeindex-sdk
```

### æœ¬åœ°å¼€å‘å®‰è£…

```bash
cd sdk/python
pip install -e .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
from codeindex_sdk import CodeIndexClient

# æ–¹å¼1ï¼šç›´æ¥ä½¿ç”¨æ•°æ®åº“è·¯å¾„
with CodeIndexClient(".codeindex/project.db") as client:
    # æŸ¥æ‰¾ç¬¦å·
    symbols = client.find_symbols(name="CreateUser", language="go")
    for symbol in symbols:
        print(f"{symbol['name']} at {symbol['location']['path']}:{symbol['location']['startLine']}")
    
    # æŸ¥æ‰¾å•ä¸ªç¬¦å·
    symbol = client.find_symbol("CreateUser", language="go")
    if symbol:
        print(f"Found: {symbol['qualifiedName']}")
    
    # æŸ¥è¯¢å¯¹è±¡å±æ€§
    props = client.object_properties("UserService", language="go")
    for prop in props:
        print(f"{prop['kind']} {prop['name']}")
    
    # ç”Ÿæˆè°ƒç”¨é“¾
    chain = client.call_chain(from_symbol=12345, direction="forward", depth=3)
    if chain:
        print(f"Call chain: {chain['name']} -> {len(chain.get('children', []))} calls")
    
    # è·å–å®šä¹‰ä½ç½®
    location = client.definition(12345)
    if location:
        print(f"Definition: {location['path']}:{location['startLine']}")
    
    # è·å–å¼•ç”¨
    refs = client.references(12345)
    print(f"Found {len(refs)} references")
```

### ä½¿ç”¨é…ç½®å¯¹è±¡ï¼ˆå‘åå…¼å®¹ï¼‰

```python
from codeindex_sdk import CodeIndexClient, CodeIndexConfig

# æ–¹å¼2ï¼šä½¿ç”¨é…ç½®å¯¹è±¡ï¼ˆå‘åå…¼å®¹ï¼‰
config = CodeIndexConfig(
    db_path=".codeindex/project.db",
    # ä»¥ä¸‹å‚æ•°å·²åºŸå¼ƒï¼Œä½†ä¿ç•™ç”¨äºå…¼å®¹æ€§
    root_dir="/path/to/project",
    languages=["go", "ts"],
)

with CodeIndexClient(config) as client:
    symbols = client.find_symbols(name="CreateUser", language="go")
```

### è¯­ä¹‰æœç´¢ï¼ˆéœ€è¦é¢„å…ˆç”Ÿæˆ embeddingï¼‰

```python
from codeindex_sdk import CodeIndexClient
import numpy as np

# æ³¨æ„ï¼šéœ€è¦å…ˆä½¿ç”¨ CodeIndex CLI ç”Ÿæˆ embedding
# ç„¶åä½¿ç”¨ç›¸åŒçš„ embedding æ¨¡å‹ç”Ÿæˆ query_embedding

with CodeIndexClient(".codeindex/project.db") as client:
    # å‡è®¾ä½ å·²ç»æœ‰äº† query_embeddingï¼ˆä¾‹å¦‚ä½¿ç”¨ OpenAI APIï¼‰
    query_embedding = [0.1, 0.2, ...]  # ä½ çš„ embedding å‘é‡
    
    results = client.semantic_search(
        query="ç”¨æˆ·ç™»å½•éªŒè¯",
        query_embedding=query_embedding,
        model="text-embedding-3-small",  # ä¸ç”Ÿæˆ embedding æ—¶ä½¿ç”¨çš„æ¨¡å‹ä¸€è‡´
        top_k=5,
        language="go",
        min_similarity=0.7
    )
    
    for result in results:
        print(f"{result['symbol']['name']} (similarity: {result['similarity']:.2f})")
```

## ğŸ“š API æ–‡æ¡£

### CodeIndexClient

#### `__init__(db_path, **kwargs)`

åˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚

**å‚æ•°ï¼š**
- `db_path` (str | CodeIndexConfig): æ•°æ®åº“æ–‡ä»¶è·¯å¾„æˆ–é…ç½®å¯¹è±¡
- `node_command`, `worker_path`, `startup_timeout`: å·²åºŸå¼ƒï¼Œå¿½ç•¥

#### `find_symbols(name, language=None) -> List[Dict]`

æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…åç§°çš„ç¬¦å·ã€‚

**å‚æ•°ï¼š**
- `name` (str): ç¬¦å·åç§°
- `language` (str, optional): è¯­è¨€è¿‡æ»¤å™¨

**è¿”å›ï¼š** ç¬¦å·å­—å…¸åˆ—è¡¨

#### `find_symbol(name, language=None, in_file=None, kind=None) -> Dict | None`

æŸ¥æ‰¾å•ä¸ªåŒ¹é…æ¡ä»¶çš„ç¬¦å·ã€‚

**å‚æ•°ï¼š**
- `name` (str): ç¬¦å·åç§°
- `language` (str, optional): è¯­è¨€è¿‡æ»¤å™¨
- `in_file` (str, optional): æ–‡ä»¶è·¯å¾„è¿‡æ»¤å™¨
- `kind` (str, optional): ç¬¦å·ç±»å‹è¿‡æ»¤å™¨

**è¿”å›ï¼š** ç¬¦å·å­—å…¸æˆ– None

#### `object_properties(object_name, language=None) -> List[Dict]`

è·å–å¯¹è±¡/ç±»/ç»“æ„ä½“çš„å±æ€§å’Œæ–¹æ³•ã€‚

**å‚æ•°ï¼š**
- `object_name` (str): å¯¹è±¡åç§°
- `language` (str, optional): è¯­è¨€è¿‡æ»¤å™¨

**è¿”å›ï¼š** å±æ€§å­—å…¸åˆ—è¡¨

#### `call_chain(from_symbol, direction="forward", depth=5) -> Dict | None`

æ„å»ºè°ƒç”¨é“¾ã€‚

**å‚æ•°ï¼š**
- `from_symbol` (int): èµ·å§‹ç¬¦å· ID
- `direction` (str): "forward" æˆ– "backward"
- `depth` (int): æœ€å¤§æ·±åº¦

**è¿”å›ï¼š** è°ƒç”¨é“¾å­—å…¸æˆ– None

#### `definition(symbol_id) -> Dict | None`

è·å–ç¬¦å·çš„å®šä¹‰ä½ç½®ã€‚

**å‚æ•°ï¼š**
- `symbol_id` (int): ç¬¦å· ID

**è¿”å›ï¼š** ä½ç½®å­—å…¸æˆ– None

#### `references(symbol_id) -> List[Dict]`

è·å–ç¬¦å·çš„æ‰€æœ‰å¼•ç”¨ã€‚

**å‚æ•°ï¼š**
- `symbol_id` (int): ç¬¦å· ID

**è¿”å›ï¼š** å¼•ç”¨ä½ç½®å­—å…¸åˆ—è¡¨

#### `semantic_search(query, query_embedding, model="default", top_k=10, ...) -> List[Dict]`

è¯­ä¹‰æœç´¢ï¼ˆéœ€è¦é¢„å…ˆç”Ÿæˆ embeddingï¼‰ã€‚

**å‚æ•°ï¼š**
- `query` (str): æŸ¥è¯¢æ–‡æœ¬ï¼ˆä»…ä¾›å‚è€ƒï¼‰
- `query_embedding` (List[float]): æŸ¥è¯¢ embedding å‘é‡ï¼ˆå¿…éœ€ï¼‰
- `model` (str): Embedding æ¨¡å‹åç§°
- `top_k` (int): è¿”å›ç»“æœæ•°é‡
- `language` (str, optional): è¯­è¨€è¿‡æ»¤å™¨
- `kind` (str, optional): ç¬¦å·ç±»å‹è¿‡æ»¤å™¨
- `min_similarity` (float): æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼

**è¿”å›ï¼š** æœç´¢ç»“æœåˆ—è¡¨ï¼ˆåŒ…å«ç›¸ä¼¼åº¦åˆ†æ•°ï¼‰

## âš™ï¸ å·¥ä½œåŸç†

1. **ç´¢å¼•æ„å»º**ï¼šä½¿ç”¨ CodeIndex CLIï¼ˆTypeScriptï¼‰æ„å»ºç´¢å¼•æ•°æ®åº“
2. **æ•°æ®åº“æŸ¥è¯¢**ï¼šPython SDK ç›´æ¥è¯»å– SQLite æ•°æ®åº“
3. **æ— éœ€ Node.js**ï¼šå®Œå…¨ç‹¬ç«‹äº Node.js è¿è¡Œæ—¶

## ğŸ“‹ å‰ç½®è¦æ±‚

- **Python**: >= 3.9
- **ç´¢å¼•æ•°æ®åº“**ï¼šéœ€è¦å…ˆä½¿ç”¨ CodeIndex CLI æ„å»ºç´¢å¼•
  ```bash
  node dist/src/cli/index.js index --root . --db .codeindex/project.db --lang go
  ```

## ğŸ”„ ä»æ—§ç‰ˆæœ¬è¿ç§»

### æ—§ç‰ˆæœ¬ï¼ˆ0.1.xï¼‰

```python
from codeindex_sdk import CodeIndexClient, CodeIndexConfig

config = CodeIndexConfig(
    root_dir="/path/to/project",
    db_path=".codeindex/project.db",
    languages=["go", "ts"],
)

with CodeIndexClient(config) as client:
    symbols = client.find_symbols(name="CreateUser", language="go")
```

### æ–°ç‰ˆæœ¬ï¼ˆ0.2.xï¼‰

```python
from codeindex_sdk import CodeIndexClient

# ç®€åŒ–ï¼šåªéœ€æ•°æ®åº“è·¯å¾„
with CodeIndexClient(".codeindex/project.db") as client:
    symbols = client.find_symbols(name="CreateUser", language="go")
```

**æ³¨æ„**ï¼šæ—§ç‰ˆæœ¬ä»£ç æ— éœ€ä¿®æ”¹å³å¯è¿è¡Œï¼ˆå‘åå…¼å®¹ï¼‰ï¼Œä½†å»ºè®®æ›´æ–°ä¸ºæ–° APIã€‚

## ğŸ†š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | æ—§ç‰ˆæœ¬ï¼ˆNode Workerï¼‰ | æ–°ç‰ˆæœ¬ï¼ˆç›´æ¥ DBï¼‰ | æå‡ |
|------|---------------------|------------------|------|
| å¯åŠ¨æ—¶é—´ | ~500ms | ~10ms | **50x** |
| æŸ¥è¯¢å»¶è¿Ÿ | 50-100ms | 1-5ms | **20x** |
| å†…å­˜å ç”¨ | Node + Python | ä»… Python | **å‡å°‘ ~50MB** |
| ä¾èµ–è¦æ±‚ | Node.js + Python | ä»… Python | **ç®€åŒ–** |

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨ï¼Ÿ

A: è¯·å…ˆä½¿ç”¨ CodeIndex CLI æ„å»ºç´¢å¼•ï¼š
```bash
node dist/src/cli/index.js index --root . --db .codeindex/project.db --lang go
```

### Q: è¯­ä¹‰æœç´¢è¿”å›ç©ºç»“æœï¼Ÿ

A: ç¡®ä¿ï¼š
1. å·²ä½¿ç”¨ CLI ç”Ÿæˆ embeddingï¼š`node dist/src/cli/index.js embed`
2. ä½¿ç”¨ç›¸åŒçš„ embedding æ¨¡å‹ç”Ÿæˆ query_embedding
3. æ£€æŸ¥ `min_similarity` é˜ˆå€¼æ˜¯å¦è¿‡é«˜

### Q: å¦‚ä½•ç”Ÿæˆ query_embeddingï¼Ÿ

A: ä½¿ç”¨ä½ é€‰æ‹©çš„ embedding APIï¼ˆå¦‚ OpenAIï¼‰ï¼š
```python
import openai

response = openai.embeddings.create(
    model="text-embedding-3-small",
    input="ä½ çš„æŸ¥è¯¢æ–‡æœ¬"
)
query_embedding = response.data[0].embedding
```

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³é“¾æ¥

- [CodeIndex ä¸»é¡¹ç›®](https://github.com/LydiaCai1203/codeindex)
- [é—®é¢˜åé¦ˆ](https://github.com/LydiaCai1203/codeindex/issues)
