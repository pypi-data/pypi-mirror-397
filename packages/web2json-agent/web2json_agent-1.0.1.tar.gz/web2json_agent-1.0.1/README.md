# web2json-agent

æ™ºèƒ½ç½‘é¡µè§£æä»£ç ç”Ÿæˆå™¨ - åŸºäº AI è‡ªåŠ¨ç”Ÿæˆç½‘é¡µè§£æä»£ç 

## ç®€ä»‹

**web2json-agent** æ˜¯ä¸€ä¸ªåŸºäº LangChain çš„æ™ºèƒ½ Agent ç³»ç»Ÿï¼Œé€šè¿‡å¤šæ¨¡æ€ AI è‡ªåŠ¨åˆ†æç½‘é¡µç»“æ„å¹¶ç”Ÿæˆé«˜è´¨é‡çš„ Python è§£æä»£ç ã€‚

### æ ¸å¿ƒèƒ½åŠ›

æä¾›å‡ ä¸ªç¤ºä¾‹ HTML æ–‡ä»¶ï¼ŒAgent è‡ªåŠ¨å®Œæˆï¼š

1. ğŸ“ è¯»å–æœ¬åœ°HTMLæ–‡ä»¶å¹¶ç²¾ç®€
2. ğŸ“¸ æ¸²æŸ“HTMLå¹¶æˆªå›¾ï¼ˆDrissionPageï¼‰
3. ğŸ” åŒé‡Schemaæå–ï¼ˆHTMLåˆ†æ + è§†è§‰ç†è§£ï¼‰
4. ğŸ”„ æ™ºèƒ½Schemaåˆå¹¶ä¸ä¼˜åŒ–
5. ğŸ’» ç”Ÿæˆ BeautifulSoup è§£æä»£ç 

### é€‚ç”¨åœºæ™¯

- æ‰¹é‡çˆ¬å–åŒç±»å‹ç½‘é¡µï¼ˆåšå®¢ã€äº§å“é¡µã€æ–°é—»ç­‰ï¼‰
- å¿«é€Ÿç”Ÿæˆè§£æä»£ç åŸå‹
- å‡å°‘æ‰‹åŠ¨ç¼–å†™è§£æå™¨çš„æ—¶é—´

## å·¥ä½œæµç¨‹

```
æœ¬åœ°HTMLæ–‡ä»¶ â†’ ä»»åŠ¡è§„åˆ’ â†’ Schemaè¿­ä»£é˜¶æ®µï¼ˆå¯¹æ¯ä¸ªHTMLï¼‰
                    â”œâ”€ è¯»å–HTMLæ–‡ä»¶ + æˆªå›¾ï¼ˆDrissionPageï¼‰
                    â”œâ”€ HTMLç²¾ç®€ï¼ˆå‡å°‘tokenæ¶ˆè€—ï¼‰
                    â”œâ”€ HTML â†’ Schemaï¼ˆå«xpathè·¯å¾„ï¼‰
                    â”œâ”€ è§†è§‰ â†’ Schemaï¼ˆå«è§†è§‰æè¿°ï¼‰
                    â””â”€ åˆå¹¶ä¸¤ä¸ªSchema
         â†“
    å¤šSchemaåˆå¹¶ï¼ˆç­›é€‰+ä¿®æ­£+å»é‡ï¼‰â†’ æœ€ç»ˆSchema
         â†“
    ä»£ç è¿­ä»£é˜¶æ®µ â†’ ç”Ÿæˆ/ä¼˜åŒ–è§£æä»£ç  â†’ æœ€ç»ˆä»£ç 
```

### Schemaè¿­ä»£è§„åˆ™

**å¯¹äºå•ä¸ªHTMLï¼ˆå»ºè®®è¾“å…¥2ï½5ä¸ªï¼‰ï¼š**
1. **HTMLåˆ†æ**ï¼šä»HTMLä»£ç æå–Schemaï¼ˆå­—æ®µåã€è¯´æ˜ã€å€¼ç¤ºä¾‹ã€**xpathè·¯å¾„**ï¼‰
2. **è§†è§‰åˆ†æ**ï¼šä»ç½‘é¡µæˆªå›¾æå–Schemaï¼ˆå­—æ®µåã€è¯´æ˜ã€å€¼ç¤ºä¾‹ã€**è§†è§‰æè¿°**ï¼‰
3. **Schemaåˆå¹¶**ï¼šåˆ¤æ–­ç›¸åŒå­—æ®µï¼Œåˆå¹¶xpathå’Œvisual_features

**å¤„ç†å®Œæ‰€æœ‰HTMLåï¼š**
4. **å¤šSchemaæ•´åˆ**ï¼š
   - å»é™¤æ— æ„ä¹‰å­—æ®µï¼ˆå¹¿å‘Šã€å¯¼èˆªç­‰ï¼‰
   - ä¿®æ­£å­—æ®µç»“æ„ï¼ˆå…ƒä¿¡æ¯å½’å±ã€åˆ—è¡¨å­—æ®µè¯†åˆ«ï¼‰
   - åˆå¹¶xpathè·¯å¾„ï¼ˆæ¯ä¸ªå­—æ®µåŒ…å«å¤šä¸ªxpathï¼Œå¢å¼ºé²æ£’æ€§ï¼‰
   - ç”Ÿæˆæœ€ç»ˆSchema

### æ ¸å¿ƒæŠ€æœ¯

- **åŒé‡è§†è§’Schemaæå–**ï¼šåŒæ—¶ä»HTMLä»£ç å’Œè§†è§‰å¸ƒå±€æå–Schemaï¼Œäº’ç›¸è¡¥å……
- **å¤šè·¯å¾„é²æ£’æ€§**ï¼šæ¯ä¸ªå­—æ®µä¿ç•™å¤šä¸ªxpathæå–è·¯å¾„ï¼Œé€‚åº”ä¸åŒé¡µé¢ç»“æ„
- **æ™ºèƒ½Schemaåˆå¹¶**ï¼šè‡ªåŠ¨è¯†åˆ«ç›¸åŒå­—æ®µã€ä¿®æ­£å­—æ®µç±»å‹ã€ä¼˜åŒ–æ•°æ®ç»“æ„
- **HTMLç²¾ç®€**ï¼šä½¿ç”¨è‡ªå®šä¹‰HTMLç²¾ç®€å·¥å…·ï¼Œå‡å°‘tokenæ¶ˆè€—ï¼Œæå‡å“åº”é€Ÿåº¦

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ 1 æ­¥ï¼šå…‹éš†é¡¹ç›®å¹¶å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/ccprocessor/web2json-agent.git
cd web2json-agent

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### ç¬¬ 2 æ­¥ï¼šé…ç½® API å¯†é’¥ï¼ˆâš ï¸ å¿…éœ€ï¼‰

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API é…ç½®
vim .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

**å¿…å¡«é…ç½®é¡¹**ï¼ˆåœ¨ `.env` æ–‡ä»¶ä¸­ä¿®æ”¹ï¼‰ï¼š

```bash
OPENAI_API_KEY=your_api_key_here          # ä½ çš„ API å¯†é’¥
OPENAI_API_BASE=https://api.openai.com/v1  # API åœ°å€
```
> æ›´å¤šé…ç½®é€‰é¡¹è¯·æŸ¥çœ‹ `.env.example` æ–‡ä»¶

### ç¬¬ 3 æ­¥ï¼šå‡†å¤‡ HTML æ–‡ä»¶

åœ¨ `input_html/` ç›®å½•ä¸‹æ”¾ç½® **2-5 ä¸ª**åŒç±»å‹ç½‘é¡µçš„ HTML æºç æ–‡ä»¶ï¼ˆå·²æœ‰ç¤ºä¾‹ï¼‰ï¼š

### ç¬¬ 4 æ­¥ï¼šè¿è¡Œè§£æå™¨ç”Ÿæˆ

```bash
# åŸºç¡€ç”¨æ³•
python main.py -d input_html/ -o output/blog

# æŒ‡å®šé¡µé¢ç±»å‹ï¼ˆå¯é€‰ï¼‰
python main.py -d input_html/ -o output/blog --domain blog_article
```

### ç¬¬ 5 æ­¥ï¼šä½¿ç”¨ç”Ÿæˆçš„è§£æå™¨

ç”Ÿæˆå®Œæˆåï¼Œè§£æå™¨ä»£ç ä¿å­˜åœ¨ `output/blog/final_parser.py`

#### æ–¹å¼ 1ï¼šä½¿ç”¨ demo.pyï¼ˆæ¨èï¼‰

é¡¹ç›®æ ¹ç›®å½•æä¾›äº†é€šç”¨çš„ `demo.py` è„šæœ¬ï¼Œè‡ªåŠ¨æŸ¥æ‰¾æœ€æ–°çš„è§£æå™¨ï¼š

```bash
# è‡ªåŠ¨ä½¿ç”¨æœ€æ–°çš„è§£æå™¨è§£æå•ä¸ªæ–‡ä»¶
python demo.py example.html

# æ‰¹é‡è§£æç›®å½•
python demo.py -d input_html/

# æ‰¹é‡è§£æå¹¶ä¿å­˜ç»“æœ
python demo.py -d input_html/ -o results.json

# æŒ‡å®šç‰¹å®šçš„è§£æå™¨
python demo.py -p output/blog/final_parser.py example.html

# è§£æURLï¼ˆéœ€è¦å®‰è£… DrissionPageï¼‰
python demo.py https://example.com/article
```

#### æ–¹å¼ 2ï¼šç›´æ¥è¿è¡Œ final_parser.py

ç”Ÿæˆçš„è§£æå™¨å¯ä»¥ç›´æ¥ä½œä¸ºå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ï¼š

```bash
# è§£æå•ä¸ªæ–‡ä»¶
python output/blog/final_parser.py example.html

# è§£æURL
python output/blog/final_parser.py https://example.com/article
```

#### æ–¹å¼ 3ï¼šåœ¨ä½ çš„ä»£ç ä¸­å¯¼å…¥

```python
import sys
from pathlib import Path

# æ·»åŠ è§£æå™¨è·¯å¾„
sys.path.insert(0, 'output/blog')
from final_parser import WebPageParser

# ä½¿ç”¨è§£æå™¨
html_content = Path('example.html').read_text(encoding='utf-8')
parser = WebPageParser()
data = parser.parse(html_content)
print(data)
```

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

- **HTML æ–‡ä»¶æ•°é‡**ï¼šå»ºè®®å‡†å¤‡ 2-5 ä¸ªåŒç±»å‹é¡µé¢ï¼Œå¤ªå°‘æå–ä¸å‡†ï¼Œå¤ªå¤šå¢åŠ æˆæœ¬
- **å¿«é€Ÿä¸Šæ‰‹**ï¼šç›´æ¥ä½¿ç”¨æ ¹ç›®å½•çš„ `demo.py`ï¼Œä¼šè‡ªåŠ¨æ‰¾åˆ°æœ€æ–°çš„è§£æå™¨
- **æ‰¹é‡å¤„ç†**ï¼š`python demo.py -d html_dir -o results.json` å¯æ‰¹é‡è§£æå¹¶ä¿å­˜ç»“æœ
- **æŸ¥çœ‹ä¸­é—´ç»“æœ**ï¼šç”Ÿæˆè¿‡ç¨‹ä¸­çš„ Schema å’Œæˆªå›¾éƒ½ä¿å­˜åœ¨ `output/` ç›®å½•ä¸­
- **è°ƒæ•´æ¨¡å‹é…ç½®**ï¼šå¦‚æœç»“æœä¸ç†æƒ³ï¼Œå¯ä»¥åœ¨ `.env` ä¸­æ›´æ¢æ›´å¼ºå¤§çš„æ¨¡å‹

---

## é¡¹ç›®ç»“æ„

```
web2json-agent/
â”œâ”€â”€ agent/                  # Agent æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ planner.py         # ä»»åŠ¡è§„åˆ’
â”‚   â”œâ”€â”€ executor.py        # ä»»åŠ¡æ‰§è¡Œï¼ˆå«Schemaè¿­ä»£é€»è¾‘ï¼‰
â”‚   â””â”€â”€ orchestrator.py    # Agent ç¼–æ’
â”‚
â”œâ”€â”€ tools/                  # LangChain Tools
â”‚   â”œâ”€â”€ webpage_source.py          # è¯»å–æœ¬åœ°HTMLæ–‡ä»¶
â”‚   â”œâ”€â”€ webpage_screenshot.py      # æˆªå›¾ï¼ˆDrissionPageï¼‰
â”‚   â”œâ”€â”€ schema_extraction.py       # Schemaæå–å’Œåˆå¹¶
â”‚   â”œâ”€â”€ html_simplifier.py         # HTMLç²¾ç®€å·¥å…·
â”‚   â””â”€â”€ code_generator.py          # ä»£ç ç”Ÿæˆ
â”‚
â”œâ”€â”€ prompts/                # Prompt æ¨¡æ¿
â”‚   â”œâ”€â”€ schema_extraction.py       # Schemaæå–Promptï¼ˆHTML+è§†è§‰ï¼‰
â”‚   â”œâ”€â”€ schema_merge.py            # Schemaåˆå¹¶Prompt
â”‚   â””â”€â”€ code_generator.py          # ä»£ç ç”ŸæˆPrompt
â”‚
â”œâ”€â”€ config/                 # é…ç½®
â”‚   â””â”€â”€ settings.py
â”‚
â”œâ”€â”€ utils/                  # å·¥å…·ç±»
â”‚   â””â”€â”€ llm_client.py      # LLM å®¢æˆ·ç«¯
â”‚
â”œâ”€â”€ output/                 # è¾“å‡ºç›®å½•
â”‚   â””â”€â”€ [domain]/
â”‚       â”œâ”€â”€ screenshots/       # ç½‘é¡µæˆªå›¾
â”‚       â”œâ”€â”€ html_original/     # åŸå§‹HTML
â”‚       â”œâ”€â”€ html_simplified/   # ç²¾ç®€HTML
â”‚       â”œâ”€â”€ schemas/           # Schemaæ–‡ä»¶
â”‚       â”‚   â”œâ”€â”€ html_schema_round_{N}.json     # HTMLæå–çš„Schema
â”‚       â”‚   â”œâ”€â”€ visual_schema_round_{N}.json   # è§†è§‰æå–çš„Schema
â”‚       â”‚   â”œâ”€â”€ merged_schema_round_{N}.json   # åˆå¹¶åçš„Schema
â”‚       â”‚   â””â”€â”€ final_schema.json              # æœ€ç»ˆSchema
â”‚       â”œâ”€â”€ parsers/           # ç”Ÿæˆçš„è§£æå™¨
â”‚       â”‚   â””â”€â”€ parser_round_{N}.py            # æ¯è½®ç”Ÿæˆçš„è§£æå™¨
â”‚       â”œâ”€â”€ result/            # è§£æç»“æœJSON
â”‚       â””â”€â”€ final_parser.py    # æœ€ç»ˆè§£æå™¨ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰
â”‚
â”œâ”€â”€ main.py                # å‘½ä»¤è¡Œå…¥å£
â”œâ”€â”€ demo.py                # é€šç”¨Demoè„šæœ¬ï¼ˆä½¿ç”¨è§£æå™¨ï¼‰
â””â”€â”€ requirements.txt       # ä¾èµ–åˆ—è¡¨
```

---

## Schemaæ ¼å¼è¯´æ˜

### æœ€ç»ˆSchemaç»“æ„

ç”Ÿæˆçš„`final_schema.json`åŒ…å«æ¯ä¸ªå­—æ®µçš„å®Œæ•´ä¿¡æ¯ï¼š

```json
{
  "title": {
    "type": "string",
    "description": "æ–‡ç« æ ‡é¢˜",
    "value_sample": "å…³äºäººå·¥æ™ºèƒ½çš„æœªæ¥",
    "xpaths": [
      "//h1[@class='article-title']/text()",
      "//div[@class='title']/text()"
    ],
    "visual_features": "ä½äºé¡µé¢ä¸Šéƒ¨ä¸­å¤®åŒºåŸŸï¼Œå­—ä½“éå¸¸å¤§ä¸”åŠ ç²—ï¼Œé¢œè‰²ä¸ºæ·±è‰²..."
  },
  "comments": {
    "type": "array",
    "description": "è¯„è®ºåˆ—è¡¨",
    "value_sample": [{"user": "ç”¨æˆ·A", "text": "è¯„è®ºå†…å®¹"}],
    "xpaths": [
      "//div[@class='comment-list']//div[@class='comment']",
      "//ul[@class='comments']//li"
    ],
    "visual_features": "ä½äºæ­£æ–‡ä¸‹æ–¹ï¼Œå¤šä¸ªè¯„è®ºé¡¹å‚ç›´æ’åˆ—..."
  }
}
```

### å­—æ®µè¯´æ˜

- **type**: æ•°æ®ç±»å‹ï¼ˆstring, number, array, objectç­‰ï¼‰
- **description**: å­—æ®µçš„è¯­ä¹‰æè¿°
- **value_sample**: å®é™…å€¼ç¤ºä¾‹ï¼ˆå­—ç¬¦ä¸²æˆªå–å‰50å­—ç¬¦ï¼‰
- **xpaths**: æ•°ç»„å½¢å¼ï¼ŒåŒ…å«å¤šä¸ªå¯ç”¨çš„xpathæå–è·¯å¾„ï¼ˆå¢å¼ºé²æ£’æ€§ï¼‰
- **visual_features**: è§†è§‰ç‰¹å¾æè¿°ï¼ŒåŒ…æ‹¬ä½ç½®ã€å­—ä½“ã€é¢œè‰²ã€å¸ƒå±€ç­‰

---

## è¿”å›å€¼è¯´æ˜

`generate_parser()` è¿”å›ï¼š

```python
{
    'success': bool,              # æ˜¯å¦æˆåŠŸ
    'parser_path': str,           # è§£æå™¨è·¯å¾„
    'config_path': str,           # é…ç½®æ–‡ä»¶è·¯å¾„
    'validation_result': {        # éªŒè¯ç»“æœ
        'success': bool,
        'success_rate': float,    # æˆåŠŸç‡ (0.0-1.0)
        'tests': [...]            # æµ‹è¯•è¯¦æƒ…
    },
    'error': str                  # é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰
}
```

---

## è®¸å¯è¯

MIT License

---

**æœ€åæ›´æ–°**: 2025-12-18
**ç‰ˆæœ¬**: 1.0.1

## æ›´æ–°æ—¥å¿—

### v1.0.1 (2025-12-18)
- ğŸ› ä¿®å¤æœ¬åœ°HTMLæ–‡ä»¶æˆªå›¾å¤±è´¥é—®é¢˜
  - å¢åŠ ç­‰å¾…æ—¶é—´ï¼šä»3ç§’æå‡è‡³7ç§’ï¼ˆ5+2ç§’ï¼‰
  - æ·»åŠ bodyå…ƒç´ ç­‰å¾…æœºåˆ¶
  - æ·»åŠ é¡µé¢å°ºå¯¸æ£€æŸ¥å’Œè­¦å‘Š
  - æ·»åŠ æˆªå›¾é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š2æ¬¡ï¼‰
  - ä¼˜åŒ–æµè§ˆå™¨å‚æ•°ï¼šç¦ç”¨åŒæºç­–ç•¥ä»¥æ”¯æŒæœ¬åœ°æ–‡ä»¶åŠ è½½
- âœ¨ æ”¹è¿›é”™è¯¯å¤„ç†ï¼šå³ä½¿é¡µé¢åŠ è½½ä¸å®Œæ•´ä¹Ÿèƒ½ç»§ç»­æ‰§è¡Œ

### v1.0.0 (2025-12-18)
- âœ¨ æ›´æ¸…æ™°çš„æ¨¡å—ç»“æ„ï¼šæ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€æ˜ç¡®
- âœ… å®Œå–„äº¤äº’ï¼šæ–°å¢é…ç½®éªŒè¯å’Œäº¤äº’å¼è®¾ç½®
- âœ¨ åŒé‡è§†è§’Schemaæå–ï¼ˆHTML + è§†è§‰ï¼‰
- âœ¨ æ”¯æŒå¤šxpathè·¯å¾„ï¼Œå¢å¼ºè§£æé²æ£’æ€§
- âœ¨ æ™ºèƒ½Schemaåˆå¹¶å’Œç»“æ„ä¼˜åŒ–
- âœ¨ é›†æˆHTMLç²¾ç®€å·¥å…·ï¼Œå‡å°‘tokenæ¶ˆè€—ä»¥åŠå†—ä½™è¾“å…¥

### v0.2.0 (2025-12-12)
- âœ¨ æ–°å¢åŒé‡è§†è§’Schemaæå–ï¼ˆHTML + è§†è§‰ï¼‰
- âœ¨ æ”¯æŒå¤šxpathè·¯å¾„ï¼Œå¢å¼ºè§£æé²æ£’æ€§
- âœ¨ æ™ºèƒ½Schemaåˆå¹¶å’Œç»“æ„ä¼˜åŒ–
- âœ¨ é›†æˆHTMLç²¾ç®€å·¥å…·ï¼Œå‡å°‘tokenæ¶ˆè€—ä»¥åŠå†—ä½™è¾“å…¥

### v0.1.0 (2025-11-26)
- ğŸ‰ é¦–æ¬¡å‘å¸ƒ
- åŸºäºè§†è§‰ç†è§£çš„Schemaæå–
- è‡ªåŠ¨ä»£ç ç”Ÿæˆå’Œè¿­ä»£ä¼˜åŒ–

