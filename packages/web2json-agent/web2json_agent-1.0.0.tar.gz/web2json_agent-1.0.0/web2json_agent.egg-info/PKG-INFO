Metadata-Version: 2.4
Name: web2json-agent
Version: 1.0.0
Summary: æ™ºèƒ½ç½‘é¡µè§£æä»£ç ç”Ÿæˆå™¨ - åŸºäº AI è‡ªåŠ¨ç”Ÿæˆç½‘é¡µè§£æä»£ç 
Author-email: YangGuoqiang <1041206149@qq.com>
License: MIT
Project-URL: Homepage, https://github.com/ccprocessor/web2json-agent
Project-URL: Repository, https://github.com/ccprocessor/web2json-agent.git
Project-URL: Bug Tracker, https://github.com/ccprocessor/web2json-agent/issues
Keywords: web scraping,html parser,ai agent,code generation,langchain,web automation
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Software Development :: Code Generators
Classifier: Topic :: Internet :: WWW/HTTP :: Indexing/Search
Classifier: Topic :: Text Processing :: Markup :: HTML
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: langchain==1.0.1
Requires-Dist: langchain-core==1.0.5
Requires-Dist: langchain-openai==1.0.3
Requires-Dist: langchain-anthropic==1.1.0
Requires-Dist: openai==2.8.1
Requires-Dist: pydantic==2.10.3
Requires-Dist: pydantic-settings==2.6.1
Requires-Dist: python-dotenv==1.1.0
Requires-Dist: loguru==0.7.3
Requires-Dist: DrissionPage==4.1.1.2
Requires-Dist: beautifulsoup4==4.12.3
Requires-Dist: lxml==5.3.0
Requires-Dist: requests==2.32.3
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Dynamic: license-file

# web2json-agent

æ™ºèƒ½ç½‘é¡µè§£æä»£ç ç”Ÿæˆå™¨ - åŸºäº AI è‡ªåŠ¨ç”Ÿæˆç½‘é¡µè§£æä»£ç 

## ç®€ä»‹

**web2json-agent** æ˜¯ä¸€ä¸ªåŸºäº LangChain çš„æ™ºèƒ½ Agent ç³»ç»Ÿï¼Œé€šè¿‡å¤šæ¨¡æ€ AI è‡ªåŠ¨åˆ†æç½‘é¡µç»“æ„å¹¶ç”Ÿæˆé«˜è´¨é‡çš„ Python è§£æä»£ç ã€‚

### æ ¸å¿ƒèƒ½åŠ›

æä¾›å‡ ä¸ªç¤ºä¾‹ HTML æ–‡ä»¶ï¼ŒAgent è‡ªåŠ¨å®Œæˆï¼š

1. ğŸ“ è¯»å–æœ¬åœ°HTMLæ–‡ä»¶å¹¶ç²¾ç®€
2. ğŸ“¸ æ¸²æŸ“HTMLå¹¶æˆªå›¾ï¼ˆDrissionPageï¼‰
3. ğŸ” åŒé‡Schemaæå–ï¼ˆHTMLåˆ†æ + è§†è§‰ç†è§£ï¼‰
4. ğŸ”„ æ™ºèƒ½Schemaåˆå¹¶ä¸ä¼˜åŒ–
5. ğŸ’» ç”Ÿæˆ BeautifulSoup è§£æä»£ç 

### é€‚ç”¨åœºæ™¯

- æ‰¹é‡çˆ¬å–åŒç±»å‹ç½‘é¡µï¼ˆåšå®¢ã€äº§å“é¡µã€æ–°é—»ç­‰ï¼‰
- å¿«é€Ÿç”Ÿæˆè§£æä»£ç åŸå‹
- å‡å°‘æ‰‹åŠ¨ç¼–å†™è§£æå™¨çš„æ—¶é—´

## å·¥ä½œæµç¨‹

```
æœ¬åœ°HTMLæ–‡ä»¶ â†’ ä»»åŠ¡è§„åˆ’ â†’ Schemaè¿­ä»£é˜¶æ®µï¼ˆå¯¹æ¯ä¸ªHTMLï¼‰
                    â”œâ”€ è¯»å–HTMLæ–‡ä»¶ + æˆªå›¾ï¼ˆDrissionPageï¼‰
                    â”œâ”€ HTMLç²¾ç®€ï¼ˆå‡å°‘tokenæ¶ˆè€—ï¼‰
                    â”œâ”€ HTML â†’ Schemaï¼ˆå«xpathè·¯å¾„ï¼‰
                    â”œâ”€ è§†è§‰ â†’ Schemaï¼ˆå«è§†è§‰æè¿°ï¼‰
                    â””â”€ åˆå¹¶ä¸¤ä¸ªSchema
         â†“
    å¤šSchemaåˆå¹¶ï¼ˆç­›é€‰+ä¿®æ­£+å»é‡ï¼‰â†’ æœ€ç»ˆSchema
         â†“
    ä»£ç è¿­ä»£é˜¶æ®µ â†’ ç”Ÿæˆ/ä¼˜åŒ–è§£æä»£ç  â†’ æœ€ç»ˆä»£ç 
```

### Schemaè¿­ä»£è§„åˆ™

**å¯¹äºå•ä¸ªHTMLï¼ˆå»ºè®®è¾“å…¥2ï½5ä¸ªï¼‰ï¼š**
1. **HTMLåˆ†æ**ï¼šä»HTMLä»£ç æå–Schemaï¼ˆå­—æ®µåã€è¯´æ˜ã€å€¼ç¤ºä¾‹ã€**xpathè·¯å¾„**ï¼‰
2. **è§†è§‰åˆ†æ**ï¼šä»ç½‘é¡µæˆªå›¾æå–Schemaï¼ˆå­—æ®µåã€è¯´æ˜ã€å€¼ç¤ºä¾‹ã€**è§†è§‰æè¿°**ï¼‰
3. **Schemaåˆå¹¶**ï¼šåˆ¤æ–­ç›¸åŒå­—æ®µï¼Œåˆå¹¶xpathå’Œvisual_features

**å¤„ç†å®Œæ‰€æœ‰HTMLåï¼š**
4. **å¤šSchemaæ•´åˆ**ï¼š
   - å»é™¤æ— æ„ä¹‰å­—æ®µï¼ˆå¹¿å‘Šã€å¯¼èˆªç­‰ï¼‰
   - ä¿®æ­£å­—æ®µç»“æ„ï¼ˆå…ƒä¿¡æ¯å½’å±ã€åˆ—è¡¨å­—æ®µè¯†åˆ«ï¼‰
   - åˆå¹¶xpathè·¯å¾„ï¼ˆæ¯ä¸ªå­—æ®µåŒ…å«å¤šä¸ªxpathï¼Œå¢å¼ºé²æ£’æ€§ï¼‰
   - ç”Ÿæˆæœ€ç»ˆSchema

### æ ¸å¿ƒæŠ€æœ¯

- **åŒé‡è§†è§’Schemaæå–**ï¼šåŒæ—¶ä»HTMLä»£ç å’Œè§†è§‰å¸ƒå±€æå–Schemaï¼Œäº’ç›¸è¡¥å……
- **å¤šè·¯å¾„é²æ£’æ€§**ï¼šæ¯ä¸ªå­—æ®µä¿ç•™å¤šä¸ªxpathæå–è·¯å¾„ï¼Œé€‚åº”ä¸åŒé¡µé¢ç»“æ„
- **æ™ºèƒ½Schemaåˆå¹¶**ï¼šè‡ªåŠ¨è¯†åˆ«ç›¸åŒå­—æ®µã€ä¿®æ­£å­—æ®µç±»å‹ã€ä¼˜åŒ–æ•°æ®ç»“æ„
- **HTMLç²¾ç®€**ï¼šä½¿ç”¨è‡ªå®šä¹‰HTMLç²¾ç®€å·¥å…·ï¼Œå‡å°‘tokenæ¶ˆè€—ï¼Œæå‡å“åº”é€Ÿåº¦

---

## å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/ccprocessor/web2json-agent.git
cd web2json-agent

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æˆ–ä½¿ç”¨å¯ç¼–è¾‘æ¨¡å¼ï¼ˆå¼€å‘ï¼‰
pip install -e .
```

---

## âš™ï¸ é…ç½®ï¼ˆé‡è¦ï¼ï¼‰

### ç¯å¢ƒé…ç½®

**ä½¿ç”¨å‰å¿…é¡»å…ˆé…ç½® .env æ–‡ä»¶ï¼**

1. **å¤åˆ¶é…ç½®æ¨¡æ¿**

```bash
cp .env.example .env
```

2. **ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„é…ç½®**

```bash
vim .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

3. **å¿…å¡«é…ç½®é¡¹**

```bash
# API é…ç½®ï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY=your_api_key_here          # ä½ çš„ API å¯†é’¥
OPENAI_API_BASE=https://api.openai.com/v1  # API åœ°å€
```

4. **å¯é€‰é…ç½®é¡¹**ï¼ˆæœ‰é»˜è®¤å€¼ï¼Œå¯ä¸ä¿®æ”¹ï¼‰

```bash
# æ¨¡å‹é…ç½®
DEFAULT_MODEL=claude-sonnet-4-5-20250929     # é»˜è®¤æ¨¡å‹ï¼ˆé€šç”¨åœºæ™¯ï¼‰
AGENT_MODEL=claude-sonnet-4-5-20250929      # Agent ä½¿ç”¨çš„æ¨¡å‹
CODE_GEN_MODEL=claude-sonnet-4-5-20250929   # ä»£ç ç”Ÿæˆæ¨¡å‹
VISION_MODEL=qwen-vl-max                     # è§†è§‰ç†è§£æ¨¡å‹
```

æ›´å¤šé…ç½®é€‰é¡¹è¯·æŸ¥çœ‹ `.env.example` æ–‡ä»¶ã€‚

---

## ä½¿ç”¨

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# æŸ¥çœ‹å¸®åŠ©
web2json --help

# ä»ç›®å½•è¯»å–HTMLæ–‡ä»¶ï¼ˆæ¨èï¼‰
web2json -d input_html/ -o output/blog
```

### Python æºç ä½¿ç”¨ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

å¦‚æœä»æºç å®‰è£…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸå§‹çš„ Python æ–¹å¼ï¼š

```bash
# ä»ç›®å½•è¯»å–ï¼ˆæ¨èï¼‰
python main.py -d input_html/ -o output/blog

# æŒ‡å®šé¡µé¢ç±»å‹
python main.py -d input_html/ -o output/blog -t blog_article
```

### HTML æ–‡ä»¶å‡†å¤‡

åœ¨ `input_html/` ç›®å½•ä¸‹æ”¾ç½®å¤šä¸ªåŒç±»å‹ç½‘é¡µçš„ HTML æºç æ–‡ä»¶ï¼š

```
input_html/
  â”œâ”€â”€ page1.html
  â”œâ”€â”€ page2.html
  â””â”€â”€ page3.html
```

### ä½¿ç”¨ç”Ÿæˆçš„è§£æå™¨

```python
import sys
sys.path.insert(0, 'output/blog/parsers')
from generated_parser import WebPageParser

parser = WebPageParser()
data = parser.parse(html_content)
print(data)
```

---

## é¡¹ç›®ç»“æ„

```
web2json-agent/
â”œâ”€â”€ agent/                  # Agent æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ planner.py         # ä»»åŠ¡è§„åˆ’
â”‚   â”œâ”€â”€ executor.py        # ä»»åŠ¡æ‰§è¡Œï¼ˆå«Schemaè¿­ä»£é€»è¾‘ï¼‰
â”‚   â””â”€â”€ orchestrator.py    # Agent ç¼–æ’
â”‚
â”œâ”€â”€ tools/                  # LangChain Tools
â”‚   â”œâ”€â”€ webpage_source.py          # è¯»å–æœ¬åœ°HTMLæ–‡ä»¶
â”‚   â”œâ”€â”€ webpage_screenshot.py      # æˆªå›¾ï¼ˆDrissionPageï¼‰
â”‚   â”œâ”€â”€ schema_extraction.py       # Schemaæå–å’Œåˆå¹¶
â”‚   â”œâ”€â”€ html_simplifier.py         # HTMLç²¾ç®€å·¥å…·
â”‚   â””â”€â”€ code_generator.py          # ä»£ç ç”Ÿæˆ
â”‚
â”œâ”€â”€ prompts/                # Prompt æ¨¡æ¿
â”‚   â”œâ”€â”€ schema_extraction.py       # Schemaæå–Promptï¼ˆHTML+è§†è§‰ï¼‰
â”‚   â”œâ”€â”€ schema_merge.py            # Schemaåˆå¹¶Prompt
â”‚   â””â”€â”€ code_generator.py          # ä»£ç ç”ŸæˆPrompt
â”‚
â”œâ”€â”€ config/                 # é…ç½®
â”‚   â””â”€â”€ settings.py
â”‚
â”œâ”€â”€ utils/                  # å·¥å…·ç±»
â”‚   â””â”€â”€ llm_client.py      # LLM å®¢æˆ·ç«¯
â”‚
â”œâ”€â”€ output/                 # è¾“å‡ºç›®å½•
â”‚   â””â”€â”€ [domain]/
â”‚       â”œâ”€â”€ screenshots/       # ç½‘é¡µæˆªå›¾
â”‚       â”œâ”€â”€ html_original/     # åŸå§‹HTML
â”‚       â”œâ”€â”€ html_simplified/   # ç²¾ç®€HTML
â”‚       â”œâ”€â”€ schemas/           # Schemaæ–‡ä»¶
â”‚       â”‚   â”œâ”€â”€ html_schema_round_{N}.json     # HTMLæå–çš„Schema
â”‚       â”‚   â”œâ”€â”€ visual_schema_round_{N}.json   # è§†è§‰æå–çš„Schema
â”‚       â”‚   â”œâ”€â”€ merged_schema_round_{N}.json   # åˆå¹¶åçš„Schema
â”‚       â”‚   â””â”€â”€ final_schema.json              # æœ€ç»ˆSchema
â”‚       â”œâ”€â”€ parsers/           # ç”Ÿæˆçš„è§£æå™¨
â”‚       â”‚   â”œâ”€â”€ parser_round_{N}.py            # æ¯è½®ç”Ÿæˆçš„è§£æå™¨
â”‚       â”‚   â””â”€â”€ final_parser.py                # æœ€ç»ˆè§£æå™¨
â”‚       â””â”€â”€ result/            # è§£æç»“æœJSON
â”‚
â”œâ”€â”€ main.py                # å‘½ä»¤è¡Œå…¥å£
â””â”€â”€ requirements.txt       # ä¾èµ–åˆ—è¡¨
```

---

## Schemaæ ¼å¼è¯´æ˜

### æœ€ç»ˆSchemaç»“æ„

ç”Ÿæˆçš„`final_schema.json`åŒ…å«æ¯ä¸ªå­—æ®µçš„å®Œæ•´ä¿¡æ¯ï¼š

```json
{
  "title": {
    "type": "string",
    "description": "æ–‡ç« æ ‡é¢˜",
    "value_sample": "å…³äºäººå·¥æ™ºèƒ½çš„æœªæ¥",
    "xpaths": [
      "//h1[@class='article-title']/text()",
      "//div[@class='title']/text()"
    ],
    "visual_features": "ä½äºé¡µé¢ä¸Šéƒ¨ä¸­å¤®åŒºåŸŸï¼Œå­—ä½“éå¸¸å¤§ä¸”åŠ ç²—ï¼Œé¢œè‰²ä¸ºæ·±è‰²..."
  },
  "comments": {
    "type": "array",
    "description": "è¯„è®ºåˆ—è¡¨",
    "value_sample": [{"user": "ç”¨æˆ·A", "text": "è¯„è®ºå†…å®¹"}],
    "xpaths": [
      "//div[@class='comment-list']//div[@class='comment']",
      "//ul[@class='comments']//li"
    ],
    "visual_features": "ä½äºæ­£æ–‡ä¸‹æ–¹ï¼Œå¤šä¸ªè¯„è®ºé¡¹å‚ç›´æ’åˆ—..."
  }
}
```

### å­—æ®µè¯´æ˜

- **type**: æ•°æ®ç±»å‹ï¼ˆstring, number, array, objectç­‰ï¼‰
- **description**: å­—æ®µçš„è¯­ä¹‰æè¿°
- **value_sample**: å®é™…å€¼ç¤ºä¾‹ï¼ˆå­—ç¬¦ä¸²æˆªå–å‰50å­—ç¬¦ï¼‰
- **xpaths**: æ•°ç»„å½¢å¼ï¼ŒåŒ…å«å¤šä¸ªå¯ç”¨çš„xpathæå–è·¯å¾„ï¼ˆå¢å¼ºé²æ£’æ€§ï¼‰
- **visual_features**: è§†è§‰ç‰¹å¾æè¿°ï¼ŒåŒ…æ‹¬ä½ç½®ã€å­—ä½“ã€é¢œè‰²ã€å¸ƒå±€ç­‰

---

## è¿”å›å€¼è¯´æ˜

`generate_parser()` è¿”å›ï¼š

```python
{
    'success': bool,              # æ˜¯å¦æˆåŠŸ
    'parser_path': str,           # è§£æå™¨è·¯å¾„
    'config_path': str,           # é…ç½®æ–‡ä»¶è·¯å¾„
    'validation_result': {        # éªŒè¯ç»“æœ
        'success': bool,
        'success_rate': float,    # æˆåŠŸç‡ (0.0-1.0)
        'tests': [...]            # æµ‹è¯•è¯¦æƒ…
    },
    'error': str                  # é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰
}
```

---

## è®¸å¯è¯

MIT License

---

**æœ€åæ›´æ–°**: 2025-12-18
**ç‰ˆæœ¬**: 1.0.0

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-12-18)
- âœ¨ æ›´æ¸…æ™°çš„æ¨¡å—ç»“æ„ï¼šæ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€æ˜ç¡®
- âœ… å®Œå–„CLIï¼šæ–°å¢é…ç½®éªŒè¯å’Œäº¤äº’å¼è®¾ç½®
- âœ¨ åŒé‡è§†è§’Schemaæå–ï¼ˆHTML + è§†è§‰ï¼‰
- âœ¨ æ”¯æŒå¤šxpathè·¯å¾„ï¼Œå¢å¼ºè§£æé²æ£’æ€§
- âœ¨ æ™ºèƒ½Schemaåˆå¹¶å’Œç»“æ„ä¼˜åŒ–
- âœ¨ é›†æˆHTMLç²¾ç®€å·¥å…·ï¼Œå‡å°‘tokenæ¶ˆè€—ä»¥åŠå†—ä½™è¾“å…¥

### v0.2.0 (2025-12-12)
- âœ¨ æ–°å¢åŒé‡è§†è§’Schemaæå–ï¼ˆHTML + è§†è§‰ï¼‰
- âœ¨ æ”¯æŒå¤šxpathè·¯å¾„ï¼Œå¢å¼ºè§£æé²æ£’æ€§
- âœ¨ æ™ºèƒ½Schemaåˆå¹¶å’Œç»“æ„ä¼˜åŒ–
- âœ¨ é›†æˆHTMLç²¾ç®€å·¥å…·ï¼Œå‡å°‘tokenæ¶ˆè€—ä»¥åŠå†—ä½™è¾“å…¥

### v0.1.0 (2025-11-26)
- ğŸ‰ é¦–æ¬¡å‘å¸ƒ
- åŸºäºè§†è§‰ç†è§£çš„Schemaæå–
- è‡ªåŠ¨ä»£ç ç”Ÿæˆå’Œè¿­ä»£ä¼˜åŒ–

