Metadata-Version: 2.4
Name: robin-logs
Version: 0.1.0
Summary: Sistema de logs estructurado y desacoplado para FastAPI
Home-page: https://github.com/yourorg/robin-logs
Author: Robin Team
Author-email: Robin Team <team@robin.com>
License: MIT
Project-URL: Homepage, https://github.com/yourorg/robin-logs
Project-URL: Documentation, https://github.com/yourorg/robin-logs/wiki
Project-URL: Repository, https://github.com/yourorg/robin-logs
Keywords: logging,fastapi,structured-logging,log-rotation
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: System :: Logging
Classifier: Programming Language :: Python :: 3
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: fastapi>=0.100.0
Requires-Dist: python-json-logger>=2.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: httpx>=0.24.0; extra == "dev"
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-python

# robin-logs

Sistema de logs estructurado y f치cil de integrar para aplicaciones FastAPI.

## 游 Caracter칤sticas

- **Instalable v칤a pip** - Librer칤a desacoplada y reutilizable
- **Logs estructurados en JSON** - F치cil de procesar y analizar
- **Rotaci칩n autom치tica** - Gesti칩n inteligente del tama침o de archivos
- **Retenci칩n configurable** - Limpieza autom치tica de logs antiguos
- **API REST integrada** - Consulta logs sin abrir archivos
- **Filtros avanzados** - Por m칩dulo, nivel, tiempo, etc.
- **Sin dependencias externas** - No requiere ELK, Loki, ni servicios externos
- **Convivencia perfecta** - Se integra en tu FastAPI existente

## 游닍 Instalaci칩n

```bash
pip install robin-logs
```

## 游꿢 Inicio R치pido

```python
from fastapi import FastAPI
from robin_logs import setup_logging, register_log_routes, LogConfig

# Crear tu aplicaci칩n FastAPI
app = FastAPI()

# Configurar el sistema de logs
config = LogConfig(
    log_directory="./logs",
    retention_hours=72,  # 3 d칤as
    max_bytes=10 * 1024 * 1024,  # 10MB por archivo
    enable_api=True,
    api_prefix="/logs"
)

# Inicializar el sistema
setup_logging(config)

# Registrar endpoints de logs en tu FastAPI
register_log_routes(app, config)

# Tus rutas existentes...
@app.get("/")
async def root():
    return {"message": "Hello World"}
```

### Escribir Logs

```python
from robin_logs import get_logger

# Obtener logger para tu m칩dulo
logger = get_logger("whatsapp")

# Escribir logs con metadatos
logger.info(
    "Mensaje enviado correctamente",
    extra={
        "phone": "+573001234567",
        "message_id": "msg_123",
        "status": "delivered"
    }
)

logger.error(
    "Error al enviar mensaje",
    extra={
        "phone": "+573001234567",
        "error_code": "TIMEOUT",
        "retry_count": 3
    }
)
```

### Consultar Logs

Una vez integrada la librer칤a, puedes consultar logs a trav칠s de HTTP:

```bash
# Obtener todos los logs
GET http://localhost:8000/logs

# Logs de un m칩dulo espec칤fico
GET http://localhost:8000/logs/whatsapp

# 칔ltimos errores de las 칰ltimas 2 horas
GET http://localhost:8000/logs/whatsapp?level=ERROR&last=2h&limit=100

# Logs en un rango de tiempo espec칤fico
GET http://localhost:8000/logs?from=2025-12-17T00:00:00&to=2025-12-17T23:59:59

# Listar m칩dulos disponibles
GET http://localhost:8000/logs/modules/list
```

## 丘뙖잺 Configuraci칩n

```python
from robin_logs import LogConfig

config = LogConfig(
    # Almacenamiento
    log_directory="./logs",
    log_filename_pattern="{module}.log",
    max_bytes=10 * 1024 * 1024,  # 10MB
    backup_count=5,
    
    # Retenci칩n y limpieza
    retention_hours=72,  # 3 d칤as
    auto_cleanup=True,
    cleanup_interval_hours=24,
    
    # Formato
    json_format=True,
    log_level="INFO",
    include_timestamp=True,
    timezone="UTC",
    
    # API
    enable_api=True,
    api_prefix="/logs",
    
    # Seguridad
    require_auth=False,  # Activar para proteger endpoints
    api_key_header="X-API-Key",
    api_key="tu-api-key-secreta",  # Requerido si require_auth=True
)
```

### Seguridad (Opcional)

```python
config = LogConfig(
    enable_api=True,
    require_auth=True,
    api_key="mi-clave-super-secreta-123"
)

setup_logging(config)
register_log_routes(app, config)
```

Luego, para consultar logs:

```bash
curl -H "X-API-Key: mi-clave-super-secreta-123" \
     http://localhost:8000/logs/whatsapp
```

## 游닄 Ejemplos

### M칩dulo de WhatsApp

```python
from robin_logs import get_logger

logger = get_logger("whatsapp")

async def send_message(phone: str, message: str):
    logger.info("Iniciando env칤o de mensaje", extra={
        "phone": phone,
        "message_length": len(message)
    })
    
    try:
        # ... l칩gica de env칤o ...
        logger.info("Mensaje enviado exitosamente", extra={
            "phone": phone,
            "message_id": "msg_123"
        })
    except Exception as e:
        logger.error("Error al enviar mensaje", extra={
            "phone": phone,
            "error": str(e)
        })
        raise
```

### M칰ltiples M칩dulos

```python
# whatsapp.py
whatsapp_logger = get_logger("whatsapp")

# instagram.py
instagram_logger = get_logger("instagram")

# email.py
email_logger = get_logger("email")

# Cada m칩dulo escribe en su propio archivo:
# - logs/whatsapp.log
# - logs/instagram.log
# - logs/email.log
```

### Middleware de Logging

```python
from fastapi import FastAPI, Request
from robin_logs import get_logger
import time

app = FastAPI()
logger = get_logger("api")

@app.middleware("http")
async def log_requests(request: Request, call_next):
    start_time = time.time()
    
    logger.info("Request iniciado", extra={
        "method": request.method,
        "path": request.url.path,
        "client": request.client.host
    })
    
    response = await call_next(request)
    
    duration = time.time() - start_time
    logger.info("Request completado", extra={
        "method": request.method,
        "path": request.url.path,
        "status_code": response.status_code,
        "duration_ms": round(duration * 1000, 2)
    })
    
    return response
```

## 游댌 Filtros de Consulta

| Par치metro | Tipo | Descripci칩n | Ejemplo |
|-----------|------|-------------|---------|
| `module` | string | Filtrar por m칩dulo | `whatsapp` |
| `level` | string | Nivel de log | `ERROR`, `INFO`, `WARNING` |
| `from` | datetime | Timestamp inicial (ISO 8601) | `2025-12-17T00:00:00` |
| `to` | datetime | Timestamp final (ISO 8601) | `2025-12-17T23:59:59` |
| `last` | string | Rango relativo | `2h`, `30m`, `1d` |
| `limit` | int | M치ximo de resultados | `200` (default: 1000) |
| `order` | string | Orden de resultados | `asc`, `desc` (default: desc) |

### Ejemplos de Consultas

```bash
# Errores de WhatsApp en las 칰ltimas 2 horas
GET /logs/whatsapp?level=ERROR&last=2h

# Todos los logs de hoy
GET /logs?from=2025-12-17T00:00:00&to=2025-12-17T23:59:59

# 칔ltimos 50 logs de Instagram
GET /logs/instagram?limit=50&order=asc
```

## 游닇 Formato de Logs

Los logs se guardan en formato JSON por defecto:

```json
{
  "timestamp": "2025-12-17 10:30:45",
  "level": "INFO",
  "module": "whatsapp",
  "message": "Mensaje enviado correctamente",
  "phone": "+573001234567",
  "message_id": "msg_123"
}
```

## 游늯 Licencia

MIT License - Ver archivo `LICENSE` para m치s detalles.

---

Desarrollado con 仇벒잺 por el equipo de Robin
