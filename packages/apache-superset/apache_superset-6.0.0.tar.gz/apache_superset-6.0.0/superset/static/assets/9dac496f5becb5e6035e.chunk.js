"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5169],{35273:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(2445),l=a(50290),s=a(95018),n=a(7437),r=a(8558);const o=function({warningMarkdown:e,size:t,marginRight:a}){const o=(0,l.DP)();return(0,i.Y)(s.m,{id:"warning-tooltip",title:(0,i.Y)(n.z,{source:e}),children:(0,i.Y)(r.F.WarningOutlined,{iconColor:o.colorWarning,iconSize:t,css:{marginRight:null!=a?a:2*o.sizeUnit}})})}},69880:(e,t,a)=>{a.r(t),a.d(t,{default:()=>K});var i=a(2445),l=a(1763),s=a(50290),n=a(17437),r=a(74098),o=a(79378),d=a(96540),c=a(61574),u=a(71519),h=a(58561),p=a.n(h),m=a(71323),b=a(86784),y=a(54569),g=a(5250),S=a(8558),f=a(27509);const w=({datasetType:e})=>{const t=(0,s.DP)(),a="physical"===e?(0,r.t)("Physical"):(0,r.t)("Virtual"),l="physical"===e?(0,i.Y)(S.F.InsertRowAboveOutlined,{iconSize:"s",iconColor:t.colorPrimary}):(0,i.Y)(S.F.ConsoleSqlOutlined,{iconSize:"s"}),n="physical"===e?"primary":"default";return(0,i.Y)(f.JU,{icon:l,type:n,style:{color:"physical"===e?t.colorPrimaryText:t.colorPrimary},children:a})};var Y=a(95018),v=a(94551),_=a(19187),D=a(38961),k=a(92998),C=a(89232),F=a(42566),A=a(51304),T=a(20237),z=a(64457),P=a(35273),H=a(47305),x=a(31121),I=a(97163),B=a(23195),N=a(17355),O=a(51692);const E=({dataset:e,onHide:t,onDuplicate:a})=>{const[l,s]=(0,d.useState)(!1),[n,o]=(0,d.useState)(!1),[c,u]=(0,d.useState)(""),h=()=>{a(c)};return(0,d.useEffect)((()=>{u(""),s(null!==e)}),[e]),(0,i.FD)(I.aF,{show:l,onHide:t,name:(0,r.t)("Duplicate dataset"),title:(0,i.Y)(O.r,{title:(0,r.t)("Duplicate dataset"),icon:(0,i.Y)(S.F.CopyOutlined,{})}),disablePrimaryButton:n,onHandledPrimaryAction:h,primaryButtonName:(0,r.t)("Duplicate"),children:[(0,i.Y)(B.l,{htmlFor:"duplicate",children:(0,r.t)("New dataset name")}),(0,i.Y)(N.A,{type:"text",id:"duplicate",autoComplete:"off",value:c,onChange:e=>{var t;const a=null!=(t=e.target.value)?t:"";u(a),o(""===a)},onPressEnter:h})]})};var M=a(61225),R=a(79605),$=a(66124);const L=(0,l.a)().get("dataset.delete.related"),J=s.I4.div`
  align-items: center;
  display: flex;
  gap: ${({theme:e})=>e.sizeUnit}px;

  svg {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,U=s.I4.div`
  ${({theme:e})=>n.AH`
    color: ${e.colorIcon};

    .disabled {
      svg,
      i {
        &:hover {
          path {
            fill: ${e.colorText};
          }
        }
      }
      color: ${e.colorTextDisabled};
      &:hover {
        cursor: not-allowed;
      }
      .ant-menu-item:hover {
        cursor: default;
      }
      &::after {
        color: ${e.colorTextDisabled};
      }
    }
  `}
`,K=(0,z.Ay)((({addDangerToast:e,addSuccessToast:t,user:a})=>{const l=(0,c.W6)(),n=(0,s.DP)(),{state:{loading:h,resourceCount:f,resourceCollection:z,bulkSelectEnabled:I},hasPerm:B,fetchData:N,toggleBulkSelect:O,refreshData:K}=(0,b.RU)("dataset",(0,r.t)("dataset"),e),[W,q]=(0,d.useState)(null),[j,V]=(0,d.useState)(null),[X,G]=(0,d.useState)(null),[Q,Z]=(0,d.useState)(!1),[ee,te]=(0,d.useState)([]),[ae,ie]=(0,d.useState)(!1),[le,se]=(0,d.useState)([]),[ne,re]=(0,d.useState)([]),[oe,de]=(0,d.useState)([]),ce=(0,M.d4)((e=>{var t;return(null==(t=e.common)||null==(t=t.conf)?void 0:t.PREVENT_UNSAFE_DEFAULT_URLS_ON_DATASET)||!1})),ue=B("can_write"),he=B("can_write"),pe=B("can_write"),me=B("can_duplicate"),be=B("can_export"),ye=x.Hu,ge=(0,d.useCallback)((({id:t})=>{o.A.get({endpoint:`/api/v1/dataset/${t}`}).then((({json:e={}})=>{const t=e.result.columns.map((e=>{const{certification:{details:t="",certified_by:a=""}={}}=JSON.parse(e.extra||"{}")||{};return{...e,certification_details:t||"",certified_by:a||"",is_certified:t||a}}));e.result.columns=[...t],V(e.result)})).catch((()=>{e((0,r.t)("An error occurred while fetching dataset related data"))}))}),[e]),Se=e=>{const t=e.map((({id:e})=>e));(0,A.A)("dataset",t,(()=>{ie(!1)})),ie(!0)},fe=(0,d.useMemo)((()=>[{Cell:({row:{original:{kind:e}}})=>null,accessor:"kind_icon",disableSortBy:!0,size:"xs",id:"id"},{Cell:({row:{original:{extra:e,table_name:t,description:a,explore_url:l}}})=>{let s;s=ce?(0,i.Y)(u.N_,{to:l,children:t}):(0,i.Y)(C.Kt,{to:l,children:t});try{const t=JSON.parse(e);return(0,i.FD)(J,{children:[(null==t?void 0:t.certification)&&(0,i.Y)(y.T,{certifiedBy:t.certification.certified_by,details:t.certification.details,size:"l"}),(null==t?void 0:t.warning_markdown)&&(0,i.Y)(P.A,{warningMarkdown:t.warning_markdown,size:"l"}),s,a&&(0,i.Y)(g.I,{tooltip:a})]})}catch{return s}},Header:(0,r.t)("Name"),accessor:"table_name",id:"table_name"},{Cell:({row:{original:{kind:e}}})=>(0,i.Y)(w,{datasetType:e}),Header:(0,r.t)("Type"),accessor:"kind",disableSortBy:!0,size:"sm",id:"kind"},{Header:(0,r.t)("Database"),accessor:"database.database_name",size:"xl",id:"database.database_name"},{Header:(0,r.t)("Schema"),accessor:"schema",size:"lg",id:"schema"},{accessor:"database",disableSortBy:!0,hidden:!0,id:"database"},{Cell:({row:{original:{owners:e=[]}}})=>(0,i.Y)(C.WM,{users:e}),Header:(0,r.t)("Owners"),id:"owners",disableSortBy:!0,size:"lg"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,i.Y)(C.UW,{date:e,user:t}),Header:(0,r.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",id:"changed_on_delta_humanized"},{accessor:"sql",hidden:!0,disableSortBy:!0,id:"sql"},{Cell:({row:{original:e}})=>{const t=e.owners.map((e=>e.id)).includes(a.userId)||(0,H.N6)(a);return ue||he||be||me?(0,i.FD)(U,{className:"actions",children:[he&&(0,i.Y)(Y.m,{id:"delete-action-tooltip",title:(0,r.t)("Delete"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return t=e,o.A.get({endpoint:`/api/v1/dataset/${t.id}/related_objects`}).then((({json:e={}})=>{q({...t,charts:e.charts,dashboards:e.dashboards})})).catch((0,m.JF)((e=>(0,r.t)("An error occurred while fetching dataset related data: %s",e))));var t},children:(0,i.Y)(S.F.DeleteOutlined,{iconSize:"l"})})}),be&&(0,i.Y)(Y.m,{id:"export-action-tooltip",title:(0,r.t)("Export"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>Se([e]),children:(0,i.Y)(S.F.UploadOutlined,{iconSize:"l"})})}),ue&&(0,i.Y)(Y.m,{id:"edit-action-tooltip",title:t?(0,r.t)("Edit"):(0,r.t)("You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access."),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button "+(t?"":"disabled"),onClick:t?()=>ge(e):void 0,children:(0,i.Y)(S.F.EditOutlined,{iconSize:"l"})})}),me&&"virtual"===e.kind&&(0,i.Y)(Y.m,{id:"duplicate-action-tooltip",title:(0,r.t)("Duplicate"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{G(e)},children:(0,i.Y)(S.F.CopyOutlined,{iconSize:"l"})})})]}):null},Header:(0,r.t)("Actions"),id:"actions",hidden:!ue&&!he&&!me,disableSortBy:!0},{accessor:R.H.ChangedBy,hidden:!0,id:R.H.ChangedBy}]),[ue,he,be,ge,me,a]),we=(0,d.useMemo)((()=>[{Header:(0,r.t)("Name"),key:"search",id:"table_name",input:"search",operator:C.c0.Contains},{Header:(0,r.t)("Type"),key:"sql",id:"sql",input:"select",operator:C.c0.DatasetIsNullOrEmpty,unfilteredLabel:"All",selects:[{label:(0,r.t)("Virtual"),value:!1},{label:(0,r.t)("Physical"),value:!0}]},{Header:(0,r.t)("Database"),key:"database",id:"database",input:"select",operator:C.c0.RelationOneMany,unfilteredLabel:"All",fetchSelects:(0,m.u1)("dataset","database",(0,m.JF)((e=>(0,r.t)("An error occurred while fetching datasets: %s",e)))),paginate:!0,dropdownStyle:{minWidth:$.f8}},{Header:(0,r.t)("Schema"),key:"schema",id:"schema",input:"select",operator:C.c0.Equals,unfilteredLabel:"All",fetchSelects:(0,m.$C)("dataset","schema",(0,m.JF)((e=>(0,r.t)("An error occurred while fetching schema values: %s",e)))),paginate:!0,dropdownStyle:{minWidth:$.f8}},{Header:(0,r.t)("Owner"),key:"owner",id:"owners",input:"select",operator:C.c0.RelationManyMany,unfilteredLabel:"All",fetchSelects:(0,m.u1)("dataset","owners",(0,m.JF)((e=>(0,r.t)("An error occurred while fetching dataset owner values: %s",e))),a),paginate:!0,dropdownStyle:{minWidth:$.f8}},{Header:(0,r.t)("Certified"),key:"certified",id:"id",urlDisplay:"certified",input:"select",operator:C.c0.DatasetIsCertified,unfilteredLabel:(0,r.t)("Any"),selects:[{label:(0,r.t)("Yes"),value:!0},{label:(0,r.t)("No"),value:!1}]},{Header:(0,r.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:C.c0.RelationOneMany,unfilteredLabel:(0,r.t)("All"),fetchSelects:(0,m.u1)("dataset","changed_by",(0,m.JF)((e=>(0,r.t)("An error occurred while fetching dataset datasource values: %s",e))),a),paginate:!0,dropdownStyle:{minWidth:$.f8}}]),[a]),Ye={activeChild:"Datasets",name:(0,r.t)("Datasets")},ve=[];return pe&&ve.push({name:(0,i.Y)(Y.m,{id:"import-tooltip",title:(0,r.t)("Import datasets"),placement:"bottomRight",children:(0,i.Y)(S.F.DownloadOutlined,{iconColor:n.colorPrimary,iconSize:"l"})}),buttonStyle:"link",onClick:()=>{Z(!0)}}),(he||be)&&ve.push({name:(0,r.t)("Bulk select"),onClick:O,buttonStyle:"secondary"}),pe&&ve.push({icon:(0,i.Y)(S.F.PlusOutlined,{iconSize:"m"}),name:(0,r.t)("Dataset"),onClick:()=>{l.push("/dataset/add/")},buttonStyle:"primary"}),Ye.buttons=ve,(0,i.FD)(i.FK,{children:[(0,i.Y)(T.A,{...Ye}),W&&(0,i.Y)(v.T,{description:(0,i.FD)(i.FK,{children:[(0,i.FD)("p",{children:[(0,r.t)("The dataset"),(0,i.FD)("b",{children:[" ",W.table_name," "]}),(0,r.t)("is linked to %s charts that appear on %s dashboards. Are you sure you want to continue? Deleting the dataset will break those objects.",W.charts.count,W.dashboards.count)]}),W.dashboards.count>=1&&(0,i.FD)(i.FK,{children:[(0,i.Y)("h4",{children:(0,r.t)("Affected Dashboards")}),(0,i.Y)(_.B,{split:!1,size:"small",dataSource:W.dashboards.result.slice(0,10),renderItem:e=>(0,i.Y)(_.B.Item,{compact:!0,children:(0,i.Y)(_.B.Item.Meta,{avatar:(0,i.Y)("span",{children:"•"}),title:(0,i.Y)(F.o.Link,{href:`/superset/dashboard/${e.id}`,target:"_atRiskItem",children:e.title})})},e.id),footer:W.dashboards.result.length>10&&(0,i.Y)("div",{children:(0,r.t)("... and %s others",W.dashboards.result.length-10)})})]}),W.charts.count>=1&&(0,i.FD)(i.FK,{children:[(0,i.Y)("h4",{children:(0,r.t)("Affected Charts")}),(0,i.Y)(_.B,{split:!1,size:"small",dataSource:W.charts.result.slice(0,10),renderItem:e=>(0,i.Y)(_.B.Item,{compact:!0,children:(0,i.Y)(_.B.Item.Meta,{avatar:(0,i.Y)("span",{children:"•"}),title:(0,i.Y)(F.o.Link,{href:`/explore/?slice_id=${e.id}`,target:"_atRiskItem",children:e.slice_name})})},e.id),footer:W.charts.result.length>10&&(0,i.Y)("div",{children:(0,r.t)("... and %s others",W.charts.result.length-10)})})]}),L&&(0,i.Y)(L,{dataset:W})]}),onConfirm:()=>{W&&(({id:a,table_name:i})=>{o.A.delete({endpoint:`/api/v1/dataset/${a}`}).then((()=>{K(),q(null),t((0,r.t)("Deleted: %s",i))}),(0,m.JF)((t=>e((0,r.t)("There was an issue deleting %s: %s",i,t)))))})(W)},onHide:()=>{q(null)},open:!0,title:(0,r.t)("Delete Dataset?")}),j&&(0,i.Y)(C.XR,{datasource:j,onDatasourceSave:K,onHide:()=>{V(null)},show:!0}),(0,i.Y)(E,{dataset:X,onHide:()=>{G(null)},onDuplicate:t=>{null===X&&e((0,r.t)("There was an issue duplicating the dataset.")),o.A.post({endpoint:"/api/v1/dataset/duplicate",jsonPayload:{base_model_id:null==X?void 0:X.id,table_name:t}}).then((()=>{G(null),K()}),(0,m.JF)((t=>e((0,r.t)("There was an issue duplicating the selected datasets: %s",t)))))}}),(0,i.Y)(D.h,{title:(0,r.t)("Please confirm"),description:(0,r.t)("Are you sure you want to delete the selected datasets?"),onConfirm:a=>{o.A.delete({endpoint:`/api/v1/dataset/?q=${p().encode(a.map((({id:e})=>e)))}`}).then((({json:e={}})=>{K(),t(e.message)}),(0,m.JF)((t=>e((0,r.t)("There was an issue deleting the selected datasets: %s",t)))))},children:a=>{const l=[];return he&&l.push({key:"delete",name:(0,r.t)("Delete"),onSelect:a,type:"danger"}),be&&l.push({key:"export",name:(0,r.t)("Export"),type:"primary",onSelect:Se}),(0,i.Y)(C.uO,{className:"dataset-list-view",columns:fe,data:z,count:f,pageSize:x.md,fetchData:N,filters:we,loading:h,initialSort:ye,bulkActions:l,bulkSelectEnabled:I,disableBulkSelect:O,addDangerToast:e,addSuccessToast:t,refreshData:K,renderBulkSelectCopy:e=>{const{virtualCount:t,physicalCount:a}=e.reduce(((e,t)=>("physical"===t.original.kind?e.physicalCount+=1:"virtual"===t.original.kind&&(e.virtualCount+=1),e)),{virtualCount:0,physicalCount:0});return e.length?t&&!a?(0,r.t)("%s Selected (Virtual)",e.length,t):a&&!t?(0,r.t)("%s Selected (Physical)",e.length,a):(0,r.t)("%s Selected (%s Physical, %s Virtual)",e.length,a,t):(0,r.t)("0 Selected")}})}}),(0,i.Y)(C.zb,{resourceName:"dataset",resourceLabel:(0,r.t)("dataset"),passwordsNeededMessage:x.ry,confirmOverwriteMessage:x.R6,addDangerToast:e,addSuccessToast:t,onModelImport:()=>{Z(!1),K(),t((0,r.t)("Dataset imported"))},show:Q,onHide:()=>{Z(!1)},passwordFields:ee,setPasswordFields:te,sshTunnelPasswordFields:le,setSSHTunnelPasswordFields:se,sshTunnelPrivateKeyFields:ne,setSSHTunnelPrivateKeyFields:re,sshTunnelPrivateKeyPasswordFields:oe,setSSHTunnelPrivateKeyPasswordFields:de}),ae&&(0,i.Y)(k.R,{})]})}))}}]);