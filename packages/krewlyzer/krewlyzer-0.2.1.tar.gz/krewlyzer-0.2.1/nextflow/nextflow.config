params {
    // Pipeline Options
    outdir = './results'
    ref = null          // Required
    targets = null      // Optional
    
    // Filters & Algorithm Settings
    mapq = 20
    minlen = 65
    maxlen = 400
    skip_duplicates = true
    require_proper_pair = true
    exclude_regions = ''
    threads = 8

    // Boilerplate for nf-core standards
    monochrome_logs = false
    help = false
}

// Global Process Configuration
process {
    cpus = params.threads
    memory = '32 GB'
    time = '24h'
    shell = ['/bin/bash', '-euo', 'pipefail']

    // Publish Results organized by Sample ID
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[-1].toLowerCase() == 'runall' ? meta.id : meta.id}" },
        mode: 'copy',
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]
}

// Profiles
profiles {
    docker {
        docker.enabled = true
        singularity.enabled = false
        podman.enabled = false
        shifter.enabled = false
        charliecloud.enabled = false
    }
    
    slurm {
        process {
            executor = 'slurm'
            queue = 'cmobic_cpu'
            clusterOptions = '' // Add specific options if needed
        }
        singularity {
            enabled = true
            autoMounts = true
            cacheDir = "${HOME}/.singularity_cache"
        }
        docker.enabled = false
    }
}

manifest {
    name = 'msk-access/krewlyzer'
    author = 'MSK-ACCESS Team'
    homePage = 'https://github.com/msk-access/krewlyzer'
    description = 'Fragmentation Features Pipeline'
    mainScript = 'main.nf'
    nextflowVersion = '!>=22.10.1'
    version = '0.2.0'
}
