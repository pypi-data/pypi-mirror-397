<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Montecarlo Simulation - PyFlange Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Montecarlo Simulation";
        var mkdocs_page_input_path = "examples\\montecarlo.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../assets/logo.svg" class="logo" alt="Logo"/>
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API's</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../apis/bolts/">bolts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../apis/flangesegments/">flangesegments</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../apis/fatigue/">fatigue</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../apis/stats/">stats</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deprecated API's</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../apis/gap/">gap</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Montecarlo Simulation</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">PyFlange Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Examples</li>
      <li class="breadcrumb-item active">Montecarlo Simulation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="example-montecarlo-simulation">Example: Montecarlo Simulation</h1>
<p>This example shows how the pyflange library can be used to generate a random 
sample of bolt fatigue cases, which could be used, for example in a reliability 
analysis.</p>
<p>The first step would be to create certain 'sampler' objects, which are just
<a href="https://realpython.com/ref/glossary/generator/">Python generator functions</a>
that yield random values. The samplers that we need to create are namely:</p>
<ul>
<li>A flange segment sampler: a random generator of <code>pyflange.flangesegments.FlangeSegment</code> objects</li>
<li>A Markov matrix sampler: a random generator of flange load <code>pyflange.fatigue.MarkovMatrix</code> objects</li>
<li>A SN-curve sampler: a random generator of <code>pyflange.fatigue.BoltFatigueCurve</code> objects</li>
<li>An allowable damage sampler: a random generator of real numbers that represent the allowable damage</li>
</ul>
<p>Let's start with creating a <strong>polynomial L-Flange segment sampler</strong>. This can be done using the <code>pyflange.stats.standard_PolynomialLFlangeSegment_sampler</code> function, as shown in the following snippet.</p>
<pre><code class="language-py">import pyflange.stats as stats

from math import pi
mm = 0.001
kN = 1000
deg = pi/180

from pyflange.bolts import StandardMetricBolt, RoundNut
N_BOLTS = 156

fseg_samp = stats.standard_PolynomialLFlangeSegment_sampler (
        a = 150*mm,        # distance between inner face of the flange and center of the bolt hole
        b = 122*mm,        # distance between center of the bolt hole and center-line of the shell
        s =  54*mm,        # shell thickness
        t = 172*mm,        # flange thickness
        R = 4000*mm,       # shell outer curvature radius
        central_angle = 2*pi / N_BOLTS,  # angle subtended by the flange segment

        Zg = -18044*kN / N_BOLTS,      # load applied to the flange segment shell at rest

        # Bolt object representing the flange segment bolt
        bolt = StandardMetricBolt(&quot;M80&quot;, &quot;10.9&quot;, shank_length=160*mm, 
                shank_diameter_ratio=76.1/80, stud=True),


        Do = 86*mm,               # Bolt hole diameter
        washer = None,            # Bolt washer
        nut = RoundNut(&quot;M80&quot;),    # Bolt nut

        # Bolt preload random sampler
        preload_sampler = stats.norm_sampler(2932.24*kN, 0.03), # bolt preload random sampler

        # Gap random stampler
        gap_sampler = stats.standard_gap_sampler(flange_diameter = 8000*mm,
                                                 flange_flatness_tolerance = 0.0014,   # 1.4 mm/m
                                                 gap_angle_sampler = stats.lognorm_sampler(100*deg, 1.0),
                                                 gap_shape_factor_sampler = stats.norm_sampler(1.0, 0.15)),

        # Flange tilt angle random stampler
        tilt_sampler = stats.lognorm_sampler(0.1*deg, 0.50),

        # Ratio of bottom shell thickness over s. Default s_botom = s.
        s_ratio = 1.0       
    )
</code></pre>
<blockquote>
<p>The <code>fseg_samp</code> object (like any other sampler) could be used in a for-loop such 
as <code>for random_fseg in fseg_samp: ...</code> to generate an infinite (you need to break the
loop yourself) series of random flange-segments or with the <code>next</code> function 
(e.g. <code>random_fseg1 = next(fseg_samp)</code>, <code>random_fseg2 = next(fseg_samp)</code>, etc.) to
generate individual random flange-segment objects. </p>
</blockquote>
<p>The next sampler we need is a <strong>MarkovMatrix sampler</strong>, which we can create using the
<code>pyflange.stats.standard_markov_matrix_sampler</code> fuctions, as shown in the snipped below.</p>
<pre><code class="language-py">import pyflange.stats as stats
from pyflange.fatigue import MarkovMatrix

# An &quot;average&quot; flange-load markov matrix is necessary as starting point. This could be 
# created cexplicitly as shown before, but more likely it will be loaded from an external
# csv or excel file. See the pyflange.fatigue module for more details.
avg_markov_matrix = MarkovMatrix(
        cycles = [ n0,  n1,  n2, ...],
        mean   = [ M0,  M1,  M2, ...],
        range  = [DM0, DM1, DM2, ...],
        duration = 25 # years
    )

# Create a sampler that generates random markov matrices having the same number of
# cycles and mean values that the average markov matrix, but random moment ranges from a
# log-normal distribution with mean value the avg_markov_matrix range and CoV=0.12.
markov_matrix_samp = stats.standard_markov_matrix_sampler(flange_mkv)
</code></pre>
<blockquote>
<p>The "standard" markov matrix sampler (like any other standard sampler contained in
the <code>pyflange.stats</code> module) is just one of the possible MarkovMatrix samplers. If you
want you can create your own sampler and, as long as it yields MarkovMatrix objects,
it will still work with the following code.</p>
</blockquote>
<p>The third sampler we need is a <strong>BoltFatigueCurve sampler</strong>, which we can generate 
using the <code>pyflange.stats.standard_bolt_fatigue_curve_sampler</code> function, as shown in
the snippet below.</p>
<pre><code class="language-py">import pyflange.stats as stats

Dn = 0.080 # Bolt nominal diameter: 80 mm
fatigue_curve_sampler = stats.bolt_fatigue_curve_sampler(Dn)
</code></pre>
<p>The forth sampler we need to create is the <strong>allowable damage sampler</strong>, which is 
necessay to take into account the uncertainties connected to the Miner's rule. We
can assume a sampler with log-normal distribution with mean value 1 and CoV=0.3.</p>
<pre><code class="language-py">import pyflange.stats as stats

allowable_damage_samp = stats.lognorm_samp(1.0, 0.30)
</code></pre>
<p>The four samplers we created are actually needed to create a "master" sampler that
uses them to create random realizations of fatigue cases. This is the sampler that
we will use in the montecarlo simulation. It is created as shown in the following
snippet.</p>
<pre><code class="language-py">import pyflange.stats as stats

fcase_samp = stats.fatigue_case_sampler(fseg_samp, 
                                        markov_matrix_samp,
                                        fatigue_curve_samp,
                                        allowable_damage_samp)
</code></pre>
<p>Each fatogue case ralization (i.e. each <code>fcase = next(fcase_samp)</code> value) will return a 
<code>pyflange.fatigue.BoltFatigueAnalysis</code> object that contains the following
attributes (see BoltFatigueAnalysis API documentation for more details):</p>
<ul>
<li><code>fcase.fseg</code> : a random realization of flange segment</li>
<li><code>fcase.flange_mkvm</code> : a random realization of a flange Markov matrix</li>
<li><code>fcase.fatigue_curve</code> : a random BoltFatigueCurve realization</li>
<li><code>fcase.allowable_damage</code> : a random realization of allowable damage</li>
<li><code>fcase.damage</code> : the cumulated damage corresponding to the random attributes above</li>
<li><code>fcase.fatigue_life</code> : the fatigue life corresponding to the random attributes above</li>
</ul>
<p>Finally, we can use the fatigue case sampler to create a sample of fatigue cases. In the
following example, we will store a 100 000 items sample in a Pandas DataFrame.</p>
<pre><code class="language-py">import pandas as pd
SAMPLE_SIZE = int(100000)

# Create an empty DataFrame
samp_df = pd.DataFrame(dtype=float,                 # cells data type
                       index=range(SAMPLE_SIZE),    # 100000 rows
                       columns=[                    # Names of the data-frame columns
                            &quot;BoltPreload&quot;,
                            &quot;GapShapeFactor&quot;,
                            &quot;TiltAngle&quot;,
                            &quot;GapAngle&quot;,
                            &quot;GapHeight&quot;,
                            &quot;Damage&quot;,
                            &quot;AllowableDamage&quot;,
                            &quot;FatigueLife&quot;
                       ])

# Fill the data-frame with fatigue cases, one for each row.
for i in range(SAMPLE_SIZE):

    # Generate the next random fatigue case
    fcase = next(fcase_samp)

    # Fill row number i of the data-frame with the values in fcase
    samp_df.at[i, 'BoltPreload'    ] = fcase.fseg.Fv               # Bolt preload
    samp_df.at[i, 'GapShapeFactor' ] = fcase.fseg.gap_shape_factor # Gap shape factor
    samp_df.at[i, 'TiltAngle'      ] = fcase.fseg.tilt_angle       # Flange tilt angle
    samp_df.at[i, 'GapAngle'       ] = fcase.fseg.gap_angle        # Gap angle
    samp_df.at[i, 'GapHeight'      ] = fcase.fseg.gap_height       # Gap height
    samp_df.at[i, 'Damage'         ] = fcase.damage                # Cumulate damage
    samp_df.at[i, 'AllowableDamage'] = fcase.allowable_damage      # Allowable damage
    samp_df.at[i, 'FatigueLife'    ] = fcase.fatigue_life          # Fatigue life

    # This can take a while, so print a message every 1000 iteration
    # to show the progress
    if i % 1000 == 0:
        print(f&quot;Completed iteration number {i}&quot;)
</code></pre>
<p>The generate sample dataframe (the <code>samp_df</code> object) can be further processed with your
favourite python statictical library or exported to a .csv file or .xlsx file for
post-processing in Excel.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../apis/gap/" class="btn btn-neutral float-left" title="gap"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../apis/gap/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
