var yt=e=>{throw TypeError(e)};var H=(e,t,a)=>t.has(e)||yt("Cannot "+a);var n=(e,t,a)=>(H(e,t,"read from private field"),a?a.call(e):t.get(e)),f=(e,t,a)=>t.has(e)?yt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a),l=(e,t,a,s)=>(H(e,t,"write to private field"),s?s.call(e,a):t.set(e,a),a),y=(e,t,a)=>(H(e,t,"access private method"),a);import{f as It,h as Et,i as Rt,j as Ct,k as Qt,l as qt,u as St,m as Kt,n as Mt,o as Dt,p as xt,g as Tt,q as Bt,s as Vt,t as Ut,v as Lt,w as jt,x as Pt,y as Wt,e as kt,z as _t,A as zt,B as Nt,C as Gt,D as Ht,E as Jt}from"./BpLiSKgx.js";import{c as Xt}from"./CvGjimpO.js";import{aN as Yt,y as J,i as rt,x as Zt}from"./DkbXUtyG.js";import{u as it}from"./KNLP4aJU.js";import{S as $t,p as ft,r as A,s as X,a as k,n as te,i as mt,b as pt,t as ee,f as ae,c as se,d as bt,e as vt,g as ne,h as re}from"./MErlcOXj.js";var g,r,j,O,S,T,R,v,P,B,V,K,M,C,U,c,L,Y,Z,$,tt,et,at,st,At,Ft,ie=(Ft=class extends $t{constructor(t,a){super();f(this,c);f(this,g);f(this,r);f(this,j);f(this,O);f(this,S);f(this,T);f(this,R);f(this,v);f(this,P);f(this,B);f(this,V);f(this,K);f(this,M);f(this,C);f(this,U,new Set);this.options=a,l(this,g,t),l(this,v,null),l(this,R,ft()),this.options.experimental_prefetchInRender||n(this,R).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(a)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(n(this,r).addObserver(this),Ot(n(this,r),this.options)?y(this,c,L).call(this):this.updateResult(),y(this,c,tt).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return nt(n(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return nt(n(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,y(this,c,et).call(this),y(this,c,at).call(this),n(this,r).removeObserver(this)}setOptions(t,a){const s=this.options,o=n(this,r);if(this.options=n(this,g).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof A(this.options.enabled,n(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");y(this,c,st).call(this),n(this,r).setOptions(this.options),s._defaulted&&!X(this.options,s)&&n(this,g).getQueryCache().notify({type:"observerOptionsUpdated",query:n(this,r),observer:this});const i=this.hasListeners();i&&gt(n(this,r),o,this.options,s)&&y(this,c,L).call(this),this.updateResult(a),i&&(n(this,r)!==o||A(this.options.enabled,n(this,r))!==A(s.enabled,n(this,r))||k(this.options.staleTime,n(this,r))!==k(s.staleTime,n(this,r)))&&y(this,c,Y).call(this);const u=y(this,c,Z).call(this);i&&(n(this,r)!==o||A(this.options.enabled,n(this,r))!==A(s.enabled,n(this,r))||u!==n(this,C))&&y(this,c,$).call(this,u)}getOptimisticResult(t){const a=n(this,g).getQueryCache().build(n(this,g),t),s=this.createResult(a,t);return ue(this,s)&&(l(this,O,s),l(this,T,this.options),l(this,S,n(this,r).state)),s}getCurrentResult(){return n(this,O)}trackResult(t,a){const s={};return Object.keys(t).forEach(o=>{Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(o),a==null||a(o),t[o])})}),s}trackProp(t){n(this,U).add(t)}getCurrentQuery(){return n(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const a=n(this,g).defaultQueryOptions(t),s=n(this,g).getQueryCache().build(n(this,g),a);return s.fetch().then(()=>this.createResult(s,a))}fetch(t){return y(this,c,L).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),n(this,O)))}createResult(t,a){var lt;const s=n(this,r),o=this.options,i=n(this,O),u=n(this,S),p=n(this,T),I=t!==s?t.state:n(this,j),{state:h}=t;let d={...h},Q=!1,w;if(a._optimisticResults){const b=this.hasListeners(),D=!b&&Ot(t,a),x=b&&gt(t,s,a,o);(D||x)&&(d={...d,...se(h.data,t.options)}),a._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:ut,errorUpdatedAt:ct,status:q}=d;if(a.select&&d.data!==void 0)if(i&&d.data===(u==null?void 0:u.data)&&a.select===n(this,P))w=n(this,B);else try{l(this,P,a.select),w=a.select(d.data),w=bt(i==null?void 0:i.data,w,a),l(this,B,w),l(this,v,null)}catch(b){l(this,v,b)}else w=d.data;if(a.placeholderData!==void 0&&w===void 0&&q==="pending"){let b;if(i!=null&&i.isPlaceholderData&&a.placeholderData===(p==null?void 0:p.placeholderData))b=i.data;else if(b=typeof a.placeholderData=="function"?a.placeholderData((lt=n(this,V))==null?void 0:lt.state.data,n(this,V)):a.placeholderData,a.select&&b!==void 0)try{b=a.select(b),l(this,v,null)}catch(D){l(this,v,D)}b!==void 0&&(q="success",w=bt(i==null?void 0:i.data,b,a),Q=!0)}n(this,v)&&(ut=n(this,v),w=n(this,B),ct=Date.now(),q="error");const z=d.fetchStatus==="fetching",N=q==="pending",G=q==="error",ht=N&&z,dt=w!==void 0,F={status:q,fetchStatus:d.fetchStatus,isPending:N,isSuccess:q==="success",isError:G,isInitialLoading:ht,isLoading:ht,data:w,dataUpdatedAt:d.dataUpdatedAt,error:ut,errorUpdatedAt:ct,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>I.dataUpdateCount||d.errorUpdateCount>I.errorUpdateCount,isFetching:z,isRefetching:z&&!N,isLoadingError:G&&!dt,isPaused:d.fetchStatus==="paused",isPlaceholderData:Q,isRefetchError:G&&dt,isStale:ot(t,a),refetch:this.refetch,promise:n(this,R)};if(this.options.experimental_prefetchInRender){const b=W=>{F.status==="error"?W.reject(F.error):F.data!==void 0&&W.resolve(F.data)},D=()=>{const W=l(this,R,F.promise=ft());b(W)},x=n(this,R);switch(x.status){case"pending":t.queryHash===s.queryHash&&b(x);break;case"fulfilled":(F.status==="error"||F.data!==x.value)&&D();break;case"rejected":(F.status!=="error"||F.error!==x.reason)&&D();break}}return F}updateResult(t){const a=n(this,O),s=this.createResult(n(this,r),this.options);if(l(this,S,n(this,r).state),l(this,T,this.options),n(this,S).data!==void 0&&l(this,V,n(this,r)),X(s,a))return;l(this,O,s);const o={},i=()=>{if(!a)return!0;const{notifyOnChangeProps:u}=this.options,p=typeof u=="function"?u():u;if(p==="all"||!p&&!n(this,U).size)return!0;const E=new Set(p??n(this,U));return this.options.throwOnError&&E.add("error"),Object.keys(n(this,O)).some(I=>{const h=I;return n(this,O)[h]!==a[h]&&E.has(h)})};(t==null?void 0:t.listeners)!==!1&&i()&&(o.listeners=!0),y(this,c,At).call(this,{...o,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&y(this,c,tt).call(this)}},g=new WeakMap,r=new WeakMap,j=new WeakMap,O=new WeakMap,S=new WeakMap,T=new WeakMap,R=new WeakMap,v=new WeakMap,P=new WeakMap,B=new WeakMap,V=new WeakMap,K=new WeakMap,M=new WeakMap,C=new WeakMap,U=new WeakMap,c=new WeakSet,L=function(t){y(this,c,st).call(this);let a=n(this,r).fetch(this.options,t);return t!=null&&t.throwOnError||(a=a.catch(te)),a},Y=function(){y(this,c,et).call(this);const t=k(this.options.staleTime,n(this,r));if(mt||n(this,O).isStale||!pt(t))return;const s=ee(n(this,O).dataUpdatedAt,t)+1;l(this,K,setTimeout(()=>{n(this,O).isStale||this.updateResult()},s))},Z=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(n(this,r)):this.options.refetchInterval)??!1},$=function(t){y(this,c,at).call(this),l(this,C,t),!(mt||A(this.options.enabled,n(this,r))===!1||!pt(n(this,C))||n(this,C)===0)&&l(this,M,setInterval(()=>{(this.options.refetchIntervalInBackground||ae.isFocused())&&y(this,c,L).call(this)},n(this,C)))},tt=function(){y(this,c,Y).call(this),y(this,c,$).call(this,y(this,c,Z).call(this))},et=function(){n(this,K)&&(clearTimeout(n(this,K)),l(this,K,void 0))},at=function(){n(this,M)&&(clearInterval(n(this,M)),l(this,M,void 0))},st=function(){const t=n(this,g).getQueryCache().build(n(this,g),this.options);if(t===n(this,r))return;const a=n(this,r);l(this,r,t),l(this,j,t.state),this.hasListeners()&&(a==null||a.removeObserver(this),t.addObserver(this))},At=function(t){vt.batch(()=>{t.listeners&&this.listeners.forEach(a=>{a(n(this,O))}),n(this,g).getQueryCache().notify({query:n(this,r),type:"observerResultsUpdated"})})},Ft);function oe(e,t){return A(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function Ot(e,t){return oe(e,t)||e.state.data!==void 0&&nt(e,t,t.refetchOnMount)}function nt(e,t,a){if(A(t.enabled,e)!==!1){const s=typeof a=="function"?a(e):a;return s==="always"||s!==!1&&ot(e,t)}return!1}function gt(e,t,a,s){return(e!==t||A(s.enabled,e)===!1)&&(!a.suspense||e.state.status!=="error")&&ot(e,a)}function ot(e,t){return A(t.enabled,e)!==!1&&e.isStaleByTime(k(t.staleTime,e))}function ue(e,t){return!X(e.getCurrentResult(),t)}function ce(){return ne()}function he(e){return re()}function de(e){return"subscribe"in e&&typeof e.subscribe=="function"}function le(){}function ye(e,t,a){const s=he(),o=ce(),i=de(e)?e:Yt(e),u=J([i,o],([h,d])=>{const Q=s.defaultQueryOptions(h);return Q._optimisticResults=d?"isRestoring":"optimistic",Q}),p=new t(s,rt(u));u.subscribe(h=>{p.setOptions(h,{listeners:!1})});const E=J(o,(h,d)=>{const Q=h?le:p.subscribe(vt.batchCalls(d));return p.updateResult(),Q}),{subscribe:I}=J([E,u],([h,d])=>(h=p.getOptimisticResult(d),d.notifyOnChangeProps?h:p.trackResult(h)));return{subscribe:I}}function fe(e,t){return ye(e,ie)}function We(e){return e}const m=(e,t,a)=>{const s={_id:e,baseUrl:(t==null?void 0:t.baseUrl)||((t==null?void 0:t.client)??Xt).getConfig().baseUrl};return a&&(s._infinite=a),t!=null&&t.body&&(s.body=t.body),t!=null&&t.headers&&(s.headers=t.headers),t!=null&&t.path&&(s.path=t.path),t!=null&&t.query&&(s.query=t.query),[s]},_=(e,t)=>{const a={...e[0]};return t.body&&(a.body={...e[0].body,...t.body}),t.headers&&(a.headers={...e[0].headers,...t.headers}),t.path&&(a.path={...e[0].path,...t.path}),t.query&&(a.query={...e[0].query,...t.query}),a},me=e=>m("readRootDataset",e),ke=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Mt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:me(e)}),pe=e=>m("readImage",e),_e=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Kt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:pe(e)}),be=e=>m("readSamples",e,!0),ze=e=>({queryFn:async({pageParam:t,queryKey:a,signal:s})=>{const i=_(a,typeof t=="object"?t:{query:{cursor:t}}),{data:u}=await Wt({...e,...i,signal:s,throwOnError:!0});return u},queryKey:be(e)}),Ne=e=>({mutationFn:async a=>{const{data:s}=await Rt({...e,...a,throwOnError:!0});return s}}),Oe=e=>m("readAnnotationLabels",e),Ge=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Dt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Oe(e)}),He=e=>({mutationFn:async a=>{const{data:s}=await Qt({...e,...a,throwOnError:!0});return s}}),Je=e=>({mutationFn:async a=>{const{data:s}=await Ct({...e,...a,throwOnError:!0});return s}}),Xe=e=>({mutationFn:async a=>{const{data:s}=await St({...e,...a,throwOnError:!0});return s}}),ge=e=>m("countAnnotationsByDataset",e),Ye=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Vt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:ge(e)}),we=e=>m("readAnnotationsWithPayload",e,!0),Ze=e=>({queryFn:async({pageParam:t,queryKey:a,signal:s})=>{const i=_(a,typeof t=="object"?t:{query:{cursor:t}}),{data:u}=await Bt({...e,...i,signal:s,throwOnError:!0});return u},queryKey:we(e)}),$e=e=>({mutationFn:async a=>{const{data:s}=await Jt({...e,...a,throwOnError:!0});return s}}),ta=e=>({mutationFn:async a=>{const{data:s}=await It({...e,...a,throwOnError:!0});return s}}),Fe=e=>m("getAnnotation",e),ea=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await zt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Fe(e)}),ve=e=>m("getAnnotationWithPayload",e),aa=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Pt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:ve(e)}),sa=e=>({mutationFn:async a=>{const{data:s}=await Et({...e,...a,throwOnError:!0});return s}}),Ae=e=>m("getCaption",e),na=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Nt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Ae(e)}),ra=e=>({mutationFn:async a=>{const{data:s}=await Gt({...e,...a,throwOnError:!0});return s}}),ia=e=>({mutationFn:async a=>{const{data:s}=await qt({...e,...a,throwOnError:!0});return s}}),Ie=e=>m("embedText",e),oa=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Ut({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Ie(e)}),Ee=e=>m("get2dEmbeddings",e),ua=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Ht({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Ee(e)}),Re=e=>m("getMetadataInfo",e),Ce=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await xt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Re(e)}),Qe=e=>m("getAllFrames",e,!0),ca=e=>({queryFn:async({pageParam:t,queryKey:a,signal:s})=>{const i=_(a,typeof t=="object"?t:{query:{cursor:t}}),{data:u}=await kt({...e,...i,signal:s,throwOnError:!0});return u},queryKey:Qe(e)}),qe=e=>m("getFrameById",e),ha=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await _t({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:qe(e)}),Se=e=>m("countVideoFrameAnnotations",e),da=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await Lt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Se(e)}),Ke=e=>m("countVideoFrameAnnotationsByVideoDataset",e),la=e=>({queryFn:async({queryKey:t,signal:a})=>{const{data:s}=await jt({...e,...t[0],signal:a,throwOnError:!0});return s},queryKey:Ke(e)}),Me=e=>m("getAllVideos",e,!0),ya=e=>({queryFn:async({pageParam:t,queryKey:a,signal:s})=>{const i=_(a,typeof t=="object"?t:{query:{cursor:t}}),{data:u}=await Tt({...e,...i,signal:s,throwOnError:!0});return u},queryKey:Me(e)}),wt=Zt(),De=async e=>{if(rt(wt)==e)return;const t=Ce({path:{dataset_id:e}});fe(t).subscribe(s=>{if(s.data){const o=s.data,{updateMetadataBounds:i,updateMetadataValues:u,updateMetadataInfo:p}=it(),E={},I={};o.forEach(h=>{(h.type==="integer"||h.type==="float")&&h.min!=null&&h.max!=null&&(E[h.name]={min:h.min,max:h.max},I[h.name]={min:h.min,max:h.max})}),i(E),u(I),p(o),wt.set(e)}})},xe=e=>{const t=[],{metadataBounds:a}=it();for(const[s,o]of Object.entries(e)){const u=rt(a)[s];u&&(o.min>u.min&&t.push({key:s,value:o.min,op:">="}),o.max<u.max&&t.push({key:s,value:o.max,op:"<="}))}return t},fa=e=>{e&&De(e);const{metadataBounds:t,metadataValues:a,metadataInfo:s,updateMetadataValues:o,updateMetadataBounds:i,updateMetadataInfo:u}=it();return{metadataBounds:t,metadataValues:a,metadataInfo:s,updateMetadataValues:o,updateMetadataBounds:i,updateMetadataInfo:u,createMetadataFilters:xe}};export{le as A,Xe as B,Ze as C,ea as D,na as E,ra as F,We as G,ie as Q,ke as a,ia as b,fe as c,sa as d,xe as e,fa as f,ze as g,ca as h,Je as i,He as j,ta as k,ya as l,ha as m,_e as n,$e as o,aa as p,Ge as q,Ne as r,Ye as s,oa as t,he as u,ua as v,la as w,da as x,ye as y,de as z};
