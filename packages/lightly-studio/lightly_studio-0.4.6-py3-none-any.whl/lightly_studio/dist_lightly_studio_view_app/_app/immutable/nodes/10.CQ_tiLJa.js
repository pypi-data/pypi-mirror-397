import"../chunks/CWj6FrbW.js";import{p as ke,d as x,e as Pe,u as ze,g as e,b as l,h as c,c as u,s as D,f as B,r as g,t as ue,a as Ie,x as Ne,i as Ce,n as We}from"../chunks/DkbXUtyG.js";import{f as y,c as oe,a as s}from"../chunks/CmLg0ys7.js";import{i as N,s as ge,a as Me}from"../chunks/B_1cpokE.js";import{b as qe,S as Ee,e as He,d as de,u as Oe,i as je,t as _e,k as Ke,a as Ue}from"../chunks/C8mfFM-u.js";import{p as Qe,q as se,s as Re,r as Ve,t as Ae,C as Be,n as De,v as Ge,w as Ye,x as Te,L as Je}from"../chunks/CGY1p9L4.js";import{p as P,r as Xe,b as Le}from"../chunks/DuUalyFS.js";import{g as Ze,u as $e}from"../chunks/VYb2dkNs.js";import{S as et}from"../chunks/D4y7iiT3.js";import"../chunks/CvGjimpO.js";import{u as tt}from"../chunks/KNLP4aJU.js";import"../chunks/D_FFv0Oe.js";import"../chunks/69_IOA4Y.js";import{p as at}from"../chunks/C80h3dJx.js";import"../chunks/xGHZQ1pe.js";import"../chunks/DtWZc_tl.js";import{I as it}from"../chunks/D3RDXHoj.js";import{s as re}from"../chunks/VqWvU2yF.js";import{d as rt}from"../chunks/D9SC3jBb.js";import{u as ot,a as st}from"../chunks/COfLknXM.js";const lt=Re(),nt=Ve();var dt=y("<div><!></div>"),ct=y("<div><!></div>"),vt=y("<div><!></div>"),ft=y("<div><!></div>"),mt=y("<div><!></div>"),ut=y("<div><!> <div><!> <!></div> <!></div>");function gt(W,t){ke(t,!0);let v=P(t,"height",3,"100%"),U=P(t,"width",3,"100%"),S=P(t,"stickyIndices",19,()=>[]),q=P(t,"overScan",3,1),b=P(t,"marginLeft",3,0),n=P(t,"marginTop",3,0),ee=P(t,"layout",3,"vertical"),T=P(t,"scrollPosition",15,0),ce=P(t,"scrollAlignment",3,"auto"),G=P(t,"scrollBehavior",3,"auto"),M=P(t,"getKey",3,a=>a),ve=Xe(t,["$$slots","$$events","$$legacy","itemCount","itemSize","height","width","stickyIndices","overScan","marginLeft","marginTop","layout","scrollPosition","scrollAlignment","scrollBehavior","getKey","onscroll","header","item","placeholder","footer"]),f=x(void 0),Q=x(Pe(T())),h=x(0),w=x(0),E=x(0),Y=x(0),J=x(0),te=x(0),H=x(Pe([])),C=!1,X=!1,ae=x(!1);function O(a,r=ce(),p=G()){he(xe(a,r),p)}function I(a,r=G()){he(a,r)}const xe=(a,r)=>{const p=e(m)?n()+e(h):b()+e(w),z=a*t.itemSize+p,K=z-e($)+t.itemSize+p;let i;switch(r){case"start":i=z;break;case"center":i=z-(e($)-t.itemSize)/2;break;case"end":i=K;break;default:i=Math.max(K,Math.min(z,T()));break}return Math.max(0,Math.min(e(fe)-e($),i))},he=(a,r=G())=>{e(f)&&(C=!0,e(f).scrollTo({[e(m)?"top":"left"]:a,behavior:r}),C=!1)},pe=a=>{e(f)&&!C&&!X&&(C=!0,e(f).scrollTo({top:a,behavior:G()}),C=!1)},_=a=>{const r=a*t.itemSize;return`position: absolute; transform: translate3d(${e(m)?`${b()}px, ${r+n()}px`:`${e(w)+r+b()}px, ${n()}px`}, 0px); ${e(me)} will-change: transform;`},Z=a=>{X=!0,C||(e(m)?(c(Q,Math.max(0,a.currentTarget.scrollTop-e(h)),!0),T(a.currentTarget.scrollTop)):(c(Q,Math.max(0,a.currentTarget.scrollLeft-e(w)),!0),T(a.currentTarget.scrollLeft)),e(ye)(e(Q))),lt(()=>{X=!1})};let m=l(()=>ee()==="vertical"),fe=l(()=>t.itemCount*t.itemSize),me=l(()=>e(m)?`height: ${t.itemSize}px; width: ${b()>0?`${e(te)-b()}px`:"100%"};`:`height: ${n()>0?`${e(Y)-n()}px`:"100%"}; width: ${t.itemSize}px;`),$=l(()=>e(m)?e(E):e(J));ze(()=>{e($)&&c(H,Qe(t.itemCount,t.itemSize,e($),q(),e(Q)),!0)}),ze(()=>{e(f)&&pe(T())});let ye=l(()=>nt(e($),{fast:()=>{c(ae,!0)},slow:()=>{c(ae,!1)}}));var Se={scrollToIndex:O,scrollToPosition:I},L=ut(),be=a=>{var r;Z(a),(r=t.onscroll)==null||r.call(t,a)};qe(L,a=>({onscroll:be,...ve,[Ee]:a}),[()=>({position:"relative",overflow:"auto",height:typeof v()=="number"?`${v()}px`:v(),width:typeof U()!="number"?U():`${U()}px`})]);var le=u(L);{var F=a=>{var r=oe(),p=B(r);{var z=i=>{var o=dt(),d=u(o);re(d,()=>t.header),g(o),se(o,"offsetHeight",k=>c(h,k)),s(i,o)},K=i=>{var o=ct();de(o,"",{},{position:"absolute"});var d=u(o);re(d,()=>t.header),g(o),se(o,"offsetWidth",k=>c(w,k)),s(i,o)};N(p,i=>{e(m)?i(z):i(K,!1)})}s(a,r)};N(le,a=>{t.header&&a(F)})}var R=D(le,2);let ne;var j=u(R);{var V=a=>{const r=l(()=>Math.max(...S().filter(i=>i<e(H)[0])));var p=oe(),z=B(p);{var K=i=>{var o=vt();let d;var k=u(o);re(k,()=>t.item,()=>({index:e(r),style:""})),g(o),ue(ie=>d=de(o,"",d,ie),[()=>({position:"sticky",top:e(m)?`${n()}px`:"0px",left:e(m)?"0px":`${b()}px`,"z-index":"1"})]),s(i,o)};N(z,i=>{e(r)>=0&&i(K)})}s(a,p)};N(j,a=>{S().length&&e(H).length&&a(V)})}var A=D(j,2);He(A,17,()=>e(H),a=>M()(a),(a,r)=>{const p=l(()=>_(e(r)));var z=oe(),K=B(z);{var i=d=>{var k=oe(),ie=B(k);re(ie,()=>t.item,()=>({index:e(r),style:e(p)})),s(d,k)},o=d=>{var k=oe(),ie=B(k);re(ie,()=>t.placeholder,()=>({index:e(r),style:e(p)})),s(d,k)};N(K,d=>{!e(ae)||!t.placeholder?d(i):d(o,!1)})}s(a,z)}),g(R);var we=D(R,2);{var Fe=a=>{var r=oe(),p=B(r);{var z=i=>{var o=ft(),d=u(o);re(d,()=>t.footer),g(o),s(i,o)},K=i=>{var o=mt();let d;var k=u(o);re(k,()=>t.footer),g(o),ue(ie=>d=de(o,"",d,ie),[()=>({position:"absolute",top:"0px",left:`${e(w)+t.itemCount*t.itemSize+b()}px`})]),s(i,o)};N(p,i=>{e(m)?i(z):i(K,!1)})}s(a,r)};N(we,a=>{t.footer&&a(Fe)})}return g(L),Le(L,a=>c(f,a),()=>e(f)),ue(a=>ne=de(R,"",ne,a),[()=>({height:e(m)?`${e(fe)}px`:"100%",width:e(m)?"100%":`${e(fe)}px`})]),se(L,"offsetHeight",a=>c(E,a)),se(L,"clientHeight",a=>c(Y,a)),se(L,"offsetWidth",a=>c(J,a)),se(L,"clientWidth",a=>c(te,a)),s(W,L),Ie(Se)}const ht=(...W)=>{const t=Ze(...W),v=Ae({...t,getNextPageParam:n=>n.nextCursor||void 0}),U=$e(),S=()=>{U.invalidateQueries({queryKey:t.queryKey})},q=Ne([]);return v.subscribe(n=>{if(n.isSuccess){const ee=n.data.pages.flatMap(T=>T.data);q.set(ee)}}),{data:q,loadMore:()=>{Ce(v).hasNextPage&&!Ce(v).isFetchingNextPage&&Ce(v).fetchNextPage()},query:v,refresh:S}};var _t=(W,t,v)=>t(v.item.sample_id),xt=y('<button type="button" class="mb-2 flex h-8 items-center justify-center rounded-sm bg-card px-2 py-0 text-diffuse-foreground transition-colors hover:bg-primary hover:text-primary-foreground" data-testid="add-caption-button">+</button>'),pt=y('<!> <div class="flex h-full w-full flex-1 flex-col overflow-auto px-4 py-2"><!> <!></div>',1),yt=y("<div><!></div>");function St(W,t){ke(t,!0);const v=()=>ge(n,"$gridViewSampleRenderingStore",S),U=()=>ge(ee,"$isEditingMode",S),[S,q]=Me(),b=P(t,"maxHeight",3,"100%"),{gridViewSampleRenderingStore:n}=Oe(),{isEditingMode:ee}=at.data.globalStorage;let T=l(v);const{deleteCaption:ce}=ot(),G=async h=>{if(t.item)try{await ce(h),_e.success("Caption deleted successfully"),t.onUpdate()}catch(w){_e.error("Failed to delete caption. Please try again."),console.error("Error deleting caption:",w)}},{createCaption:M}=st(),ve=async h=>{try{await M({parent_sample_id:h}),_e.success("Caption created successfully"),t.onUpdate()}catch(w){_e.error("Failed to create caption. Please try again."),console.error("Error creating caption:",w)}};var f=yt(),Q=u(f);Be(Q,{className:"h-full",children:(h,w)=>{De(h,{className:"h-full flex min-h-0 flex-row items-center dark:[color-scheme:dark]",children:(E,Y)=>{var J=pt(),te=B(J);Ge(te,{get sample(){return t.item},get objectFit(){return e(T)}});var H=D(te,2),C=u(H);He(C,17,()=>t.item.captions,je,(O,I)=>{Ye(O,{get caption(){return e(I)},onDeleteCaption:()=>G(e(I).sample_id),get onUpdate(){return t.onUpdate}})});var X=D(C,2);{var ae=O=>{var I=xt();I.__click=[_t,ve,t],s(O,I)};N(X,O=>{U()&&O(ae)})}g(H),s(E,J)},$$slots:{default:!0}})},$$slots:{default:!0}}),g(f),ue(()=>de(f,`height: ${b()}; max-height: ${b()};`)),s(W,f),Ie(),q()}rt(["click"]);var bt=y('<div class="flex h-full w-full items-center justify-center"><!> <div>Loading samples...</div></div>'),wt=y('<div data-testid="caption-grid-item"><!></div>'),Ct=y('<div class="flex justify-center p-4"><!></div>'),zt=y("<!> <!>",1),kt=y('<div class="flex flex-1 flex-col space-y-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><div class="text-2xl font-semibold">Captions</div></div> <div class="w-4/12"><!></div></div> <!> <div class="h-full w-full flex-1 overflow-hidden"><!></div></div>');function It(W,t){ke(t,!0);const v=()=>ge(e(ee),"$data",q),U=()=>ge(ve,"$sampleSize",q),S=()=>ge(e(T),"$query",q),[q,b]=Me(),n=l(()=>ht({body:{filters:{dataset_id:t.datasetId,has_captions:!0}}})),ee=l(()=>e(n).data),T=l(()=>e(n).query),ce=l(()=>e(n).loadMore),G=l(()=>e(n).refresh);let M=x(null);const{sampleSize:ve}=tt();let f=x(0),Q=x(0),h=x(0),w=x(0);ze(()=>{if(!e(M))return;c(Q,e(w)/U().width),c(h,e(Q)-Y),c(f,e(M).clientHeight,!0);const _=new ResizeObserver(()=>{e(M)&&c(f,e(M).clientHeight,!0)});return _.observe(e(M)),()=>{_.disconnect()}});let E=l(v);const Y=8,J=32,te=l(()=>e(f)+Y);var H=kt(),C=u(H),X=D(u(C),2),ae=u(X);it(ae,{}),g(X),g(C);var O=D(C,2);et(O,{class:"mb-4 bg-border-hard"});var I=D(O,2),xe=u(I);{var he=_=>{var Z=bt(),m=u(Z);Te(m,{}),We(2),g(Z),s(_,Z)},pe=_=>{var Z=oe(),m=B(Z);{var fe=me=>{{const $=(le,F)=>{let R=()=>F==null?void 0:F().index,ne=()=>F==null?void 0:F().style;var j=wt();Ue(j,1,`w-full pb-[${Y}]`);var V=u(j);{let A=l(()=>`${e(h)}px`);St(V,{get maxHeight(){return e(A)},get item(){return e(E)[R()]},get onUpdate(){return e(G)}})}g(j),ue(()=>de(j,ne())),s(le,j)},ye=le=>{var F=zt(),R=B(F);Ke(R,()=>e(E).length,V=>{{let A=l(()=>!S().hasNextPage||S().isFetchingNextPage);Je(V,{get onIntersect(){return e(ce)},get disabled(){return e(A)}})}});var ne=D(R,2);{var j=V=>{var A=Ct(),we=u(A);Te(we,{}),g(A),s(V,A)};N(ne,V=>{S().isFetchingNextPage&&V(j)})}s(le,F)};let Se=l(()=>e(h)+Y),L=l(()=>e(h)-J),be=l(()=>e(h)-J);gt(me,{get itemCount(){return e(E).length},get height(){return e(te)},get itemSize(){return e(Se)},class:"dark:[color-scheme:dark]",get style(){return`--sample-width: ${e(L)??""}px; --sample-height: ${e(be)??""}px;`},item:$,footer:ye,$$slots:{item:!0,footer:!0}})}};N(m,me=>{S().isSuccess&&e(E).length>0&&me(fe)},!0)}s(_,Z)};N(xe,_=>{S().isPending&&e(E).length===0?_(he):_(pe,!1)})}g(I),Le(I,_=>c(M,_),()=>e(M)),g(H),se(I,"clientWidth",_=>c(w,_)),s(W,H),Ie(),b()}function Gt(W,t){const{datasetId:v}=t.data;It(W,{get datasetId(){return v}})}export{Gt as component};
