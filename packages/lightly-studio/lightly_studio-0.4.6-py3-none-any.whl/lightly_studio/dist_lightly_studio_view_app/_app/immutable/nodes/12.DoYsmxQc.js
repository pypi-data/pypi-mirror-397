import"../chunks/CWj6FrbW.js";import{x as se,i as U,p as oe,c as v,s as z,r as u,t as le,a as ne,u as Le,g as e,b as l,h as ie,d as re,n as Oe,f as W}from"../chunks/DkbXUtyG.js";import{d as me}from"../chunks/D9SC3jBb.js";import{f as F,a as f,c as J}from"../chunks/CmLg0ys7.js";import{s as c,i as V,a as Te}from"../chunks/B_1cpokE.js";import{d as ce,s as y,k as Ee,a as He}from"../chunks/C8mfFM-u.js";import{t as Ke,q as Qe,y as Re,x as de,G as Ue,L as Je,z as Xe}from"../chunks/CGY1p9L4.js";import{b as Ye}from"../chunks/DuUalyFS.js";import"../chunks/CvGjimpO.js";import{u as Ze}from"../chunks/KNLP4aJU.js";import"../chunks/D_FFv0Oe.js";import{h as $e,u as et,f as tt,e as at}from"../chunks/VYb2dkNs.js";import"../chunks/69_IOA4Y.js";import"../chunks/C80h3dJx.js";import{p as st}from"../chunks/DwIonDAZ.js";import{S as it}from"../chunks/D4y7iiT3.js";import{u as rt}from"../chunks/da7Oy_lO.js";import{a as dt}from"../chunks/DtWZc_tl.js";import{I as ot}from"../chunks/D3RDXHoj.js";import{g as lt}from"../chunks/xGHZQ1pe.js";import{r as nt}from"../chunks/BRmB-kJ9.js";import{V as mt}from"../chunks/BiqpDEr0.js";const ct=(i,t)=>{const a=$e({path:{video_frame_dataset_id:i},query:{limit:30},body:{filter:t}}),s=Ke({...a,getNextPageParam:h=>h.nextCursor||void 0}),S=et(),j=()=>{S.invalidateQueries({queryKey:a.queryKey})},P=se([]),A=se(0);return s.subscribe(h=>{if(h.isSuccess){const _=h.data.pages.flatMap(M=>M.data);P.set(_),A.set(h.data.pages[0].total_count)}}),{data:P,totalCount:A,loadMore:()=>{U(s).hasNextPage&&!U(s).isFetchingNextPage&&U(s).fetchNextPage()},query:s,refresh:j}};function vt(i,t){lt(nt.toFramesDetails(t.videoFrame.sample.dataset_id,t.videoFrame.sample_id,t.index))}var ut=F('<div class="video-frame-container relative overflow-hidden rounded-lg svelte-1y9r35j" role="img"><img class="svelte-1y9r35j"/> <!></div>');function ft(i,t){oe(t,!0);var a=ut();a.__dblclick=[vt,t];var s=v(a),S=z(s,2);mt(S,{get width(){return t.size},get height(){return t.size},get sampleWidth(){return t.videoFrame.video.width},get sampleHeight(){return t.videoFrame.video.height},get sample(){return t.videoFrame}}),u(a),le(()=>{ce(a,`width: var(${t.videoFrame.video.width}); height: var(${t.videoFrame.video.height});`),y(s,"src",`${dt}/${t.videoFrame.sample_id}`),y(s,"alt",`${t.videoFrame.sample_id}-${t.videoFrame.frame_number}`)}),f(i,a),ne()}me(["dblclick"]);function gt(i,t,a){const s=i.currentTarget.dataset.sampleId;t(s,a().params.dataset_id)}function _t(i,t,a){if(i.key==="Enter"||i.key===" "){i.preventDefault();const s=i.currentTarget.dataset.sampleId;t(s,a().params.dataset_id)}}var ht=F('<div class="flex h-full w-full items-center justify-center"><!> <div>Loading video frames...</div></div>'),pt=F(`<div class="flex h-full w-full items-center justify-center"><div class="text-center text-muted-foreground"><div class="mb-2 text-lg font-medium">No video frames found</div> <div class="text-sm">This dataset doesn't contain any video frames.</div></div></div>`),xt=F('<div data-testid="frame-grid-item" role="button" tabindex="0"><div class="absolute right-7 top-1 z-10"><!></div> <div class="relative overflow-hidden rounded-lg" style="width: var(--sample-width); height: var(--sample-height);"><!></div></div>'),yt=F('<div class="flex justify-center p-4"><!></div>'),Ft=F("<!> <!>",1),St=F('<div class="flex flex-1 flex-col space-y-4"><div class="my-2 flex items-center space-x-4"><div class="flex-1"><div class="text-2xl font-semibold">Frames</div></div> <div class="w-4/12"><!></div></div> <!> <div class="h-full w-full flex-1 overflow-hidden"><!></div></div>');function Kt(i,t){oe(t,!0);const a=()=>c(st,"$page",m),s=()=>c(e(fe),"$selectedAnnotationFilterIds",m),S=()=>c(ge,"$tagsSelected",m),j=()=>c(Y,"$metadataValues",m),P=()=>c(ue,"$videoFramesBoundsValues",m),A=()=>c(e(he),"$data",m),X=()=>c(Fe,"$sampleSize",m),h=()=>c(e(ye),"$totalCount",m),_=()=>c(e(pe),"$query",m),M=()=>c(we,"$selectedSampleIds",m),[m,ve]=Te(),{metadataValues:Y}=tt(a().params.dataset_id),{videoFramesBoundsValues:ue}=Re(),fe=l(()=>t.data.selectedAnnotationFilterIds),{tagsSelected:ge}=rt({dataset_id:a().params.dataset_id,kind:["sample"]}),_e=l(()=>{var d;return{sample_filter:{annotation_label_ids:(d=s())!=null&&d.length?s():void 0,tag_ids:S().size>0?Array.from(S()):void 0,metadata_filters:Y?at(j()):void 0},...P()}}),N=l(()=>ct(a().params.dataset_id,e(_e))),he=l(()=>e(N).data),pe=l(()=>e(N).query),xe=l(()=>e(N).loadMore),ye=l(()=>e(N).totalCount),{sampleSize:Fe,getSelectedSampleIds:Se,setfilteredSampleCount:be,toggleSampleSelection:Z}=Ze(),we=Se(a().params.dataset_id),Ie=16;let b=re(null),ke=re(0),r=l(A);const G=l(()=>e(b)==null||e(b).clientWidth===0?0:e(b).clientWidth/X().width),L=l(()=>e(G)-Ie);Le(()=>{be(h())});var O=St(),T=v(O),$=z(v(T),2),ze=v($);ot(ze,{}),u($),u(T);var ee=z(T,2);it(ee,{class:"mb-4 bg-border-hard"});var q=z(ee,2),Ce=v(q);{var Ve=d=>{var w=ht(),E=v(w);de(E,{}),Oe(2),u(w),f(d,w)},Pe=d=>{var w=J(),E=W(w);{var Ae=I=>{var D=pt();f(I,D)},Me=I=>{var D=J(),Ne=W(D);{var qe=H=>{{const De=(k,g)=>{let o=()=>g==null?void 0:g().index,K=()=>g==null?void 0:g().style;var B=J(),p=W(B);{var x=C=>{var n=xt();let te;n.__click=[gt,Z,a],n.__keydown=[_t,Z,a];var Q=v(n),je=v(Q);{let R=l(()=>M().has(e(r)[o()].sample_id));Xe(je,{onSelect:()=>{},get isSelected(){return e(R)}})}u(Q);var ae=z(Q,2),Ge=v(ae);ft(Ge,{get videoFrame(){return e(r)[o()]},get index(){return o()},get size(){return e(L)}}),u(ae),u(n),le(R=>{te=He(n,1,"relative svelte-1figrwa",null,te,R),ce(n,K()),y(n,"data-sample-id",e(r)[o()].sample_id),y(n,"data-dataset-id",e(r)[o()].sample.dataset_id),y(n,"data-frame-name",e(r)[o()].sample_id),y(n,"data-index",o()),y(n,"aria-label",`View frame: ${e(r)[o()].sample_id}`)},[()=>({"frame-selected":M().has(e(r)[o()].sample_id)})]),f(C,n)};V(p,C=>{e(r)[o()]&&C(x)})}f(k,B)},Be=k=>{var g=Ft(),o=W(g);Ee(o,()=>e(r).length,p=>{{let x=l(()=>!_().hasNextPage||_().isFetchingNextPage);Je(p,{get onIntersect(){return e(xe)},get disabled(){return e(x)}})}});var K=z(o,2);{var B=p=>{var x=yt(),C=v(x);de(C,{}),u(x),f(p,x)};V(K,p=>{_().isFetchingNextPage&&p(B)})}f(k,g)};let We=l(()=>{var k;return(k=e(b))==null?void 0:k.clientHeight});Ue(H,{get itemCount(){return e(r).length},get itemHeight(){return e(G)},get itemWidth(){return e(G)},get height(){return e(We)},class:"overflow-none overflow-y-auto dark:[color-scheme:dark]",get style(){return`--sample-width: ${e(L)??""}px; --sample-height: ${e(L)??""}px;`},overScan:30,item:De,footer:Be,$$slots:{item:!0,footer:!0}})}};V(Ne,H=>{_().isSuccess&&e(r).length>0&&H(qe)},!0)}f(I,D)};V(E,I=>{_().isSuccess&&e(r).length===0?I(Ae):I(Me,!1)},!0)}f(d,w)};V(Ce,d=>{_().isPending&&e(r).length===0?d(Ve):d(Pe,!1)})}u(q),Ye(q,d=>ie(b,d),()=>e(b)),u(O),Qe(q,"clientWidth",d=>ie(ke,d)),f(i,O),ne(),ve()}me(["click","keydown"]);export{Kt as component};
