import{g as ke,d as Oe,e as Re}from"../chunks/BpLiSKgx.js";import{x as ze,i as Y,p as He,d as W,e as Le,u as be,g as e,h as T,a as Me,b as j,s as r,c as o,r as i,f as q,t as we,n as We}from"../chunks/DkbXUtyG.js";import{u as Ae}from"../chunks/KNLP4aJU.js";import{u as qe}from"../chunks/da7Oy_lO.js";import{l as Ge,C as ye,n as Ve,o as Ue,b as Fe,M as Ze,B as Je}from"../chunks/CGY1p9L4.js";import{f as Ke,e as Qe}from"../chunks/VYb2dkNs.js";import"../chunks/CWj6FrbW.js";import{s as R}from"../chunks/eAy8rZzC.js";import{f as z,a as w,c as Pe,t as Xe}from"../chunks/CmLg0ys7.js";import{i as G,a as Ye,s as Se}from"../chunks/B_1cpokE.js";import{k as et}from"../chunks/C8mfFM-u.js";import{b as tt}from"../chunks/DuUalyFS.js";import"../chunks/D_FFv0Oe.js";import"../chunks/CvGjimpO.js";import"../chunks/69_IOA4Y.js";import{p as at}from"../chunks/C80h3dJx.js";import{g as Ne,i as st}from"../chunks/xGHZQ1pe.js";import{S as rt}from"../chunks/D4y7iiT3.js";import"../chunks/DtWZc_tl.js";import{r as ee}from"../chunks/BRmB-kJ9.js";import{u as ot}from"../chunks/VRI4prUD.js";import{u as it}from"../chunks/DmK2hulV.js";import{V as nt}from"../chunks/BiqpDEr0.js";import{V as lt}from"../chunks/DiZ5o5vz.js";import{S as dt}from"../chunks/erjNR5MX.js";import{D as mt}from"../chunks/BK4An2kI.js";const ut=({dataset_id:h,sampleIndex:l,filter:u})=>{const c=ze({isLoading:!1});return(async()=>{c.update(n=>({...n,isLoading:!0,error:void 0}));try{const{data:n}=await ke({path:{dataset_id:h},query:{cursor:l<1?0:l-1,limit:3},body:{filter:u},throwOnError:!0}),{setfilteredSampleCount:a}=Ae();a(n==null?void 0:n.total_count);let $;const S=l>0?n.data[0]:void 0;n.data.length>2&&($=l===0?n.data[1]:n.data[2]),c.update(B=>({...B,isLoading:!1,sampleNext:$,samplePrevious:S,error:void 0}))}catch(n){c.update(a=>({...a,isLoading:!1,error:n.message||"Failed to load adjacent videos"}))}})(),c};function vt({tagIds:h,metadata:l,annotationIds:u,bounds:c}){return{sample_filter:{tag_ids:h.size>0?[...h]:void 0,metadata_filters:l?Qe(l):void 0},annotation_frames_label_ids:[...u],...c}}const ct=async({params:h,url:l})=>{const u=h.dataset_id,c=h.sample_id,C=l.searchParams.get("index"),n=C!==null?Number(C):null;let a=null;if(n!==null){const{selectedAnnotationFilterIds:S}=Ae(),{videoBoundsValues:B}=Ge(),{metadataValues:te}=Ke(),{tagsSelected:ae}=qe({dataset_id:u,kind:["sample"]}),se=Y(ae),re=Y(te),N=Y(S),E=Y(B),p=vt({tagIds:se,metadata:re,annotationIds:N,bounds:E});a=ut({dataset_id:u,sampleIndex:n,filter:p})}return{sample:(await Oe({path:{sample_id:c}})).data,videoIndex:n,videoAdjacents:a}},Gt=Object.freeze(Object.defineProperty({__proto__:null,load:ct},Symbol.toStringTag,{value:"Module"}));var pt=z("<!> <!>",1),ft=z('<div class="video-frame-container relative overflow-hidden rounded-lg bg-black svelte-1m63o1l"><!> <!></div>'),_t=z('<div class="min-w-full space-y-3 text-diffuse-foreground"><div class="flex items-start gap-3"><span class="truncate text-sm font-medium" title="Width">Width:</span> <span class="text-sm"> </span></div> <div class="flex items-start gap-3"><span class="truncate text-sm font-medium" title="Height">Height:</span> <span class="text-sm"> </span></div> <div class="flex items-start gap-3"><span class="truncate text-sm font-medium" title="Duration">Duration:</span> <span class="text-sm"> </span></div> <div class="flex items-start gap-3"><span class="truncate text-sm font-medium" title="FPS">FPS:</span> <span class="text-sm"> </span></div></div>'),gt=z('<div class="space-y-2 text-sm text-diffuse-foreground"><div class="flex items-center gap-2"><span class="font-medium">Frame #:</span> <span> </span></div> <div class="flex items-center gap-2"><span class="font-medium">Timestamp:</span> <span> </span></div></div> <!>',1),xt=z("<!> <!> <!> <!>",1),ht=z('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><!> <!></div></div>');function Ut(h,l){He(l,!0);const u=()=>Se(e(S),"$videoAdjacents",C),c=()=>Se(ae,"$rootDataset",C),[C,n]=Ye(),a=j(()=>l.data.sample),$=j(()=>l.data.videoIndex),S=j(()=>l.data.videoAdjacents),{datasetId:B}=at.data,{removeTagFromSample:te}=it({datasetId:B}),{rootDataset:ae}=ot({datasetId:B}),se=j(()=>{var t,s,d;return((d=(s=(t=e(a))==null?void 0:t.sample)==null?void 0:s.tags)==null?void 0:d.map(A=>({tagId:A.tag_id,name:A.name})))??[]}),re=async t=>{var s;if((s=e(a))!=null&&s.sample_id)try{await te(e(a).sample_id,t),await st()}catch(d){console.error("Error removing tag from video:",d)}};let N=W(null),E=W(Le([])),p=W(void 0),ce=null,oe=W(0),pe=W(0),fe=0,U=0,H=!1,ie=!1;const ne=25;let le;be(()=>{if(!e(N))return;const t=()=>{var d;const s=(d=e(N))==null?void 0:d.getBoundingClientRect();T(oe,(s==null?void 0:s.width)??0,!0),T(pe,(s==null?void 0:s.height)??0,!0)};return t(),le=new ResizeObserver(t),le.observe(e(N)),()=>le.disconnect()});function Ie(t,s){T(p,t,!0),s!=null&&s%ne==0&&s!=0&&fe<s&&_e()}async function _e(){var d,A,x,y,I;if(H||ie)return;H=!0;const t=await Re({path:{video_frame_dataset_id:(A=(d=e(a))==null?void 0:d.frame)==null?void 0:A.sample.dataset_id},query:{cursor:U,limit:ne},body:{filter:{video_id:(x=e(a))==null?void 0:x.sample_id}}}),s=((y=t==null?void 0:t.data)==null?void 0:y.data)??[];if(s.length===0){ie=!0,H=!1;return}T(E,[...e(E),...s],!0),U=((I=t==null?void 0:t.data)==null?void 0:I.nextCursor)??U+ne,H=!1}function De(){_e()}function Te(){var s;if(e($)===null||!e(a)||!e(S))return null;const t=(s=u())==null?void 0:s.sampleNext;if(!t)return null;Ne(ee.toVideosDetails(e(a).sample.dataset_id,t.sample_id,e($)+1))}function je(){var s;if(e($)===null||!e(a)||!e(S))return null;const t=(s=u())==null?void 0:s.samplePrevious;if(!t)return null;Ne(ee.toVideosDetails(e(a).sample.dataset_id,t.sample_id,e($)-1))}let ge=null;be(()=>{if(!e(a))return;const t=e(a).sample_id;t!==ge&&(T(E,e(a).frame?[e(a).frame]:[],!0),T(p,e(a).frame??null,!0),U=0,fe=0,H=!1,ie=!1,ge=t)});var de=ht(),me=o(de),Ce=o(me);{var Be=t=>{mt(t,{get rootDataset(){return c().data},section:"Videos",subsection:"Video",get navigateTo(){return ee.toVideos},get index(){return e($)}})};G(Ce,t=>{c().data&&t(Be)})}i(me);var xe=r(me,2);rt(xe,{class:"mb-4 bg-border-hard"});var he=r(xe,2),$e=o(he);ye($e,{className:"flex w-[60vw] flex-col",children:(t,s)=>{Ve(t,{className:"flex h-full flex-col gap-4 overflow-hidden",children:(d,A)=>{var x=ft(),y=o(x);{var I=v=>{{let f=j(()=>{var m;return!!((m=u())!=null&&m.samplePrevious)}),L=j(()=>{var m;return!!((m=u())!=null&&m.sampleNext)});dt(v,{get hasPrevious(){return e(f)},get hasNext(){return e(L)},onPrevious:je,onNext:Te})}};G(y,v=>{u()&&v(I)})}var Z=r(y,2);et(Z,()=>{var v;return(v=e(a))==null?void 0:v.sample_id},v=>{var f=Pe(),L=q(f);{var m=b=>{var D=pt(),V=q(D);lt(V,{get video(){return e(a)},get frames(){return e(E)},muted:!0,controls:!0,update:Ie,className:"block h-full w-full",onplay:De,get videoEl(){return e(N)},set videoEl(_){T(N,_,!0)}});var F=r(V,2);{var P=_=>{nt(_,{get width(){return e(oe)},get height(){return e(pe)},get sample(){return e(p)},showLabel:!0,get sampleWidth(){return e(a).width},get sampleHeight(){return e(a).height}})};G(F,_=>{e(p)&&e(oe)>0&&_(P)})}w(b,D)};G(L,b=>{e(a)&&b(m)})}w(v,f)}),i(x),tt(x,v=>ce=v,()=>ce),w(d,x)},$$slots:{default:!0}})},$$slots:{default:!0}});var Ee=r($e,2);ye(Ee,{className:"flex flex-1 flex-col overflow-hidden",children:(t,s)=>{Ve(t,{className:"h-full overflow-y-auto",children:(d,A)=>{var x=xt(),y=q(x);Ue(y,{get tags(){return e(se)},onClick:re});var I=r(y,2);Fe(I,{title:"Sample details",children:(f,L)=>{var m=_t(),b=o(m),D=r(o(b),2),V=o(D);i(D),i(b);var F=r(b,2),P=r(o(F),2),_=o(P);i(P),i(F);var k=r(F,2),J=r(o(k),2),K=o(J);i(J),i(k);var M=r(k,2),Q=r(o(M),2),ue=o(Q,!0);i(Q),i(M),i(m),we((g,O)=>{var ve,X;R(V,`${((ve=e(a))==null?void 0:ve.width)??""}px`),R(_,`${((X=e(a))==null?void 0:X.height)??""}px`),R(K,`${g??""} seconds`),R(ue,O)},[()=>{var g,O;return(O=(g=e(a))==null?void 0:g.duration_s)==null?void 0:O.toFixed(2)},()=>{var g;return(g=e(a))==null?void 0:g.fps.toFixed(2)}]),w(f,m)}});var Z=r(I,2);Ze(Z,{get metadata_dict(){var f;return(f=e(a))==null?void 0:f.sample.metadata_dict}});var v=r(Z,2);Fe(v,{title:"Current Frame",children:(f,L)=>{var m=Pe(),b=q(m);{var D=V=>{var F=gt(),P=q(F),_=o(P),k=r(o(_),2),J=o(k,!0);i(k),i(_);var K=r(_,2),M=r(o(K),2),Q=o(M);i(M),i(K),i(P);var ue=r(P,2);{let g=j(()=>ee.toFramesDetails(e(p).sample.dataset_id,e(p).sample_id));Je(ue,{variant:"secondary",class:"mt-4 w-full",get href(){return e(g)},children:(O,ve)=>{We();var X=Xe("View frame");w(O,X)},$$slots:{default:!0}})}we(g=>{R(J,e(p).frame_number),R(Q,`${g??""} s`)},[()=>e(p).frame_timestamp_s.toFixed(3)]),w(V,F)};G(b,V=>{e(p)&&V(D)})}w(f,m)}}),w(d,x)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(he),i(de),w(h,de),Me(),n()}export{Ut as component,Gt as universal};
