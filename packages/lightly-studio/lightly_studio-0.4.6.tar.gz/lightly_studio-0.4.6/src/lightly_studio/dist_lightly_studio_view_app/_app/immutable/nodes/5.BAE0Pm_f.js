import"../chunks/CWj6FrbW.js";import{p as fe,f as p,j as gt,a as he,n as ot,g as e,b as r,s as c,c as S,r as I,t as ge,u as Jt,h as s,d as R,e as st,$ as rt,i as ea}from"../chunks/DkbXUtyG.js";import{c as se,a as i,f as W,t as it,b as De}from"../chunks/CmLg0ys7.js";import{s as Pe}from"../chunks/VqWvU2yF.js";import{i as L,s as T,a as Xe,b as lt,m as dt}from"../chunks/B_1cpokE.js";import{p as be}from"../chunks/C80h3dJx.js";import{I as ft,K as ta,N as aa,d as na,O as oa,u as sa,D as ra,_ as ia,P as la,Q as da,R as ca,C as ua,n as ma,z as ga,T as fa,x as ha,U as va,V as pa}from"../chunks/CGY1p9L4.js";import"../chunks/CvGjimpO.js";import{u as Ye}from"../chunks/KNLP4aJU.js";import{u as ht,k as _a,t as K,s as N,d as ba,e as ya,a as xa}from"../chunks/C8mfFM-u.js";import"../chunks/D_FFv0Oe.js";import"../chunks/69_IOA4Y.js";import{a as $a,g as wa}from"../chunks/xGHZQ1pe.js";import{b as Sa}from"../chunks/DtWZc_tl.js";import{e as ct}from"../chunks/D9SC3jBb.js";import{s as vt,r as pt,p as Ia,b as ut}from"../chunks/DuUalyFS.js";import{S as Aa}from"../chunks/D4y7iiT3.js";import{r as Ce}from"../chunks/BRmB-kJ9.js";import{u as Ca}from"../chunks/VRI4prUD.js";import{I as Da}from"../chunks/dHC3otuL.js";import{s as mt}from"../chunks/eAy8rZzC.js";import{B as Pa,a as Ra,b as Ae,c as Ue,H as ka,d as Ne,D as Ba,e as Ea}from"../chunks/DSKECuqX.js";import{n as Ma,u as La,c as Ta}from"../chunks/VYb2dkNs.js";import{a as Ha,Z as za}from"../chunks/BscxbINH.js";import{b as Fa,u as Ua,a as Na,c as Xa,d as Ya}from"../chunks/DDBy-_jD.js";import{u as Ka,a as Oa}from"../chunks/COfLknXM.js";import{u as ja}from"../chunks/DmK2hulV.js";function Za(_,a){fe(a,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let h=pt(a,["$$slots","$$events","$$legacy"]);const d=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["circle",{cx:"10",cy:"12",r:"2"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"}]];ft(_,vt({name:"file-image"},()=>h,{get iconNode(){return d},children:(o,w)=>{var b=se(),H=p(b);Pe(H,()=>a.children??gt),i(o,b)},$$slots:{default:!0}})),he()}function Qa(_,a){fe(a,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let h=pt(a,["$$slots","$$events","$$legacy"]);const d=[["path",{d:"M18 22H4a2 2 0 0 1-2-2V6"}],["path",{d:"m22 13-1.296-1.296a2.41 2.41 0 0 0-3.408 0L11 18"}],["circle",{cx:"12",cy:"8",r:"2"}],["rect",{width:"16",height:"16",x:"6",y:"2",rx:"2"}]];ft(_,vt({name:"images"},()=>h,{get iconNode(){return d},children:(o,w)=>{var b=se(),H=p(b);Pe(H,()=>a.children??gt),i(o,b)},$$slots:{default:!0}})),he()}var Va=W('<!> <span class="hidden sm:inline">Home</span>',1),qa=W('<!> <span class="max-w-[150px] truncate"> </span>',1),Ga=W('<!> <span class="hidden sm:inline">Samples</span>',1),Wa=W('<!> <span class="max-w-[200px] truncate"><!></span>',1),Ja=W("<!> <!> <!> <!> <!> <!> <!>",1);function en(_,a){fe(a,!0);const h=()=>T(w,"$filteredSampleCount",d),[d,o]=Xe(),{filteredSampleCount:w}=Ye();Pa(_,{class:"mb-2","data-testid":"sample-details-breadcrumb",children:(b,H)=>{Ra(b,{children:(re,ve)=>{var u=Ja(),J=p(u);Ae(J,{children:(k,te)=>{{let z=r(()=>Ce.toDatasetHome(a.rootDataset.dataset_id));Ue(k,{get href(){return e(z)},class:"flex items-center gap-2",children:(y,F)=>{var g=Va(),A=p(g);ka(A,{class:"h-4 w-4"}),ot(2),i(y,g)},$$slots:{default:!0}})}},$$slots:{default:!0}});var O=c(J,2);Ne(O,{});var m=c(O,2);Ae(m,{children:(k,te)=>{{let z=r(()=>Ce.toDatasetHome(a.rootDataset.dataset_id));Ue(k,{get href(){return e(z)},class:"flex items-center gap-2",children:(y,F)=>{var g=qa(),A=p(g);Ba(A,{class:"h-4 w-4"});var j=c(A,2),ie=S(j,!0);I(j),ge(()=>mt(ie,a.rootDataset.name)),i(y,g)},$$slots:{default:!0}})}},$$slots:{default:!0}});var X=c(m,2);Ne(X,{});var ee=c(X,2);Ae(ee,{children:(k,te)=>{{let z=r(()=>Ce.toSamples(be.params.dataset_id));Ue(k,{get href(){return e(z)},class:"flex items-center gap-2",children:(y,F)=>{var g=Ga(),A=p(g);Qa(A,{class:"h-4 w-4"}),ot(2),i(y,g)},$$slots:{default:!0}})}},$$slots:{default:!0}});var v=c(ee,2);Ne(v,{});var pe=c(v,2);Ae(pe,{children:(k,te)=>{Ea(k,{class:"flex items-center gap-2",children:(z,y)=>{var F=Wa(),g=p(F);Za(g,{class:"h-4 w-4"});var A=c(g,2),j=S(A);{var ie=Z=>{var de=it();ge(()=>mt(de,`Sample ${a.sampleIndex+1} of ${h()??""}`)),i(Z,de)},B=Z=>{var de=it("Sample");i(Z,de)};L(j,Z=>{a.sampleIndex!==void 0?Z(ie):Z(B,!1)})}I(A),i(z,F)},$$slots:{default:!0}})},$$slots:{default:!0}}),i(re,u)},$$slots:{default:!0}})},$$slots:{default:!0}}),he(),o()}const tn=_=>`${Sa}/sample/${_}`,_t=({sampleId:_})=>{const a=Ma({path:{sample_id:_}}),h=La(),d=Ta(a);return{refetch:()=>{h.invalidateQueries({queryKey:a.queryKey})},image:d}};function an(_,a){fe(a,!0);const h=()=>T(e(J),"$annotationResp",w),d=()=>T(e(ee),"$image",w),o=()=>T(ve,"$showAnnotationTextLabelsStore",w),[w,b]=Xe(),H=Ia(a,"isResizable",3,!1),{addReversibleAction:re}=Ye(),{showAnnotationTextLabelsStore:ve}=ht(),u=r(()=>oa({datasetId:a.datasetId,annotationId:a.annotationId})),J=r(()=>e(u).annotation),O=r(()=>e(u).updateAnnotation);let m=r(()=>h().data);const X=r(()=>_t({sampleId:a.sampleId})),ee=r(()=>e(X).image);let v=r(()=>e(m)?ta(e(m)):void 0);const pe=y=>{(async()=>{try{await e(O)({annotation_id:a.annotationId,dataset_id:a.datasetId,bounding_box:y}),e(m)&&Ha({annotation:e(m),dataset_id:a.datasetId,addReversibleAction:re,updateAnnotation:e(O)})}catch(g){console.error("Failed to update annotation:",g.message)}})()};var k=se(),te=p(k);{var z=y=>{var F=se(),g=p(F);_a(g,()=>e(v),A=>{aa(A,{get groupId(){return e(m).sample_id},get onSelect(){return a.toggleAnnotationSelection},get box(){return e(v)},get isSelected(){return a.isSelected},children:(j,ie)=>{{let B=r(()=>({x:0,y:0,width:d().data.width,height:d().data.height}));na(j,{get annotation(){return e(m)},get showLabel(){return o()},get imageWidth(){return d().data.width},get constraintBox(){return e(B)},get isResizable(){return H()},onBoundingBoxChanged:pe})}},$$slots:{default:!0}})}),i(y,F)};L(te,y=>{e(m)&&d().data&&e(v)&&y(z)})}i(_,k),he(),b()}var nn=De('<line x1="0" stroke-width="1" vector-effect="non-scaling-stroke" stroke-dasharray="5,5" opacity="0.6"></line><line y1="0" vector-effect="non-scaling-stroke" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"></line>',1),on=De('<rect class="select-none" fill="transparent" role="button" style="outline: 0;cursor: crosshair;" tabindex="0"></rect>'),sn=De("<g><!><!><!></g><!>",1),rn=De("<image></image><!>",1),ln=W('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),dn=W('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center justify-between"><!> <!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>'),cn=W('<div data-testid="sample-details-loading"><!></div>');function un(_,a){fe(a,!0);const h=()=>T(de,"$labels",u),d=()=>T(yt,"$isEditingMode",u),o=()=>T(e(ie),"$image",u),w=()=>T(Lt,"$rootDataset",u),b=()=>T(Ke,"$imageBrightness",u),H=()=>T(Oe,"$imageContrast",u),re=()=>T(pe,"$selectedSampleIds",u),ve=()=>T(k,"$isHidden",u),[u,J]=Xe(),{getSelectedSampleIds:O,toggleSampleSelection:m,addReversibleAction:X,clearReversibleActions:ee}=Ye(),v=a.dataset.dataset_id,pe=O(v),{isHidden:k,handleKeyEvent:te}=sa(),{settingsStore:z}=ht(),{deleteAnnotation:y}=Fa({datasetId:v}),{deleteCaption:F}=Ka(),{removeTagFromSample:g}=ja({datasetId:v}),A=()=>{wa(Ce.toSamples(v))},j=r(()=>_t({sampleId:a.sampleId})),ie=r(()=>e(j).image),B=r(()=>e(j).refetch),{createAnnotation:Z}=Ua({datasetId:v}),de=ra(),{createLabel:bt}=Na(),{isEditingMode:yt,imageBrightness:Ke,imageContrast:Oe}=be.data.globalStorage;let ce=R(!1);const xt=async({x:t,y:n,width:D,height:x,labelName:l})=>{if(!h().data)return;let U=h().data.find(P=>P.annotation_label_name===l);U||(U=await bt({annotation_label_name:l}));try{const P=await Z({parent_sample_id:a.sampleId,annotation_type:"object_detection",x:Math.round(t),y:Math.round(n),width:Math.round(D),height:Math.round(x),annotation_label_id:U.annotation_label_id});return e(ye).length==0&&qe(),Xa({annotation:P,addReversibleAction:X,deleteAnnotation:y,refetch:e(B)}),e(B)(),s(Q,P.sample_id,!0),K.success("Annotation created successfully"),P}catch(P){K.error("Failed to create annotation. Please try again."),console.error("Error creating annotation:",P);return}},$t=t=>{switch(t.key){case ea(z).key_go_back:d()?e(le)&&s(le,!1):A();break;case" ":t.preventDefault(),t.stopPropagation(),console.log("space pressed in sample details"),d()?s(ce,!0):m(a.sampleId,v);break}te(t)},wt=t=>{t.key===" "&&s(ce,!1),te(t)};let St=r(()=>tn(a.sampleId)),Q=R(void 0),je=R(void 0);$a(()=>{var t;s(Q,void 0),s(Qe,void 0),(t=e(je))==null||t(),s(le,!1),s(q,void 0),ee()});const Ze=t=>{e(ce)||(e(Q)===t?s(Q,void 0):s(Q,t,!0))};let Qe=R(void 0),ue=R(!1),C=R(null),ae=R(null),V=R(null);const It=()=>{s(ue,!1),s(C,null),s(V,null)};let le=R(!1);const Ve=4,At=()=>{if(!e(ae))return;const t=da(e(ae));let n=null;const D=ca().on("start",x=>{if(!e(le))return;s(ue,!0);const l=e(ae).getBoundingClientRect(),U=x.sourceEvent.clientX,P=x.sourceEvent.clientY,E=(U-l.left)/l.width*o().data.width,M=(P-l.top)/l.height*o().data.height;n={x:E,y:M},s(C,{x:E,y:M,width:0,height:0},!0),s(V,{x:E,y:M},!0)}).on("drag",x=>{if(!e(C)||!e(ue)||!n)return;const l=e(ae).getBoundingClientRect(),U=x.sourceEvent.clientX,P=x.sourceEvent.clientY;let E=(U-l.left)/l.width*o().data.width,M=(P-l.top)/l.height*o().data.height;const _e=o().data.width,Be=o().data.height;E=Math.max(0,Math.min(E,_e)),M=Math.max(0,Math.min(M,Be));const $e=Math.min(n.x,E),Ee=Math.min(n.y,M),Me=Math.abs(E-n.x),$=Math.abs(M-n.y);s(C,{x:$e,y:Ee,width:Me,height:$},!0),s(V,{x:E,y:M},!0)}).on("end",()=>{!e(C)||!e(ue)||(e(C).width>Ve&&e(C).height>Ve&&e(q)&&xt({x:e(C).x,y:e(C).y,width:e(C).width,height:e(C).height,labelName:e(q).label}),It(),n=null)});return t.call(D),t.on("mousemove",Dt),()=>{D.on("start",null).on("drag",null).on("end",null)}},Ct=t=>{if(!e(ae)||e(ue))return;const n=e(ae).getBoundingClientRect(),D=t.clientX,x=t.clientY,l=(D-n.left)/n.width*o().data.width,U=(x-n.top)/n.height*o().data.height;s(V,{x:l,y:U},!0),t.stopPropagation(),t.preventDefault()},Dt=ia.throttle(Ct,50);Jt(()=>{At(),e(ie).subscribe(t=>{if(t.isSuccess&&t.data){let n=la(t.data.annotations);s(ye,n,!0)}else s(ye,[],!0)})});let q=R(void 0),ye=R(st([])),xe=R(st(new Set));const Pt=t=>{const n=new Set(e(xe));n.has(t)?n.delete(t):n.add(t),s(xe,n,!0)},Rt=r(()=>e(ye).filter(t=>!e(xe).has(t.sample_id))),Re=r(()=>e(q)?va(e(q).label,1).color:"blue"),kt=async t=>{var x;if(!o().data||!h().data)return;const n=(x=o().data.annotations)==null?void 0:x.find(l=>l.sample_id===t);if(!n)return;(async()=>{try{Ya({annotation:n,labels:h().data,addReversibleAction:X,createAnnotation:Z,refetch:e(B)}),await y(t),K.success("Annotation deleted successfully"),e(B)(),e(Q)===t&&s(Q,void 0)}catch(l){K.error("Failed to delete annotation. Please try again."),console.error("Error deleting annotation:",l)}})()},Bt=async t=>{if(o().data)try{await F(t),K.success("Caption deleted successfully"),e(B)()}catch(n){K.error("Failed to delete caption. Please try again."),console.error("Error deleting caption:",n)}},Et=async t=>{try{await g(a.sampleId,t),K.success("Tag removed successfully"),e(B)()}catch(n){K.error("Failed to remove tag. Please try again."),console.error("Error removing tag from sample:",n)}},{createCaption:Mt}=Oa(),{rootDataset:Lt,refetch:qe}=Ca({datasetId:v}),Tt=async t=>{try{await Mt({parent_sample_id:t}),K.success("Caption created successfully"),e(B)(),o().captions||qe()}catch(n){K.error("Failed to create caption. Please try again."),console.error("Error creating caption:",n)}},Ht=r(()=>e(ce)?"grab":e(ke)?"crosshair":"auto"),zt=r(()=>d()&&!e(ce)),ke=r(()=>e(le)&&!e(ce)&&e(q)!==void 0);let Ge=R(null);var We=se();ct("keydown",rt,$t),ct("keyup",rt,wt);var Ft=p(We);{var Ut=t=>{var n=dn(),D=S(n),x=S(D);{var l=$=>{en($,{get rootDataset(){return w().data},get sampleIndex(){return a.sampleIndex}})};L(x,$=>{w().data&&$(l)})}var U=c(x,2);{var P=$=>{Da($,{get brightness(){return dt(),b()},set brightness(ne){lt(Ke,ne)},get contrast(){return dt(),H()},set contrast(ne){lt(Oe,ne)}})};L(U,$=>{d()&&$(P)})}I(D);var E=c(D,2);Aa(E,{class:"bg-border-hard"});var M=c(E,2),_e=S(M),Be=S(_e);ua(Be,{className:"h-full",children:($,ne)=>{ma($,{className:"h-full",children:(Xt,gn)=>{var Le=ln(),Te=S(Le),He=S(Te),Yt=S(He);{let oe=r(()=>re().has(a.sampleId));ga(Yt,{onSelect:()=>m(a.sampleId,v),get isSelected(){return e(oe)}})}I(He);var Je=c(He,2);{var Kt=oe=>{var me=se(),we=p(me);Pe(we,()=>a.children),i(oe,me)};L(Je,oe=>{a.children&&oe(Kt)})}var Ot=c(Je,2);za(Ot,{get width(){return o().data.width},get height(){return o().data.height},get cursor(){return e(Ht)},get boundingBox(){return e(Qe)},registerResetFn:me=>s(je,me,!0),zoomableContent:me=>{var we=rn(),ze=p(we),jt=c(ze);{var Zt=Fe=>{var et=sn(),Se=p(et);let tt;var at=S(Se);ya(at,17,()=>e(Rt),f=>f.sample_id,(f,Y)=>{{let G=r(()=>e(Q)===e(Y).sample_id);an(f,{get annotationId(){return e(Y).sample_id},get sampleId(){return a.sampleId},get datasetId(){return v},get isResizable(){return e(zt)},get isSelected(){return e(G)},toggleAnnotationSelection:Ze})}});var nt=c(at);{var Qt=f=>{fa(f,{get bbox(){return e(C)},get colorStroke(){return e(Re)},colorFill:"rgba(0, 123, 255, 0.1)",style:"outline: 0;",opacity:.8,scale:1})};L(nt,f=>{e(C)&&e(ue)&&e(q)&&f(Qt)})}var Vt=c(nt);{var qt=f=>{var Y=nn(),G=p(Y),Ie=c(G);ge(()=>{N(G,"y1",e(V).y),N(G,"x2",o().data.width),N(G,"y2",e(V).y),N(G,"stroke",e(Re)),N(Ie,"x1",e(V).x),N(Ie,"x2",e(V).x),N(Ie,"y2",o().data.height),N(Ie,"stroke",e(Re))}),i(f,Y)};L(Vt,f=>{e(V)&&e(ke)&&f(qt)})}I(Se);var Gt=c(Se);{var Wt=f=>{var Y=on();ut(Y,G=>s(ae,G),()=>e(ae)),ge(()=>{N(Y,"width",o().data.width),N(Y,"height",o().data.height)}),i(f,Y)};L(Gt,f=>{e(ke)&&f(Wt)})}ge(f=>tt=xa(Se,0,"",null,tt,f),[()=>({invisible:ve()})]),i(Fe,et)};L(jt,Fe=>{o().data&&Fe(Zt)})}ge(()=>{N(ze,"href",e(St)),ba(ze,`filter: brightness(${b()}) contrast(${H()})`)}),i(me,we)},$$slots:{zoomableContent:!0}}),I(Te),ut(Te,oe=>s(Ge,oe),()=>e(Ge)),I(Le),i(Xt,Le)},$$slots:{default:!0}})},$$slots:{default:!0}}),I(_e);var $e=c(_e,2),Ee=S($e);{var Me=$=>{pa($,{get sample(){return o().data},get annotationsIdsToHide(){return e(xe)},get selectedAnnotationId(){return e(Q)},onAnnotationClick:Ze,onToggleShowAnnotation:Pt,onDeleteAnnotation:kt,onDeleteCaption:Bt,onCreateCaption:Tt,onRemoveTag:Et,get onUpdate(){return e(B)},get addAnnotationEnabled(){return e(le)},set addAnnotationEnabled(ne){s(le,ne,!0)},get addAnnotationLabel(){return e(q)},set addAnnotationLabel(ne){s(q,ne,!0)}})};L(Ee,$=>{o().data&&$(Me)})}I($e),I(M),I(n),i(t,n)},Nt=t=>{var n=cn(),D=S(n);ha(D,{}),I(n),i(t,n)};L(Ft,t=>{o().data?t(Ut):t(Nt,!1)})}i(_,We),he(),J()}var mn=W('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="sample-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function Nn(_,a){fe(a,!0);const h=r(()=>be.params.sampleId),d=be.data.dataset,o=r(()=>Number(be.params.sampleIndex));var w=mn(),b=S(w),H=S(b);un(H,{get sampleId(){return e(h)},get dataset(){return d},get sampleIndex(){return e(o)},children:(re,ve)=>{var u=se(),J=p(u);{var O=m=>{var X=se(),ee=p(X);Pe(ee,()=>a.children),i(m,X)};L(J,m=>{a.children&&m(O)})}i(re,u)},$$slots:{default:!0}}),I(b),I(w),i(_,w),he()}export{Nn as component};
