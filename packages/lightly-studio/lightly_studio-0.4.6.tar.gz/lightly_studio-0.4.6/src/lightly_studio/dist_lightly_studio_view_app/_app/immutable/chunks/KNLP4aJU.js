import{b as E}from"./BpLiSKgx.js";import{x as s,i as m,y as F}from"./DkbXUtyG.js";function p(n,i){const r=s((()=>{if(typeof sessionStorage>"u")return i;try{const o=sessionStorage.getItem(n);if(o)return JSON.parse(o)}catch(o){console.warn(`Failed to read ${n} from sessionStorage`,o)}return i})());return r.subscribe(o=>{if(!(typeof sessionStorage>"u"))try{sessionStorage.setItem(n,JSON.stringify(o))}catch(h){console.warn(`Failed to write ${n} to sessionStorage`,h)}}),r}const c=s([]),R=()=>({reversibleActions:c,addReversibleAction:n=>{c.update(i=>[n,...i].slice(0,50))},executeReversibleAction:async n=>{const i=m(c),l=i.find(r=>r.id===n);if(l){await l.execute();const r=i.findIndex(o=>o.id===n);c.update(o=>o.slice(r+1))}},clearReversibleActions:()=>{c.set([])},clearReversibleActionsByGroupId:n=>{c.update(i=>i.filter(l=>l.groupId!==n))},hasReversibleActions:()=>m(c).length>0}),A=s("samples"),u=s({}),S=s(new Set),g=s(new Set),b=s(0),w=s(0),v=s(0),y=s(!1),_=s(void 0),I=p("lightlyStudio_sampleSize",{width:6,height:6}),C=p("lightlyStudio_metadata_bounds",{}),D=p("lightlyStudio_metadata_values",{}),x=p("lightlyStudio_metadata_info",[]),G=s(void 0),P=s([]),f=s({}),z=s(!1),V=n=>{z.set(n)},H=s(1),J=s(1),M=s({}),T=s(!1),j=()=>{const n=R();return{tags:G,textEmbedding:_,setTextEmbedding:e=>{_.set(e)},selectedSampleIdsByDataset:u,getSelectedSampleIds:e=>F(u,t=>t[e]??new Set),selectedSampleAnnotationCropIds:S,selectedAnnotationFilterIds:g,filteredAnnotationCount:b,filteredSampleCount:w,datasetVersions:f,hideAnnotations:y,classifiers:P,metadataBounds:C,metadataValues:D,metadataInfo:x,updateMetadataValues:e=>{D.set(e)},updateMetadataBounds:e=>{C.set(e)},updateMetadataInfo:e=>{x.set(e)},filteredFramesCount:v,setHideAnnotations:e=>{y.set(e)},getDatasetVersion:async e=>{const t=m(f);if(t[e])return t[e];const{data:a}=await E({path:{dataset_id:e}});if(a!=null&&a.created_at){const d=new Date(a.created_at).getTime().toString();return f.update(B=>({...B,[e]:d})),d}return""},toggleSampleSelection:(e,t)=>{u.update(a=>{const d=a[t]??new Set;return d.has(e)?d.delete(e):d.add(e),{...a,[t]:new Set([...d])}})},clearSelectedSamples:e=>{u.update(t=>({...t,[e]:new Set}))},toggleSampleAnnotationCropSelection:e=>{S.update(t=>(t.has(e)?t.delete(e):t.add(e),t))},clearSelectedSampleAnnotationCrops:()=>{S.update(e=>(e.clear(),e))},lastGridType:A,setLastGridType:e=>{A.set(e)},setSelectedAnnotationFilterIds:e=>{g.update(t=>(t.has(e)?t.delete(e):t.add(e),t))},clearSelectedAnnotationFilterIds:()=>{g.update(e=>(e.clear(),e))},setfilteredAnnotationCount:e=>{b.set(e)},setfilteredSampleCount:e=>{w.set(e)},setfilteredFramesCount:e=>{v.set(e)},sampleSize:I,updateSampleSize:e=>{I.set({width:e,height:e})},isEditingMode:z,setIsEditingMode:V,showPlot:T,setShowPlot:e=>{T.set(e)},imageBrightness:H,imageContrast:J,setDataset:e=>{M.update(t=>({...t,[e.dataset_id]:{sampleType:e.sample_type,parentDatasetId:e.parent_dataset_id,datasetId:e.dataset_id}}))},retrieveParentDataset:(e,t)=>{const a=e[t];return a!=null&&a.parentDatasetId?e[a.parentDatasetId]:null},datasets:M,...n}};export{p as a,j as u};
