import"./CvGjimpO.js";import{I as gt,X as Tt,K as Bt,$ as kt,a0 as $,a1 as nt,Q as G,a2 as H,a3 as ot,a4 as St,a5 as Zt,B as it}from"./CGY1p9L4.js";import"./CWj6FrbW.js";import{o as Dt}from"./xGHZQ1pe.js";import{p as ut,f as vt,j as pt,a as ct,c as j,n as It,s as Q,r as U,t as yt,u as ht,g as u,d as K,h as O,e as Et,b as at}from"./DkbXUtyG.js";import{c as xt,a as L,f as zt,t as At}from"./CmLg0ys7.js";import{s as lt}from"./VqWvU2yF.js";import{s as rt,d as Rt}from"./C8mfFM-u.js";import{s as wt,r as bt,p as Pt,b as mt}from"./DuUalyFS.js";import{s as Yt}from"./eAy8rZzC.js";function Nt(n,o){ut(o,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let a=bt(o,["$$slots","$$events","$$legacy"]);const g=[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]];gt(n,wt({name:"zoom-in"},()=>a,{get iconNode(){return g},children:(v,d)=>{var c=xt(),z=vt(c);lt(z,()=>o.children??pt),L(v,c)},$$slots:{default:!0}})),ct()}function Vt(n,o){ut(o,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let a=bt(o,["$$slots","$$events","$$legacy"]);const g=[["circle",{cx:"11",cy:"11",r:"8"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11"}]];gt(n,wt({name:"zoom-out"},()=>a,{get iconNode(){return g},children:(v,d)=>{var c=xt(),z=vt(c);lt(z,()=>o.children??pt),L(v,c)},$$slots:{default:!0}})),ct()}function Xt(n){return new Tt([document.querySelectorAll(n)],[document.documentElement])}const Ct="bbox-change-annotation-details",de=({annotation:n,dataset_id:o,addReversibleAction:a,updateAnnotation:g})=>{const v=Bt(n),d=async()=>{const c={annotation_id:n.sample_id,dataset_id:o,bounding_box:v};await g(c)};a({id:`bbox-change-${n.sample_id}-${Date.now()}`,description:`Revert bounding box change for annotation ${n.sample_id}`,execute:d,timestamp:new Date,groupId:Ct})};var Ot=1e-12;function ft(n){return((n=Math.exp(n))+1/n)/2}function Gt(n){return((n=Math.exp(n))-1/n)/2}function qt(n){return((n=Math.exp(2*n))-1)/(n+1)}const Ft=function n(o,a,g){function v(d,c){var z=d[0],x=d[1],p=d[2],B=c[0],F=c[1],w=c[2],N=B-z,V=F-x,S=N*N+V*V,R,s;if(S<Ot)s=Math.log(w/p)/o,R=function(h){return[z+h*N,x+h*V,p*Math.exp(o*h*s)]};else{var Z=Math.sqrt(S),M=(w*w-p*p+g*S)/(2*p*a*Z),D=(w*w-p*p-g*S)/(2*w*a*Z),P=Math.log(Math.sqrt(M*M+1)-M),T=Math.log(Math.sqrt(D*D+1)-D);s=(T-P)/o,R=function(h){var k=h*s,I=ft(P),q=p/(a*Z)*(I*qt(o*k+P)-Gt(P));return[z+q*N,x+q*V,p*I/ft(o*k+P)]}}return R.duration=s*1e3*o/Math.SQRT2,R}return v.rho=function(d){var c=Math.max(.001,+d),z=c*c,x=z*z;return n(c,z,x)},v}(Math.SQRT2,2,4),J=n=>()=>n;function Ht(n,{sourceEvent:o,target:a,transform:g,dispatch:v}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:o,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},transform:{value:g,enumerable:!0,configurable:!0},_:{value:v}})}function st(n){n.stopImmediatePropagation()}function W(n){n.preventDefault(),n.stopImmediatePropagation()}function Kt(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function Wt(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function dt(){return this.__zoom||$}function jt(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function Qt(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ut(n,o,a){var g=n.invertX(o[0][0])-a[0][0],v=n.invertX(o[1][0])-a[1][0],d=n.invertY(o[0][1])-a[0][1],c=n.invertY(o[1][1])-a[1][1];return n.translate(v>g?(g+v)/2:Math.min(0,g)||Math.max(0,v),c>d?(d+c)/2:Math.min(0,d)||Math.max(0,c))}function Lt(){var n=Kt,o=Wt,a=Ut,g=jt,v=Qt,d=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],z=250,x=Ft,p=kt("start","zoom","end"),B,F,w,N=500,V=150,S=0,R=10;function s(t){t.property("__zoom",dt).on("wheel.zoom",k,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",q).filter(v).on("touchstart.zoom",tt).on("touchmove.zoom",_t).on("touchend.zoom touchcancel.zoom",Mt).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}s.transform=function(t,i,e,r){var l=t.selection?t.selection():t;l.property("__zoom",dt),t!==l?P(t,i,e,r):l.interrupt().each(function(){T(this,arguments).event(r).start().zoom(null,typeof i=="function"?i.apply(this,arguments):i).end()})},s.scaleBy=function(t,i,e,r){s.scaleTo(t,function(){var l=this.__zoom.k,m=typeof i=="function"?i.apply(this,arguments):i;return l*m},e,r)},s.scaleTo=function(t,i,e,r){s.transform(t,function(){var l=o.apply(this,arguments),m=this.__zoom,f=e==null?D(l):typeof e=="function"?e.apply(this,arguments):e,y=m.invert(f),b=typeof i=="function"?i.apply(this,arguments):i;return a(M(Z(m,b),f,y),l,c)},e,r)},s.translateBy=function(t,i,e,r){s.transform(t,function(){return a(this.__zoom.translate(typeof i=="function"?i.apply(this,arguments):i,typeof e=="function"?e.apply(this,arguments):e),o.apply(this,arguments),c)},null,r)},s.translateTo=function(t,i,e,r,l){s.transform(t,function(){var m=o.apply(this,arguments),f=this.__zoom,y=r==null?D(m):typeof r=="function"?r.apply(this,arguments):r;return a($.translate(y[0],y[1]).scale(f.k).translate(typeof i=="function"?-i.apply(this,arguments):-i,typeof e=="function"?-e.apply(this,arguments):-e),m,c)},r,l)};function Z(t,i){return i=Math.max(d[0],Math.min(d[1],i)),i===t.k?t:new nt(i,t.x,t.y)}function M(t,i,e){var r=i[0]-e[0]*t.k,l=i[1]-e[1]*t.k;return r===t.x&&l===t.y?t:new nt(t.k,r,l)}function D(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function P(t,i,e,r){t.on("start.zoom",function(){T(this,arguments).event(r).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(r).end()}).tween("zoom",function(){var l=this,m=arguments,f=T(l,m).event(r),y=o.apply(l,m),b=e==null?D(y):typeof e=="function"?e.apply(l,m):e,Y=Math.max(y[1][0]-y[0][0],y[1][1]-y[0][1]),_=l.__zoom,E=typeof i=="function"?i.apply(l,m):i,X=x(_.invert(b).concat(Y/_.k),E.invert(b).concat(Y/E.k));return function(A){if(A===1)A=E;else{var C=X(A),et=Y/C[2];A=new nt(et,b[0]-C[0]*et,b[1]-C[1]*et)}f.zoom(null,A)}})}function T(t,i,e){return!e&&t.__zooming||new h(t,i)}function h(t,i){this.that=t,this.args=i,this.active=0,this.sourceEvent=null,this.extent=o.apply(t,i),this.taps=0}h.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,i){return this.mouse&&t!=="mouse"&&(this.mouse[1]=i.invert(this.mouse[0])),this.touch0&&t!=="touch"&&(this.touch0[1]=i.invert(this.touch0[0])),this.touch1&&t!=="touch"&&(this.touch1[1]=i.invert(this.touch1[0])),this.that.__zoom=i,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var i=G(this.that).datum();p.call(t,this.that,new Ht(t,{sourceEvent:this.sourceEvent,target:s,transform:this.that.__zoom,dispatch:p}),i)}};function k(t,...i){if(!n.apply(this,arguments))return;var e=T(this,i).event(t),r=this.__zoom,l=Math.max(d[0],Math.min(d[1],r.k*Math.pow(2,g.apply(this,arguments)))),m=H(t);if(e.wheel)(e.mouse[0][0]!==m[0]||e.mouse[0][1]!==m[1])&&(e.mouse[1]=r.invert(e.mouse[0]=m)),clearTimeout(e.wheel);else{if(r.k===l)return;e.mouse=[m,r.invert(m)],ot(this),e.start()}W(t),e.wheel=setTimeout(f,V),e.zoom("mouse",a(M(Z(r,l),e.mouse[0],e.mouse[1]),e.extent,c));function f(){e.wheel=null,e.end()}}function I(t,...i){if(w||!n.apply(this,arguments))return;var e=t.currentTarget,r=T(this,i,!0).event(t),l=G(t.view).on("mousemove.zoom",b,!0).on("mouseup.zoom",Y,!0),m=H(t,e),f=t.clientX,y=t.clientY;St(t.view),st(t),r.mouse=[m,this.__zoom.invert(m)],ot(this),r.start();function b(_){if(W(_),!r.moved){var E=_.clientX-f,X=_.clientY-y;r.moved=E*E+X*X>S}r.event(_).zoom("mouse",a(M(r.that.__zoom,r.mouse[0]=H(_,e),r.mouse[1]),r.extent,c))}function Y(_){l.on("mousemove.zoom mouseup.zoom",null),Zt(_.view,r.moved),W(_),r.event(_).end()}}function q(t,...i){if(n.apply(this,arguments)){var e=this.__zoom,r=H(t.changedTouches?t.changedTouches[0]:t,this),l=e.invert(r),m=e.k*(t.shiftKey?.5:2),f=a(M(Z(e,m),r,l),o.apply(this,i),c);W(t),z>0?G(this).transition().duration(z).call(P,f,r,t):G(this).call(s.transform,f,r,t)}}function tt(t,...i){if(n.apply(this,arguments)){var e=t.touches,r=e.length,l=T(this,i,t.changedTouches.length===r).event(t),m,f,y,b;for(st(t),f=0;f<r;++f)y=e[f],b=H(y,this),b=[b,this.__zoom.invert(b),y.identifier],l.touch0?!l.touch1&&l.touch0[2]!==b[2]&&(l.touch1=b,l.taps=0):(l.touch0=b,m=!0,l.taps=1+!!B);B&&(B=clearTimeout(B)),m&&(l.taps<2&&(F=b[0],B=setTimeout(function(){B=null},N)),ot(this),l.start())}}function _t(t,...i){if(this.__zooming){var e=T(this,i).event(t),r=t.changedTouches,l=r.length,m,f,y,b;for(W(t),m=0;m<l;++m)f=r[m],y=H(f,this),e.touch0&&e.touch0[2]===f.identifier?e.touch0[0]=y:e.touch1&&e.touch1[2]===f.identifier&&(e.touch1[0]=y);if(f=e.that.__zoom,e.touch1){var Y=e.touch0[0],_=e.touch0[1],E=e.touch1[0],X=e.touch1[1],A=(A=E[0]-Y[0])*A+(A=E[1]-Y[1])*A,C=(C=X[0]-_[0])*C+(C=X[1]-_[1])*C;f=Z(f,Math.sqrt(A/C)),y=[(Y[0]+E[0])/2,(Y[1]+E[1])/2],b=[(_[0]+X[0])/2,(_[1]+X[1])/2]}else if(e.touch0)y=e.touch0[0],b=e.touch0[1];else return;e.zoom("touch",a(M(f,y,b),e.extent,c))}}function Mt(t,...i){if(this.__zooming){var e=T(this,i).event(t),r=t.changedTouches,l=r.length,m,f;for(st(t),w&&clearTimeout(w),w=setTimeout(function(){w=null},N),m=0;m<l;++m)f=r[m],e.touch0&&e.touch0[2]===f.identifier?delete e.touch0:e.touch1&&e.touch1[2]===f.identifier&&delete e.touch1;if(e.touch1&&!e.touch0&&(e.touch0=e.touch1,delete e.touch1),e.touch0)e.touch0[1]=this.__zoom.invert(e.touch0[0]);else if(e.end(),e.taps===2&&(f=H(f,this),Math.hypot(F[0]-f[0],F[1]-f[1])<R)){var y=G(this).on("dblclick.zoom");y&&y.apply(this,arguments)}}}return s.wheelDelta=function(t){return arguments.length?(g=typeof t=="function"?t:J(+t),s):g},s.filter=function(t){return arguments.length?(n=typeof t=="function"?t:J(!!t),s):n},s.touchable=function(t){return arguments.length?(v=typeof t=="function"?t:J(!!t),s):v},s.extent=function(t){return arguments.length?(o=typeof t=="function"?t:J([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),s):o},s.scaleExtent=function(t){return arguments.length?(d[0]=+t[0],d[1]=+t[1],s):[d[0],d[1]]},s.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],s):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},s.constrain=function(t){return arguments.length?(a=t,s):a},s.duration=function(t){return arguments.length?(z=+t,s):z},s.interpolate=function(t){return arguments.length?(x=t,s):x},s.on=function(){var t=p.on.apply(p,arguments);return t===p?s:t},s.clickDistance=function(t){return arguments.length?(S=(t=+t)*t,s):Math.sqrt(S)},s.tapDistance=function(t){return arguments.length?(R=+t,s):R},s}function Jt(n,o){let a=n.scaleIndependentXForm;a||(a=n.scaleIndependentXForm=o.createSVGTransform(),n.transform.baseVal.appendItem(a));const g=n.parentNode;if(g){const v=g.getScreenCTM();if(v){const d=v.inverse().multiply(o.getScreenCTM());d.e=d.f=0,a.setMatrix(d)}}}var $t=zt('<div class="pointer-events-auto absolute bottom-0 left-1 z-20 flex select-none items-center gap-1 rounded-lg bg-muted bg-opacity-80 shadow-md backdrop-blur-sm"><!> <div class="h-6 w-px bg-white bg-opacity-20"></div> <!> <div class="w-[32px] text-center text-sm text-muted-foreground" data-testid="zoom-level"> </div> <!></div>');function te(n,o){var a=$t(),g=j(a);it(g,{variant:"ghost","data-testid":"zoom-reset",size:"sm",get onclick(){return o.onZoomReset},get disabled(){return o.isResetDisabled},children:(x,p)=>{It();var B=At("Reset");L(x,B)},$$slots:{default:!0}});var v=Q(g,4);it(v,{title:"zoom out",variant:"ghost",size:"icon","data-testid":"zoom-out",get onclick(){return o.onZoomOut},get disabled(){return o.isZoominDisabled},children:(x,p)=>{Vt(x,{class:"h-4 w-4"})},$$slots:{default:!0}});var d=Q(v,2),c=j(d);U(d);var z=Q(d,2);it(z,{title:"zoom in",variant:"ghost",size:"icon","data-testid":"zoom-in",get onclick(){return o.onZoomIn},get disabled(){return o.isZoomoutDisabled},children:(x,p)=>{Nt(x,{class:"h-4 w-4"})},$$slots:{default:!0}}),U(a),yt(x=>Yt(c,`${x??""}%`),[()=>Math.round(o.scale*100)]),L(n,a)}var ee=zt('<div class="relative flex h-full w-full select-none items-center justify-center"><!> <svg class="z-10 h-full w-full" preserveAspectRatio="xMidYMid meet"><g><!></g></svg> <svg class="pointer-events-none absolute inset-0" preserveAspectRatio="xMidYMid meet"></svg></div>');function ge(n,o){ut(o,!0);let a=K(null),g=K(null);const v=Pt(o,"cursor",3,"auto");let d=K(800),c=K(600);ht(()=>{if(!u(a))return;O(d,u(a).clientWidth,!0),O(c,u(a).clientHeight,!0);const h=new ResizeObserver(()=>{u(a)&&(O(d,u(a).clientWidth,!0),O(c,u(a).clientHeight,!0))});return h.observe(u(a)),()=>h.disconnect()});const z=10,x=at(()=>{const h={x:0,y:0,width:o.width,height:o.height};if(o.boundingBox){S();const{x:k,y:I,width:q,height:tt}=o.boundingBox;return{x:Math.round(Math.max(0,k-z)),y:Math.round(Math.max(0,I-z)),width:Math.round(Math.min(o.width-k,q+z*2)),height:Math.round(Math.min(o.height-I,tt+z*2))}}return h});let p=K(Et({k:1,x:0,y:0}));const B=at(()=>{if(!u(a))return 1;const h=u(d)/o.width,k=u(c)/o.height,I=Math.min(h,k);return u(p).k*I}),F=at(()=>{if(!u(a))return 1;let h=u(B);if(o.boundingBox){const k=o.width/u(x).width,I=o.height/u(x).height,q=Math.min(k,I);h*=q}return h});let w=K(null);const N=()=>{u(a)&&(O(w,Lt().on("zoom",h=>{O(p,h.transform,!0)}).filter(h=>(!h.ctrlKey||h.type==="wheel")&&!h.button&&!(h.type==="mousedown"&&h.button===2)).wheelDelta(h=>-h.deltaY*.002),!0),G(u(a)).call(u(w)).on("dblclick.zoom",null))},V=h=>{if(!u(a)||!u(w))return;const k=h?1.5:.75;G(u(a)).transition().duration(300).call(u(w).scaleBy,k)},S=()=>{!u(a)||!u(w)||G(u(a)).transition().duration(300).call(u(w).transform,$)},R=()=>{O(p,{k:1,x:0,y:0},!0),u(a)&&u(w)&&G(u(a)).call(u(w).transform,$)};Dt(()=>{var h;N(),(h=o.registerResetFn)==null||h.call(o,R)}),ht(()=>{u(p).k,Xt(".unscaled").each(function(){Jt(this,u(g))})});var s=ee(),Z=j(s);te(Z,{get scale(){return u(B)},onZoomIn:()=>V(!0),onZoomOut:()=>V(!1),onZoomReset:S});var M=Q(Z,2),D=j(M),P=j(D);lt(P,()=>o.zoomableContent,()=>({scale:u(F)})),U(D),U(M),mt(M,h=>O(a,h),()=>u(a));var T=Q(M,2);rt(T,"viewBox","0 0 1024 768"),mt(T,h=>O(g,h),()=>u(g)),U(s),yt(()=>{Rt(M,`cursor: ${v()};`),rt(M,"viewBox",`${u(x).x} ${u(x).y} ${u(x).width} ${u(x).height}`),rt(D,"transform",`translate(${u(p).x}, ${u(p).y}) scale(${u(p).k})`)}),L(n,s),ct()}export{ge as Z,de as a};
