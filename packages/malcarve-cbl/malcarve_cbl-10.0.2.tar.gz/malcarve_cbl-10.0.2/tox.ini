[tox]
envlist =
    style
    test

[testenv:style]
# linting checks don't need the package or dependencies installed as they scan the source tree
skip_install = true

# index-url is passed by default, trusted-host is not
# optionally allow trusted-host to be passed
passenv = PIP_TRUSTED_HOST

# must supply this as uppercase as otherwise tests fail if proxy is set
setenv =
    NO_PROXY=localhost

deps =
    toml
    isort[pyproject]
    bandit
    black
    flake8
    flake8-bugbear
    flake8-docstrings

commands =
    isort -c .
    black . --check
    flake8 .
    bandit -r {{ cookiecutter.__pkg_name }}

[testenv:test]
# index-url is passed by default, trusted-host is not
# optionally allow trusted-host to be passed
passenv = 
    PIP_TRUSTED_HOST
    FILE_MANAGER_VIRUSTOTAL_API_KEY
    FILE_MANAGER_AZURE_STORAGE_ACCESS_KEY
    FILE_MANAGER_AZURE_STORAGE_ACCOUNT_ADDRESS
    FILE_MANAGER_FILE_CACHE_DIR

# must supply this as uppercase as otherwise tests fail if proxy is set
setenv =
    NO_PROXY=localhost

deps =
    toml
    pytest
    pytest-cov
    -rrequirements_tests.txt

commands =
    pytest --cov=malcarve_cbl --cov-report=xml:.tox/.work_env/coverage.xml --junitxml=.tox/.work_env/test-results.xml tests/

[flake8]
ignore = B008,C901,D104,D107,E800,W503,E203
exclude = .*,__pycache__,build,dist,tests,test,interop.py
max-complexity = 10
max-line-length = 119
docstring-convention=google
