import{h as c,d as re,r as D,o as m,c as g,b as e,n as te,i as B,v as j,a as i,w as h,u as F,j as se,l as le,t as S,k as x,m as ie,p as oe,g as A,q as ue,E as R,s as ce,x as Y,e as de,y as ae,z as pe,F as ve,A as _e,B as me,C as fe,D as ge,G as ne}from"./index-428191b7.js";import{S as he}from"./Sidebar-ddd109a0.js";import{a as ye}from"./axios-b5ee139b.js";import{_ as ee}from"./logo2-5154ae89.js";const we=""+new URL("bean-20b95a41.gif",import.meta.url).href,ke="http://localhost:9000",J=ye.create({baseURL:ke,headers:{"Content-Type":"application/json"}}),be=async L=>J.post("/extract/process-html",L,{headers:{"Content-Type":"multipart/form-data"}}),Re=async(L,p)=>J.post("/extract/process-async",L,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:p}),O=async L=>J.get(`/tasks/${L}`),Z=async L=>J.get(`/tasks/${L}/download`,{responseType:"blob"}),Ie=async(L,p="node")=>{try{return J.post("/extract/process-url",null,{params:{url:L,model_type:p},paramsSerializer:{encode:$=>$}})}catch($){throw new Error("处理URL时发生错误: "+$.message)}};const Te={class:"input-section"},Le={class:"input-type-selector"},Se={class:"radio-group"},$e={key:0,class:"file-upload-wrapper"},Ue={class:"file-upload"},xe={class:"upload-interface"},Ce={key:0,class:"file-count"},Me=["disabled"],De={key:1,class:"url-input-wrapper"},Fe=["disabled"],Ee={key:2,class:"error-message"},Pe={class:"choose-section",style:{padding:"1rem"}},Ae={class:"preview-section"},Be={class:"preview-title"},He={key:0,class:"card"},Ve={class:"header"},Ne={class:"top"},ze={class:"title"},Oe={id:"title2"},je={class:"code-container"},Je=["innerHTML"],Ke={key:1,class:"no-files"},We={key:0,class:"progress-section"},qe={class:"progress-info"},Ge={class:"progress-percentage"},Qe={class:"progress-bar"},Xe={key:1,class:"progress-section",style:{display:"flex","justify-content":"space-around"}},Ye={__name:"Single",setup(L){const p=c(""),$=c("first"),o=c(0),u=c(!1),E=c(!1),y=c(""),v=c(""),C=c(null),w=c(!1),M=c("file"),I=c(""),V=c(""),N=c(""),W=c(!0),q=c(!0),z=c(null),T=c([]);re(()=>{});const G=f=>{if(T.value=Array.from(f.target.files),T.value.length>0){const s=T.value[0];v.value=s.name;const r=new FileReader;r.onload=k=>{p.value=k.target.result,w.value=!0},r.readAsText(s)}else w.value=!1,p.value="",v.value=""},Q=async()=>{if(T.value.length===0){y.value="请选择至少一个HTML文件";return}try{y.value="",u.value=!0,o.value=0;const f=setInterval(()=>{o.value<90&&(o.value+=5)},500),s=new FormData;if(T.value.forEach(k=>{s.append("files",k)}),V.value||N.value){const k={include_tags:V.value?V.value.split(",").map(t=>t.trim()):[],exclude_tags:N.value?N.value.split(",").map(t=>t.trim()):[],include_html:W.value,include_links:q.value},l=new Blob([JSON.stringify(k)],{type:"application/json"});s.append("tag_probs",l,"tag_config.json")}s.append("model_type","node");const r=await be(s);if(clearInterval(f),r.data&&r.data.status==="completed"){if(o.value=100,r.data.task_id){C.value=r.data.task_id;try{const k=await Z(r.data.task_id),l=window.URL.createObjectURL(new Blob([k.data])),t=document.createElement("a");t.href=l,t.setAttribute("download",`denoised-content-${new Date().getTime()}.zip`),document.body.appendChild(t),t.click(),document.body.removeChild(t);let a="",n=null;try{if(n=(await O(r.data.task_id)).data,n&&n.results&&n.results.length>0)a=n.results[0].content;else{const b=await O(r.data.task_id);b.data&&b.data.length>0?a=b.data[0].content:(a=p.value,console.warn("未能从API获取处理结果，使用原始HTML作为备选"))}}catch(d){console.error("获取任务详情失败:",d),a=r.data.results&&r.data.results.length>0?r.data.results[0].content:p.value}let _=v.value||"本地HTML文件";try{const d=a.match(/<title>(.*?)<\/title>/i);if(d&&d[1])_=d[1];else{const b=a.match(/<h1>(.*?)<\/h1>/i);b&&b[1]&&(_=b[1])}}catch(d){console.error("提取标题失败:",d)}const P={id:new Date().getTime(),url:_,time:new Date().toLocaleString(),task_id:r.data.task_id,content:a,selected:!1,isBatch:!1,filename:v.value};console.log("保存的内容:",{contentSource:"tasks API",contentPreview:a.substring(0,100),title:_,filename:v.value});const U=JSON.parse(localStorage.getItem("denoisedResults")||"[]");U.push(P),localStorage.setItem("denoisedResults",JSON.stringify(U)),localStorage.setItem("lastTaskId",r.data.task_id)}catch(k){console.error("下载结果文件失败:",k),R.warning("处理成功，但下载结果文件失败，可以稍后在结果页面重试")}}setTimeout(()=>{E.value=!0,u.value=!1},1e3),R({message:`成功处理 ${r.data.result_count||T.value.length} 个文件`,type:"success"}),z.value&&(z.value.value=null),T.value=[]}else H("处理失败："+(r.data.error||"未知错误"))}catch(f){H(f)}},K=async()=>{if(!I.value){y.value="请输入有效的URL";return}try{y.value="",u.value=!0,o.value=0,w.value=!1;const f=setInterval(()=>{o.value<90&&(o.value+=3)},500),s=await Ie(I.value,"node");if(clearInterval(f),s.data&&s.data.status==="completed"){o.value=100;const r=s.data.task_id,k=s.data.title||"";C.value=r;try{const l=await Z(r),t=window.URL.createObjectURL(new Blob([l.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",`denoised-content-${new Date().getTime()}.zip`),document.body.appendChild(a),a.click(),document.body.removeChild(a);let n="";if(s.data.results&&s.data.results.length>0)n=s.data.results[0].content,p.value=n,v.value=k||new URL(I.value).hostname,w.value=!0;else try{const b=(await O(r)).data;if(b&&b.results&&b.results.length>0)n=b.results[0].content,p.value=n,v.value=k||new URL(I.value).hostname,w.value=!0;else{const X=await O(r);X.data&&X.data.length>0?(n=X.data[0].content,p.value=n,v.value=k||new URL(I.value).hostname,w.value=!0):console.warn("未能从API获取处理结果")}}catch(d){console.error("获取任务详情失败:",d)}let _=k||I.value;if(!_&&n)try{const d=n.match(/<title>(.*?)<\/title>/i);if(d&&d[1])_=d[1];else{const b=n.match(/<h1>(.*?)<\/h1>/i);b&&b[1]&&(_=b[1])}}catch(d){console.error("提取标题失败:",d)}const P={id:new Date().getTime(),url:_,time:new Date().toLocaleString(),task_id:r,content:n,selected:!1,isBatch:!1,filename:v.value,source_url:I.value},U=JSON.parse(localStorage.getItem("denoisedResults")||"[]");U.push(P),localStorage.setItem("denoisedResults",JSON.stringify(U)),localStorage.setItem("lastTaskId",r)}catch(l){console.error("下载结果文件失败:",l),R.warning("处理成功，但下载结果文件失败，可以稍后在结果页面重试")}setTimeout(()=>{E.value=!0,u.value=!1},1e3),R({message:`成功处理 URL: ${I.value}`,type:"success"}),I.value=""}else H("处理失败："+(s.data?.message||s.data?.error||"未知错误"))}catch(f){H(f)}},H=f=>{console.error("处理文件时出错:",f),u.value=!1,o.value=0,f.response?y.value=`请求错误 (${f.response.status}): ${f.response.data.error||f.response.data.message||"服务器错误"}`:f.request?y.value="无法连接到服务器，请确认API服务是否正在运行":y.value=f.message||"处理请求时出错",R({message:y.value,type:"error"})};return(f,s)=>{const r=D("el-icon"),k=D("el-input"),l=D("el-tab-pane"),t=D("el-tabs"),a=D("router-link");return m(),g("div",null,[e("div",Te,[s[7]||(s[7]=e("h3",{style:{color:"black","font-weight":"400"}},"选择输入方式",-1)),e("div",Le,[e("div",Se,[e("label",{class:te(["radio-button",{active:M.value==="file"}])},[B(e("input",{type:"radio",value:"file","onUpdate:modelValue":s[0]||(s[0]=n=>M.value=n),name:"inputType"},null,512),[[j,M.value]]),i(r,{class:"radio-icon"},{default:h(()=>[i(F(se))]),_:1}),s[4]||(s[4]=e("span",{class:"radio-label"},"上传HTML文件",-1))],2),e("label",{class:te(["radio-button",{active:M.value==="url"}])},[B(e("input",{type:"radio",value:"url","onUpdate:modelValue":s[1]||(s[1]=n=>M.value=n),name:"inputType"},null,512),[[j,M.value]]),i(r,{class:"radio-icon"},{default:h(()=>[i(F(le))]),_:1}),s[5]||(s[5]=e("span",{class:"radio-label"},"输入网址URL",-1))],2)])]),M.value==="file"?(m(),g("div",$e,[e("div",Ue,[e("input",{type:"file",accept:".html,.htm",multiple:"",ref_key:"fileInput",ref:z,onChange:G,class:"file-input"},null,544),e("div",xe,[i(r,{style:{"font-size":"24px"}},{default:h(()=>[i(F(se))]),_:1}),s[6]||(s[6]=e("span",null,"点击或拖拽HTML文件到此处",-1)),T.value.length>0?(m(),g("span",Ce," 已选择 "+S(T.value.length)+" 个文件 ",1)):x("",!0)])]),e("button",{onClick:Q,disabled:u.value||!T.value.length},S(u.value?"处理中...":"开始处理"),9,Me)])):x("",!0),M.value==="url"?(m(),g("div",De,[i(k,{modelValue:I.value,"onUpdate:modelValue":s[2]||(s[2]=n=>I.value=n),placeholder:"请输入网址 (例如: https://www.example.com)",disabled:u.value,onKeyup:ie(K,["enter"]),class:"url-input"},{prefix:h(()=>[i(r,null,{default:h(()=>[i(F(le))]),_:1})]),_:1},8,["modelValue","disabled"]),e("button",{onClick:K,disabled:u.value||!I.value},S(u.value?"处理中...":"开始处理"),9,Fe)])):x("",!0),y.value?(m(),g("div",Ee,S(y.value),1)):x("",!0)]),e("div",Pe,[i(t,{modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=n=>$.value=n),class:"demo-tabs"},{default:h(()=>[i(l,{label:"Preview",name:"first"},{default:h(()=>[e("div",Ae,[e("h2",Be,[i(r,null,{default:h(()=>[i(F(oe))]),_:1}),s[8]||(s[8]=A(" 预览文件内容 ",-1))]),w.value?(m(),g("div",He,[e("div",Ve,[e("div",Ne,[s[9]||(s[9]=e("div",{class:"circle"},[e("span",{class:"red circle2"})],-1)),s[10]||(s[10]=e("div",{class:"circle"},[e("span",{class:"yellow circle2"})],-1)),s[11]||(s[11]=e("div",{class:"circle"},[e("span",{class:"green circle2"})],-1)),e("div",ze,[e("p",Oe,S(v.value),1)])])]),e("div",je,[e("div",{class:"area",id:"code",name:"code",innerHTML:p.value},null,8,Je)])])):(m(),g("div",Ke,"请选择HTML文件以查看预览"))])]),_:1})]),_:1},8,["modelValue"])]),u.value?(m(),g("div",We,[s[12]||(s[12]=e("img",{src:we,style:{display:"block",margin:"0 auto"}},null,-1)),e("div",qe,[e("span",Ge,S(o.value)+"%",1)]),e("div",Qe,[e("div",{class:"progress",style:ue({width:o.value+"%"})},null,4)])])):x("",!0),E.value?(m(),g("div",Xe,[i(a,{to:"/results",class:"nav-item"},{default:h(()=>s[13]||(s[13]=[e("button",null,"查看结果",-1)])),_:1,__:[13]})])):x("",!0)])}}},Ze=ee(Ye,[["__scopeId","data-v-610330aa"]]);const et={class:"multiple-container"},tt={class:"upload-section"},st={class:"upload-icon"},lt={key:0,class:"file-list"},at={class:"list-header"},nt={class:"actions"},ot={class:"files"},rt={class:"file-name"},it={class:"file-size"},ut={key:0,class:"more-files"},ct={key:1,class:"progress-section"},dt={class:"progress-card"},pt={class:"progress-header"},vt={key:0,class:"uploading"},_t={key:1,class:"processing"},mt={key:2,class:"completed"},ft={class:"success-icon"},gt={class:"action-buttons"},ht={key:3,class:"failed"},yt={class:"error-icon"},wt={__name:"Multiple",setup(L){const p=ce(),$=c(null),o=c([]),u=c(!1),E=c(0),y=c(null),v=c(null),C=c(""),w=c(null),M=Y(()=>o.value.slice(0,5)),I=Y(()=>{switch(v.value){case"processing":return"info";case"completed":return"success";case"failed":return"danger";default:return"info"}}),V=Y(()=>{switch(v.value){case"processing":return"处理中";case"completed":return"已完成";case"failed":return"失败";default:return"等待中"}}),N=()=>{$.value.click()},W=l=>{const a=Array.from(l.target.files).filter(n=>n.name.endsWith(".html")||n.type==="text/html");if(a.length===0){R.warning("未找到HTML文件，请确保文件夹中包含HTML文件");return}o.value=a,R.success(`已选择 ${a.length} 个HTML文件`)},q=l=>{l.preventDefault()},z=l=>{l.preventDefault();const t=l.dataTransfer.items,a=[];for(let n=0;n<t.length;n++){const _=t[n].webkitGetAsEntry();_&&T(_,a)}},T=(l,t)=>{l.isFile?l.file(a=>{(a.name.endsWith(".html")||a.type==="text/html")&&(t.push(a),o.value=[...o.value,a])}):l.isDirectory&&l.createReader().readEntries(n=>{for(let _=0;_<n.length;_++)T(n[_],t)})},G=l=>l<1024?l+" B":l<1024*1024?(l/1024).toFixed(2)+" KB":(l/(1024*1024)).toFixed(2)+" MB",Q=()=>{o.value=[],$.value.value=null},K=async()=>{if(o.value.length===0){R.warning("请先选择要处理的文件");return}u.value=!0,E.value=0,C.value="";try{const l=new FormData;o.value.forEach(a=>{l.append("files",a)}),l.append("model_type","node");const t=await Re(l,a=>{E.value=Math.round(a.loaded/a.total*100)});if(t.data&&t.data.task_id)y.value=t.data.task_id,v.value="processing",R.success("文件已上传，正在处理中"),H();else throw new Error("未返回有效的任务ID")}catch(l){console.error("处理请求失败:",l),u.value=!1,C.value=l.message||"提交处理请求时发生错误",v.value="failed",R.error("请求失败: "+C.value)}},H=()=>{w.value&&clearInterval(w.value),w.value=setInterval(async()=>{try{const t=(await O(y.value)).data;v.value=t.status,t.status==="completed"?(clearInterval(w.value),u.value=!1,f(t),R.success("处理完成！")):t.status==="failed"&&(clearInterval(w.value),u.value=!1,C.value=t.error||"处理失败",R.error("处理失败: "+C.value))}catch(l){console.error("检查任务状态失败:",l)}},3e3)},f=l=>{try{const t=JSON.parse(localStorage.getItem("denoisedResults")||"[]");if(l.results&&l.results.length>0){const a=new Date().toLocaleString(),n=l.results.map((_,P)=>{let U=_.filename;try{const d=_.content.match(/<title>(.*?)<\/title>/i);d&&d[1]&&(U=d[1])}catch(d){console.error("提取URL失败:",d)}return{id:Date.now()+P,url:U,time:a,content:_.content,task_id:y.value,selected:!1}});localStorage.setItem("denoisedResults",JSON.stringify([...n,...t]))}}catch(t){console.error("保存结果到本地存储失败:",t),R.warning("保存结果到本地失败，但您仍然可以下载结果")}},s=async()=>{try{const l=await Z(y.value),t=window.URL.createObjectURL(new Blob([l.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",`batch-denoised-${new Date().getTime()}.zip`),document.body.appendChild(a),a.click(),document.body.removeChild(a),R.success("下载成功")}catch(l){console.error("下载结果失败:",l),R.error("下载结果失败: "+(l.message||"未知错误"))}},r=()=>{p.push("/results")},k=()=>{u.value=!1,y.value=null,v.value=null,C.value="",E.value=0,w.value&&(clearInterval(w.value),w.value=null)};return de(()=>{w.value&&clearInterval(w.value)}),(l,t)=>{const a=D("el-icon"),n=D("el-button"),_=D("el-tag"),P=D("el-progress");return m(),g("div",et,[t[10]||(t[10]=e("div",{class:"title-section"},[e("h1",null,"批量清洗"),e("p",null,"上传包含HTML文件的文件夹，进行批量页面清洗处理")],-1)),e("div",tt,[e("div",{class:"upload-card",onClick:N,onDragover:ae(q,["prevent"]),onDrop:ae(z,["prevent"])},[e("div",st,[i(a,{size:32},{default:h(()=>[i(F(pe))]),_:1})]),t[0]||(t[0]=e("div",{class:"upload-text"},[e("p",null,"点击选择文件夹或拖拽至此处"),e("p",{class:"upload-hint"},"支持包含多个HTML文件的文件夹")],-1)),e("input",{ref_key:"fileInput",ref:$,type:"file",webkitdirectory:"",directory:"",multiple:"",style:{display:"none"},onChange:W},null,544)],32)]),o.value.length>0?(m(),g("div",lt,[e("div",at,[e("h3",null,"已选择 "+S(o.value.length)+" 个文件",1),e("div",nt,[i(n,{size:"small",onClick:Q},{default:h(()=>t[1]||(t[1]=[A("清空",-1)])),_:1,__:[1]}),i(n,{type:"primary",size:"small",onClick:K,loading:u.value},{default:h(()=>t[2]||(t[2]=[A("开始处理",-1)])),_:1,__:[2]},8,["loading"])])]),e("div",ot,[(m(!0),g(ve,null,_e(M.value,(U,d)=>(m(),g("div",{key:d,class:"file-item"},[i(a,null,{default:h(()=>[i(F(oe))]),_:1}),e("span",rt,S(U.name),1),e("span",it,S(G(U.size)),1)]))),128)),o.value.length>5?(m(),g("div",ut," 还有 "+S(o.value.length-5)+" 个文件... ",1)):x("",!0)])])):x("",!0),u.value||v.value?(m(),g("div",ct,[e("div",dt,[e("div",pt,[t[3]||(t[3]=e("h3",null,"处理进度",-1)),v.value?(m(),me(_,{key:0,type:I.value},{default:h(()=>[A(S(V.value),1)]),_:1},8,["type"])):x("",!0)]),u.value&&!y.value?(m(),g("div",vt,[i(P,{type:"circle",percentage:E.value},null,8,["percentage"]),t[4]||(t[4]=e("p",null,"正在上传文件...",-1))])):y.value&&v.value!=="completed"&&v.value!=="failed"?(m(),g("div",_t,[i(P,{type:"circle",percentage:50,status:"success",indeterminate:""}),t[5]||(t[5]=e("p",null,"正在处理文件，请稍候...",-1))])):v.value==="completed"?(m(),g("div",mt,[e("div",ft,[i(a,{size:48},{default:h(()=>[i(F(fe))]),_:1})]),t[8]||(t[8]=e("p",null,"处理完成！",-1)),e("div",gt,[i(n,{type:"primary",onClick:s},{default:h(()=>t[6]||(t[6]=[A("下载结果",-1)])),_:1,__:[6]}),i(n,{onClick:r},{default:h(()=>t[7]||(t[7]=[A("查看结果",-1)])),_:1,__:[7]})])])):v.value==="failed"?(m(),g("div",ht,[e("div",yt,[i(a,{size:48},{default:h(()=>[i(F(ge))]),_:1})]),e("p",null,"处理失败: "+S(C.value),1),i(n,{onClick:k},{default:h(()=>t[9]||(t[9]=[A("重新尝试",-1)])),_:1,__:[9]})])):x("",!0)])])):x("",!0)])}}},kt=ee(wt,[["__scopeId","data-v-cfd557e3"]]);const bt={class:"use-page"},Rt={class:"main-content"},It={class:"radio-inputs"},Tt={class:"radio"},Lt={class:"radio"},St={class:"radio"},$t={class:"function"},Ut={__name:"UsePage",setup(L){const p=c("single");return($,o)=>(m(),g("div",bt,[i(he),e("div",Rt,[o[6]||(o[6]=e("div",{class:"use-header"},[e("h1",null,"CLEAN"),e("h2",null,"清洗网页并生成可供LLM使用的数据格式")],-1)),e("div",It,[e("label",Tt,[B(e("input",{type:"radio",name:"radio",value:"single","onUpdate:modelValue":o[0]||(o[0]=u=>p.value=u)},null,512),[[j,p.value]]),o[3]||(o[3]=e("span",{class:"name"},"简单爬取",-1))]),e("label",Lt,[B(e("input",{type:"radio",name:"radio",checked:"",value:"single","onUpdate:modelValue":o[1]||(o[1]=u=>p.value=u)},null,512),[[j,p.value]]),o[4]||(o[4]=e("span",{class:"name"},"单页面清洗",-1))]),e("label",St,[B(e("input",{type:"radio",name:"radio",value:"multiple","onUpdate:modelValue":o[2]||(o[2]=u=>p.value=u)},null,512),[[j,p.value]]),o[5]||(o[5]=e("span",{class:"name"},"多页面清洗",-1))])]),e("div",$t,[B(i(Ze,null,null,512),[[ne,p.value=="single"]]),B(i(kt,null,null,512),[[ne,p.value=="multiple"]])])])]))}},Ft=ee(Ut,[["__scopeId","data-v-4452d82e"]]);export{Ft as default};
