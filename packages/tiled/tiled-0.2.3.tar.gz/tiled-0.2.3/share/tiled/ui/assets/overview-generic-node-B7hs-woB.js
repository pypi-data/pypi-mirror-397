import{_ as N,j as e,b as T,c as k,r as g,M as A,F as R,K as M,w as E}from"./index-DamtKecr.js";import{B as F,s as O}from"./browse-DbQ1AyW9.js";import{f as D,u as G,s as U,c as $,g as W,T as H,v as L,a as w,b as z,d as V,e as B,h as _,G as v,i as K,j as Z,k as q,l as J,D as Q}from"./DataGrid-BobDyAGx.js";import"./toPropertyKey-DCwh5dYN.js";import"./FormControlLabel-BjTnMOc_.js";import"./Input-4KBIG5d8.js";import"./Stack-UKMuYVo8.js";import"./Tooltip--ZstDYOc.js";import"./Checkbox-Dc-7Dz0B.js";const X=["className","children"],Y=n=>{const{classes:f}=n;return $({root:["toolbarContainer"]},W,f)},ee=U(H,{name:"MuiDataGrid",slot:"ToolbarContainer",shouldForwardProp:n=>n!=="ownerState"})({display:"flex",alignItems:"center",flexWrap:"wrap",gap:L.spacing(1),padding:L.spacing(.5),minHeight:"auto"}),te=D(function(f,x){const{className:l,children:t}=f,r=N(f,X),o=G(),s=Y(o);return t?e.jsx(ee,T({className:k(s.root,l),ownerState:o},r,{ref:x,children:t})):null}),se=D(function(f,x){const{slotProps:l={}}=f,t=l.button||{},r=l.tooltip||{},o=w(),s=w(),u=z(),b=G(),{columnsPanelTriggerRef:S}=V(),p=B(u,K),a=_(x,S),m=d=>{p.open&&p.openedPanelValue===v.columns?u.current.hidePreferences():u.current.showPreferences(v.columns,s,o),t.onClick?.(d)};if(b.disableColumnSelector)return null;const c=p.open&&p.panelId===s;return e.jsx(b.slots.baseTooltip,T({title:u.current.getLocaleText("toolbarColumnsLabel"),enterDelay:1e3},b.slotProps?.baseTooltip,r,{children:e.jsx(b.slots.baseButton,T({id:o,size:"small","aria-label":u.current.getLocaleText("toolbarColumnsLabel"),"aria-haspopup":"menu","aria-expanded":c,"aria-controls":c?s:void 0,startIcon:e.jsx(b.slots.columnSelectorIcon,{})},b.slotProps?.baseButton,t,{onPointerUp:d=>{p.open&&d.stopPropagation(),t.onPointerUp?.(d)},onClick:m,ref:a,children:u.current.getLocaleText("toolbarColumns")}))}))}),oe=D(function(f,x){const{slotProps:l={}}=f,t=l.button||{},r=l.tooltip||{},o=z(),s=G(),u=B(o,J),b=w(),S=w(),[p,a]=g.useState(!1),m=g.useRef(null),c=_(x,m),d=[{icon:e.jsx(s.slots.densityCompactIcon,{}),label:o.current.getLocaleText("toolbarDensityCompact"),value:"compact"},{icon:e.jsx(s.slots.densityStandardIcon,{}),label:o.current.getLocaleText("toolbarDensityStandard"),value:"standard"},{icon:e.jsx(s.slots.densityComfortableIcon,{}),label:o.current.getLocaleText("toolbarDensityComfortable"),value:"comfortable"}],j=g.useMemo(()=>{switch(u){case"compact":return e.jsx(s.slots.densityCompactIcon,{});case"comfortable":return e.jsx(s.slots.densityComfortableIcon,{});default:return e.jsx(s.slots.densityStandardIcon,{})}},[u,s]),i=y=>{a(I=>!I),t.onClick?.(y)},C=()=>{a(!1)},P=y=>{o.current.setDensity(y),a(!1)};if(s.disableDensitySelector)return null;const h=d.map((y,I)=>e.jsx(s.slots.baseMenuItem,{onClick:()=>P(y.value),selected:y.value===u,iconStart:y.icon,children:y.label},I));return e.jsxs(g.Fragment,{children:[e.jsx(s.slots.baseTooltip,T({title:o.current.getLocaleText("toolbarDensityLabel"),enterDelay:1e3},s.slotProps?.baseTooltip,r,{children:e.jsx(s.slots.baseButton,T({size:"small",startIcon:j,"aria-label":o.current.getLocaleText("toolbarDensityLabel"),"aria-haspopup":"menu","aria-expanded":p,"aria-controls":p?S:void 0,id:b},s.slotProps?.baseButton,t,{onClick:i,ref:c,children:o.current.getLocaleText("toolbarDensity")}))})),e.jsx(Z,{open:p,target:m.current,onClose:C,position:"bottom-end",children:e.jsx(s.slots.baseMenuList,{id:S,className:q.menuList,"aria-labelledby":b,autoFocusItem:p,children:h})})]})});function ne(){return e.jsxs(te,{children:[e.jsx(se,{}),e.jsx(oe,{})]})}const ae=10,le=n=>{let f=A();const x=[{field:"id",headerName:"ID",flex:1,hide:!n.defaultColumns.includes("id")}];n.columns.map(a=>x.push({field:a.field,headerName:a.header,flex:1,hide:!n.defaultColumns.includes(a.field)}));const l=g.useContext(R),[t,r]=g.useState({page:0,pageSize:ae,rows:[],loading:!1}),[o,s]=g.useState([]),[u,b]=g.useState({}),[S,p]=g.useState(0);return g.useEffect(()=>{let a=!0;async function m(){let c,d;const j=new AbortController;n.columns.length===0?(d=[],c=null):(d=["metadata"],c="{"+n.columns.map(h=>`${h.field}:${h.select_metadata}`).join(",")+"}");let i=null;o.length>0&&(i=o.map(h=>h.sort==="desc"?`-${h.field}`:h.field).join(","));const C=await O(l.api_url,n.segments,j.signal,d,c,t.pageSize*t.page,t.pageSize,i);return p(C.meta.count),C.data}return(async()=>{r(i=>({...i,loading:!0}));const c=await m(),d={};c.map(i=>(d[i.id]=i.attributes.ancestors,null));const j=c.map(i=>{const C={};return C.id=i.id,n.columns.map(P=>(C[P.field]=i.attributes.metadata[P.field],null)),C});a&&(b(d),r(i=>({...i,loading:!1,rows:j})))})(),()=>{a=!1}},[t.page,t.pageSize,n.columns,n.segments,o,l.api_url]),e.jsx(F,{sx:{my:4},children:e.jsx(M,{maxWidth:"lg",children:e.jsx(Q,{columns:x,pagination:!0,rowCount:S,...t,paginationModel:{page:t.page,pageSize:t.pageSize},paginationMode:"server",pageSizeOptions:[10,30,100],onPaginationModelChange:({page:a,pageSize:m})=>{r(c=>({...c,page:a,pageSize:m}))},onRowClick:a=>{f(`/browse${u[a.id].map(function(m){return"/"+m}).join("")}/${a.id}`)},slots:{toolbar:ne},disableColumnFilter:!0,autoHeight:!0,sortingMode:"server",sortModel:o,onSortModelChange:a=>{s(a),r(m=>({...m,page:0}))}})})})},ge=n=>{const l=(g.useContext(R).specs||[]).find(o=>n.item.data.attributes.specs.includes(o.spec));let t,r;return l===void 0?(t=[],r=["id"]):(t=l.columns,r=l.default_columns),e.jsxs(M,{maxWidth:"lg",children:[e.jsx(E,{id:"table-title",variant:"h6",component:"h2",children:"Contents"}),e.jsx(le,{segments:n.segments,specs:n.item.data.attributes.specs,columns:t,defaultColumns:r})]})};export{ge as default};
