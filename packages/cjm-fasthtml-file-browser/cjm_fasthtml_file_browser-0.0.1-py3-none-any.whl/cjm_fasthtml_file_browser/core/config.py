"""Configuration for file discovery and browser settings"""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/core/config.ipynb.

# %% auto 0
__all__ = ['BROWSER_CONFIG_SCHEMA', 'BrowserConfig']

# %% ../../nbs/core/config.ipynb 3
from dataclasses import dataclass, field
from typing import List, Dict, Set, ClassVar, Optional

from cjm_fasthtml_jsonschema.core.dataclass import (
    SCHEMA_TITLE, SCHEMA_DESC, SCHEMA_MIN, SCHEMA_MAX, SCHEMA_ENUM,
    dataclass_to_jsonschema
)

from .types import FileType, FileTypeConfig, DEFAULT_TYPE_CONFIGS

# %% ../../nbs/core/config.ipynb 5
@dataclass
class BrowserConfig:
    """Configuration for file discovery and browser display."""
    
    # Class-level schema metadata
    __schema_name__: ClassVar[str] = "file_browser"
    __schema_title__: ClassVar[str] = "File Browser Settings"
    __schema_description__: ClassVar[str] = "Configure file scanning and browser display"
    
    # Directories to scan
    directories: List[str] = field(
        default_factory=list,
        metadata={
            SCHEMA_TITLE: "Scan Directories",
            SCHEMA_DESC: "Directories to scan for files"
        }
    )
    
    # File type filters - which types to include
    enabled_types: List[str] = field(
        default_factory=lambda: ["audio", "video"],
        metadata={
            SCHEMA_TITLE: "Enabled File Types",
            SCHEMA_DESC: "File types to include in scan (audio, video, image, document)"
        }
    )
    
    # Custom extensions per type (overrides defaults)
    audio_extensions: List[str] = field(
        default_factory=lambda: ["mp3", "wav", "flac", "m4a", "ogg", "wma", "aac", "opus"],
        metadata={
            SCHEMA_TITLE: "Audio Extensions",
            SCHEMA_DESC: "File extensions to recognize as audio"
        }
    )
    video_extensions: List[str] = field(
        default_factory=lambda: ["mp4", "mkv", "avi", "mov", "webm", "wmv", "flv", "m4v"],
        metadata={
            SCHEMA_TITLE: "Video Extensions",
            SCHEMA_DESC: "File extensions to recognize as video"
        }
    )
    image_extensions: List[str] = field(
        default_factory=lambda: ["jpg", "jpeg", "png", "gif", "webp", "svg", "bmp", "ico"],
        metadata={
            SCHEMA_TITLE: "Image Extensions",
            SCHEMA_DESC: "File extensions to recognize as images"
        }
    )
    document_extensions: List[str] = field(
        default_factory=lambda: ["pdf", "doc", "docx", "txt", "md", "rtf", "odt"],
        metadata={
            SCHEMA_TITLE: "Document Extensions",
            SCHEMA_DESC: "File extensions to recognize as documents"
        }
    )
    
    # Size limits
    min_file_size_kb: int = field(
        default=0,
        metadata={
            SCHEMA_TITLE: "Minimum File Size (KB)",
            SCHEMA_DESC: "Minimum file size in kilobytes (0 = no minimum)",
            SCHEMA_MIN: 0
        }
    )
    max_file_size_mb: int = field(
        default=0,
        metadata={
            SCHEMA_TITLE: "Maximum File Size (MB)",
            SCHEMA_DESC: "Maximum file size in megabytes (0 = no limit)",
            SCHEMA_MIN: 0
        }
    )
    
    # Scanning behavior
    recursive_scan: bool = field(
        default=True,
        metadata={
            SCHEMA_TITLE: "Recursive Scan",
            SCHEMA_DESC: "Scan subdirectories"
        }
    )
    include_hidden: bool = field(
        default=False,
        metadata={
            SCHEMA_TITLE: "Include Hidden Files",
            SCHEMA_DESC: "Include files starting with a dot"
        }
    )
    follow_symlinks: bool = field(
        default=False,
        metadata={
            SCHEMA_TITLE: "Follow Symlinks",
            SCHEMA_DESC: "Follow symbolic links when scanning"
        }
    )
    exclude_patterns: List[str] = field(
        default_factory=list,
        metadata={
            SCHEMA_TITLE: "Exclude Patterns",
            SCHEMA_DESC: "Glob patterns to exclude from results"
        }
    )
    
    # Caching
    cache_results: bool = field(
        default=True,
        metadata={
            SCHEMA_TITLE: "Cache Results",
            SCHEMA_DESC: "Cache scan results for faster loading"
        }
    )
    cache_duration_minutes: int = field(
        default=60,
        metadata={
            SCHEMA_TITLE: "Cache Duration (minutes)",
            SCHEMA_DESC: "How long to cache scan results",
            SCHEMA_MIN: 1
        }
    )
    
    # Display settings
    max_results: int = field(
        default=1000,
        metadata={
            SCHEMA_TITLE: "Maximum Results",
            SCHEMA_DESC: "Maximum number of files to return",
            SCHEMA_MIN: 1
        }
    )
    items_per_page: int = field(
        default=30,
        metadata={
            SCHEMA_TITLE: "Items Per Page",
            SCHEMA_DESC: "Number of files to show per page",
            SCHEMA_MIN: 10,
            SCHEMA_MAX: 100
        }
    )
    default_view: str = field(
        default="list",
        metadata={
            SCHEMA_TITLE: "Default View",
            SCHEMA_DESC: "Default view mode for file browser",
            SCHEMA_ENUM: ["grid", "list"]
        }
    )
    sort_by: str = field(
        default="name",
        metadata={
            SCHEMA_TITLE: "Sort By",
            SCHEMA_DESC: "Default sort field",
            SCHEMA_ENUM: ["name", "size", "modified", "type"]
        }
    )
    sort_descending: bool = field(
        default=False,
        metadata={
            SCHEMA_TITLE: "Sort Descending",
            SCHEMA_DESC: "Sort in descending order"
        }
    )
    
    def get_enabled_file_types(self) -> List[FileType]:  # List of enabled FileType enums
        """Get the list of enabled FileType enums."""
        type_map = {
            "audio": FileType.AUDIO,
            "video": FileType.VIDEO,
            "image": FileType.IMAGE,
            "document": FileType.DOCUMENT
        }
        return [type_map[t] for t in self.enabled_types if t in type_map]
    
    def get_extensions_for_type(
        self,
        file_type: FileType  # The file type to get extensions for
    ) -> List[str]:  # List of extensions for the type
        """Get configured extensions for a specific file type."""
        extension_map = {
            FileType.AUDIO: self.audio_extensions,
            FileType.VIDEO: self.video_extensions,
            FileType.IMAGE: self.image_extensions,
            FileType.DOCUMENT: self.document_extensions
        }
        return extension_map.get(file_type, [])
    
    def get_all_enabled_extensions(self) -> Set[str]:  # Set of all enabled extensions
        """Get all extensions for enabled file types."""
        extensions = set()
        for file_type in self.get_enabled_file_types():
            for ext in self.get_extensions_for_type(file_type):
                extensions.add(ext.lower())
        return extensions
    
    def build_extension_to_type_map(self) -> Dict[str, FileType]:  # Mapping of extension to FileType
        """Build a mapping from extension to FileType for enabled types."""
        ext_map = {}
        for file_type in self.get_enabled_file_types():
            for ext in self.get_extensions_for_type(file_type):
                ext_map[ext.lower()] = file_type
        return ext_map

# %% ../../nbs/core/config.ipynb 7
BROWSER_CONFIG_SCHEMA = dataclass_to_jsonschema(BrowserConfig)
