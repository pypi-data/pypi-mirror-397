# cjm-fasthtml-file-browser


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Install

``` bash
pip install cjm_fasthtml_file_browser
```

## Project Structure

    nbs/
    ├── components/ (2)
    │   ├── browser.ipynb  # UI components for file browser views (grid, list, controls)
    │   └── preview.ipynb  # Modal dialog for previewing files with type-specific players
    ├── core/ (5)
    │   ├── config.ipynb        # Configuration for file discovery and browser settings
    │   ├── file_browser.ipynb  # Unified facade for file discovery, mounting, and access
    │   ├── html_ids.ipynb      # Centralized HTML ID constants for file browser components
    │   ├── models.ipynb        # Data models for discovered files
    │   └── types.ipynb         # File type definitions, icon registry, and extension mapping for the file browser
    ├── discovery/ (2)
    │   ├── scanner.ipynb  # Scans directories for files with caching support
    │   └── utils.ipynb    # Formatting utilities for file discovery and display
    ├── patterns/ (2)
    │   ├── browser_pagination.ipynb    # Factory function for creating paginated file browser views
    │   └── selection_pagination.ipynb  # Factory function for creating paginated file selection table with radio buttons
    └── serving/ (1)
        └── mounter.ipynb  # Mounts directories as static files for serving through the web server

Total: 12 notebooks across 5 directories

## Module Dependencies

``` mermaid
graph LR
    components_browser[components.browser<br/>Browser Components]
    components_preview[components.preview<br/>Preview Components]
    core_config[core.config<br/>Browser Configuration]
    core_file_browser[core.file_browser<br/>File Browser]
    core_html_ids[core.html_ids<br/>HTML IDs]
    core_models[core.models<br/>File Models]
    core_types[core.types<br/>File Types]
    discovery_scanner[discovery.scanner<br/>File Scanner]
    discovery_utils[discovery.utils<br/>File Utilities]
    patterns_browser_pagination[patterns.browser_pagination<br/>Browser Pagination]
    patterns_selection_pagination[patterns.selection_pagination<br/>File Selection Pagination]
    serving_mounter[serving.mounter<br/>Directory Mounter]

    components_browser --> core_types
    components_browser --> core_models
    components_browser --> serving_mounter
    components_preview --> core_types
    components_preview --> core_models
    core_config --> core_types
    core_file_browser --> core_models
    core_file_browser --> patterns_browser_pagination
    core_file_browser --> patterns_selection_pagination
    core_file_browser --> core_types
    core_file_browser --> discovery_scanner
    core_file_browser --> core_config
    core_file_browser --> serving_mounter
    core_models --> core_types
    discovery_scanner --> discovery_utils
    discovery_scanner --> core_models
    discovery_scanner --> core_types
    discovery_scanner --> core_config
    patterns_browser_pagination --> core_models
    patterns_browser_pagination --> components_browser
    patterns_browser_pagination --> core_types
    patterns_browser_pagination --> discovery_scanner
    patterns_browser_pagination --> serving_mounter
    patterns_selection_pagination --> core_types
    patterns_selection_pagination --> core_models
    patterns_selection_pagination --> discovery_scanner
```

*26 cross-module dependencies detected*

## CLI Reference

No CLI commands found in this project.

## Module Overview

Detailed documentation for each module in the project:

### Browser Components (`browser.ipynb`)

> UI components for file browser views (grid, list, controls)

#### Import

``` python
from cjm_fasthtml_file_browser.components.browser import (
    grid_view_content,
    list_view_content,
    empty_browser_content,
    browser_controls
)
```

#### Functions

``` python
def grid_view_content(
    files: List[FileEntry],  # List of files to display
    mounter: DirectoryMounter,  # DirectoryMounter instance for URL generation
    start_idx: int = 0,  # Starting index for item numbering
    file_type_filter: Optional[str] = None,  # Current filter type for maintaining state
    preview_route_func = None,  # Function to generate preview route URL
    modal_id: str = "fb-preview-modal"  # ID for the preview modal
) -> FT:  # Grid container with file cards
    "Render files as cards in a responsive grid layout."
```

``` python
def list_view_content(
    files: List[FileEntry],  # List of files to display
    mounter: DirectoryMounter,  # DirectoryMounter instance for URL generation
    start_idx: int = 0,  # Starting index for item numbering
    file_type_filter: Optional[str] = None,  # Current filter type for maintaining state
    preview_route_func = None,  # Function to generate preview route URL
    modal_id: str = "fb-preview-modal"  # ID for the preview modal
) -> FT:  # Table with file rows
    "Render files as rows in a table."
```

``` python
def empty_browser_content(
    message: str = "No files found.",  # Message to display
    action_url: Optional[str] = None,  # Optional URL for action button
    action_text: str = "Configure Settings"  # Text for action button
) -> FT:  # Empty state container
    "Render empty state display when no files are found."
```

``` python
def browser_controls(
    view_mode: str,  # Current view mode ("grid" or "list")
    file_type_filter: Optional[str],  # Current file type filter
    enabled_types: List[FileType],  # List of enabled file types for filter buttons
    change_view_url_func,  # Function to generate URL for view change
    change_filter_url_func,  # Function to generate URL for filter change
    content_target_id: str  # ID of content container to target
) -> FT:  # Controls bar element
    "Render control bar for file browser with view mode toggle and file type filter."
```

### Browser Pagination (`browser_pagination.ipynb`)

> Factory function for creating paginated file browser views

#### Import

``` python
from cjm_fasthtml_file_browser.patterns.browser_pagination import (
    create_browser_pagination
)
```

#### Functions

``` python
def create_browser_pagination(
    pagination_id: str,  # Unique identifier for this pagination instance
    scanner: FileScanner,  # FileScanner instance for loading files
    mounter: DirectoryMounter,  # DirectoryMounter instance for URL generation
    items_per_page: int = 30,  # Number of items per page
    content_id: Optional[str] = None,  # HTML ID for content area
    preview_route_func = None,  # Function to generate preview route URL
    modal_id: str = "fb-preview-modal"  # ID for the preview modal
) -> Pagination:  # Configured Pagination instance
    "Create a Pagination instance for file browsing."
```

### Browser Configuration (`config.ipynb`)

> Configuration for file discovery and browser settings

#### Import

``` python
from cjm_fasthtml_file_browser.core.config import (
    BROWSER_CONFIG_SCHEMA,
    BrowserConfig
)
```

#### Classes

``` python
@dataclass
class BrowserConfig:
    "Configuration for file discovery and browser display."
    
    __schema_name__: ClassVar[str] = 'file_browser'
    __schema_title__: ClassVar[str] = 'File Browser Settings'
    __schema_description__: ClassVar[str] = 'Configure file scanning and browser display'
    directories: List[str] = field(...)
    enabled_types: List[str] = field(...)
    audio_extensions: List[str] = field(...)
    video_extensions: List[str] = field(...)
    image_extensions: List[str] = field(...)
    document_extensions: List[str] = field(...)
    min_file_size_kb: int = field(...)
    max_file_size_mb: int = field(...)
    recursive_scan: bool = field(...)
    include_hidden: bool = field(...)
    follow_symlinks: bool = field(...)
    exclude_patterns: List[str] = field(...)
    cache_results: bool = field(...)
    cache_duration_minutes: int = field(...)
    max_results: int = field(...)
    items_per_page: int = field(...)
    default_view: str = field(...)
    sort_by: str = field(...)
    sort_descending: bool = field(...)
    
    def get_enabled_file_types(self) -> List[FileType]:  # List of enabled FileType enums
            """Get the list of enabled FileType enums."""
            type_map = {
                "audio": FileType.AUDIO,
        "Get the list of enabled FileType enums."
    
    def get_extensions_for_type(
            self,
            file_type: FileType  # The file type to get extensions for
        ) -> List[str]:  # List of extensions for the type
        "Get configured extensions for a specific file type."
    
    def get_all_enabled_extensions(self) -> Set[str]:  # Set of all enabled extensions
            """Get all extensions for enabled file types."""
            extensions = set()
            for file_type in self.get_enabled_file_types()
        "Get all extensions for enabled file types."
    
    def build_extension_to_type_map(self) -> Dict[str, FileType]:  # Mapping of extension to FileType
            """Build a mapping from extension to FileType for enabled types."""
            ext_map = {}
            for file_type in self.get_enabled_file_types()
        "Build a mapping from extension to FileType for enabled types."
```

#### Variables

``` python
BROWSER_CONFIG_SCHEMA
```

### File Browser (`file_browser.ipynb`)

> Unified facade for file discovery, mounting, and access

#### Import

``` python
from cjm_fasthtml_file_browser.core.file_browser import (
    FileBrowser
)
```

#### Functions

``` python
@patch
def mount(
    self: FileBrowser,
    app  # FastHTML/Starlette application instance
) -> None
    "Mount directories to app for static file serving."
```

``` python
@patch
def scan(
    self: FileBrowser,
    force_refresh: bool = False  # Force a fresh scan, ignoring cache
) -> List[FileEntry]:  # List of FileEntry objects
    "Scan for files."
```

``` python
@patch
def get_files_by_type(
    self: FileBrowser,
    file_types: List[FileType]  # List of FileType values to filter by
) -> List[FileEntry]:  # List of FileEntry objects matching the types
    "Get files filtered by specific file types."
```

``` python
@patch
def get_url(
    self: FileBrowser,
    file_path: str  # Full path to the file
) -> Optional[str]:  # URL path to access the file, or None if not in a mounted directory
    "Get URL for a file."
```

``` python
@patch
def clear_cache(
    self: FileBrowser
) -> None
    "Clear the scan cache."
```

``` python
@patch
def get_summary(
    self: FileBrowser
) -> dict:  # Dictionary with file counts, sizes, and breakdowns
    "Get summary statistics for scanned files."
```

``` python
@patch
def create_pagination(
    self: FileBrowser,
    pagination_id: str,  # Unique identifier for this pagination instance
    content_id: str,  # HTML ID for the content area
    preview_route_func = None,  # Optional function to generate preview route URL
    modal_id: str = "fb-preview-modal"  # ID for the preview modal
):  # Configured Pagination instance
    "Create a pagination instance for browsing files."
```

``` python
@patch
def get_pagination_router(
    self: FileBrowser,
    prefix: str  # URL prefix for pagination routes
) -> Optional[APIRouter]:  # APIRouter for pagination, or None if pagination not created
    "Get the pagination router for registration with the app."
```

``` python
@patch
def create_file_selection_pagination(
    self: FileBrowser,
    pagination_id: str,  # Unique identifier for this pagination instance
    content_id: str,  # HTML ID for the content area
    preview_url_func = None,  # Function that takes file index and returns preview URL
    preview_target_id: str = None,  # HTML ID to target for preview modal
    file_type_filter: Optional[List[FileType]] = None  # Optional filter to only show certain file types
):  # Configured Pagination instance for file selection
    "Create a pagination instance for file selection table with radio buttons."
```

``` python
@patch
def get_file_selection_router(
    self: FileBrowser,
    prefix: str  # URL prefix for pagination routes
) -> Optional[APIRouter]:  # APIRouter for file selection pagination, or None if not created
    "Get the file selection pagination router."
```

#### Classes

``` python
class FileBrowser:
    def __init__(
        self,
        config: BrowserConfig  # Browser configuration with directories and settings
    )
    "Unified interface for file scanning, mounting, and browsing."
    
    def __init__(
            self,
            config: BrowserConfig  # Browser configuration with directories and settings
        )
        "Initialize the file browser."
    
    def pagination(self):
            """Access to the pagination instance."""
            return self._pagination
    
        @property
        def pagination_router(self) -> Optional[APIRouter]
        "Access to the pagination instance."
    
    def pagination_router(self) -> Optional[APIRouter]:
            """Access to the pagination router."""
            return self._pagination_router
    
        @property
        def file_selection_pagination(self)
        "Access to the pagination router."
    
    def file_selection_pagination(self):
            """Access to the file selection pagination instance."""
            return getattr(self, '_file_selection_pagination', None)
    
        @property
        def file_selection_router(self) -> Optional[APIRouter]
        "Access to the file selection pagination instance."
    
    def file_selection_router(self) -> Optional[APIRouter]
        "Access to the file selection pagination router."
```

### HTML IDs (`html_ids.ipynb`)

> Centralized HTML ID constants for file browser components

#### Import

``` python
from cjm_fasthtml_file_browser.core.html_ids import (
    FileBrowserHtmlIds
)
```

#### Classes

``` python
class FileBrowserHtmlIds(InteractionHtmlIds):
    "HTML ID constants for file browser components."
    
    def file_radio(
            index: int  # File index in the selection list
        ) -> str:  # HTML ID for the file radio button
        "Generate HTML ID for a file radio button."
    
    def file_row(
            index: int  # File index in the list
        ) -> str:  # HTML ID for the file row
        "Generate HTML ID for a file row element."
```

### File Models (`models.ipynb`)

> Data models for discovered files

#### Import

``` python
from cjm_fasthtml_file_browser.core.models import (
    FileEntry
)
```

#### Classes

``` python
@dataclass
class FileEntry:
    "Represents a discovered file for display and processing."
    
    path: str  # Full path to the file
    name: str  # Display name of the file
    extension: str  # File extension (without dot)
    size: int  # Size in bytes
    size_str: str  # Human-readable size (e.g., "15.2 MB")
    modified: float  # Modification timestamp
    modified_str: str  # Human-readable modification date
    file_type: FileType  # File type category (audio, video, image, etc.)
    directory: str  # Parent directory path
```

### Directory Mounter (`mounter.ipynb`)

> Mounts directories as static files for serving through the web server

#### Import

``` python
from cjm_fasthtml_file_browser.serving.mounter import (
    DirectoryMounter
)
```

#### Functions

``` python
@patch
def mount(
    self: DirectoryMounter,
    app,  # FastHTML/Starlette application instance
    directories: List[str]  # List of directory paths to mount
) -> None
    "Mount directories to app for static file serving."
```

``` python
@patch
def get_url(
    self: DirectoryMounter,
    file_path: str  # Full path to the file
) -> Optional[str]:  # URL to access the file, or None if not in a mounted directory
    "Get URL for a file based on mounted directories."
```

``` python
@patch
def is_mounted(
    self: DirectoryMounter,
    directory: str  # Directory path to check
) -> bool:  # True if the directory is mounted
    "Check if a directory is currently mounted."
```

``` python
@patch
def get_mounted_directories(
    self: DirectoryMounter
) -> List[str]:  # List of mounted directory paths
    "Get list of currently mounted directories."
```

``` python
@patch
def unmount_all(
    self: DirectoryMounter
) -> None
    "Remove all mounts from this instance."
```

``` python
@patch
def _mount_directory(
    self: DirectoryMounter, 
    app,  # FastHTML/Starlette application instance
    directory: str  # Directory path to mount
) -> None
    "Mount a single directory."
```

``` python
@patch
def _generate_prefix(
    self: DirectoryMounter, 
    directory: str  # Directory path
) -> str:  # Route prefix string (e.g., "fb_static_abc12345")
    "Generate a unique route prefix for a directory using MD5 hash."
```

``` python
@patch
def _remove_existing_mounts(
    self: DirectoryMounter, 
    app  # FastHTML/Starlette application instance
) -> None
    "Remove existing mounts matching this mounter's prefix pattern."
```

#### Classes

``` python
class DirectoryMounter:
    def __init__(self):
        """Initialize the mounter with empty state."""
        self._mounted: Dict[str, str] = {}  # directory -> route_prefix
    "Mounts directories for static file serving with instance-level state."
    
    def __init__(self):
            """Initialize the mounter with empty state."""
            self._mounted: Dict[str, str] = {}  # directory -> route_prefix
        "Initialize the mounter with empty state."
```

### Preview Components (`preview.ipynb`)

> Modal dialog for previewing files with type-specific players

#### Import

``` python
from cjm_fasthtml_file_browser.components.preview import (
    file_preview_modal
)
```

#### Functions

``` python
def file_preview_modal(
    file: FileEntry,  # FileEntry to preview
    file_url: Optional[str],  # URL to the file for playback/display
    modal_id: str = "fb-preview-modal"  # ID for the modal element
) -> FT:  # Modal dialog with file preview
    "Create a modal dialog for previewing files with type-specific players."
```

``` python
def _render_preview_content(
    file: FileEntry,  # FileEntry to preview
    file_url: str  # URL to the file
) -> FT:  # Preview content element
    "Render type-specific preview content."
```

### File Scanner (`scanner.ipynb`)

> Scans directories for files with caching support

#### Import

``` python
from cjm_fasthtml_file_browser.discovery.scanner import (
    FileScanner
)
```

#### Functions

``` python
@patch
def _is_cache_valid(
    self: FileScanner
) -> bool:  # True if cache exists and hasn't expired
    "Check if cache is still valid."
```

``` python
@patch
def clear_cache(
    self: FileScanner
) -> None
    "Clear the scan cache."
```

``` python
@patch
def _update_cache(
    self: FileScanner, 
    files: List[FileEntry]  # List of scanned FileEntry objects
) -> None
    "Update cache with new scan results."
```

``` python
@patch
def _scan_directories(
    self: FileScanner
) -> List[FileEntry]:  # List of FileEntry objects matching the configuration
    "Perform actual directory scan."
```

``` python
@patch
def _sort_files(
    self: FileScanner,
    files: List[FileEntry]  # Files to sort
) -> List[FileEntry]:  # Sorted files
    "Sort files according to configuration."
```

``` python
@patch
def scan(
    self: FileScanner, 
    force_refresh: bool = False  # Force a fresh scan, ignoring cache
) -> List[FileEntry]:  # List of FileEntry objects
    "Scan for files, using cache if valid."
```

``` python
@patch
def get_summary(
    self: FileScanner
) -> Dict[str, Any]:  # Dictionary with total count, size, and breakdowns by type/extension
    "Get summary statistics for scanned files."
```

#### Classes

``` python
class FileScanner:
    def __init__(
        self,
        config: BrowserConfig  # Browser configuration with directories and filters
    )
    "Scans directories for files with instance-level caching."
    
    def __init__(
            self,
            config: BrowserConfig  # Browser configuration with directories and filters
        )
        "Initialize the scanner."
```

### File Selection Pagination (`selection_pagination.ipynb`)

> Factory function for creating paginated file selection table with
> radio buttons

#### Import

``` python
from cjm_fasthtml_file_browser.patterns.selection_pagination import (
    create_selection_pagination
)
```

#### Functions

``` python
def _escape_js(
    s: str  # String to escape
) -> str:  # Escaped string safe for JavaScript
    "Escape a string for use in JavaScript."
```

``` python
def _render_file_row(
    file: FileEntry,  # FileEntry to render
    idx: int,  # Global index of this file (across all pages)
    selected_file: Optional[str],  # Currently selected file path (if any)
    preview_url_func: Optional[Callable[[int], str]],  # Function to generate preview URL
    preview_target_id: Optional[str]  # Target ID for preview modal
) -> FT:  # Table row element
    "Render a single file row in the selection table."
```

``` python
def create_selection_pagination(
    pagination_id: str,  # Unique identifier for this pagination instance
    scanner: FileScanner,  # FileScanner instance for loading files
    items_per_page: int = 30,  # Number of items per page
    content_id: Optional[str] = None,  # HTML ID for content area
    preview_url_func: Optional[Callable[[int], str]] = None,  # Function that takes file index and returns preview URL
    preview_target_id: Optional[str] = None,  # HTML ID to target for preview modal
    file_type_filter: Optional[List[FileType]] = None  # Optional filter to only show certain file types
) -> Pagination:  # Configured Pagination instance for file selection
    "Create a Pagination instance for file selection with radio buttons."
```

### File Types (`types.ipynb`)

> File type definitions, icon registry, and extension mapping for the
> file browser

#### Import

``` python
from cjm_fasthtml_file_browser.core.types import (
    DEFAULT_TYPE_CONFIGS,
    DEFAULT_EXTENSION_MAP,
    ICON_REGISTRY,
    FILE_TYPE_BADGE_COLORS,
    FileType,
    FileTypeConfig,
    build_extension_map,
    get_file_type,
    video_icon,
    audio_icon,
    image_icon,
    document_icon,
    other_icon,
    get_file_icon,
    get_badge_color
)
```

#### Functions

``` python
def build_extension_map(
    type_configs: Dict[FileType, FileTypeConfig]  # Type configurations to build map from
) -> Dict[str, FileType]:  # Mapping of extension to FileType
    "Build a mapping from file extensions to file types."
```

``` python
def get_file_type(
    extension: str,  # File extension (with or without dot)
    extension_map: Optional[Dict[str, FileType]] = None  # Custom extension map
) -> FileType:  # The corresponding FileType
    "Get the FileType for a given extension."
```

``` python
def _create_icon_svg(
    *children,  # SVG child elements
    cls: str = ""  # Additional CSS classes
) -> FT:  # SVG element
    "Create a base SVG icon with consistent styling."
```

``` python
def video_icon(cls: str = "") -> FT:  # SVG icon element
    "Video file icon."
```

``` python
def audio_icon(cls: str = "") -> FT:  # SVG icon element
    "Audio file icon."
```

``` python
def image_icon(cls: str = "") -> FT:  # SVG icon element
    "Image file icon."
```

``` python
def document_icon(cls: str = "") -> FT:  # SVG icon element
    "Document file icon."
```

``` python
def other_icon(cls: str = "") -> FT:  # SVG icon element
    "Generic file icon for unknown types."
```

``` python
def get_file_icon(
    file_type: FileType,  # The file type to get icon for
    cls: str = ""  # CSS classes to apply
) -> FT:  # SVG icon element
    "Get the icon for a file type."
```

``` python
def get_badge_color(
    file_type: FileType  # The file type
) -> str:  # Badge color class string
    "Get the badge color class for a file type."
```

#### Classes

``` python
class FileType(str, Enum):
    "Supported file type categories."
```

``` python
@dataclass
class FileTypeConfig:
    "Configuration for a file type category."
    
    file_type: FileType  # The file type this config is for
    extensions: List[str]  # File extensions (without dot)
    label: str  # Display label (e.g., "Audio", "Video")
    preview_supported: bool = True  # Whether preview is supported
    enabled: bool = True  # Whether this type is enabled for scanning
```

#### Variables

``` python
DEFAULT_TYPE_CONFIGS: Dict[FileType, FileTypeConfig]
DEFAULT_EXTENSION_MAP: Dict[str, FileType]
ICON_REGISTRY: Dict[FileType, Callable[[str], FT]]
FILE_TYPE_BADGE_COLORS: Dict[FileType, str]
```

### File Utilities (`utils.ipynb`)

> Formatting utilities for file discovery and display

#### Import

``` python
from cjm_fasthtml_file_browser.discovery.utils import (
    format_file_size,
    format_timestamp,
    matches_patterns
)
```

#### Functions

``` python
def format_file_size(
    size_bytes: int  # Size in bytes
) -> str:  # Human-readable size string (e.g., "15.2 MB")
    "Format file size in human-readable format."
```

``` python
def format_timestamp(
    timestamp: float  # Unix timestamp
) -> str:  # Human-readable date string
    "Format timestamp to human-readable date with relative time for recent files."
```

``` python
def matches_patterns(
    path: str,  # File path to check
    patterns: List[str]  # List of glob patterns to match against
) -> bool:  # True if path matches any pattern
    "Check if path matches any of the exclude patterns."
```
