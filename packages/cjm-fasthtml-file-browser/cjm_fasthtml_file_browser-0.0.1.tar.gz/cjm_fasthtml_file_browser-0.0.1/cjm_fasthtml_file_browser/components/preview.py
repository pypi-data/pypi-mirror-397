"""Modal dialog for previewing files with type-specific players"""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/components/preview.ipynb.

# %% auto 0
__all__ = ['file_preview_modal']

# %% ../../nbs/components/preview.ipynb 3
from typing import Optional
from fasthtml.common import *

from cjm_fasthtml_daisyui.components.data_display.badge import badge
from cjm_fasthtml_daisyui.utilities.semantic_colors import bg_dui, text_dui
from cjm_fasthtml_daisyui.utilities.border_radius import border_radius
from cjm_fasthtml_tailwind.utilities.spacing import p, m
from cjm_fasthtml_tailwind.utilities.sizing import w, max_w
from cjm_fasthtml_tailwind.utilities.typography import font_size, font_weight, text_align
from cjm_fasthtml_tailwind.core.base import combine_classes

from cjm_fasthtml_interactions.patterns.modal_dialog import ModalDialog, ModalSize

from ..core.types import FileType, get_badge_color
from ..core.models import FileEntry

# %% ../../nbs/components/preview.ipynb 5
def file_preview_modal(
    file: FileEntry,  # FileEntry to preview
    file_url: Optional[str],  # URL to the file for playback/display
    modal_id: str = "fb-preview-modal"  # ID for the modal element
) -> FT:  # Modal dialog with file preview
    """Create a modal dialog for previewing files with type-specific players."""
    badge_color = get_badge_color(file.file_type)
    
    # Build modal content
    modal_content = Div(
        # Modal header
        H3(file.name,
           cls=combine_classes(font_size.lg, font_weight.bold, m.b(4))),

        # File details
        Div(
            Div(
                Strong("Type: "),
                Span(
                    file.file_type.value.capitalize(),
                    cls=combine_classes(badge, badge_color)
                ),
                cls=str(m.b(2))
            ),
            Div(Strong("Extension: "), file.extension.upper(), cls=str(m.b(2))),
            Div(Strong("Size: "), file.size_str, cls=str(m.b(2))),
            Div(Strong("Modified: "), file.modified_str, cls=str(m.b(2))),
            Div(
                Strong("Path: "),
                Code(file.path, cls=combine_classes(font_size.xs, text_dui.base_content.opacity(80))),
                cls=str(m.b(4))
            ),
            cls=str(m.b(4))
        ),

        # File preview based on type
        _render_preview_content(file, file_url) if file_url else None,
    )

    return ModalDialog(
        modal_id=modal_id,
        content=modal_content,
        size=ModalSize.LARGE,
        auto_show=True,
        show_close_button=True,
        close_on_backdrop=True
    )

# %% ../../nbs/components/preview.ipynb 7
def _render_preview_content(
    file: FileEntry,  # FileEntry to preview
    file_url: str  # URL to the file
) -> FT:  # Preview content element
    """Render type-specific preview content."""
    preview_container_cls = combine_classes(
        p(4),
        bg_dui.base_200,
        border_radius.box,
        m.b(4)
    )
    
    if file.file_type == FileType.VIDEO:
        return Div(
            Video(
                Source(src=file_url, type=f"video/{file.extension}"),
                controls=True,
                cls=combine_classes(w.full, max_w._2xl, m.x.auto)
            ),
            cls=preview_container_cls
        )
    
    elif file.file_type == FileType.AUDIO:
        return Div(
            Audio(
                Source(src=file_url, type=f"audio/{file.extension}"),
                controls=True,
                cls=str(w.full)
            ),
            cls=preview_container_cls
        )
    
    elif file.file_type == FileType.IMAGE:
        return Div(
            Img(
                src=file_url,
                alt=file.name,
                cls=combine_classes(max_w.full, m.x.auto)
            ),
            cls=preview_container_cls
        )
    
    else:
        # No preview available for this type
        return Div(
            P(
                f"Preview not available for {file.file_type.value} files",
                cls=combine_classes(text_align.center, text_dui.base_content.opacity(60))
            ),
            cls=preview_container_cls
        )
