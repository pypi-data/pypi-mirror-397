"""UI components for file browser views (grid, list, controls)"""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/components/browser.ipynb.

# %% auto 0
__all__ = ['grid_view_content', 'list_view_content', 'empty_browser_content', 'browser_controls']

# %% ../../nbs/components/browser.ipynb 3
from typing import List, Optional
from fasthtml.common import *

from cjm_fasthtml_daisyui.components.actions.button import btn, btn_colors, btn_sizes, btn_styles
from cjm_fasthtml_daisyui.components.data_display.card import card, card_body, card_actions
from cjm_fasthtml_daisyui.components.data_display.table import table, table_modifiers
from cjm_fasthtml_daisyui.components.data_display.badge import badge, badge_sizes
from cjm_fasthtml_daisyui.components.navigation.pagination import join
from cjm_fasthtml_daisyui.utilities.semantic_colors import bg_dui, text_dui, border_dui
from cjm_fasthtml_daisyui.utilities.border_radius import border_radius
from cjm_fasthtml_tailwind.utilities.spacing import p, m
from cjm_fasthtml_tailwind.utilities.sizing import w, h, max_w
from cjm_fasthtml_tailwind.utilities.typography import font_size, font_weight, text_align
from cjm_fasthtml_tailwind.utilities.flexbox_and_grid import (
    flex_display, gap, items, justify, grid_display, grid_cols
)
from cjm_fasthtml_tailwind.utilities.layout import overflow
from cjm_fasthtml_tailwind.utilities.borders import border
from cjm_fasthtml_tailwind.core.base import combine_classes

from ..core.types import FileType, get_file_icon, get_badge_color
from ..core.models import FileEntry
from ..serving.mounter import DirectoryMounter

# %% ../../nbs/components/browser.ipynb 6
def grid_view_content(
    files: List[FileEntry],  # List of files to display
    mounter: DirectoryMounter,  # DirectoryMounter instance for URL generation
    start_idx: int = 0,  # Starting index for item numbering
    file_type_filter: Optional[str] = None,  # Current filter type for maintaining state
    preview_route_func = None,  # Function to generate preview route URL
    modal_id: str = "fb-preview-modal"  # ID for the preview modal
) -> FT:  # Grid container with file cards
    """Render files as cards in a responsive grid layout."""
    return Div(
        *[
            Div(
                Div(
                    # File type badge
                    Div(
                        Span(
                            file.file_type.value.upper(),
                            cls=combine_classes(
                                badge,
                                get_badge_color(file.file_type),
                                badge_sizes.xs
                            )
                        ),
                        cls=combine_classes(flex_display, justify.end, m.b(2))
                    ),

                    # File icon based on type
                    Div(
                        get_file_icon(
                            file.file_type,
                            cls=combine_classes(w(16), h(16), m.x.auto)
                        ),
                        cls=combine_classes(
                            text_align.center,
                            p(8),
                            bg_dui.base_200,
                            border_radius.box,
                            m.b(4)
                        )
                    ),

                    # File info
                    H3(
                        file.name[:30] + "..." if len(file.name) > 30 else file.name,
                        title=file.name,
                        cls=combine_classes(font_weight.bold, m.b(2))
                    ),
                    P(file.size_str, cls=combine_classes(text_dui.base_content.opacity(70), font_size.sm)),
                    P(file.modified_str, cls=combine_classes(text_dui.base_content.opacity(70), font_size.sm)),

                    # Actions
                    Div(
                        Button(
                            "Preview",
                            hx_get=preview_route_func(idx=start_idx + idx, file_type=file_type_filter) if preview_route_func else "#",
                            hx_target=f"#{modal_id}",
                            hx_swap="innerHTML",
                            cls=combine_classes(btn, btn_colors.primary, btn_sizes.sm, w.full)
                        ) if preview_route_func else None,
                        cls=combine_classes(card_actions, m.t(4))
                    ),
                    cls=str(card_body)
                ),
                cls=combine_classes(
                    card,
                    bg_dui.base_100,
                    border(),
                    border_dui.base_300
                )
            )
            for idx, file in enumerate(files)
        ],
        cls=combine_classes(
            grid_display,
            grid_cols(1),
            grid_cols(2).md,
            grid_cols(3).lg,
            grid_cols(4).xl,
            gap(4)
        )
    )

# %% ../../nbs/components/browser.ipynb 9
def list_view_content(
    files: List[FileEntry],  # List of files to display
    mounter: DirectoryMounter,  # DirectoryMounter instance for URL generation
    start_idx: int = 0,  # Starting index for item numbering
    file_type_filter: Optional[str] = None,  # Current filter type for maintaining state
    preview_route_func = None,  # Function to generate preview route URL
    modal_id: str = "fb-preview-modal"  # ID for the preview modal
) -> FT:  # Table with file rows
    """Render files as rows in a table."""
    return Div(
        Table(
            Thead(
                Tr(
                    Th("#"),
                    Th("Name"),
                    Th("Type"),
                    Th("Extension"),
                    Th("Size"),
                    Th("Modified"),
                    Th("Actions") if preview_route_func else None
                )
            ),
            Tbody(
                *[
                    Tr(
                        Td(str(start_idx + idx + 1)),
                        Td(
                            file.name[:40] + "..." if len(file.name) > 40 else file.name,
                            title=file.name
                        ),
                        Td(
                            Span(
                                file.file_type.value,
                                cls=combine_classes(
                                    badge,
                                    get_badge_color(file.file_type),
                                    badge_sizes.sm
                                )
                            )
                        ),
                        Td(file.extension.upper()),
                        Td(file.size_str),
                        Td(file.modified_str),
                        Td(
                            Button(
                                "Preview",
                                hx_get=preview_route_func(idx=start_idx + idx, file_type=file_type_filter) if preview_route_func else "#",
                                hx_target=f"#{modal_id}",
                                hx_swap="innerHTML",
                                cls=combine_classes(btn, btn_styles.ghost, btn_sizes.xs)
                            )
                        ) if preview_route_func else None,
                        cls=str(bg_dui.base_300.hover)
                    )
                    for idx, file in enumerate(files)
                ]
            ),
            cls=combine_classes(
                table,
                table_modifiers.zebra,
                w.full
            )
        ),
        cls=combine_classes(
            overflow.x.auto,
            bg_dui.base_100,
            border_radius.box
        )
    )

# %% ../../nbs/components/browser.ipynb 11
def empty_browser_content(
    message: str = "No files found.",  # Message to display
    action_url: Optional[str] = None,  # Optional URL for action button
    action_text: str = "Configure Settings"  # Text for action button
) -> FT:  # Empty state container
    """Render empty state display when no files are found."""
    content = [
        P(message, cls=combine_classes(text_align.center, p(8), text_dui.base_content.opacity(60)))
    ]

    if action_url:
        content.append(
            Div(
                A(
                    action_text,
                    href=action_url,
                    cls=combine_classes(btn, btn_colors.primary)
                ),
                cls=str(text_align.center)
            )
        )

    return Div(*content)

# %% ../../nbs/components/browser.ipynb 13
def browser_controls(
    view_mode: str,  # Current view mode ("grid" or "list")
    file_type_filter: Optional[str],  # Current file type filter
    enabled_types: List[FileType],  # List of enabled file types for filter buttons
    change_view_url_func,  # Function to generate URL for view change
    change_filter_url_func,  # Function to generate URL for filter change
    content_target_id: str  # ID of content container to target
) -> FT:  # Controls bar element
    """Render control bar for file browser with view mode toggle and file type filter."""
    
    # Build filter buttons based on enabled types
    filter_buttons = [
        A(
            "All",
            hx_get=change_filter_url_func(file_type="all"),
            hx_target=f"#{content_target_id}",
            hx_swap="outerHTML",
            cls=combine_classes(
                btn,
                btn_sizes.sm,
                btn_colors.primary if (not file_type_filter or file_type_filter == "all") else btn_styles.ghost
            )
        )
    ]
    
    for file_type in enabled_types:
        filter_buttons.append(
            A(
                file_type.value.capitalize(),
                hx_get=change_filter_url_func(file_type=file_type.value),
                hx_target=f"#{content_target_id}",
                hx_swap="outerHTML",
                cls=combine_classes(
                    btn,
                    btn_sizes.sm,
                    btn_colors.primary if file_type_filter == file_type.value else btn_styles.ghost
                )
            )
        )
    
    return Div(
        # View mode selector
        Div(
            Label("View:", cls=str(m.r(2))),
            Div(
                A(
                    "Grid",
                    hx_get=change_view_url_func(view="grid"),
                    hx_target=f"#{content_target_id}",
                    hx_swap="outerHTML",
                    cls=combine_classes(
                        btn,
                        btn_sizes.sm,
                        btn_colors.primary if view_mode == "grid" else btn_styles.ghost
                    )
                ),
                A(
                    "List",
                    hx_get=change_view_url_func(view="list"),
                    hx_target=f"#{content_target_id}",
                    hx_swap="outerHTML",
                    cls=combine_classes(
                        btn,
                        btn_sizes.sm,
                        btn_colors.primary if view_mode == "list" else btn_styles.ghost
                    )
                ),
                cls=str(join)
            ),
            cls=combine_classes(flex_display, items.center)
        ),

        # File type filter
        Div(
            Label("Filter:", cls=str(m.r(2))),
            Div(*filter_buttons, cls=str(join)),
            cls=combine_classes(flex_display, items.center)
        ),

        cls=combine_classes(
            flex_display,
            justify.between,
            items.center,
            m.b(4),
            p(3),
            bg_dui.base_200,
            border_radius.box
        )
    )
