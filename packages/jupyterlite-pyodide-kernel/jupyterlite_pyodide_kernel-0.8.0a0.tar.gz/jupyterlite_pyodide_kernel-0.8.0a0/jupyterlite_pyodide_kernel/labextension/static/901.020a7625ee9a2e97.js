"use strict";(self.webpackChunk_jupyterlite_pyodide_kernel_extension=self.webpackChunk_jupyterlite_pyodide_kernel_extension||[]).push([["901"],{4(e,t,i){i.d(t,{U:()=>Z,a:()=>G});var r=Object.create,n=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,h=(e,t)=>()=>(e&&(t=e(e=0)),t),u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),d=u((e,t)=>{var i,r;i=e,r=function(e){var t;function i(e,t){let i=0;for(let r of e)if(!1===t(r,i++))return!1;return!0}e.ArrayExt=void 0,function(e){function t(e,i,r=0,n=-1){let s,a=e.length;if(0===a)return -1;r=r<0?Math.max(0,r+a):Math.min(r,a-1),s=(n=n<0?Math.max(0,n+a):Math.min(n,a-1))<r?n+1+(a-r):n-r+1;for(let t=0;t<s;++t){let n=(r+t)%a;if(e[n]===i)return n}return -1}function i(e,t,r=-1,n=0){let s,a=e.length;if(0===a)return -1;s=(r=r<0?Math.max(0,r+a):Math.min(r,a-1))<(n=n<0?Math.max(0,n+a):Math.min(n,a-1))?r+1+(a-n):r-n+1;for(let i=0;i<s;++i){let n=(r-i+a)%a;if(e[n]===t)return n}return -1}function r(e,t,i=0,n=-1){let s,a=e.length;if(0===a)return -1;i=i<0?Math.max(0,i+a):Math.min(i,a-1),s=(n=n<0?Math.max(0,n+a):Math.min(n,a-1))<i?n+1+(a-i):n-i+1;for(let r=0;r<s;++r){let n=(i+r)%a;if(t(e[n],n))return n}return -1}function n(e,t,i=-1,r=0){let s,a=e.length;if(0===a)return -1;s=(i=i<0?Math.max(0,i+a):Math.min(i,a-1))<(r=r<0?Math.max(0,r+a):Math.min(r,a-1))?i+1+(a-r):i-r+1;for(let r=0;r<s;++r){let n=(i-r+a)%a;if(t(e[n],n))return n}return -1}function s(e,t=0,i=-1){let r=e.length;if(!(r<=1))for(t=t<0?Math.max(0,t+r):Math.min(t,r-1),i=i<0?Math.max(0,i+r):Math.min(i,r-1);t<i;){let r=e[t],n=e[i];e[t++]=n,e[i--]=r}}function a(e,t){let i=e.length;if(t<0&&(t+=i),t<0||t>=i)return;let r=e[t];for(let r=t+1;r<i;++r)e[r-1]=e[r];return e.length=i-1,r}e.firstIndexOf=t,e.lastIndexOf=i,e.findFirstIndex=r,e.findLastIndex=n,e.findFirstValue=function(e,t,i=0,n=-1){let s=r(e,t,i,n);return -1!==s?e[s]:void 0},e.findLastValue=function(e,t,i=-1,r=0){let s=n(e,t,i,r);return -1!==s?e[s]:void 0},e.lowerBound=function(e,t,i,r=0,n=-1){let s=e.length;if(0===s)return 0;r=r<0?Math.max(0,r+s):Math.min(r,s-1),n=n<0?Math.max(0,n+s):Math.min(n,s-1);let a=r,o=n-r+1;for(;o>0;){let r=o>>1,n=a+r;0>i(e[n],t)?(a=n+1,o-=r+1):o=r}return a},e.upperBound=function(e,t,i,r=0,n=-1){let s=e.length;if(0===s)return 0;r=r<0?Math.max(0,r+s):Math.min(r,s-1),n=n<0?Math.max(0,n+s):Math.min(n,s-1);let a=r,o=n-r+1;for(;o>0;){let r=o>>1,n=a+r;i(e[n],t)>0?o=r:(a=n+1,o-=r+1)}return a},e.shallowEqual=function(e,t,i){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(i?!i(e[r],t[r]):e[r]!==t[r])return!1;return!0},e.slice=function(e,t={}){let i,{start:r,stop:n,step:s}=t;if(void 0===s&&(s=1),0===s)throw Error("Slice `step` cannot be zero.");let a=e.length;void 0===r?r=s<0?a-1:0:r<0?r=Math.max(r+a,s<0?-1:0):r>=a&&(r=s<0?a-1:a),void 0===n?n=s<0?-1:a:n<0?n=Math.max(n+a,s<0?-1:0):n>=a&&(n=s<0?a-1:a),i=s<0&&n>=r||s>0&&r>=n?0:s<0?Math.floor((n-r+1)/s+1):Math.floor((n-r-1)/s+1);let o=[];for(let t=0;t<i;++t)o[t]=e[r+t*s];return o},e.move=function(e,t,i){let r=e.length;if(r<=1||(t=t<0?Math.max(0,t+r):Math.min(t,r-1))===(i=i<0?Math.max(0,i+r):Math.min(i,r-1)))return;let n=e[t],s=t<i?1:-1;for(let r=t;r!==i;r+=s)e[r]=e[r+s];e[i]=n},e.reverse=s,e.rotate=function(e,t,i=0,r=-1){let n=e.length;if(n<=1||(i=i<0?Math.max(0,i+n):Math.min(i,n-1))>=(r=r<0?Math.max(0,r+n):Math.min(r,n-1)))return;let a=r-i+1;if(t>0?t%=a:t<0&&(t=(t%a+a)%a),0===t)return;let o=i+t;s(e,i,o-1),s(e,o,r),s(e,i,r)},e.fill=function(e,t,i=0,r=-1){let n,s=e.length;if(0!==s){i=i<0?Math.max(0,i+s):Math.min(i,s-1),n=(r=r<0?Math.max(0,r+s):Math.min(r,s-1))<i?r+1+(s-i):r-i+1;for(let r=0;r<n;++r)e[(i+r)%s]=t}},e.insert=function(e,t,i){let r=e.length;t=t<0?Math.max(0,t+r):Math.min(t,r);for(let i=r;i>t;--i)e[i]=e[i-1];e[t]=i},e.removeAt=a,e.removeFirstOf=function(e,i,r=0,n=-1){let s=t(e,i,r,n);return -1!==s&&a(e,s),s},e.removeLastOf=function(e,t,r=-1,n=0){let s=i(e,t,r,n);return -1!==s&&a(e,s),s},e.removeAllOf=function(e,t,i=0,r=-1){let n=e.length;if(0===n)return 0;i=i<0?Math.max(0,i+n):Math.min(i,n-1),r=r<0?Math.max(0,r+n):Math.min(r,n-1);let s=0;for(let a=0;a<n;++a)i<=r&&a>=i&&a<=r&&e[a]===t||r<i&&(a<=r||a>=i)&&e[a]===t?s++:s>0&&(e[a-s]=e[a]);return s>0&&(e.length=n-s),s},e.removeFirstWhere=function(e,t,i=0,n=-1){let s,o=r(e,t,i,n);return -1!==o&&(s=a(e,o)),{index:o,value:s}},e.removeLastWhere=function(e,t,i=-1,r=0){let s,o=n(e,t,i,r);return -1!==o&&(s=a(e,o)),{index:o,value:s}},e.removeAllWhere=function(e,t,i=0,r=-1){let n=e.length;if(0===n)return 0;i=i<0?Math.max(0,i+n):Math.min(i,n-1),r=r<0?Math.max(0,r+n):Math.min(r,n-1);let s=0;for(let a=0;a<n;++a)i<=r&&a>=i&&a<=r&&t(e[a],a)||r<i&&(a<=r||a>=i)&&t(e[a],a)?s++:s>0&&(e[a-s]=e[a]);return s>0&&(e.length=n-s),s}}(e.ArrayExt||(e.ArrayExt={})),(t||(t={})).rangeLength=function(e,t,i){return 0===i?1/0:e>t&&i>0||e<t&&i<0?0:Math.ceil((t-e)/i)},e.StringExt=void 0,function(e){function t(e,i,r=0){let n=Array(i.length);for(let t=0,s=r,a=i.length;t<a;++t,++s){if(-1===(s=e.indexOf(i[t],s)))return null;n[t]=s}return n}e.findIndices=t,e.matchSumOfSquares=function(e,i,r=0){let n=t(e,i,r);if(!n)return null;let s=0;for(let e=0,t=n.length;e<t;++e){let t=n[e]-r;s+=t*t}return{score:s,indices:n}},e.matchSumOfDeltas=function(e,i,r=0){let n=t(e,i,r);if(!n)return null;let s=0,a=r-1;for(let e=0,t=n.length;e<t;++e){let t=n[e];s+=t-a-1,a=t}return{score:s,indices:n}},e.highlight=function(e,t,i){let r=[],n=0,s=0,a=t.length;for(;n<a;){let o=t[n],l=t[n];for(;++n<a&&t[n]===l+1;)l++;s<o&&r.push(e.slice(s,o)),o<l+1&&r.push(i(e.slice(o,l+1))),s=l+1}return s<e.length&&r.push(e.slice(s)),r},e.cmp=function(e,t){return e<t?-1:+(e>t)}}(e.StringExt||(e.StringExt={})),e.chain=function*(...e){for(let t of e)yield*t},e.each=function(e,t){let i=0;for(let r of e)if(!1===t(r,i++))return},e.empty=function*(){},e.enumerate=function*(e,t=0){for(let i of e)yield[t++,i]},e.every=i,e.filter=function*(e,t){let i=0;for(let r of e)t(r,i++)&&(yield r)},e.find=function(e,t){let i=0;for(let r of e)if(t(r,i++))return r},e.findIndex=function(e,t){let i=0;for(let r of e)if(t(r,i++))return i-1;return -1},e.map=function*(e,t){let i=0;for(let r of e)yield t(r,i++)},e.max=function(e,t){let i;for(let r of e){if(void 0===i){i=r;continue}t(r,i)>0&&(i=r)}return i},e.min=function(e,t){let i;for(let r of e){if(void 0===i){i=r;continue}0>t(r,i)&&(i=r)}return i},e.minmax=function(e,t){let i=!0,r,n;for(let s of e)i?(r=s,n=s,i=!1):0>t(s,r)?r=s:t(s,n)>0&&(n=s);return i?void 0:[r,n]},e.once=function*(e){yield e},e.range=function*(e,i,r){void 0===i?(i=e,e=0,r=1):void 0===r&&(r=1);let n=t.rangeLength(e,i,r);for(let t=0;t<n;t++)yield e+r*t},e.reduce=function(e,t,i){let r,n,s=e[Symbol.iterator](),a=0,o=s.next();if(o.done&&void 0===i)throw TypeError("Reduce of empty iterable with no initial value.");if(o.done)return i;let l=s.next();if(l.done&&void 0===i)return o.value;if(l.done)return t(i,o.value,a++);for(r=t(void 0===i?o.value:t(i,o.value,a++),l.value,a++);!(n=s.next()).done;)r=t(r,n.value,a++);return r},e.repeat=function*(e,t){for(;0<t--;)yield e},e.retro=function*(e){if("function"==typeof e.retro)yield*e.retro();else for(let t=e.length-1;t>-1;t--)yield e[t]},e.some=function(e,t){let i=0;for(let r of e)if(t(r,i++))return!0;return!1},e.stride=function*(e,t){let i=0;for(let r of e)i++%t==0&&(yield r)},e.take=function*(e,t){if(t<1)return;let i=e[Symbol.iterator](),r;for(;0<t--&&!(r=i.next()).done;)yield r.value},e.toArray=function(e){return Array.from(e)},e.toObject=function(e){let t={};for(let[i,r]of e)t[i]=r;return t},e.topologicSort=function(e){let t=[],i=new Set,r=new Map;for(let t of e)!function(e){let[t,i]=e,n=r.get(i);n?n.push(t):r.set(i,[t])}(t);for(let[e]of r)!function e(n){if(i.has(n))return;i.add(n);let s=r.get(n);if(s)for(let t of s)e(t);t.push(n)}(e);return t},e.zip=function*(...e){let t=e.map(e=>e[Symbol.iterator]()),r=t.map(e=>e.next());for(;i(r,e=>!e.done);r=t.map(e=>e.next()))yield r.map(e=>e.value)}},"object"==typeof e&&void 0!==t?r(e):"function"==typeof define&&define.amd?define(["exports"],r):r((i="undefined"!=typeof globalThis?globalThis:i||self).lumino_algorithm={})}),f=u((e,t)=>{var i,r;i=e,r=function(e,t){let i;e.JSONExt=void 0,function(e){function t(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e}function i(e){return Array.isArray(e)}e.emptyObject=Object.freeze({}),e.emptyArray=Object.freeze([]),e.isPrimitive=t,e.isArray=i;e.isObject=function(e){return!t(e)&&!i(e)},e.deepEqual=function e(r,n){if(r===n)return!0;if(t(r)||t(n))return!1;let s=i(r),a=i(n);return s===a&&(s&&a?function(t,i){if(t===i)return!0;if(t.length!==i.length)return!1;for(let r=0,n=t.length;r<n;++r)if(!e(t[r],i[r]))return!1;return!0}(r,n):function(t,i){if(t===i)return!0;for(let e in t)if(void 0!==t[e]&&!(e in i))return!1;for(let e in i)if(void 0!==i[e]&&!(e in t))return!1;for(let r in t){let n=t[r],s=i[r];if((void 0!==n||void 0!==s)&&(void 0===n||void 0===s||!e(n,s)))return!1}return!0}(r,n))},e.deepCopy=function e(r){return t(r)?r:i(r)?function(t){let i=Array(t.length);for(let r=0,n=t.length;r<n;++r)i[r]=e(t[r]);return i}(r):function(t){let i={};for(let r in t){let n=t[r];void 0!==n&&(i[r]=e(n))}return i}(r)}}(e.JSONExt||(e.JSONExt={}));var r,n=r||(r={});class s{constructor(e){var t,i,r,n;this._activated=!1,this._promise=null,this._service=null,this.id=e.id,this.description=null!=(t=e.description)?t:"",this.activate=e.activate,this.deactivate=null!=(i=e.deactivate)?i:null,this.provides=null!=(r=e.provides)?r:null,this.autoStart=null!=(n=e.autoStart)&&n,this.requires=e.requires?e.requires.slice():[],this.optional=e.optional?e.optional.slice():[]}get activated(){return this._activated}set activated(e){this._activated=e}get service(){return this._service}set service(e){this._service=e}get promise(){return this._promise}set promise(e){this._promise=e}}n.createPluginData=function(e){return new s(e)},n.ensureNoCycle=function(e,t,i){let r=[...e.requires,...e.optional],n=r=>{if(r===e.provides)return!0;let a=i.get(r);if(!a)return!1;let o=t.get(a),l=[...o.requires,...o.optional];return 0!==l.length&&(s.push(a),!!l.some(n)||(s.pop(),!1))};if(!e.provides||0===r.length)return;let s=[e.id];if(r.some(n))throw ReferenceError(`Cycle detected: ${s.join(" -> ")}.`)},n.findDependents=function(e,i,r){let n=[],s=e=>{let t=i.get(e),s=[...t.requires,...t.optional];n.push(...s.reduce((t,i)=>{let n=r.get(i);return n&&t.push([e,n]),t},[]))};for(let e of i.keys())s(e);let a=n.filter(t=>t[1]===e),o=0;for(;a.length>o;){let e=a.length;for(let e of new Set(a.map(e=>e[0])))n.filter(t=>t[1]===e).forEach(e=>{a.includes(e)||a.push(e)});o=e}let l=t.topologicSort(a),h=l.findIndex(t=>t===e);return -1===h?[e]:l.slice(0,h+1)},n.collectStartupPlugins=function(e,t){let i=new Set;for(let t of e.keys())!0===e.get(t).autoStart&&i.add(t);if(t.startPlugins)for(let e of t.startPlugins)i.add(e);if(t.ignorePlugins)for(let e of t.ignorePlugins)i.delete(e);return Array.from(i)};e.Random=void 0,(e.Random||(e.Random={})).getRandomValues=(i="undefined"!=typeof window&&(window.crypto||window.msCrypto)||null)&&"function"==typeof i.getRandomValues?function(e){return i.getRandomValues(e)}:function(e){let t=0;for(let i=0,r=e.length;i<r;++i)i%4==0&&(t=0xffffffff*Math.random()>>>0),e[i]=255&t,t>>>=8},e.UUID=void 0,(e.UUID||(e.UUID={})).uuid4=function(e){let t=new Uint8Array(16),i=Array(256);for(let e=0;e<16;++e)i[e]="0"+e.toString(16);for(let e=16;e<256;++e)i[e]=e.toString(16);return function(){return e(t),t[6]=64|15&t[6],t[8]=128|63&t[8],i[t[0]]+i[t[1]]+i[t[2]]+i[t[3]]+"-"+i[t[4]]+i[t[5]]+"-"+i[t[6]]+i[t[7]]+"-"+i[t[8]]+i[t[9]]+"-"+i[t[10]]+i[t[11]]+i[t[12]]+i[t[13]]+i[t[14]]+i[t[15]]}}(e.Random.getRandomValues),e.MimeData=class{constructor(){this._types=[],this._values=[]}types(){return this._types.slice()}hasData(e){return -1!==this._types.indexOf(e)}getData(e){let t=this._types.indexOf(e);return -1!==t?this._values[t]:void 0}setData(e,t){this.clearData(e),this._types.push(e),this._values.push(t)}clearData(e){let t=this._types.indexOf(e);-1!==t&&(this._types.splice(t,1),this._values.splice(t,1))}clear(){this._types.length=0,this._values.length=0}},e.PluginRegistry=class{constructor(e={}){this._application=null,this._validatePlugin=()=>!0,this._plugins=new Map,this._services=new Map,e.validatePlugin&&(console.info("Plugins may be rejected by the custom validation plugin method."),this._validatePlugin=e.validatePlugin)}get application(){return this._application}set application(e){if(null!==this._application)throw Error("PluginRegistry.application is already set. It cannot be overridden.");this._application=e}get deferredPlugins(){return Array.from(this._plugins).filter(([e,t])=>"defer"===t.autoStart).map(([e,t])=>e)}getPluginDescription(e){var t,i;return null!=(i=null==(t=this._plugins.get(e))?void 0:t.description)?i:""}hasPlugin(e){return this._plugins.has(e)}isPluginActivated(e){var t,i;return null!=(i=null==(t=this._plugins.get(e))?void 0:t.activated)&&i}listPlugins(){return Array.from(this._plugins.keys())}registerPlugin(e){if(this._plugins.has(e.id))throw TypeError(`Plugin '${e.id}' is already registered.`);if(!this._validatePlugin(e))throw Error(`Plugin '${e.id}' is not valid.`);let t=r.createPluginData(e);r.ensureNoCycle(t,this._plugins,this._services),t.provides&&this._services.set(t.provides,t.id),this._plugins.set(t.id,t)}registerPlugins(e){for(let t of e)this.registerPlugin(t)}deregisterPlugin(e,t){let i=this._plugins.get(e);if(i){if(i.activated&&!t)throw Error(`Plugin '${e}' is still active.`);this._plugins.delete(e)}}async activatePlugin(e){let t=this._plugins.get(e);if(!t)throw ReferenceError(`Plugin '${e}' is not registered.`);if(t.activated)return;if(t.promise)return t.promise;let i=t.requires.map(e=>this.resolveRequiredService(e)),r=t.optional.map(e=>this.resolveOptionalService(e));return t.promise=Promise.all([...i,...r]).then(e=>t.activate.apply(void 0,[this.application,...e])).then(e=>{t.service=e,t.activated=!0,t.promise=null}).catch(e=>{throw t.promise=null,e}),t.promise}async activatePlugins(e,t={}){switch(e){case"defer":{let e=this.deferredPlugins.filter(e=>this._plugins.get(e).autoStart).map(e=>this.activatePlugin(e));await Promise.all(e);break}case"startUp":{let e=r.collectStartupPlugins(this._plugins,t).map(async e=>{try{return await this.activatePlugin(e)}catch(t){console.error(`Plugin '${e}' failed to activate.`,t)}});await Promise.all(e)}}}async deactivatePlugin(e){let t=this._plugins.get(e);if(!t)throw ReferenceError(`Plugin '${e}' is not registered.`);if(!t.activated)return[];if(!t.deactivate)throw TypeError(`Plugin '${e}'#deactivate() method missing`);let i=r.findDependents(e,this._plugins,this._services),n=i.map(e=>this._plugins.get(e));for(let t of n)if(!t.deactivate)throw TypeError(`Plugin ${t.id}#deactivate() method missing (depends on ${e})`);for(let e of n){let t=[...e.requires,...e.optional].map(e=>{let t=this._services.get(e);return t?this._plugins.get(t).service:null});await e.deactivate(this.application,...t),e.service=null,e.activated=!1}return i.pop(),i}async resolveRequiredService(e){let t=this._services.get(e);if(!t)throw TypeError(`No provider for: ${e.name}.`);let i=this._plugins.get(t);return i.activated||await this.activatePlugin(t),i.service}async resolveOptionalService(e){let t=this._services.get(e);if(!t)return null;let i=this._plugins.get(t);if(!i.activated)try{await this.activatePlugin(t)}catch(e){return console.error(e),null}return i.service}},e.PromiseDelegate=class{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){(0,this._resolve)(e)}reject(e){(0,this._reject)(e)}},e.Token=class{constructor(e,t){this.name=e,this.description=null!=t?t:"",this._tokenStructuralPropertyT=null}}},"object"==typeof e&&void 0!==t?r(e,d()):"function"==typeof define&&define.amd?define(["exports","@lumino/algorithm"],r):r((i="undefined"!=typeof globalThis?globalThis:i||self).lumino_coreutils={},i.lumino_algorithm)}),c=h(()=>{}),p={},m={BLOCK_SIZE:()=>v,ContentsAPI:()=>M,DRIVE_SEPARATOR:()=>y,DriveFS:()=>x,DriveFSEmscriptenNodeOps:()=>k,DriveFSEmscriptenStreamOps:()=>E,ServiceWorkerContentsAPI:()=>R};for(var g in m)n(p,g,{get:m[g],enumerable:!0});var _,y,v,P,w,b,E,k,M,R,x,S=h(()=>{let e,t;t=null!=(e=f())?r(o(e)):{},_=((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of a(t))l.call(e,i)||void 0===i||n(e,i,{get:()=>t[i],enumerable:!(r=s(t,i))||r.enumerable});return e})(e&&e.__esModule?t:n(t,"default",{value:e,enumerable:!0}),e),c(),y=":",v=4096,P=new TextEncoder,w=new TextDecoder("utf-8"),b={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0},E=class{constructor(e){this.fs=e}open(e){var t;let i=this.fs.realPath(e.node);if(this.fs.FS.isFile(e.node.mode))try{e.file=this.fs.API.get(i)}catch{let r=null!=(t=e.flags)?t:e.shared.flags,n="string"==typeof r?parseInt(r,10):r,s=!0;if((n&=8191)in b&&(s=b[n]),s)e.node=this.fs.node_ops.mknod(e.node.parent,e.node.name,e.node.mode,0),e.file=this.fs.API.get(i);else throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT)}}close(e){var t;if(!this.fs.FS.isFile(e.node.mode)||!e.file)return;let i=this.fs.realPath(e.node),r=null!=(t=e.flags)?t:e.shared.flags,n="string"==typeof r?parseInt(r,10):r,s=!0;(n&=8191)in b&&(s=b[n]),s&&this.fs.API.put(i,e.file),e.file=void 0}read(e,t,i,r,n){if(r<=0||void 0===e.file||n>=(e.file.data.length||0))return 0;let s=Math.min(e.file.data.length-n,r);return t.set(e.file.data.subarray(n,n+s),i),s}write(e,t,i,r,n){var s;if(r<=0||void 0===e.file)return 0;let a=Date.now();if(e.node.timestamp=a,e.node.atime=a,e.node.mtime=a,e.node.ctime=a,n+r>((null==(s=e.file)?void 0:s.data.length)||0)){let t=e.file.data?e.file.data:new Uint8Array;e.file.data=new Uint8Array(n+r),e.file.data.set(t)}return e.file.data.set(t.subarray(i,i+r),n),r}llseek(e,t,i){var r;let n=t;if(1===i)n+=null!=(r=e.position)?r:e.shared.position;else if(2===i&&this.fs.FS.isFile(e.node.mode))if(void 0!==e.file)n+=e.file.data.length;else throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);if(n<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return n}},k=class{constructor(e){this.node=e=>"node"in e?e.node:e,this.getattr=e=>{let t=this.node(e);return{...this.fs.API.getattr(this.fs.realPath(t)),mode:t.mode,ino:t.id}},this.setattr=(e,t)=>{let i=this.node(e);for(let[e,r]of Object.entries(t))switch(e){case"mode":i.mode=r;break;case"timestamp":i.timestamp=r;break;case"atime":i.atime=r;break;case"mtime":i.mtime=r;break;case"ctime":i.ctime=r;break;case"size":{let e=this.fs.realPath(i);if(this.fs.FS.isFile(i.mode)&&r>=0){let t;try{t=this.fs.API.get(e)}catch{break}let i=t.data?t.data:new Uint8Array;r!==i.length&&(r<i.length?t.data=t.data.slice(0,r):(t.data=new Uint8Array(r),t.data.set(i)),this.fs.API.put(e,t))}else console.warn("setattr size of",r,"on",i,"not yet implemented");break}case"dontFollow":break;default:console.warn("setattr",e,"of",r,"on",i,"not yet implemented")}},this.lookup=(e,t)=>{let i=this.node(e),r=this.fs.PATH.join2(this.fs.realPath(i),t),n=this.fs.API.lookup(r);if(!n.ok)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);return this.fs.createNode(i,t,n.mode,0)},this.mknod=(e,t,i,r)=>{let n=this.node(e),s=this.fs.PATH.join2(this.fs.realPath(n),t);return this.fs.API.mknod(s,i),this.fs.createNode(n,t,i,r)},this.rename=(e,t,i)=>{let r=this.node(e),n=this.node(t);this.fs.API.rename(r.parent?this.fs.PATH.join2(this.fs.realPath(r.parent),r.name):r.name,this.fs.PATH.join2(this.fs.realPath(n),i)),r.name=i,r.parent=n},this.unlink=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.rmdir=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.readdir=e=>this.fs.API.readdir(this.fs.realPath(this.node(e))),this.symlink=(e,t,i)=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)},this.readlink=e=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL)},this.fs=e}},M=class{constructor(e){this._driveName=e.driveName,this._mountpoint=e.mountpoint,this.FS=e.FS,this.ERRNO_CODES=e.ERRNO_CODES}lookup(e){return this.request({method:"lookup",path:this.normalizePath(e)})}getmode(e){return this.request({method:"getmode",path:this.normalizePath(e)})}mknod(e,t){return this.request({method:"mknod",path:this.normalizePath(e),data:{mode:t}})}rename(e,t){return this.request({method:"rename",path:this.normalizePath(e),data:{newPath:this.normalizePath(t)}})}readdir(e){let t=this.request({method:"readdir",path:this.normalizePath(e)});return t.push("."),t.push(".."),t}rmdir(e){return this.request({method:"rmdir",path:this.normalizePath(e)})}get(e){let t=this.request({method:"get",path:this.normalizePath(e)});if(!t)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);let i=t.content,r=t.format;switch(r){case"json":case"text":return{data:P.encode(i),format:r};case"base64":{let e=atob(i),t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return{data:n,format:r}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(e,t){switch(t.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:w.decode(t.data)}});case"base64":{let i="";for(let e=0;e<t.data.byteLength;e++)i+=String.fromCharCode(t.data[e]);return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:btoa(i)}})}}}getattr(e){let t=this.request({method:"getattr",path:this.normalizePath(e)}),i=new Date(0);return t.atime=t.atime?new Date(t.atime):i,t.mtime=t.mtime?new Date(t.mtime):i,t.ctime=t.ctime?new Date(t.ctime):i,t.size=t.size||0,t}normalizePath(e){return e.startsWith(this._mountpoint)&&(e=e.slice(this._mountpoint.length)),this._driveName&&(e=`${this._driveName}${y}${e}`),e}},R=class extends M{constructor(e){super(e),this._baseUrl=e.baseUrl,this._browsingContextId=e.browsingContextId||""}request(e){let t=new XMLHttpRequest;t.open("POST",encodeURI(this.endpoint),!1);let i=_.UUID.uuid4(),r={data:{...e,requestId:i},browsingContextId:this._browsingContextId,requestId:i};try{t.send(JSON.stringify(r))}catch(e){console.error(e)}if(t.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(t.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}},x=class{constructor(e){this.FS=e.FS,this.PATH=e.PATH,this.ERRNO_CODES=e.ERRNO_CODES,this.API=this.createAPI(e),this.driveName=e.driveName,this.node_ops=new k(this),this.stream_ops=new E(this)}createAPI(e){if(!e.browsingContextId||!e.baseUrl)throw Error("Cannot create service-worker API without current browsingContextId");return new R(e)}mount(e){return this.createNode(null,e.mountpoint,16895,0)}createNode(e,t,i,r){let n=this.FS;if(!n.isDir(i)&&!n.isFile(i))throw new n.ErrnoError(this.ERRNO_CODES.EINVAL);let s=n.createNode(e,t,i,r);return s.node_ops=this.node_ops,s.stream_ops=this.stream_ops,s}getMode(e){return this.API.getmode(e)}realPath(e){let t=[],i=e;for(t.push(i.name);i.parent!==i;)i=i.parent,t.push(i.name);return t.reverse(),this.PATH.join.apply(null,t)}}}),O="function",A="64e10b34-2bf7-4616-9668-f99de5aa046e",{isArray:I}=Array,{SharedArrayBuffer:N,window:D}=globalThis,{notify:C,wait:T,waitAsync:F}=Atomics,j=null;F||(F=e=>({value:new Promise(t=>{let i=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");i.onmessage=t,i.postMessage(e)})}));try{new N(4)}catch{N=ArrayBuffer;let e=new WeakMap;if(D){let t=new Map,{prototype:{postMessage:i}}=Worker,r=e=>{var i;let r=null==(i=e.data)?void 0:i[A];if(!I(r)){e.stopImmediatePropagation();let{id:i,sb:n}=r;t.get(i)(n)}};j=function(t,...n){let s=null==t?void 0:t[A];if(I(s)){let[t,i]=s;e.set(i,t),this.addEventListener("message",r)}return i.call(this,t,...n)},F=i=>({value:new Promise(r=>{t.set(e.get(i),r)}).then(r=>{t.delete(e.get(i)),e.delete(i);for(let e=0;e<r.length;e++)i[e]=r[e];return"ok"})})}else C=t=>{postMessage({[A]:{id:e.get(t),sb:t}})},addEventListener("message",t=>{var i;let r=null==(i=t.data)?void 0:i[A];if(I(r)){let[t,i]=r;e.set(i,t)}})}var{Int32Array:U,Map:q,Uint16Array:z}=globalThis,{BYTES_PER_ELEMENT:$}=U,{BYTES_PER_ELEMENT:L}=z,W=new WeakSet,H=new WeakMap,V={value:{then:e=>e()}},J=0,B=(e,{parse:t=JSON.parse,stringify:i=JSON.stringify,transform:r,interrupt:n}=JSON)=>{if(!H.has(e)){let s=j||e.postMessage,a=(t,...i)=>s.call(e,{[A]:i},{transfer:t}),o=typeof n===O?n:null==n?void 0:n.handler,l=(null==n?void 0:n.delay)||42,h=new TextDecoder("utf-16"),u=(e,t)=>e?F(t,0):(o?((e,t,i)=>{for(;"timed-out"===T(e,0,0,t);)i()})(t,l,o):T(t,0),V),d=!1;H.set(e,new Proxy(new q,{has:(e,t)=>"string"==typeof t&&!t.startsWith("_"),get:(i,n)=>"then"===n?null:(...i)=>{let s=J++,o=new U(new N(2*$)),l=[];W.has(i.at(-1)||l)&&W.delete(l=i.pop()),a(l,s,o,n,r?i.map(r):i);let f=e!==globalThis,c=0;return d&&f&&(c=setTimeout(console.warn,1e3,`\u{1F480}\u{1F512} - Possible deadlock if proxy.${n}(...args) is awaited`)),u(f,o).value.then(()=>{clearTimeout(c);let e=o[1];if(!e)return;let i=L*e;return a([],s,o=new U(new N(i+i%$))),u(f,o).value.then(()=>t(h.decode(new z(o.buffer).slice(0,e))))})},set(t,n,s){let a=typeof s;if(a!==O)throw Error(`Unable to assign ${n} as ${a}`);if(!t.size){let n=new q;e.addEventListener("message",async e=>{var s;let a=null==(s=e.data)?void 0:s[A];if(I(a)){e.stopImmediatePropagation();let[s,o,...l]=a,h;if(l.length){let[e,a]=l;if(t.has(e)){d=!0;try{let l=await t.get(e)(...a);if(void 0!==l){let e=i(r?r(l):l);n.set(s,e),o[1]=e.length}}catch(e){h=e}finally{d=!1}}else h=Error(`Unsupported action: ${e}`);o[0]=1}else{let e=n.get(s);n.delete(s);for(let t=new z(o.buffer),i=0;i<e.length;i++)t[i]=e.charCodeAt(i)}if(C(o,0),h)throw h}})}return!!t.set(n,s)}}))}return H.get(e)};B.transfer=(...e)=>(W.add(e),e),S();var K=class{constructor(){this._options=null,this._initializer=null,this._pyodide=null,this._localPath="",this._driveName="",this._driveFS=null,this._sendWorkerMessage=()=>{},this._logMessage=()=>{},this._initialized=new Promise((e,t)=>{this._initializer={resolve:e,reject:t}})}async initialize(e){var t;if(this._options=e,e.location.includes(":")){let t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initFilesystem(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null==(t=this._initializer)||t.resolve()}async initRuntime(e){let{pyodideUrl:t,indexUrl:r}=e,n;t.endsWith(".mjs")?n=(await i(745)(t)).loadPyodide:(importScripts(t),n=self.loadPyodide),this._pyodide=await n({indexURL:r,stdout:e=>{console.log(e),this._logMessage({type:"text",level:"info",data:e})},stderr:e=>{console.error(e),this._logMessage({type:"text",level:"critical",data:e})},...e.loadPyodideOptions}),this._pyodide._api.on_fatal=async e=>{let t="";t="Exit"===e.name?"Pyodide has exited and can no longer be used.":`Pyodide has suffered a fatal error. Please report this to the Pyodide maintainers.
The cause of the error was: ${e.name}
${e.message}
Stack trace:
${e.stack}`,this._logMessage({type:"text",level:"critical",data:t})}}async initPackageManager(e){if(!this._options)throw Error("Uninitialized");let{pipliteWheelUrl:t,disablePyPIFallback:i,pipliteUrls:r,loadPyodideOptions:n}=this._options,s=(n||{}).packages||[];s.includes("micropip")||await this._pyodide.loadPackage(["micropip"]),s.includes("piplite")||await this._pyodide.runPythonAsync(`
      import micropip
      await micropip.install('${t}', keep_going=True)
    `),await this._pyodide.runPythonAsync(`
      import piplite.piplite
      piplite.piplite._PIPLITE_DISABLE_PYPI = ${i?"True":"False"}
      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(r)}
    `)}async initKernel(e){let t=(e.loadPyodideOptions||{}).packages||[],i=[];for(let e of["sqlite3","ipykernel","comm","pyodide_kernel","jedi","ipython"])t.includes(e)||i.push(`await piplite.install('${e}', keep_going=True)`);i.push("import pyodide_kernel"),e.mountDrive&&this._localPath&&i.push("import os",`os.chdir("${this._localPath}")`),await this._pyodide.runPythonAsync(i.join(`
`))}async initGlobals(e){let{globals:t}=this._pyodide;this._kernel=t.get("pyodide_kernel").kernel_instance.copy(),this._stdout_stream=t.get("pyodide_kernel").stdout_stream.copy(),this._stderr_stream=t.get("pyodide_kernel").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:i,PATH:r,ERRNO_CODES:n}=this._pyodide,{baseUrl:s}=e,{DriveFS:a}=await Promise.resolve().then(()=>(S(),p)),o=new a({FS:i,PATH:r,ERRNO_CODES:n,baseUrl:s,driveName:this._driveName,mountpoint:t,browsingContextId:this._browsingContextId});i.mkdirTree(t),i.mount(o,{},t),i.chdir(t),this._driveFS=o}}mapToObject(e){let t=e instanceof Array?[]:{};for(let[i,r]of e instanceof Map?e.entries():Object.entries(e))t[i]=r instanceof Map||r instanceof Array?this.mapToObject(r):r;return t}formatResult(e){if(!(e instanceof this._pyodide.ffi.PyProxy))return e;let t=e.toJs();return this.mapToObject(t)}registerWorkerMessageCallback(e){this._sendWorkerMessage=e}registerLogMessageCallback(e){this._logMessage=e}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);let i=(e,t,i)=>{let r={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(i)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:r,type:"execute_result"})},r=(e,t,i)=>{this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:{ename:e,evalue:t,traceback:i},type:"execute_error"})},n=e=>{let t={wait:this.formatResult(e)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},s=(e,t,i)=>{let r={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(i)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:r,type:"display_data"})},a=(e,t,i)=>{let r={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(i)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:r,type:"update_display_data"})},o=(e,t)=>{let i={name:this.formatResult(e),text:this.formatResult(t)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"stream"})};this._stdout_stream.publish_stream_callback=o,this._stderr_stream.publish_stream_callback=o,this._interpreter.display_pub.clear_output_callback=n,this._interpreter.display_pub.display_data_callback=s,this._interpreter.display_pub.update_display_data_callback=a,this._interpreter.displayhook.publish_execution_result=i,this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);let l=await this._kernel.run(e.code),h=this.formatResult(l);return"error"===h.status&&r(h.ename,h.evalue,h.traceback),h}async complete(e,t){await this.setup(t);let i=this._kernel.complete(e.code,e.cursor_pos);return this.formatResult(i)}async inspect(e,t){await this.setup(t);let i=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level);return this.formatResult(i)}async isComplete(e,t){await this.setup(t);let i=this._kernel.is_complete(e.code);return this.formatResult(i)}async commInfo(e,t){await this.setup(t);let i=this._kernel.comm_info(e.target_name);return{comms:this.formatResult(i),status:"ok"}}async commOpen(e,t){await this.setup(t);let i=this._kernel.comm_manager.comm_open(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(i)}async commMsg(e,t){await this.setup(t);let i=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(i)}async commClose(e,t){await this.setup(t);let i=this._kernel.comm_manager.comm_close(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(i)}async inputReply(e,t){}getpass(e){return e=void 0===e?"":e,this.sendInputRequest(e,!0)}input(e){return e=void 0===e?"":e,this.sendInputRequest(e,!1)}async sendComm(e,t,i,r,n){this._sendWorkerMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(i),ident:this.formatResult(r),buffers:this.formatResult(n),parentHeader:this.formatResult(this._kernel._parent_header).header})}},Y=B(self),G=class extends M{request(e){return Y.processDriveRequest(e)}},X=class extends x{createAPI(e){return new G(e)}},Z=class extends K{async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:i,PATH:r,ERRNO_CODES:n}=this._pyodide,{baseUrl:s}=e,a=new X({FS:i,PATH:r,ERRNO_CODES:n,baseUrl:s,driveName:this._driveName,mountpoint:t});i.mkdirTree(t),i.mount(a,{},t),i.chdir(t),this._driveFS=a}}sendInputRequest(e,t){return Y.processStdinRequest({prompt:e,password:t})}},Q=new Z,ee=Y.processWorkerMessage.bind(Y);Q.registerWorkerMessageCallback(ee);var et=Y.processLogMessage.bind(Y);Q.registerLogMessageCallback(et),Y.initialize=Q.initialize.bind(Q),Y.execute=Q.execute.bind(Q),Y.complete=Q.complete.bind(Q),Y.inspect=Q.inspect.bind(Q),Y.isComplete=Q.isComplete.bind(Q),Y.commInfo=Q.commInfo.bind(Q),Y.commOpen=Q.commOpen.bind(Q),Y.commMsg=Q.commMsg.bind(Q),Y.commClose=Q.commClose.bind(Q),Y.inputReply=Q.inputReply.bind(Q)}}]);
//# sourceMappingURL=901.020a7625ee9a2e97.js.map?v=020a7625ee9a2e97