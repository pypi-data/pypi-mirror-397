"use strict";(self.webpackChunk_jupyterlite_pyodide_kernel_extension=self.webpackChunk_jupyterlite_pyodide_kernel_extension||[]).push([["782"],{829(t,e,s){s.d(e,{DriveFS:()=>m});var r=s(370);let i=new TextEncoder,a=new TextDecoder("utf-8"),n={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0};class o{constructor(t){this.fs=t}open(t){var e;let s=this.fs.realPath(t.node);if(this.fs.FS.isFile(t.node.mode))try{t.file=this.fs.API.get(s)}catch(o){let r=null!=(e=t.flags)?e:t.shared.flags,i="string"==typeof r?parseInt(r,10):r,a=!0;if((i&=8191)in n&&(a=n[i]),a)t.node=this.fs.node_ops.mknod(t.node.parent,t.node.name,t.node.mode,0),t.file=this.fs.API.get(s);else throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT)}}close(t){var e;if(!this.fs.FS.isFile(t.node.mode)||!t.file)return;let s=this.fs.realPath(t.node),r=null!=(e=t.flags)?e:t.shared.flags,i="string"==typeof r?parseInt(r,10):r,a=!0;(i&=8191)in n&&(a=n[i]),a&&this.fs.API.put(s,t.file),t.file=void 0}read(t,e,s,r,i){if(r<=0||void 0===t.file||i>=(t.file.data.length||0))return 0;let a=Math.min(t.file.data.length-i,r);return e.set(t.file.data.subarray(i,i+a),s),a}write(t,e,s,r,i){var a;if(r<=0||void 0===t.file)return 0;let n=Date.now();if(t.node.timestamp=n,t.node.atime=n,t.node.mtime=n,t.node.ctime=n,i+r>((null==(a=t.file)?void 0:a.data.length)||0)){let e=t.file.data?t.file.data:new Uint8Array;t.file.data=new Uint8Array(i+r),t.file.data.set(e)}return t.file.data.set(e.subarray(s,s+r),i),r}llseek(t,e,s){var r;let i=e;if(1===s)i+=null!=(r=t.position)?r:t.shared.position;else if(2===s&&this.fs.FS.isFile(t.node.mode))if(void 0!==t.file)i+=t.file.data.length;else throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);if(i<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return i}}class h{constructor(t){this.node=t=>"node"in t?t.node:t,this.getattr=t=>{let e=this.node(t);return{...this.fs.API.getattr(this.fs.realPath(e)),mode:e.mode,ino:e.id}},this.setattr=(t,e)=>{let s=this.node(t);for(let[t,r]of Object.entries(e))switch(t){case"mode":s.mode=r;break;case"timestamp":s.timestamp=r;break;case"atime":s.atime=r;break;case"mtime":s.mtime=r;break;case"ctime":s.ctime=r;break;case"size":{let t=this.fs.realPath(s);if(this.fs.FS.isFile(s.mode)&&r>=0){let e;try{e=this.fs.API.get(t)}catch(t){break}let s=e.data?e.data:new Uint8Array;r!==s.length&&(r<s.length?e.data=e.data.slice(0,r):(e.data=new Uint8Array(r),e.data.set(s)),this.fs.API.put(t,e))}else console.warn("setattr size of",r,"on",s,"not yet implemented");break}case"dontFollow":break;default:console.warn("setattr",t,"of",r,"on",s,"not yet implemented")}},this.lookup=(t,e)=>{let s=this.node(t),r=this.fs.PATH.join2(this.fs.realPath(s),e),i=this.fs.API.lookup(r);if(!i.ok)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);return this.fs.createNode(s,e,i.mode,0)},this.mknod=(t,e,s,r)=>{let i=this.node(t),a=this.fs.PATH.join2(this.fs.realPath(i),e);return this.fs.API.mknod(a,s),this.fs.createNode(i,e,s,r)},this.rename=(t,e,s)=>{let r=this.node(t),i=this.node(e);this.fs.API.rename(r.parent?this.fs.PATH.join2(this.fs.realPath(r.parent),r.name):r.name,this.fs.PATH.join2(this.fs.realPath(i),s)),r.name=s,r.parent=i},this.unlink=(t,e)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(t)),e)),this.rmdir=(t,e)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(t)),e)),this.readdir=t=>this.fs.API.readdir(this.fs.realPath(this.node(t))),this.symlink=(t,e,s)=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)},this.readlink=t=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL)},this.fs=t}}class d{constructor(t){this._driveName=t.driveName,this._mountpoint=t.mountpoint,this.FS=t.FS,this.ERRNO_CODES=t.ERRNO_CODES}lookup(t){return this.request({method:"lookup",path:this.normalizePath(t)})}getmode(t){return this.request({method:"getmode",path:this.normalizePath(t)})}mknod(t,e){return this.request({method:"mknod",path:this.normalizePath(t),data:{mode:e}})}rename(t,e){return this.request({method:"rename",path:this.normalizePath(t),data:{newPath:this.normalizePath(e)}})}readdir(t){let e=this.request({method:"readdir",path:this.normalizePath(t)});return e.push("."),e.push(".."),e}rmdir(t){return this.request({method:"rmdir",path:this.normalizePath(t)})}get(t){let e=this.request({method:"get",path:this.normalizePath(t)});if(!e)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);let s=e.content,r=e.format;switch(r){case"json":case"text":return{data:i.encode(s),format:r};case"base64":{let t=atob(s),e=t.length,i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=t.charCodeAt(s);return{data:i,format:r}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(t,e){switch(e.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(t),data:{format:e.format,data:a.decode(e.data)}});case"base64":{let s="";for(let t=0;t<e.data.byteLength;t++)s+=String.fromCharCode(e.data[t]);return this.request({method:"put",path:this.normalizePath(t),data:{format:e.format,data:btoa(s)}})}}}getattr(t){let e=this.request({method:"getattr",path:this.normalizePath(t)}),s=new Date(0);return e.atime=e.atime?new Date(e.atime):s,e.mtime=e.mtime?new Date(e.mtime):s,e.ctime=e.ctime?new Date(e.ctime):s,e.size=e.size||0,e}normalizePath(t){return t.startsWith(this._mountpoint)&&(t=t.slice(this._mountpoint.length)),this._driveName&&(t=`${this._driveName}:${t}`),t}}class l extends d{constructor(t){super(t),this._baseUrl=t.baseUrl,this._browsingContextId=t.browsingContextId||""}request(t){let e=new XMLHttpRequest;e.open("POST",encodeURI(this.endpoint),!1);let s=r.UUID.uuid4(),i={data:{...t,requestId:s},browsingContextId:this._browsingContextId,requestId:s};try{e.send(JSON.stringify(i))}catch(t){console.error(t)}if(e.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(e.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}}class m{constructor(t){this.FS=t.FS,this.PATH=t.PATH,this.ERRNO_CODES=t.ERRNO_CODES,this.API=this.createAPI(t),this.driveName=t.driveName,this.node_ops=new h(this),this.stream_ops=new o(this)}createAPI(t){if(!t.browsingContextId||!t.baseUrl)throw Error("Cannot create service-worker API without current browsingContextId");return new l(t)}mount(t){return this.createNode(null,t.mountpoint,16895,0)}createNode(t,e,s,r){let i=this.FS;if(!i.isDir(s)&&!i.isFile(s))throw new i.ErrnoError(this.ERRNO_CODES.EINVAL);let a=i.createNode(t,e,s,r);return a.node_ops=this.node_ops,a.stream_ops=this.stream_ops,a}getMode(t){return this.API.getmode(t)}realPath(t){let e=[],s=t;for(e.push(s.name);s.parent!==s;)s=s.parent,e.push(s.name);return e.reverse(),this.PATH.join.apply(null,e)}}}}]);
//# sourceMappingURL=782.637306852b235bf5.js.map?v=637306852b235bf5