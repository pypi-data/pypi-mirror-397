"use strict";(self.webpackChunk_jupyterlite_pyodide_kernel_extension=self.webpackChunk_jupyterlite_pyodide_kernel_extension||[]).push([["323"],{360(e,t,s){s.r(t),s.d(t,{pyodide_kernelWheelUrl:()=>d,allJSONUrl:()=>a,widgetsnbextensionWheelUrl:()=>c,widgetsnbextensionWheelUrl1:()=>u,PyodideCoincidentKernel:()=>m.U,PyodideRemoteKernel:()=>x,ipykernelWheelUrl:()=>n,PIPLITE_INDEX_SCHEMA:()=>R,pipliteWheelUrl:()=>l,PyodideKernel:()=>P,SharedBufferContentsAPI:()=>m.a,PyodideComlinkKernel:()=>y.N});let i=s.p+"pypi/all.json";var a=s.t(i);let r=s.p+"pypi/ipykernel-6.9.2-py3-none-any.whl";var n=s.t(r);let o=s.p+"pypi/piplite-0.8.0a0-py3-none-any.whl";var l=s.t(o);let p=s.p+"pypi/pyodide_kernel-0.8.0a0-py3-none-any.whl";var d=s.t(p);let h=s.p+"pypi/widgetsnbextension-3.6.999-py3-none-any.whl";var c=s.t(h);let _=s.p+"pypi/widgetsnbextension-4.0.999-py3-none-any.whl";var u=s.t(_),m=s(4),y=s(509),g=s(959),k=s(648),w=s(370),f=s(846),b=s(989);class P extends b.BaseKernel{constructor(e){super(e),this._ready=new w.PromiseDelegate,this._inputDelegate=new w.PromiseDelegate,this._worker=this.initWorker(e),this._remoteKernel=this.initRemote(e),this._contentsManager=e.contentsManager,this._logger=e.logger||(()=>{})}initWorker(e){return crossOriginIsolated?new Worker(new URL(s.p+s.u("992"),s.b),Object.assign({},{type:"module"},{type:void 0})):new Worker(new URL(s.p+s.u("608"),s.b),Object.assign({},{type:"module"},{type:void 0}))}initRemote(e){let t;crossOriginIsolated?((t=(0,g.A)(this._worker)).processLogMessage=this._processLogMessage.bind(this),t.processWorkerMessage=this._processWorkerMessage.bind(this),t.processDriveRequest=async e=>{if(!b.DriveContentsProcessor)throw Error("File system calls over Atomics.wait is only supported with jupyterlite>=0.4.0a3");return void 0===this._contentsProcessor&&(this._contentsProcessor=new b.DriveContentsProcessor({contentsManager:this._contentsManager})),await this._contentsProcessor.processDriveRequest(e)},t.processStdinRequest=async e=>(this._processWorkerMessage({type:"input_request",content:e}),this._inputDelegate=new w.PromiseDelegate,await this._inputDelegate.promise)):(t=(0,k.LV)(this._worker),this._worker.addEventListener("message",e=>{var t,s;void 0!==(null==(t=null==e?void 0:e.data)?void 0:t._kernelMessage)?this._processWorkerMessage(e.data._kernelMessage):void 0!==(null==(s=null==e?void 0:e.data)?void 0:s._logMessage)&&this._processLogMessage(e.data._logMessage)}));let s=this.initRemoteOptions(e);return t.initialize(s).then(this._ready.resolve.bind(this._ready)).catch(e=>{this._logger({payload:{type:"text",level:"critical",data:e.message},kernelId:this.id}),this._ready.reject(e.message)}),t}initRemoteOptions(e){let{pyodideUrl:t}=e,s=t.slice(0,t.lastIndexOf("/")+1),a=f.PageConfig.getBaseUrl(),r=[...e.pipliteUrls||[],i],n=!!e.disablePyPIFallback;return{baseUrl:a,pyodideUrl:t,indexUrl:s,pipliteWheelUrl:e.pipliteWheelUrl||o,pipliteUrls:r,disablePyPIFallback:n,location:this.location,mountDrive:e.mountDrive,loadPyodideOptions:e.loadPyodideOptions||{},browsingContextId:e.browsingContextId,kernelId:this.id}}dispose(){if(!this.isDisposed){try{this._ready.reject(`${this.id} was disposed`)}catch(e){}this._worker.terminate(),this._worker=null,super.dispose()}}get ready(){return this._ready.promise}_processLogMessage(e){this._logger({payload:e,kernelId:this.id})}_processWorkerMessage(e){var t,s,i,a,r,n,o;if(e.type)switch(e.type){case"stream":{let s=null!=(t=e.bundle)?t:{name:"stdout",text:""};this.stream(s,e.parentHeader);break}case"input_request":{let t=null!=(s=e.content)?s:{prompt:"",password:!1};this.inputRequest(t,e.parentHeader);break}case"display_data":{let t=null!=(i=e.bundle)?i:{data:{},metadata:{},transient:{}};this.displayData(t,e.parentHeader);break}case"update_display_data":{let t=null!=(a=e.bundle)?a:{data:{},metadata:{},transient:{}};this.updateDisplayData(t,e.parentHeader);break}case"clear_output":{let t=null!=(r=e.bundle)?r:{wait:!1};this.clearOutput(t,e.parentHeader);break}case"execute_result":{let t=null!=(n=e.bundle)?n:{execution_count:0,data:{},metadata:{}};this.publishExecuteResult(t,e.parentHeader);break}case"execute_error":{let t=null!=(o=e.bundle)?o:{ename:"",evalue:"",traceback:[]};this.publishExecuteError(t,e.parentHeader);break}case"comm_msg":case"comm_open":case"comm_close":this.handleComm(e.type,e.content,e.metadata,e.buffers,e.parentHeader)}}async kernelInfoRequest(){return{implementation:"pyodide",implementation_version:"0.1.0",language_info:{codemirror_mode:{name:"python",version:3},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:"ipython3",version:"3.8"},protocol_version:"5.3",status:"ok",banner:"A WebAssembly-powered Python kernel backed by Pyodide",help_links:[{text:"Python (WASM) Kernel",url:"https://pyodide.org"}]}}async executeRequest(e){await this.ready;let t=await this._remoteKernel.execute(e,this.parent);return t.execution_count=this.executionCount,t}async completeRequest(e){return await this._remoteKernel.complete(e,this.parent)}async inspectRequest(e){return await this._remoteKernel.inspect(e,this.parent)}async isCompleteRequest(e){return await this._remoteKernel.isComplete(e,this.parent)}async commInfoRequest(e){return await this._remoteKernel.commInfo(e,this.parent)}async commOpen(e){return await this._remoteKernel.commOpen(e,this.parent)}async commMsg(e){return await this._remoteKernel.commMsg(e,this.parent)}async commClose(e){return await this._remoteKernel.commClose(e,this.parent)}async inputReply(e){let t="value"in e?e.value:void 0;this._inputDelegate.resolve(t)}}let v=s.p+"schema/piplite.v0.schema.json";var R=s.t(v);class x{constructor(){this._options=null,this._initializer=null,this._pyodide=null,this._localPath="",this._driveName="",this._driveFS=null,this._sendWorkerMessage=()=>{},this._logMessage=()=>{},this._initialized=new Promise((e,t)=>{this._initializer={resolve:e,reject:t}})}async initialize(e){var t;if(this._options=e,e.location.includes(":")){let t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initFilesystem(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null==(t=this._initializer)||t.resolve()}async initRuntime(e){let t,{pyodideUrl:s,indexUrl:i}=e;s.endsWith(".mjs")?t=(await import(s)).loadPyodide:(importScripts(s),t=self.loadPyodide),this._pyodide=await t({indexURL:i,stdout:e=>{console.log(e),this._logMessage({type:"text",level:"info",data:e})},stderr:e=>{console.error(e),this._logMessage({type:"text",level:"critical",data:e})},...e.loadPyodideOptions}),this._pyodide._api.on_fatal=async e=>{let t="";t="Exit"===e.name?"Pyodide has exited and can no longer be used.":`Pyodide has suffered a fatal error. Please report this to the Pyodide maintainers.
The cause of the error was: ${e.name}
${e.message}
Stack trace:
${e.stack}`,this._logMessage({type:"text",level:"critical",data:t})}}async initPackageManager(e){if(!this._options)throw Error("Uninitialized");let{pipliteWheelUrl:t,disablePyPIFallback:s,pipliteUrls:i,loadPyodideOptions:a}=this._options,r=(a||{}).packages||[];r.includes("micropip")||await this._pyodide.loadPackage(["micropip"]),r.includes("piplite")||await this._pyodide.runPythonAsync(`
      import micropip
      await micropip.install('${t}', keep_going=True)
    `),await this._pyodide.runPythonAsync(`
      import piplite.piplite
      piplite.piplite._PIPLITE_DISABLE_PYPI = ${s?"True":"False"}
      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(i)}
    `)}async initKernel(e){let t=(e.loadPyodideOptions||{}).packages||[],s=[];for(let e of["sqlite3","ipykernel","comm","pyodide_kernel","jedi","ipython"])t.includes(e)||s.push(`await piplite.install('${e}', keep_going=True)`);s.push("import pyodide_kernel"),e.mountDrive&&this._localPath&&s.push("import os",`os.chdir("${this._localPath}")`),await this._pyodide.runPythonAsync(s.join("\n"))}async initGlobals(e){let{globals:t}=this._pyodide;this._kernel=t.get("pyodide_kernel").kernel_instance.copy(),this._stdout_stream=t.get("pyodide_kernel").stdout_stream.copy(),this._stderr_stream=t.get("pyodide_kernel").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:i,PATH:a,ERRNO_CODES:r}=this._pyodide,{baseUrl:n}=e,{DriveFS:o}=await s.e("782").then(s.bind(s,829)),l=new o({FS:i,PATH:a,ERRNO_CODES:r,baseUrl:n,driveName:this._driveName,mountpoint:t,browsingContextId:this._browsingContextId});i.mkdirTree(t),i.mount(l,{},t),i.chdir(t),this._driveFS=l}}mapToObject(e){let t=e instanceof Array?[]:{};for(let[s,i]of e instanceof Map?e.entries():Object.entries(e))t[s]=i instanceof Map||i instanceof Array?this.mapToObject(i):i;return t}formatResult(e){if(!(e instanceof this._pyodide.ffi.PyProxy))return e;let t=e.toJs();return this.mapToObject(t)}registerWorkerMessageCallback(e){this._sendWorkerMessage=e}registerLogMessageCallback(e){this._logMessage=e}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);let s=(e,t,s)=>{let i={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(s)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"execute_result"})},i=(e,t,s)=>{this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:{ename:e,evalue:t,traceback:s},type:"execute_error"})},a=e=>{let t={wait:this.formatResult(e)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},r=(e,t,s)=>{let i={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(s)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"display_data"})},n=(e,t,s)=>{let i={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(s)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"update_display_data"})},o=(e,t)=>{let s={name:this.formatResult(e),text:this.formatResult(t)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"stream"})};this._stdout_stream.publish_stream_callback=o,this._stderr_stream.publish_stream_callback=o,this._interpreter.display_pub.clear_output_callback=a,this._interpreter.display_pub.display_data_callback=r,this._interpreter.display_pub.update_display_data_callback=n,this._interpreter.displayhook.publish_execution_result=s,this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);let l=await this._kernel.run(e.code),p=this.formatResult(l);return"error"===p.status&&i(p.ename,p.evalue,p.traceback),p}async complete(e,t){await this.setup(t);let s=this._kernel.complete(e.code,e.cursor_pos);return this.formatResult(s)}async inspect(e,t){await this.setup(t);let s=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level);return this.formatResult(s)}async isComplete(e,t){await this.setup(t);let s=this._kernel.is_complete(e.code);return this.formatResult(s)}async commInfo(e,t){await this.setup(t);let s=this._kernel.comm_info(e.target_name);return{comms:this.formatResult(s),status:"ok"}}async commOpen(e,t){await this.setup(t);let s=this._kernel.comm_manager.comm_open(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(s)}async commMsg(e,t){await this.setup(t);let s=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(s)}async commClose(e,t){await this.setup(t);let s=this._kernel.comm_manager.comm_close(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(s)}async inputReply(e,t){}getpass(e){return e=void 0===e?"":e,this.sendInputRequest(e,!0)}input(e){return e=void 0===e?"":e,this.sendInputRequest(e,!1)}async sendComm(e,t,s,i,a){this._sendWorkerMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(s),ident:this.formatResult(i),buffers:this.formatResult(a),parentHeader:this.formatResult(this._kernel._parent_header).header})}}}}]);
//# sourceMappingURL=323.d78f889b576b5854.js.map?v=d78f889b576b5854