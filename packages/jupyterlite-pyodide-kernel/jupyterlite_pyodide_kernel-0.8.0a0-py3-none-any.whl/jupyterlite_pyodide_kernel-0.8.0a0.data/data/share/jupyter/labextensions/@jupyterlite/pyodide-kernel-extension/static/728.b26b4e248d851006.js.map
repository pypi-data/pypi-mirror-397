{"version":3,"file":"728.b26b4e248d851006.js?v=b26b4e248d851006","sources":["webpack://@jupyterlite/pyodide-kernel-extension/./lib/index.js"],"sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { PageConfig, URLExt } from '@jupyterlab/coreutils';\nimport { ILoggerRegistry } from '@jupyterlab/logconsole';\nimport { IServiceWorkerManager } from '@jupyterlite/apputils';\nimport { IKernelSpecs } from '@jupyterlite/services';\nimport KERNEL_ICON_SVG_STR from '../style/img/pyodide.svg';\nexport * as KERNEL_SETTINGS_SCHEMA from '../schema/kernel.v0.schema.json';\nconst KERNEL_ICON_URL = `data:image/svg+xml;base64,${btoa(KERNEL_ICON_SVG_STR)}`;\n/**\n * The default CDN fallback for Pyodide\n */\nconst PYODIDE_CDN_URL = 'https://cdn.jsdelivr.net/pyodide/v0.29.0/full/pyodide.js';\n/**\n * The id for the extension, and key in the litePlugins.\n */\nconst PLUGIN_ID = '@jupyterlite/pyodide-kernel-extension:kernel';\n/**\n * A plugin to register the Pyodide kernel.\n */\nconst kernel = {\n    id: PLUGIN_ID,\n    description: 'A plugin providing the Pyodide kernel.',\n    autoStart: true,\n    requires: [IKernelSpecs],\n    optional: [IServiceWorkerManager, ILoggerRegistry],\n    activate: (app, kernelspecs, serviceWorkerManager, loggerRegistry) => {\n        const { contents: contentsManager, sessions } = app.serviceManager;\n        const config = JSON.parse(PageConfig.getOption('litePluginSettings') || '{}')[PLUGIN_ID] || {};\n        const baseUrl = PageConfig.getBaseUrl();\n        const url = config.pyodideUrl || PYODIDE_CDN_URL;\n        const pyodideUrl = URLExt.parse(url).href;\n        const pipliteWheelUrl = config.pipliteWheelUrl\n            ? URLExt.parse(config.pipliteWheelUrl).href\n            : undefined;\n        const rawPipUrls = config.pipliteUrls || [];\n        const pipliteUrls = rawPipUrls.map((pipUrl) => URLExt.parse(pipUrl).href);\n        const disablePyPIFallback = !!config.disablePyPIFallback;\n        const loadPyodideOptions = config.loadPyodideOptions || {};\n        for (const [key, value] of Object.entries(loadPyodideOptions)) {\n            if (key.endsWith('URL') && typeof value === 'string') {\n                loadPyodideOptions[key] = new URL(value, baseUrl).href;\n            }\n        }\n        // The logger will find the notebook associated with the kernel id\n        // and log the payload to the log console for that notebook.\n        const logger = async (options) => {\n            var _a;\n            if (!loggerRegistry) {\n                // nothing to do in this case\n                return;\n            }\n            const { payload, kernelId } = options;\n            // Find the session path that corresponds to the kernel ID\n            let sessionPath = '';\n            for (const session of sessions.running()) {\n                if (((_a = session.kernel) === null || _a === void 0 ? void 0 : _a.id) === kernelId) {\n                    sessionPath = session.path;\n                    break;\n                }\n            }\n            const logger = loggerRegistry.getLogger(sessionPath);\n            logger.log(payload);\n        };\n        kernelspecs.register({\n            spec: {\n                name: 'python',\n                display_name: 'Python (Pyodide)',\n                language: 'python',\n                argv: [],\n                resources: {\n                    'logo-32x32': KERNEL_ICON_URL,\n                    'logo-64x64': KERNEL_ICON_URL,\n                },\n            },\n            create: async (options) => {\n                const { PyodideKernel } = await import('@jupyterlite/pyodide-kernel');\n                const mountDrive = !!((serviceWorkerManager === null || serviceWorkerManager === void 0 ? void 0 : serviceWorkerManager.enabled) || crossOriginIsolated);\n                const kernel = new PyodideKernel({\n                    ...options,\n                    pyodideUrl,\n                    pipliteWheelUrl,\n                    pipliteUrls,\n                    disablePyPIFallback,\n                    mountDrive,\n                    loadPyodideOptions,\n                    contentsManager,\n                    browsingContextId: serviceWorkerManager === null || serviceWorkerManager === void 0 ? void 0 : serviceWorkerManager.browsingContextId,\n                    logger,\n                });\n                if (mountDrive) {\n                    console.info('Pyodide contents will be synced with Jupyter Contents');\n                }\n                else {\n                    const warningMessage = 'Pyodide contents will NOT be synced with Jupyter Contents. ' +\n                        'For full functionality, try using a regular browser tab instead of private/incognito mode, ' +\n                        'especially in Firefox where this is a known limitation.';\n                    console.warn(warningMessage);\n                    // Wait for kernel to be ready before logging the warning\n                    kernel.ready.then(() => {\n                        if (loggerRegistry) {\n                            void logger({\n                                payload: {\n                                    type: 'text',\n                                    data: warningMessage,\n                                    level: 'warning',\n                                },\n                                kernelId: options.id,\n                            });\n                        }\n                    });\n                }\n                return kernel;\n            },\n        });\n    },\n};\nconst plugins = [kernel];\nexport default plugins;\n"],"names":["btoa","s","JSON","Object","URL","crossOriginIsolated","console"],"mappings":"gRAQA,IAAM,EAAkB,CAAC,0BAA0B,EAAEA,K,0iCAA0B,CAAC,CAQ1E,EAAY,+CAsGlB,EADgB,CAjGD,CACX,GAAI,EACJ,YAAa,yCACb,UAAW,GACX,SAAU,CAAC,cAAY,CAAC,CACxB,SAAU,CAAC,uBAAqB,CAAE,iBAAe,CAAC,CAClD,SAAU,CAAC,EAAK,EAAa,EAAsB,KAC/C,GAAM,CAAE,SAAU,CAAe,CAAEC,SAAAA,CAAQ,CAAE,CAAG,EAAI,cAAc,CAC5D,EAASC,KAAK,KAAK,CAAC,sBAAoB,CAAC,uBAAyB,KAAK,CAAC,EAAU,EAAI,CAAC,EACvF,EAAU,uBAAqB,GAC/B,EAAM,EAAO,UAAU,EAlBb,2DAmBV,EAAa,cAAY,CAAC,GAAK,IAAI,CACnC,EAAkB,EAAO,eAAe,CACxC,cAAY,CAAC,EAAO,eAAe,EAAE,IAAI,CACzC,OAEA,EAAc,AADD,GAAO,WAAW,EAAI,EAAE,AAAD,EACX,GAAG,CAAC,AAAC,GAAW,cAAY,CAAC,GAAQ,IAAI,EAClE,EAAsB,CAAC,CAAC,EAAO,mBAAmB,CAClD,EAAqB,EAAO,kBAAkB,EAAI,CAAC,EACzD,IAAK,GAAM,CAAC,EAAK,EAAM,GAAIC,OAAO,OAAO,CAAC,GAClC,EAAI,QAAQ,CAAC,QAAU,AAAiB,UAAjB,OAAO,GAC9B,EAAkB,CAAC,EAAI,CAAG,IAAIC,IAAI,EAAO,GAAS,IAAI,AAAD,EAK7D,IAAM,EAAS,MAAO,IAClB,IAAI,EACJ,GAAI,CAAC,EAED,OAEJ,GAAM,CAAE,SAAO,CAAE,UAAQ,CAAE,CAAG,EAE1B,EAAc,GAClB,IAAK,IAAM,KAAWH,EAAS,OAAO,GAClC,GAAI,AAAC,OAAC,GAAK,EAAQ,MAAM,AAAD,EAA+B,KAAK,EAAI,EAAG,EAAE,AAAD,IAAO,EAAU,CACjF,EAAc,EAAQ,IAAI,CAC1B,KACJ,CAGJ,AADe,EAAe,SAAS,CAAC,GACjC,GAAG,CAAC,EACf,EACA,EAAY,QAAQ,CAAC,CACjB,KAAM,CACF,KAAM,SACN,aAAc,mBACd,SAAU,SACV,KAAM,EAAE,CACR,UAAW,CACP,aAAc,EACd,aAAc,CAClB,CACJ,EACA,OAAQ,MAAO,IACX,GAAM,CAAE,eAAa,CAAE,CAAG,MAAM,oCAC1B,EAAa,CAAC,CAAE,CAAC,SAAmE,KAAK,EAAI,EAAqB,OAAO,AAAD,GAAMI,mBAAkB,EAChJ,EAAS,IAAI,EAAc,CAC7B,GAAG,CAAO,CACV,aACA,kBACA,cACA,sBACA,aACA,qBACA,kBACA,kBAAmB,QAAmE,KAAK,EAAI,EAAqB,iBAAiB,CACrI,QACJ,GACA,GAAI,EACAC,QAAQ,IAAI,CAAC,6DAEZ,CACD,IAAM,EAAiB,gNAGvBA,QAAQ,IAAI,CAAC,GAEb,EAAO,KAAK,CAAC,IAAI,CAAC,KACV,GACK,EAAO,CACR,QAAS,CACL,KAAM,OACN,KAAM,EACN,MAAO,SACX,EACA,SAAU,EAAQ,EAAE,AACxB,EAER,EACJ,CACA,OAAO,CACX,CACJ,EACJ,CACJ,EACwB,A"}