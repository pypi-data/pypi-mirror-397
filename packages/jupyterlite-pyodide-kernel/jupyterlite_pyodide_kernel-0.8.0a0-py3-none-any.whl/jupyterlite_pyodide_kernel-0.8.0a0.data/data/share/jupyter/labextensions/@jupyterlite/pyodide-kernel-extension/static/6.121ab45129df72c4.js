(self.webpackChunk_jupyterlite_pyodide_kernel_extension=self.webpackChunk_jupyterlite_pyodide_kernel_extension||[]).push([["6"],{509(__unused_rspack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{N:()=>ii});var process=__webpack_require__(907),Xo=Object.create,Wn=Object.defineProperty,Yo=Object.getOwnPropertyDescriptor,Qo=Object.getOwnPropertyNames,Zo=Object.getPrototypeOf,ea=Object.prototype.hasOwnProperty,ri=(e,t)=>()=>(e&&(t=e(e=0)),t),R=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ta=(e,t)=>{for(var n in t)Wn(e,n,{get:t[n],enumerable:!0})},na=(e,t,n,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of Qo(t))ea.call(e,r)||r===n||Wn(e,r,{get:()=>t[r],enumerable:!(s=Yo(t,r))||s.enumerable});return e},$n=(e,t,n)=>(n=null!=e?Xo(Zo(e)):{},na(!t&&e&&e.__esModule?n:Wn(n,"default",{value:e,enumerable:!0}),e)),Gn=R((e,t)=>{!function(n,s){"object"==typeof e&&void 0!==t?s(e):"function"==typeof define&&define.amd?define(["exports"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_algorithm={})}(e,function(e){var t;function*n(...e){for(let t of e)yield*t}function*s(){}function*r(e,t=0){for(let n of e)yield[t++,n]}function*i(e,t){let n=0;for(let s of e)t(s,n++)&&(yield s)}function o(e,t){let n=0;for(let s of e)if(t(s,n++))return s}function a(e,t){let n=0;for(let s of e)if(t(s,n++))return n-1;return -1}function l(e,t){let n;for(let s of e){if(void 0===n){n=s;continue}0>t(s,n)&&(n=s)}return n}function h(e,t){let n;for(let s of e){if(void 0===n){n=s;continue}t(s,n)>0&&(n=s)}return n}function u(e,t){let n=!0,s,r;for(let i of e)n?(s=i,r=i,n=!1):0>t(i,s)?s=i:t(i,r)>0&&(r=i);return n?void 0:[s,r]}function c(e){return Array.from(e)}function d(e){let t={};for(let[n,s]of e)t[n]=s;return t}function p(e,t){let n=0;for(let s of e)if(!1===t(s,n++))return}function g(e,t){let n=0;for(let s of e)if(!1===t(s,n++))return!1;return!0}function _(e,t){let n=0;for(let s of e)if(t(s,n++))return!0;return!1}function*f(e,t){let n=0;for(let s of e)yield t(s,n++)}function*m(e,n,s){void 0===n?(n=e,e=0,s=1):void 0===s&&(s=1);let r=t.rangeLength(e,n,s);for(let t=0;t<r;t++)yield e+s*t}function v(e,t,n){let s,r,i=e[Symbol.iterator](),o=0,a=i.next();if(a.done&&void 0===n)throw TypeError("Reduce of empty iterable with no initial value.");if(a.done)return n;let l=i.next();if(l.done&&void 0===n)return a.value;if(l.done)return t(n,a.value,o++);for(s=t(void 0===n?a.value:t(n,a.value,o++),l.value,o++);!(r=i.next()).done;)s=t(s,r.value,o++);return s}function*y(e,t){for(;0<t--;)yield e}function*w(e){yield e}function*S(e){if("function"==typeof e.retro)yield*e.retro();else for(let t=e.length-1;t>-1;t--)yield e[t]}function b(e){let t=[],n=new Set,s=new Map;for(let t of e)r(t);for(let[e]of s)i(e);return t;function r(e){let[t,n]=e,r=s.get(n);r?r.push(t):s.set(n,[t])}function i(e){if(n.has(e))return;n.add(e);let r=s.get(e);if(r)for(let e of r)i(e);t.push(e)}}function*C(e,t){let n=0;for(let s of e)n++%t==0&&(yield s)}function*P(e,t){if(t<1)return;let n=e[Symbol.iterator](),s;for(;0<t--&&!(s=n.next()).done;)yield s.value}function*k(...e){let t=e.map(e=>e[Symbol.iterator]()),n=t.map(e=>e.next());for(;g(n,e=>!e.done);n=t.map(e=>e.next()))yield n.map(e=>e.value)}e.ArrayExt=void 0,function(e){function t(e,n,s=0,r=-1){let i,o=e.length;if(0===o)return -1;s=s<0?Math.max(0,s+o):Math.min(s,o-1),i=(r=r<0?Math.max(0,r+o):Math.min(r,o-1))<s?r+1+(o-s):r-s+1;for(let t=0;t<i;++t){let r=(s+t)%o;if(e[r]===n)return r}return -1}function n(e,t,s=-1,r=0){let i,o=e.length;if(0===o)return -1;i=(s=s<0?Math.max(0,s+o):Math.min(s,o-1))<(r=r<0?Math.max(0,r+o):Math.min(r,o-1))?s+1+(o-r):s-r+1;for(let n=0;n<i;++n){let r=(s-n+o)%o;if(e[r]===t)return r}return -1}function s(e,t,n=0,r=-1){let i,o=e.length;if(0===o)return -1;n=n<0?Math.max(0,n+o):Math.min(n,o-1),i=(r=r<0?Math.max(0,r+o):Math.min(r,o-1))<n?r+1+(o-n):r-n+1;for(let s=0;s<i;++s){let r=(n+s)%o;if(t(e[r],r))return r}return -1}function r(e,t,n=-1,s=0){let i,o=e.length;if(0===o)return -1;i=(n=n<0?Math.max(0,n+o):Math.min(n,o-1))<(s=s<0?Math.max(0,s+o):Math.min(s,o-1))?n+1+(o-s):n-s+1;for(let s=0;s<i;++s){let r=(n-s+o)%o;if(t(e[r],r))return r}return -1}function i(e,t=0,n=-1){let s=e.length;if(!(s<=1))for(t=t<0?Math.max(0,t+s):Math.min(t,s-1),n=n<0?Math.max(0,n+s):Math.min(n,s-1);t<n;){let s=e[t],r=e[n];e[t++]=r,e[n--]=s}}function o(e,t){let n=e.length;if(t<0&&(t+=n),t<0||t>=n)return;let s=e[t];for(let s=t+1;s<n;++s)e[s-1]=e[s];return e.length=n-1,s}e.firstIndexOf=t,e.lastIndexOf=n,e.findFirstIndex=s,e.findLastIndex=r,e.findFirstValue=function(e,t,n=0,r=-1){let i=s(e,t,n,r);return -1!==i?e[i]:void 0},e.findLastValue=function(e,t,n=-1,s=0){let i=r(e,t,n,s);return -1!==i?e[i]:void 0},e.lowerBound=function(e,t,n,s=0,r=-1){let i=e.length;if(0===i)return 0;s=s<0?Math.max(0,s+i):Math.min(s,i-1),r=r<0?Math.max(0,r+i):Math.min(r,i-1);let o=s,a=r-s+1;for(;a>0;){let s=a>>1,r=o+s;0>n(e[r],t)?(o=r+1,a-=s+1):a=s}return o},e.upperBound=function(e,t,n,s=0,r=-1){let i=e.length;if(0===i)return 0;s=s<0?Math.max(0,s+i):Math.min(s,i-1),r=r<0?Math.max(0,r+i):Math.min(r,i-1);let o=s,a=r-s+1;for(;a>0;){let s=a>>1,r=o+s;n(e[r],t)>0?a=s:(o=r+1,a-=s+1)}return o},e.shallowEqual=function(e,t,n){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0,r=e.length;s<r;++s)if(n?!n(e[s],t[s]):e[s]!==t[s])return!1;return!0},e.slice=function(e,t={}){let n,{start:s,stop:r,step:i}=t;if(void 0===i&&(i=1),0===i)throw Error("Slice `step` cannot be zero.");let o=e.length;void 0===s?s=i<0?o-1:0:s<0?s=Math.max(s+o,i<0?-1:0):s>=o&&(s=i<0?o-1:o),void 0===r?r=i<0?-1:o:r<0?r=Math.max(r+o,i<0?-1:0):r>=o&&(r=i<0?o-1:o),n=i<0&&r>=s||i>0&&s>=r?0:i<0?Math.floor((r-s+1)/i+1):Math.floor((r-s-1)/i+1);let a=[];for(let t=0;t<n;++t)a[t]=e[s+t*i];return a},e.move=function(e,t,n){let s=e.length;if(s<=1||(t=t<0?Math.max(0,t+s):Math.min(t,s-1))===(n=n<0?Math.max(0,n+s):Math.min(n,s-1)))return;let r=e[t],i=t<n?1:-1;for(let s=t;s!==n;s+=i)e[s]=e[s+i];e[n]=r},e.reverse=i,e.rotate=function(e,t,n=0,s=-1){let r=e.length;if(r<=1||(n=n<0?Math.max(0,n+r):Math.min(n,r-1))>=(s=s<0?Math.max(0,s+r):Math.min(s,r-1)))return;let o=s-n+1;if(t>0?t%=o:t<0&&(t=(t%o+o)%o),0===t)return;let a=n+t;i(e,n,a-1),i(e,a,s),i(e,n,s)},e.fill=function(e,t,n=0,s=-1){let r,i=e.length;if(0!==i){n=n<0?Math.max(0,n+i):Math.min(n,i-1),s=s<0?Math.max(0,s+i):Math.min(s,i-1),r=s<n?s+1+(i-n):s-n+1;for(let s=0;s<r;++s)e[(n+s)%i]=t}},e.insert=function(e,t,n){let s=e.length;t=t<0?Math.max(0,t+s):Math.min(t,s);for(let n=s;n>t;--n)e[n]=e[n-1];e[t]=n},e.removeAt=o,e.removeFirstOf=function(e,n,s=0,r=-1){let i=t(e,n,s,r);return -1!==i&&o(e,i),i},e.removeLastOf=function(e,t,s=-1,r=0){let i=n(e,t,s,r);return -1!==i&&o(e,i),i},e.removeAllOf=function(e,t,n=0,s=-1){let r=e.length;if(0===r)return 0;n=n<0?Math.max(0,n+r):Math.min(n,r-1),s=s<0?Math.max(0,s+r):Math.min(s,r-1);let i=0;for(let o=0;o<r;++o)n<=s&&o>=n&&o<=s&&e[o]===t||s<n&&(o<=s||o>=n)&&e[o]===t?i++:i>0&&(e[o-i]=e[o]);return i>0&&(e.length=r-i),i},e.removeFirstWhere=function(e,t,n=0,r=-1){let i,a=s(e,t,n,r);return -1!==a&&(i=o(e,a)),{index:a,value:i}},e.removeLastWhere=function(e,t,n=-1,s=0){let i,a=r(e,t,n,s);return -1!==a&&(i=o(e,a)),{index:a,value:i}},e.removeAllWhere=function(e,t,n=0,s=-1){let r=e.length;if(0===r)return 0;n=n<0?Math.max(0,n+r):Math.min(n,r-1),s=s<0?Math.max(0,s+r):Math.min(s,r-1);let i=0;for(let o=0;o<r;++o)n<=s&&o>=n&&o<=s&&t(e[o],o)||s<n&&(o<=s||o>=n)&&t(e[o],o)?i++:i>0&&(e[o-i]=e[o]);return i>0&&(e.length=r-i),i}}(e.ArrayExt||(e.ArrayExt={})),function(e){e.rangeLength=function(e,t,n){return 0===n?1/0:e>t&&n>0||e<t&&n<0?0:Math.ceil((t-e)/n)}}(t||(t={})),e.StringExt=void 0,function(e){function t(e,n,s=0){let r=Array(n.length);for(let t=0,i=s,o=n.length;t<o;++t,++i){if(-1===(i=e.indexOf(n[t],i)))return null;r[t]=i}return r}e.findIndices=t,e.matchSumOfSquares=function(e,n,s=0){let r=t(e,n,s);if(!r)return null;let i=0;for(let e=0,t=r.length;e<t;++e){let t=r[e]-s;i+=t*t}return{score:i,indices:r}},e.matchSumOfDeltas=function(e,n,s=0){let r=t(e,n,s);if(!r)return null;let i=0,o=s-1;for(let e=0,t=r.length;e<t;++e){let t=r[e];i+=t-o-1,o=t}return{score:i,indices:r}},e.highlight=function(e,t,n){let s=[],r=0,i=0,o=t.length;for(;r<o;){let a=t[r],l=t[r];for(;++r<o&&t[r]===l+1;)l++;i<a&&s.push(e.slice(i,a)),a<l+1&&s.push(n(e.slice(a,l+1))),i=l+1}return i<e.length&&s.push(e.slice(i)),s},e.cmp=function(e,t){return e<t?-1:+(e>t)}}(e.StringExt||(e.StringExt={})),e.chain=n,e.each=p,e.empty=s,e.enumerate=r,e.every=g,e.filter=i,e.find=o,e.findIndex=a,e.map=f,e.max=h,e.min=l,e.minmax=u,e.once=w,e.range=m,e.reduce=v,e.repeat=y,e.retro=S,e.some=_,e.stride=C,e.take=P,e.toArray=c,e.toObject=d,e.topologicSort=b,e.zip=k})}),Y=R((e,t)=>{!function(n,s){"object"==typeof e&&void 0!==t?s(e,Gn()):"function"==typeof define&&define.amd?define(["exports","@lumino/algorithm"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_coreutils={},n.lumino_algorithm)}(e,function(e,t){var n;e.JSONExt=void 0,function(e){function t(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e}function n(e){return Array.isArray(e)}function s(e,s){if(e===s)return!0;if(t(e)||t(s))return!1;let r=n(e),a=n(s);return r===a&&(r&&a?i(e,s):o(e,s))}function r(e){return t(e)?e:n(e)?a(e):l(e)}function i(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n)if(!s(e[n],t[n]))return!1;return!0}function o(e,t){if(e===t)return!0;for(let n in e)if(void 0!==e[n]&&!(n in t))return!1;for(let n in t)if(void 0!==t[n]&&!(n in e))return!1;for(let n in e){let r=e[n],i=t[n];if((void 0!==r||void 0!==i)&&(void 0===r||void 0===i||!s(r,i)))return!1}return!0}function a(e){let t=Array(e.length);for(let n=0,s=e.length;n<s;++n)t[n]=r(e[n]);return t}function l(e){let t={};for(let n in e){let s=e[n];void 0!==s&&(t[n]=r(s))}return t}e.emptyObject=Object.freeze({}),e.emptyArray=Object.freeze([]),e.isPrimitive=t,e.isArray=n,e.isObject=function(e){return!t(e)&&!n(e)},e.deepEqual=s,e.deepCopy=r}(e.JSONExt||(e.JSONExt={}));class s{constructor(){this._types=[],this._values=[]}types(){return this._types.slice()}hasData(e){return -1!==this._types.indexOf(e)}getData(e){let t=this._types.indexOf(e);return -1!==t?this._values[t]:void 0}setData(e,t){this.clearData(e),this._types.push(e),this._values.push(t)}clearData(e){let t=this._types.indexOf(e);-1!==t&&(this._types.splice(t,1),this._values.splice(t,1))}clear(){this._types.length=0,this._values.length=0}}class r{constructor(e={}){this._application=null,this._validatePlugin=()=>!0,this._plugins=new Map,this._services=new Map,e.validatePlugin&&(console.info("Plugins may be rejected by the custom validation plugin method."),this._validatePlugin=e.validatePlugin)}get application(){return this._application}set application(e){if(null!==this._application)throw Error("PluginRegistry.application is already set. It cannot be overridden.");this._application=e}get deferredPlugins(){return Array.from(this._plugins).filter(([e,t])=>"defer"===t.autoStart).map(([e,t])=>e)}getPluginDescription(e){var t,n;return null!=(n=null==(t=this._plugins.get(e))?void 0:t.description)?n:""}hasPlugin(e){return this._plugins.has(e)}isPluginActivated(e){var t,n;return null!=(n=null==(t=this._plugins.get(e))?void 0:t.activated)&&n}listPlugins(){return Array.from(this._plugins.keys())}registerPlugin(e){if(this._plugins.has(e.id))throw TypeError(`Plugin '${e.id}' is already registered.`);if(!this._validatePlugin(e))throw Error(`Plugin '${e.id}' is not valid.`);let t=n.createPluginData(e);n.ensureNoCycle(t,this._plugins,this._services),t.provides&&this._services.set(t.provides,t.id),this._plugins.set(t.id,t)}registerPlugins(e){for(let t of e)this.registerPlugin(t)}deregisterPlugin(e,t){let n=this._plugins.get(e);if(n){if(n.activated&&!t)throw Error(`Plugin '${e}' is still active.`);this._plugins.delete(e)}}async activatePlugin(e){let t=this._plugins.get(e);if(!t)throw ReferenceError(`Plugin '${e}' is not registered.`);if(t.activated)return;if(t.promise)return t.promise;let n=t.requires.map(e=>this.resolveRequiredService(e)),s=t.optional.map(e=>this.resolveOptionalService(e));return t.promise=Promise.all([...n,...s]).then(e=>t.activate.apply(void 0,[this.application,...e])).then(e=>{t.service=e,t.activated=!0,t.promise=null}).catch(e=>{throw t.promise=null,e}),t.promise}async activatePlugins(e,t={}){switch(e){case"defer":{let e=this.deferredPlugins.filter(e=>this._plugins.get(e).autoStart).map(e=>this.activatePlugin(e));await Promise.all(e);break}case"startUp":{let e=n.collectStartupPlugins(this._plugins,t).map(async e=>{try{return await this.activatePlugin(e)}catch(t){console.error(`Plugin '${e}' failed to activate.`,t)}});await Promise.all(e)}}}async deactivatePlugin(e){let t=this._plugins.get(e);if(!t)throw ReferenceError(`Plugin '${e}' is not registered.`);if(!t.activated)return[];if(!t.deactivate)throw TypeError(`Plugin '${e}'#deactivate() method missing`);let s=n.findDependents(e,this._plugins,this._services),r=s.map(e=>this._plugins.get(e));for(let t of r)if(!t.deactivate)throw TypeError(`Plugin ${t.id}#deactivate() method missing (depends on ${e})`);for(let e of r){let t=[...e.requires,...e.optional].map(e=>{let t=this._services.get(e);return t?this._plugins.get(t).service:null});await e.deactivate(this.application,...t),e.service=null,e.activated=!1}return s.pop(),s}async resolveRequiredService(e){let t=this._services.get(e);if(!t)throw TypeError(`No provider for: ${e.name}.`);let n=this._plugins.get(t);return n.activated||await this.activatePlugin(t),n.service}async resolveOptionalService(e){let t=this._services.get(e);if(!t)return null;let n=this._plugins.get(t);if(!n.activated)try{await this.activatePlugin(t)}catch(e){return console.error(e),null}return n.service}}!function(e){class n{constructor(e){var t,n,s,r;this._activated=!1,this._promise=null,this._service=null,this.id=e.id,this.description=null!=(t=e.description)?t:"",this.activate=e.activate,this.deactivate=null!=(n=e.deactivate)?n:null,this.provides=null!=(s=e.provides)?s:null,this.autoStart=null!=(r=e.autoStart)&&r,this.requires=e.requires?e.requires.slice():[],this.optional=e.optional?e.optional.slice():[]}get activated(){return this._activated}set activated(e){this._activated=e}get service(){return this._service}set service(e){this._service=e}get promise(){return this._promise}set promise(e){this._promise=e}}e.createPluginData=function(e){return new n(e)},e.ensureNoCycle=function(e,t,n){let s=[...e.requires,...e.optional],r=s=>{if(s===e.provides)return!0;let o=n.get(s);if(!o)return!1;let a=t.get(o),l=[...a.requires,...a.optional];return 0!==l.length&&(i.push(o),!!l.some(r)||(i.pop(),!1))};if(!e.provides||0===s.length)return;let i=[e.id];if(s.some(r))throw ReferenceError(`Cycle detected: ${i.join(" -> ")}.`)},e.findDependents=function(e,n,s){let r=[],i=e=>{let t=n.get(e),i=[...t.requires,...t.optional];r.push(...i.reduce((t,n)=>{let r=s.get(n);return r&&t.push([e,r]),t},[]))};for(let e of n.keys())i(e);let o=r.filter(t=>t[1]===e),a=0;for(;o.length>a;){let e=o.length;for(let e of new Set(o.map(e=>e[0])))r.filter(t=>t[1]===e).forEach(e=>{o.includes(e)||o.push(e)});a=e}let l=t.topologicSort(o),h=l.findIndex(t=>t===e);return -1===h?[e]:l.slice(0,h+1)},e.collectStartupPlugins=function(e,t){let n=new Set;for(let t of e.keys())!0===e.get(t).autoStart&&n.add(t);if(t.startPlugins)for(let e of t.startPlugins)n.add(e);if(t.ignorePlugins)for(let e of t.ignorePlugins)n.delete(e);return Array.from(n)}}(n||(n={}));class i{constructor(){this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){(0,this._resolve)(e)}reject(e){(0,this._reject)(e)}}class o{constructor(e,t){this.name=e,this.description=null!=t?t:"",this._tokenStructuralPropertyT=null}}function a(e){let t=0;for(let n=0,s=e.length;n<s;++n)n%4==0&&(t=0xffffffff*Math.random()>>>0),e[n]=255&t,t>>>=8}function l(e){let t=new Uint8Array(16),n=Array(256);for(let e=0;e<16;++e)n[e]="0"+e.toString(16);for(let e=16;e<256;++e)n[e]=e.toString(16);return function(){return e(t),t[6]=64|15&t[6],t[8]=128|63&t[8],n[t[0]]+n[t[1]]+n[t[2]]+n[t[3]]+"-"+n[t[4]]+n[t[5]]+"-"+n[t[6]]+n[t[7]]+"-"+n[t[8]]+n[t[9]]+"-"+n[t[10]]+n[t[11]]+n[t[12]]+n[t[13]]+n[t[14]]+n[t[15]]}}e.Random=void 0,function(e){e.getRandomValues=(()=>{let e="undefined"!=typeof window&&(window.crypto||window.msCrypto)||null;return e&&"function"==typeof e.getRandomValues?function(t){return e.getRandomValues(t)}:a})()}(e.Random||(e.Random={})),e.UUID=void 0,function(t){t.uuid4=l(e.Random.getRandomValues)}(e.UUID||(e.UUID={})),e.MimeData=s,e.PluginRegistry=r,e.PromiseDelegate=i,e.Token=o})}),ee=R((e,t)=>{!function(n,s){"object"==typeof e&&void 0!==t?s(e,Gn(),Y()):"function"==typeof define&&define.amd?define(["exports","@lumino/algorithm","@lumino/coreutils"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_signaling={},n.lumino_algorithm,n.lumino_coreutils)}(e,function(e,t,n){var s;class r{constructor(e){this.sender=e}connect(e,t){return s.connect(this,e,t)}disconnect(e,t){return s.disconnect(this,e,t)}emit(e){s.emit(this,e)}}!function(e){e.disconnectBetween=function(e,t){s.disconnectBetween(e,t)},e.disconnectSender=function(e){s.disconnectSender(e)},e.disconnectReceiver=function(e){s.disconnectReceiver(e)},e.disconnectAll=function(e){s.disconnectAll(e)},e.clearData=function(e){s.disconnectAll(e)},e.getExceptionHandler=function(){return s.exceptionHandler},e.setExceptionHandler=function(e){let t=s.exceptionHandler;return s.exceptionHandler=e,t}}(r||(r={}));class i extends r{constructor(){super(...arguments),this._pending=new n.PromiseDelegate}async *[Symbol.asyncIterator](){let e=this._pending;for(;;)try{let{args:t,next:n}=await e.promise;e=n,yield t}catch{return}}emit(e){let t=this._pending,s=this._pending=new n.PromiseDelegate;t.resolve({args:e,next:s}),super.emit(e)}stop(){this._pending.promise.catch(()=>{}),this._pending.reject("stop"),this._pending=new n.PromiseDelegate}}(function(e){function n(e){let t=r.get(e);if(!(!t||0===t.length)){for(let e of t){if(!e.signal)continue;let t=e.thisArg||e.slot;e.signal=null,u(i.get(t))}u(t)}}function s(e){let t=i.get(e);if(!(!t||0===t.length)){for(let e of t){if(!e.signal)continue;let t=e.signal.sender;e.signal=null,u(r.get(t))}u(t)}}e.exceptionHandler=e=>{console.error(e)},e.connect=function(e,t,n){n=n||void 0;let s=r.get(e.sender);if(s||(s=[],r.set(e.sender,s)),l(s,e,t,n))return!1;let o=n||t,a=i.get(o);a||(a=[],i.set(o,a));let h={signal:e,slot:t,thisArg:n};return s.push(h),a.push(h),!0},e.disconnect=function(e,t,n){n=n||void 0;let s=r.get(e.sender);if(!s||0===s.length)return!1;let o=l(s,e,t,n);if(!o)return!1;let a=n||t,h=i.get(a);return o.signal=null,u(s),u(h),!0},e.disconnectBetween=function(e,t){let n=r.get(e);if(!n||0===n.length)return;let s=i.get(t);if(!(!s||0===s.length)){for(let t of s)t.signal&&t.signal.sender===e&&(t.signal=null);u(n),u(s)}},e.disconnectSender=n,e.disconnectReceiver=s,e.disconnectAll=function(e){n(e),s(e)},e.emit=function(e,t){let n=r.get(e.sender);if(!(!n||0===n.length))for(let s=0,r=n.length;s<r;++s){let r=n[s];r.signal===e&&h(r,t)}};let r=new WeakMap,i=new WeakMap,o=new Set,a="function"==typeof requestAnimationFrame?requestAnimationFrame:setImmediate;function l(e,n,s,r){return t.find(e,e=>e.signal===n&&e.slot===s&&e.thisArg===r)}function h(t,n){let{signal:s,slot:r,thisArg:i}=t;try{r.call(i,s.sender,n)}catch(t){e.exceptionHandler(t)}}function u(e){0===o.size&&a(c),o.add(e)}function c(){o.forEach(d),o.clear()}function d(e){t.ArrayExt.removeAllWhere(e,p)}function p(e){return null===e.signal}})(s||(s={})),e.Signal=r,e.Stream=i})}),mi=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ActivityMonitor=void 0;var t=ee();e.ActivityMonitor=class{constructor(e){this._timer=-1,this._timeout=-1,this._isDisposed=!1,this._activityStopped=new t.Signal(this),e.signal.connect(this._onSignalFired,this),this._timeout=e.timeout||1e3}get activityStopped(){return this._activityStopped}get timeout(){return this._timeout}set timeout(e){this._timeout=e}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,t.Signal.clearData(this))}_onSignalFired(e,t){clearTimeout(this._timer),this._sender=e,this._args=t,this._timer=setTimeout(()=>{this._activityStopped.emit({sender:this._sender,args:this._args})},this._timeout)}}}),yi=R(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),wi=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LruCache=void 0;var t=128;e.LruCache=class{constructor(e={}){this._map=new Map,this._maxSize=(null==e?void 0:e.maxSize)||t}get size(){return this._map.size}clear(){this._map.clear()}get(e){let t=this._map.get(e)||null;return null!=t&&(this._map.delete(e),this._map.set(e,t)),t}set(e,t){this._map.size>=this._maxSize&&this._map.delete(this._map.keys().next().value),this._map.set(e,t)}}}),bi=R(e=>{var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MarkdownCodeBlocks=void 0,function(e){e.CODE_BLOCK_MARKER="```";let t=[".markdown",".mdown",".mkdn",".md",".mkd",".mdwn",".mdtxt",".mdtext",".text",".txt",".Rmd"];class n{constructor(e){this.startLine=e,this.code="",this.endLine=-1}}function s(t){if(!t||""===t)return[];let s=t.split(`
`),r=[],i=null;for(let t=0;t<s.length;t++){let o=s[t],a=0===o.indexOf(e.CODE_BLOCK_MARKER),l=null!=i;if(!(!a&&!l))if(l)i&&(a?(i.endLine=t-1,r.push(i),i=null):i.code+=o+`
`);else{i=new n(t);let s=o.indexOf(e.CODE_BLOCK_MARKER),a=o.lastIndexOf(e.CODE_BLOCK_MARKER);s!==a&&(i.code=o.substring(s+e.CODE_BLOCK_MARKER.length,a),i.endLine=t,r.push(i),i=null)}}return r}e.MarkdownCodeBlock=n,e.isMarkdown=function(e){return t.indexOf(e)>-1},e.findMarkdownCodeBlocks=s}(t||(e.MarkdownCodeBlocks=t={}))}),Ei=R((e,t)=>{function n(e,t){var n=e;return t.slice(0,-1).forEach(function(e){n=n[e]||{}}),t[t.length-1]in n}function s(e){return!!("number"==typeof e||/^0x[0-9a-f]+$/i.test(e))||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e)}function r(e,t){return"constructor"===t&&"function"==typeof e[t]||"__proto__"===t}t.exports=function(e,t){t||(t={});var i={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(i.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?i.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(e){i.bools[e]=!0});var o={};function a(e){return o[e].some(function(e){return i.bools[e]})}Object.keys(t.alias||{}).forEach(function(e){o[e]=[].concat(t.alias[e]),o[e].forEach(function(t){o[t]=[e].concat(o[e].filter(function(e){return t!==e}))})}),[].concat(t.string).filter(Boolean).forEach(function(e){i.strings[e]=!0,o[e]&&[].concat(o[e]).forEach(function(e){i.strings[e]=!0})});var l=t.default||{},h={_:[]};function u(e,t){return i.allBools&&/^--[^=]+$/.test(t)||i.strings[e]||i.bools[e]||o[e]}function c(e,t,n){for(var s=e,o=0;o<t.length-1;o++){var a=t[o];if(r(s,a))return;void 0===s[a]&&(s[a]={}),(s[a]===Object.prototype||s[a]===Number.prototype||s[a]===String.prototype)&&(s[a]={}),s[a]===Array.prototype&&(s[a]=[]),s=s[a]}var l=t[t.length-1];r(s,l)||((s===Object.prototype||s===Number.prototype||s===String.prototype)&&(s={}),s===Array.prototype&&(s=[]),void 0===s[l]||i.bools[l]||"boolean"==typeof s[l]?s[l]=n:Array.isArray(s[l])?s[l].push(n):s[l]=[s[l],n])}function d(e,t,n){if(!(n&&i.unknownFn&&!u(e,n)&&!1===i.unknownFn(n))){var r=!i.strings[e]&&s(t)?Number(t):t;c(h,e.split("."),r),(o[e]||[]).forEach(function(e){c(h,e.split("."),r)})}}Object.keys(i.bools).forEach(function(e){d(e,void 0!==l[e]&&l[e])});var p=[];-1!==e.indexOf("--")&&(p=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var g=0;g<e.length;g++){var _,f,m=e[g];if(/^--.+=/.test(m)){var v=m.match(/^--([^=]+)=([\s\S]*)$/);_=v[1];var y=v[2];i.bools[_]&&(y="false"!==y),d(_,y,m)}else if(/^--no-.+/.test(m))d(_=m.match(/^--no-(.+)/)[1],!1,m);else if(/^--.+/.test(m))_=m.match(/^--(.+)/)[1],void 0===(f=e[g+1])||/^(-|--)[^-]/.test(f)||i.bools[_]||i.allBools||o[_]&&a(_)?/^(true|false)$/.test(f)?(d(_,"true"===f,m),g+=1):d(_,!i.strings[_]||"",m):(d(_,f,m),g+=1);else if(/^-[^-]+/.test(m)){for(var w=m.slice(1,-1).split(""),S=!1,b=0;b<w.length;b++){if("-"===(f=m.slice(b+2))){d(w[b],f,m);continue}if(/[A-Za-z]/.test(w[b])&&"="===f[0]){d(w[b],f.slice(1),m),S=!0;break}if(/[A-Za-z]/.test(w[b])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(f)){d(w[b],f,m),S=!0;break}if(w[b+1]&&w[b+1].match(/\W/)){d(w[b],m.slice(b+2),m),S=!0;break}d(w[b],!i.strings[w[b]]||"",m)}_=m.slice(-1)[0],S||"-"===_||(!e[g+1]||/^(-|--)[^-]/.test(e[g+1])||i.bools[_]||o[_]&&a(_)?e[g+1]&&/^(true|false)$/.test(e[g+1])?(d(_,"true"===e[g+1],m),g+=1):d(_,!i.strings[_]||"",m):(d(_,e[g+1],m),g+=1))}else if(i.unknownFn&&!1===i.unknownFn(m)||h._.push(i.strings._||!s(m)?m:Number(m)),t.stopEarly){h._.push.apply(h._,e.slice(g+1));break}}return Object.keys(l).forEach(function(e){n(h,e.split("."))||(c(h,e.split("."),l[e]),(o[e]||[]).forEach(function(t){c(h,t.split("."),l[e])}))}),t["--"]?h["--"]=p.slice():p.forEach(function(e){h._.push(e)}),h}}),Wt=R((e,t)=>{function n(e){if("string"!=typeof e)throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function s(e,t){for(var n,s="",r=0,i=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(i!==a-1&&1!==o)if(i!==a-1&&2===o){if(s.length<2||2!==r||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2)){if(s.length>2){var l=s.lastIndexOf("/");if(l!==s.length-1){-1===l?(s="",r=0):r=(s=s.slice(0,l)).length-1-s.lastIndexOf("/"),i=a,o=0;continue}}else if(2===s.length||1===s.length){s="",r=0,i=a,o=0;continue}}t&&(s.length>0?s+="/..":s="..",r=2)}else s.length>0?s+="/"+e.slice(i+1,a):s=e.slice(i+1,a),r=a-i-1;i=a,o=0}else 46===n&&-1!==o?++o:o=-1}return s}function r(e,t){var n=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+s:n+e+s:s}var i={resolve:function(){for(var e,t,r="",i=!1,o=arguments.length-1;o>=-1&&!i;o--)o>=0?e=arguments[o]:(void 0===t&&(t=process.cwd()),e=t),n(e),0!==e.length&&(r=e+"/"+r,i=47===e.charCodeAt(0));return r=s(r,!i),i?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(n(e),0===e.length)return".";var t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return 0!==(e=s(e,!t)).length||t||(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return n(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0==arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var s=arguments[t];n(s),s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":i.normalize(e)},relative:function(e,t){if(n(e),n(t),e===t||(e=i.resolve(e))===(t=i.resolve(t)))return"";for(var s=1;s<e.length&&47===e.charCodeAt(s);++s);for(var r=e.length,o=r-s,a=1;a<t.length&&47===t.charCodeAt(a);++a);for(var l=t.length,h=l-a,u=o<h?o:h,c=-1,d=0;d<=u;++d){if(d===u){if(h>u){if(47===t.charCodeAt(a+d))return t.slice(a+d+1);if(0===d)return t.slice(a+d)}else o>u&&(47===e.charCodeAt(s+d)?c=d:0===d&&(c=0));break}var p=e.charCodeAt(s+d);if(p!==t.charCodeAt(a+d))break;47===p&&(c=d)}var g="";for(d=s+c+1;d<=r;++d)(d===r||47===e.charCodeAt(d))&&(0===g.length?g+="..":g+="/..");return g.length>0?g+t.slice(a+c):(a+=c,47===t.charCodeAt(a)&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(n(e),0===e.length)return".";for(var t=e.charCodeAt(0),s=47===t,r=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return -1===r?s?"/":".":s&&1===r?"//":e.slice(0,r)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw TypeError('"ext" argument must be a string');n(e);var s,r=0,i=-1,o=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(s=e.length-1;s>=0;--s){var h=e.charCodeAt(s);if(47===h){if(!o){r=s+1;break}}else -1===l&&(o=!1,l=s+1),a>=0&&(h===t.charCodeAt(a)?-1==--a&&(i=s):(a=-1,i=l))}return r===i?i=l:-1===i&&(i=e.length),e.slice(r,i)}for(s=e.length-1;s>=0;--s)if(47===e.charCodeAt(s)){if(!o){r=s+1;break}}else -1===i&&(o=!1,i=s+1);return -1===i?"":e.slice(r,i)},extname:function(e){n(e);for(var t=-1,s=0,r=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(47===l){if(!i){s=a+1;break}continue}-1===r&&(i=!1,r=a+1),46===l?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1)}return -1===t||-1===r||0===o||1===o&&t===r-1&&t===s+1?"":e.slice(t,r)},format:function(e){if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return r("/",e)},parse:function(e){n(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var s,r=e.charCodeAt(0),i=47===r;i?(t.root="/",s=1):s=0;for(var o=-1,a=0,l=-1,h=!0,u=e.length-1,c=0;u>=s;--u){if(47===(r=e.charCodeAt(u))){if(!h){a=u+1;break}continue}-1===l&&(h=!1,l=u+1),46===r?-1===o?o=u:1!==c&&(c=1):-1!==o&&(c=-1)}return -1===o||-1===l||0===c||1===c&&o===l-1&&o===a+1?-1!==l&&(0===a&&i?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(0===a&&i?(t.name=e.slice(1,o),t.base=e.slice(1,l)):(t.name=e.slice(a,o),t.base=e.slice(a,l)),t.ext=e.slice(o,l)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};i.posix=i,t.exports=i}),Oi=R((e,t)=>{t.exports=function(e,t){if(t=t.split(":")[0],!(e*=1))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}}),Ti=R(e=>{var t,n=Object.prototype.hasOwnProperty;function s(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function r(e){try{return encodeURIComponent(e)}catch{return null}}function i(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var i=s(t[1]),o=s(t[2]);null===i||null===o||i in r||(r[i]=o)}return r}e.stringify=function(e,s){var i,o,a=[];for(o in"string"!=typeof(s=s||"")&&(s="?"),e)if(n.call(e,o)){if(!(i=e[o])&&(null===i||i===t||isNaN(i))&&(i=""),o=r(o),i=r(i),null===o||null===i)continue;a.push(o+"="+i)}return a.length?s+a.join("&"):""},e.parse=i}),Ki=R((e,t)=>{var n=Oi(),s=Ti(),r=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,a=/:\d+$/,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,h=/^[a-zA-Z]:/;function u(e){return(e||"").toString().replace(r,"")}var c=[["#","hash"],["?","query"],function(e,t){return g(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],d={hash:1,query:1};function p(e){var t,n,s=(t="undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{}).location||{},r={},i=typeof(e=e||s);if("blob:"===e.protocol)r=new m(unescape(e.pathname),{});else if("string"===i)for(n in r=new m(e,{}),d)delete r[n];else if("object"===i){for(n in e)n in d||(r[n]=e[n]);void 0===r.slashes&&(r.slashes=o.test(e.href))}return r}function g(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function _(e,t){e=(e=u(e)).replace(i,""),t=t||{};var n,s=l.exec(e),r=s[1]?s[1].toLowerCase():"",o=!!s[2],a=!!s[3],h=0;return o?a?(n=s[2]+s[3]+s[4],h=s[2].length+s[3].length):(n=s[2]+s[4],h=s[2].length):a?(n=s[3]+s[4],h=s[3].length):n=s[4],"file:"===r?h>=2&&(n=n.slice(2)):g(r)?n=s[4]:r?o&&(n=n.slice(2)):h>=2&&g(t.protocol)&&(n=s[4]),{protocol:r,slashes:o||g(r),slashesCount:h,rest:n}}function f(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),s=n.length,r=n[s-1],i=!1,o=0;s--;)"."===n[s]?n.splice(s,1):".."===n[s]?(n.splice(s,1),o++):o&&(0===s&&(i=!0),n.splice(s,1),o--);return i&&n.unshift(""),("."===r||".."===r)&&n.push(""),n.join("/")}function m(e,t,r){if(e=(e=u(e)).replace(i,""),!(this instanceof m))return new m(e,t,r);var o,a,l,d,v,y,w=c.slice(),S=typeof t,b=this,C=0;for("object"!==S&&"string"!==S&&(r=t,t=null),r&&"function"!=typeof r&&(r=s.parse),o=!(a=_(e||"",t=p(t))).protocol&&!a.slashes,b.slashes=a.slashes||o&&t.slashes,b.protocol=a.protocol||t.protocol||"",e=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||h.test(e))||!a.slashes&&(a.protocol||a.slashesCount<2||!g(b.protocol)))&&(w[3]=[/(.*)/,"pathname"]);C<w.length;C++){if("function"==typeof(d=w[C])){e=d(e,b);continue}l=d[0],y=d[1],l!=l?b[y]=e:"string"==typeof l?~(v="@"===l?e.lastIndexOf(l):e.indexOf(l))&&("number"==typeof d[2]?(b[y]=e.slice(0,v),e=e.slice(v+d[2])):(b[y]=e.slice(v),e=e.slice(0,v))):(v=l.exec(e))&&(b[y]=v[1],e=e.slice(0,v.index)),b[y]=b[y]||o&&d[3]&&t[y]||"",d[4]&&(b[y]=b[y].toLowerCase())}r&&(b.query=r(b.query)),o&&t.slashes&&"/"!==b.pathname.charAt(0)&&(""!==b.pathname||""!==t.pathname)&&(b.pathname=f(b.pathname,t.pathname)),"/"!==b.pathname.charAt(0)&&g(b.protocol)&&(b.pathname="/"+b.pathname),n(b.port,b.protocol)||(b.host=b.hostname,b.port=""),b.username=b.password="",b.auth&&(~(v=b.auth.indexOf(":"))?(b.username=b.auth.slice(0,v),b.username=encodeURIComponent(decodeURIComponent(b.username)),b.password=b.auth.slice(v+1),b.password=encodeURIComponent(decodeURIComponent(b.password))):b.username=encodeURIComponent(decodeURIComponent(b.auth)),b.auth=b.password?b.username+":"+b.password:b.username),b.origin="file:"!==b.protocol&&g(b.protocol)&&b.host?b.protocol+"//"+b.host:"null",b.href=b.toString()}m.prototype={set:function(e,t,r){var i=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||s.parse)(t)),i[e]=t;break;case"port":i[e]=t,n(t,i.protocol)?t&&(i.host=i.hostname+":"+t):(i.host=i.hostname,i[e]="");break;case"hostname":i[e]=t,i.port&&(t+=":"+i.port),i.host=t;break;case"host":i[e]=t,a.test(t)?(i.port=(t=t.split(":")).pop(),i.hostname=t.join(":")):(i.hostname=t,i.port="");break;case"protocol":i.protocol=t.toLowerCase(),i.slashes=!r;break;case"pathname":case"hash":if(t){var o="pathname"===e?"/":"#";i[e]=t.charAt(0)!==o?o+t:t}else i[e]=t;break;case"username":case"password":i[e]=encodeURIComponent(t);break;case"auth":var l=t.indexOf(":");~l?(i.username=t.slice(0,l),i.username=encodeURIComponent(decodeURIComponent(i.username)),i.password=t.slice(l+1),i.password=encodeURIComponent(decodeURIComponent(i.password))):i.username=encodeURIComponent(decodeURIComponent(t))}for(var h=0;h<c.length;h++){var u=c[h];u[4]&&(i[u[1]]=i[u[1]].toLowerCase())}return i.auth=i.password?i.username+":"+i.password:i.username,i.origin="file:"!==i.protocol&&g(i.protocol)&&i.host?i.protocol+"//"+i.host:"null",i.href=i.toString(),i},toString:function(e){e&&"function"==typeof e||(e=s.stringify);var t,n=this,r=n.host,i=n.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var o=i+(n.protocol&&n.slashes||g(n.protocol)?"//":"");return n.username?(o+=n.username,n.password&&(o+=":"+n.password),o+="@"):n.password?(o+=":"+n.password,o+="@"):"file:"!==n.protocol&&g(n.protocol)&&!r&&"/"!==n.pathname&&(o+="@"),(":"===r[r.length-1]||a.test(n.hostname)&&!n.port)&&(r+=":"),o+=r+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(o+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(o+=n.hash),o}},m.extractProtocol=_,m.location=p,m.trimLeft=u,m.qs=s,t.exports=m}),ts=R(e=>{var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.URLExt=void 0;var n,s=Wt(),r=t(Ki());!function(e){function t(e){if("undefined"!=typeof document&&document){let t=document.createElement("a");return t.href=e,t}return(0,r.default)(e)}function n(...e){let t=(0,r.default)(e[0],{}),i=""===t.protocol&&t.slashes;i&&(t=(0,r.default)(e[0],"https:"+e[0]));let o=`${i?"":t.protocol}${t.slashes?"//":""}${t.auth}${t.auth?"@":""}${t.host}`,a=s.posix.join(`${o&&"/"!==t.pathname[0]?"/":""}${t.pathname}`,...e.slice(1));return`${o}${"."===a?"":a}`}e.parse=t,e.getHostName=function(e){return(0,r.default)(e).hostname},e.normalize=function(e){return e&&t(e).toString()},e.join=n,e.encodeParts=function(e){return n(...e.split("/").map(encodeURIComponent))},e.objectToQueryString=function(e){let t=Object.keys(e).filter(e=>e.length>0);return t.length?"?"+t.map(t=>{let n=encodeURIComponent(String(e[t]));return t+(n?"="+n:"")}).join("&"):""},e.queryStringToObject=function(e){return e.replace(/^\?/,"").split("&").reduce((e,t)=>{let[n,s]=t.split("=");return n.length>0&&(e[n]=decodeURIComponent(s||"")),e},{})},e.isLocal=function(e,n=!1){let{protocol:s}=t(e);return(!s||0!==e.toLowerCase().indexOf(s))&&(n?0!==e.indexOf("//"):0!==e.indexOf("/"))}}(n||(e.URLExt=n={}))}),Vi=R((exports,module)=>{var __importDefault=exports&&exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PageConfig=void 0;var PageConfig,coreutils_1=Y(),minimist_1=__importDefault(Ei()),url_1=ts();!function(PageConfig){let Extension;function getOption(name){if(configData)return configData[name]||getBodyData(name);configData=Object.create(null);let found=!1;if("undefined"!=typeof document&&document){let n=document.getElementById("jupyter-config-data");n&&(configData=JSON.parse(n.textContent||""),found=!0)}if(!found&&void 0!==process&&process.argv)try{let cli=(0,minimist_1.default)(process.argv.slice(2)),path=Wt(),fullPath="";"jupyter-config-data"in cli?fullPath=path.resolve(cli["jupyter-config-data"]):"JUPYTER_CONFIG_DATA"in process.env&&(fullPath=path.resolve(process.env.JUPYTER_CONFIG_DATA)),fullPath&&(configData=eval("require")(fullPath))}catch(n){console.error(n)}if(coreutils_1.JSONExt.isObject(configData))for(let n in configData)"string"!=typeof configData[n]&&(configData[n]=JSON.stringify(configData[n]));else configData=Object.create(null);return configData[name]||getBodyData(name)}function setOption(e,t){let n=getOption(e);return configData[e]=t,n}function getBaseUrl(){return url_1.URLExt.normalize(getOption("baseUrl")||"/")}function getTreeUrl(){return url_1.URLExt.join(getBaseUrl(),getOption("treeUrl"))}function getShareUrl(){return url_1.URLExt.normalize(getOption("shareUrl")||getBaseUrl())}function getTreeShareUrl(){return url_1.URLExt.normalize(url_1.URLExt.join(getShareUrl(),getOption("treeUrl")))}function getUrl(e){var t,n,s,r;let i=e.toShare?getShareUrl():getBaseUrl(),o=null!=(t=e.mode)?t:getOption("mode"),a=null!=(n=e.workspace)?n:getOption("workspace"),l="single-document"===o?"doc":"lab";i=url_1.URLExt.join(i,l),a!==PageConfig.defaultWorkspace&&(i=url_1.URLExt.join(i,"workspaces",encodeURIComponent(null!=(s=getOption("workspace"))?s:PageConfig.defaultWorkspace)));let h=null!=(r=e.treePath)?r:getOption("treePath");return h&&(i=url_1.URLExt.join(i,"tree",url_1.URLExt.encodeParts(h))),i}function getWsUrl(e){let t=getOption("wsUrl");if(!t){if(0!==(e=e?url_1.URLExt.normalize(e):getBaseUrl()).indexOf("http"))return"";t="ws"+e.slice(4)}return url_1.URLExt.normalize(t)}function getNBConvertURL({path:e,format:t,download:n}){let s=url_1.URLExt.encodeParts(e),r=url_1.URLExt.join(getBaseUrl(),"nbconvert",t,s);return n?r+"?download=true":r}function getToken(){return getOption("token")||getBodyData("jupyterApiToken")}function getNotebookVersion(){let e=getOption("notebookVersion");return""===e?[0,0,0]:JSON.parse(e)}PageConfig.getOption=getOption,PageConfig.setOption=setOption,PageConfig.getBaseUrl=getBaseUrl,PageConfig.getTreeUrl=getTreeUrl,PageConfig.getShareUrl=getShareUrl,PageConfig.getTreeShareUrl=getTreeShareUrl,PageConfig.getUrl=getUrl,PageConfig.defaultWorkspace="default",PageConfig.getWsUrl=getWsUrl,PageConfig.getNBConvertURL=getNBConvertURL,PageConfig.getToken=getToken,PageConfig.getNotebookVersion=getNotebookVersion;let configData=null;function getBodyData(e){if("undefined"==typeof document||!document.body)return"";let t=document.body.dataset[e];return void 0===t?"":decodeURIComponent(t)}!function(e){function t(e){try{let t=getOption(e);if(t)return JSON.parse(t)}catch(t){console.warn(`Unable to parse ${e}.`,t)}return[]}function n(t){let n=t.indexOf(":"),s="";return -1!==n&&(s=t.slice(0,n)),e.deferred.some(e=>e===t||s&&e===s)}function s(t){let n=t.indexOf(":"),s="";return -1!==n&&(s=t.slice(0,n)),e.disabled.some(e=>e===t||s&&e===s)}e.deferred=t("deferredExtensions"),e.disabled=t("disabledExtensions"),e.isDeferred=n,e.isDisabled=s}(Extension=PageConfig.Extension||(PageConfig.Extension={}))}(PageConfig||(exports.PageConfig=PageConfig={}))}),Wi=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PathExt=void 0;var t,n=Wt();!function(e){function t(e){return 0===e.indexOf("/")&&(e=e.slice(1)),e}e.join=function(...e){let s=n.posix.join(...e);return"."===s?"":t(s)},e.joinWithLeadingSlash=function(...e){let t=n.posix.join(...e);return"."===t?"":t},e.basename=function(e,t){return n.posix.basename(e,t)},e.dirname=function(e){let s=t(n.posix.dirname(e));return"."===s?"":s},e.extname=function(e){return n.posix.extname(e)},e.normalize=function(e){return""===e?"":t(n.posix.normalize(e))},e.resolve=function(...e){return t(n.posix.resolve(...e))},e.relative=function(e,s){return t(n.posix.relative(e,s))},e.normalizeExtension=function(e){return e.length>0&&0!==e.indexOf(".")&&(e=`.${e}`),e},e.removeSlash=t}(t||(e.PathExt=t={}))}),$i=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.signalToPromise=n;var t=Y();function n(e,n){let s=new t.PromiseDelegate;function r(){e.disconnect(i)}function i(e,t){r(),s.resolve([e,t])}return e.connect(i),(null!=n?n:0)>0&&setTimeout(()=>{r(),s.reject(`Signal not emitted within ${n} ms.`)},n),s.promise}}),Ji=R(e=>{var t;Object.defineProperty(e,"__esModule",{value:!0}),e.Text=void 0,function(e){let t=!0;e.jsIndexToCharIndex=function(e,n){if(t)return e;let s=e;for(let t=0;t+1<n.length&&t<e;t++){let e=n.charCodeAt(t);if(e>=55296&&e<=56319){let e=n.charCodeAt(t+1);e>=56320&&e<=57343&&(s--,t++)}}return s},e.charIndexToJsIndex=function(e,n){if(t)return e;let s=e;for(let e=0;e+1<n.length&&e<s;e++){let t=n.charCodeAt(e);if(t>=55296&&t<=56319){let t=n.charCodeAt(e+1);t>=56320&&t<=57343&&(s++,e++)}}return s},e.camelCase=function(e,t=!1){return e.replace(/^(\w)|[\s-_:]+(\w)/g,function(e,n,s){return s?s.toUpperCase():t?n.toUpperCase():n.toLowerCase()})},e.titleCase=function(e){return(e||"").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}}(t||(e.Text=t={}))}),Xi=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Time=void 0;var t,n=[{name:"years",milliseconds:31536e6},{name:"months",milliseconds:2592e6},{name:"days",milliseconds:864e5},{name:"hours",milliseconds:36e5},{name:"minutes",milliseconds:6e4},{name:"seconds",milliseconds:1e3}];!function(e){e.formatHuman=function(e,t="long"){let s=document.documentElement.lang||"en",r=new Intl.RelativeTimeFormat(s,{numeric:"auto",style:t}),i=new Date(e).getTime()-Date.now();for(let e of n){let t=Math.ceil(i/e.milliseconds);if(0!==t)return r.format(t,e.name)}return r.format(0,"seconds")},e.format=function(e){let t=document.documentElement.lang||"en";return new Intl.DateTimeFormat(t,{dateStyle:"short",timeStyle:"short"}).format(new Date(e))}}(t||(e.Time=t={}))}),Yi=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.JupyterPluginRegistry=void 0;var t=Y(),n=5e3;e.JupyterPluginRegistry=class extends t.PluginRegistry{constructor(e){var t;super(e),this._pluginData=new Map,this._expectedActivationTime=null!=(t=null==e?void 0:e.expectedActivationTime)?t:n}registerPlugin(e){return this._pluginData.set(e.id,e),super.registerPlugin(e)}async activatePlugin(e){let t=performance.now(),n=setTimeout(()=>{console.warn(`Plugin ${e} is taking too long to activate.`)},this._expectedActivationTime);try{let s=await super.activatePlugin(e);clearTimeout(n);let r=performance.now()-t;if(r>=this._expectedActivationTime){let t=this._getDependentCount(e);console.warn(`Plugin ${e} (with ${t} dependants) took ${r.toFixed(2)}ms to activate.`)}return s}catch(t){throw clearTimeout(n),console.error(`Error activating plugin: ${e}`,t),t}}_getDependentCount(e){var t;let n=this._pluginData.get(e);if(!(null!=n&&n.provides))return 0;let s=n.provides.name,r=0;for(let[n,i]of this._pluginData.entries())n!==e&&(null==(t=i.requires)?void 0:t.filter(e=>!!e).some(e=>e.name===s))&&r++;return r}}}),te=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(mi(),e),n(yi(),e),n(wi(),e),n(bi(),e),n(Vi(),e),n(Wi(),e),n($i(),e),n(Ji(),e),n(Xi(),e),n(ts(),e),n(Yi(),e)}),Ze=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.supportedKernelWebSocketProtocols=void 0,e.createMessage=s,e.isStreamMsg=r,e.isDisplayDataMsg=i,e.isUpdateDisplayDataMsg=o,e.isExecuteInputMsg=a,e.isExecuteResultMsg=l,e.isErrorMsg=h,e.isStatusMsg=u,e.isClearOutputMsg=c,e.isDebugEventMsg=d,e.isCommOpenMsg=p,e.isCommCloseMsg=g,e.isCommMsgMsg=_,e.isInfoRequestMsg=f,e.isExecuteReplyMsg=m,e.isDebugRequestMsg=v,e.isDebugReplyMsg=y,e.isInputRequestMsg=w,e.isInputReplyMsg=S;var t,n=Y();function s(e){var t,s,r,i,o,a;return{buffers:null!=(t=e.buffers)?t:[],channel:e.channel,content:e.content,header:{date:new Date().toISOString(),msg_id:null!=(s=e.msgId)?s:n.UUID.uuid4(),msg_type:e.msgType,session:e.session,username:null!=(r=e.username)?r:"",subshell_id:null!=(i=e.subshellId)?i:null,version:"5.2"},metadata:null!=(o=e.metadata)?o:{},parent_header:null!=(a=e.parentHeader)?a:{}}}function r(e){return"stream"===e.header.msg_type}function i(e){return"display_data"===e.header.msg_type}function o(e){return"update_display_data"===e.header.msg_type}function a(e){return"execute_input"===e.header.msg_type}function l(e){return"execute_result"===e.header.msg_type}function h(e){return"error"===e.header.msg_type}function u(e){return"status"===e.header.msg_type}function c(e){return"clear_output"===e.header.msg_type}function d(e){return"debug_event"===e.header.msg_type}function p(e){return"comm_open"===e.header.msg_type}function g(e){return"comm_close"===e.header.msg_type}function _(e){return"comm_msg"===e.header.msg_type}function f(e){return"kernel_info_request"===e.header.msg_type}function m(e){return"execute_reply"===e.header.msg_type}function v(e){return"debug_request"===e.header.msg_type}function y(e){return"debug_reply"===e.header.msg_type}function w(e){return"input_request"===e.header.msg_type}function S(e){return"input_reply"===e.header.msg_type}!function(e){e.v1KernelWebsocketJupyterOrg="v1.kernel.websocket.jupyter.org"}(t||(e.supportedKernelWebSocketProtocols=t={}))}),er=R(e=>{var t,n=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),s=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t};Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=o,e.deserialize=a;var i=r(Ze());function o(e,n=""){return n===i.supportedKernelWebSocketProtocols.v1KernelWebsocketJupyterOrg?t.serializeV1KernelWebsocketJupyterOrg(e):t.serializeDefault(e)}function a(e,n=""){return n===i.supportedKernelWebSocketProtocols.v1KernelWebsocketJupyterOrg?t.deserializeV1KernelWebsocketJupyterOrg(e):t.deserializeDefault(e)}!function(e){function t(e){let t=new DataView(e),n=t.getUint32(0),s=[];if(n<2)throw Error("Invalid incoming Kernel Message");for(let e=1;e<=n;e++)s.push(t.getUint32(4*e));let r=new Uint8Array(e.slice(s[0],s[1])),i=JSON.parse(new TextDecoder("utf8").decode(r));i.buffers=[];for(let t=1;t<n;t++){let n=s[t],r=s[t+1]||e.byteLength;i.buffers.push(new DataView(e.slice(n,r)))}return i}function n(e){let t=[],n=[],s=new TextEncoder,r=[];void 0!==e.buffers&&(r=e.buffers,delete e.buffers);let i=s.encode(JSON.stringify(e));n.push(i.buffer);for(let e=0;e<r.length;e++){let t=r[e];n.push(ArrayBuffer.isView(t)?t.buffer:t)}let o=n.length;t.push(4*(o+1));for(let e=0;e+1<n.length;e++)t.push(t[t.length-1]+n[e].byteLength);let a=new Uint8Array(t[t.length-1]+n[n.length-1].byteLength),l=new DataView(a.buffer);l.setUint32(0,o);for(let e=0;e<t.length;e++)l.setUint32(4*(e+1),t[e]);for(let e=0;e<n.length;e++)a.set(new Uint8Array(n[e]),t[e]);return a.buffer}e.deserializeV1KernelWebsocketJupyterOrg=function(e){let t=new DataView(e),n=Number(t.getBigUint64(0,!0)),s=[];for(let e=0;e<n;e++)s.push(Number(t.getBigUint64(8*(e+1),!0)));let r=new TextDecoder("utf8"),i=r.decode(e.slice(s[0],s[1])),o=JSON.parse(r.decode(e.slice(s[1],s[2]))),a=JSON.parse(r.decode(e.slice(s[2],s[3]))),l=JSON.parse(r.decode(e.slice(s[3],s[4]))),h=JSON.parse(r.decode(e.slice(s[4],s[5]))),u=[];for(let t=5;t<s.length-1;t++)u.push(new DataView(e.slice(s[t],s[t+1])));return{channel:i,header:o,parent_header:a,metadata:l,content:h,buffers:u}},e.serializeV1KernelWebsocketJupyterOrg=function(e){let t=JSON.stringify(e.header),n=null==e.parent_header?"{}":JSON.stringify(e.parent_header),s=JSON.stringify(e.metadata),r=JSON.stringify(e.content),i=void 0!==e.buffers?e.buffers:[],o=5+i.length+1,a=[];a.push(8*(1+o)),a.push(e.channel.length+a[a.length-1]);let l=new TextEncoder,h=l.encode(e.channel),u=l.encode(t),c=l.encode(n),d=l.encode(s),p=l.encode(r),g=new Uint8Array(h.length+u.length+c.length+d.length+p.length);for(let e of(g.set(h),g.set(u,h.length),g.set(c,h.length+u.length),g.set(d,h.length+u.length+c.length),g.set(p,h.length+u.length+c.length+d.length),[u.length,c.length,d.length,p.length]))a.push(e+a[a.length-1]);let _=0;for(let e of i){let t=e.byteLength;a.push(t+a[a.length-1]),_+=t}let f=new Uint8Array(8*(1+o)+g.byteLength+_),m=new ArrayBuffer(8),v=new DataView(m);v.setBigUint64(0,BigInt(o),!0),f.set(new Uint8Array(m),0);for(let e=0;e<a.length;e++)v.setBigUint64(0,BigInt(a[e]),!0),f.set(new Uint8Array(m),8*(e+1));f.set(g,a[0]);for(let e=0;e<i.length;e++){let t=i[e];f.set(new Uint8Array(ArrayBuffer.isView(t)?t.buffer:t),a[5+e])}return f.buffer},e.deserializeDefault=function(e){return"string"==typeof e?JSON.parse(e):t(e)},e.serializeDefault=function(e){var t;return null!=(t=e.buffers)&&t.length?n(e):JSON.stringify(e)}}(t||(t={}))}),tr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=WebSocket}),de=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ServerConnection=void 0;var t,n,s,r=te(),i=er();s="undefined"==typeof window?tr():WebSocket,function(e){e.makeSettings=function(e){return n.makeSettings(e)},e.makeRequest=function(e,t,s){return n.handleRequest(e,t,s)};class t extends Error{static async create(e){try{let{message:n,traceback:s}=await e.json();return s&&console.error(s),new t(e,null!=n?n:t._defaultMessage(e),null!=s?s:"")}catch(n){return console.debug(n),new t(e)}}constructor(e,n=t._defaultMessage(e),s=""){super(n),this.response=e,this.traceback=s}static _defaultMessage(e){return`Invalid response: ${e.status} ${e.statusText}`}}e.ResponseError=t;class s extends TypeError{constructor(e){super(e.message),this.stack=e.stack}}e.NetworkError=s}(t||(e.ServerConnection=t={})),function(e){function n(e){let t="";try{t=document.cookie}catch{return}let n=t.match("\\b"+e+"=([^;]*)\\b");return null==n?void 0:n[1]}e.makeSettings=function(e={}){var t;let n=r.PageConfig.getBaseUrl(),o=r.PageConfig.getWsUrl(),a=r.URLExt.normalize(e.baseUrl)||n,l=e.wsUrl;l||a!==n||(l=o),l||0!==a.indexOf("http")||(l="ws"+a.slice(4)),l=null!=l?l:o;let h=r.PageConfig.getOption("appendToken").toLowerCase(),u;return u=""===h?"undefined"==typeof window||void 0!==process&&(null==(t=null==process?void 0:process.env)?void 0:t.JEST_WORKER_ID)!==void 0||r.URLExt.getHostName(n)!==r.URLExt.getHostName(l):"true"===h,{init:{cache:"no-store",credentials:"same-origin"},fetch,Headers,Request,WebSocket:s,token:r.PageConfig.getToken(),appUrl:r.PageConfig.getOption("appUrl"),appendToken:u,serializer:{serialize:i.serialize,deserialize:i.deserialize},...e,baseUrl:a,wsUrl:l}},e.handleRequest=function(e,s,r){var i;if(0!==e.indexOf(r.baseUrl))throw Error("Can only be used for notebook server requests");(null!=(i=s.cache)?i:r.init.cache)==="no-store"&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let o=new r.Request(e,{...r.init,...s}),a=!1;if(r.token&&(a=!0,o.headers.append("Authorization",`token ${r.token}`)),"undefined"!=typeof document){let e=n("_xsrf");void 0!==e&&(a=!0,o.headers.append("X-XSRFToken",e))}return!o.headers.has("Content-Type")&&a&&o.headers.set("Content-Type","application/json"),r.fetch.call(null,o).catch(e=>{throw new t.NetworkError(e)})}}(n||(n={}))}),$e=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseManager=void 0;var t=ee(),n=de();e.BaseManager=class{constructor(e){var s;this._isDisposed=!1,this._disposed=new t.Signal(this),this.serverSettings=null!=(s=e.serverSettings)?s:n.ServerConnection.makeSettings()}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get isActive(){return!0}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(void 0),t.Signal.clearData(this))}}}),rr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigWithDefaults=e.ConfigSection=e.ConfigSectionManager=void 0;var t,n=te(),s=Ae(),r="api/config";e.ConfigSectionManager=class{constructor(e){var t;this.serverSettings=null!=(t=e.serverSettings)?t:s.ServerConnection.makeSettings()}async create(e){let t=new i({...e,serverSettings:this.serverSettings});return await t.load(),t}},function(e){let t;e.create=async function(e){if(!t){let t=new i(e);return await t.load(),t}return await t.create(e)},e._setConfigSectionManager=function(e){if(t)throw Error("ConfigSectionManager already set. If you would like to create a config section, use the `IConfigSectionManager` token in a plugin.");t=e}}(t||(e.ConfigSection=t={}));var i=class{constructor(e){var t;this.serverSettings=null!=(t=e.serverSettings)?t:s.ServerConnection.makeSettings(),this._name=e.name}get data(){return this._data}async load(){let e=await s.ServerConnection.makeRequest(this._url,{},this.serverSettings);if(200!==e.status)throw await s.ServerConnection.ResponseError.create(e);this._data=await e.json()}async update(e){this._data={...this._data,...e};let t={method:"PATCH",body:JSON.stringify(e)},n=await s.ServerConnection.makeRequest(this._url,t,this.serverSettings);if(200!==n.status)throw await s.ServerConnection.ResponseError.create(n);return this._data=await n.json(),this._data}get _url(){return n.URLExt.join(this.serverSettings.baseUrl,r,encodeURIComponent(this._name))}};e.ConfigWithDefaults=class{constructor(e){var t,n;this._className="",this._section=e.section,this._defaults=null!=(t=e.defaults)?t:{},this._className=null!=(n=e.className)?n:""}get(e){let t=this._classData();return e in t?t[e]:this._defaults[e]}set(e,t){let n={};if(n[e]=t,!this._className)return this._section.update(n);{let e={};return e[this._className]=n,this._section.update(e)}}_classData(){let e=this._section.data;return this._className&&this._className in e?e[this._className]:e}}}),or=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionStatus=void 0,e.ConnectionStatus=class{constructor(){this.isConnected=!0}}}),rn=R((e,t)=>{!function(n,s){"object"==typeof e&&void 0!==t?s(e,ee()):"function"==typeof define&&define.amd?define(["exports","@lumino/signaling"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_disposable={},n.lumino_signaling)}(e,function(e,t){class n{constructor(e){this._fn=e}get isDisposed(){return!this._fn}dispose(){if(!this._fn)return;let e=this._fn;this._fn=null,e()}}class s extends n{constructor(){super(...arguments),this._disposed=new t.Signal(this)}get disposed(){return this._disposed}dispose(){this.isDisposed||(super.dispose(),this._disposed.emit(void 0),t.Signal.clearData(this))}}class r{constructor(){this._isDisposed=!1,this._items=new Set}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._items.forEach(e=>{e.dispose()}),this._items.clear())}contains(e){return this._items.has(e)}add(e){this._items.add(e)}remove(e){this._items.delete(e)}clear(){this._items.clear()}}!function(e){function t(t){let n=new e;for(let e of t)n.add(e);return n}e.from=t}(r||(r={}));class i extends r{constructor(){super(...arguments),this._disposed=new t.Signal(this)}get disposed(){return this._disposed}dispose(){this.isDisposed||(super.dispose(),this._disposed.emit(void 0),t.Signal.clearData(this))}}(function(e){function t(t){let n=new e;for(let e of t)n.add(e);return n}e.from=t})(i||(i={})),e.DisposableDelegate=n,e.DisposableSet=r,e.ObservableDisposableDelegate=s,e.ObservableDisposableSet=i})}),lt=R(e=>{function t(e,n,s,r=[]){if(!e.hasOwnProperty(n))throw Error(`Missing property '${n}'`);let i=e[n];if(void 0!==s){let e=!0;switch(s){case"array":e=Array.isArray(i);break;case"object":e=void 0!==i;break;default:e=typeof i===s}if(!e)throw Error(`Property '${n}' is not of type '${s}'`);if(r.length>0){let e=!0;switch(s){case"string":case"number":case"boolean":e=r.includes(i);break;default:e=r.findIndex(e=>e===i)>=0}if(!e)throw Error(`Property '${n}' is not one of the valid values ${JSON.stringify(r)}`)}}}Object.defineProperty(e,"__esModule",{value:!0}),e.validateProperty=t}),lr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateContentsModel=n,e.validateCheckpointModel=s;var t=lt();function n(e){(0,t.validateProperty)(e,"name","string"),(0,t.validateProperty)(e,"path","string"),(0,t.validateProperty)(e,"type","string"),(0,t.validateProperty)(e,"created","string"),(0,t.validateProperty)(e,"last_modified","string"),(0,t.validateProperty)(e,"mimetype","object"),(0,t.validateProperty)(e,"content","object"),(0,t.validateProperty)(e,"format","object")}function s(e){(0,t.validateProperty)(e,"id","string"),(0,t.validateProperty)(e,"last_modified","string")}}),_s=R(e=>{var t,n=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),s=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t};Object.defineProperty(e,"__esModule",{value:!0}),e.RestContentProvider=e.ContentProviderRegistry=e.Drive=e.ContentsManager=e.Contents=void 0;var i,o=te(),a=rn(),l=ee(),h=Ae(),u=r(lr()),c="api/contents",d="files";!function(e){e.validateContentsModel=function(e){u.validateContentsModel(e)},e.validateCheckpointModel=function(e){u.validateCheckpointModel(e)}}(i||(e.Contents=i={})),e.ContentsManager=class{constructor(e={}){var t,n;this._isDisposed=!1,this._additionalDrives=new Map,this._fileChanged=new l.Signal(this);let s=this.serverSettings=null!=(t=e.serverSettings)?t:h.ServerConnection.makeSettings();this._defaultDrive=null!=(n=e.defaultDrive)?n:new p({serverSettings:s}),this._defaultDrive.fileChanged.connect(this._onFileChanged,this)}get defaultDrive(){return this._defaultDrive}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,l.Signal.clearData(this))}addDrive(e){this._additionalDrives.set(e.name,e),e.fileChanged.connect(this._onFileChanged,this)}getSharedModelFactory(e,t){var n,s;let[r]=this._driveForPath(e),i=null==(n=r.contentProviderRegistry)?void 0:n.getProvider(null==t?void 0:t.contentProviderId);return null!=i&&i.sharedModelFactory?i.sharedModelFactory:null!=(s=r.sharedModelFactory)?s:null}localPath(e){let t=e.split("/"),n=t[0].split(":");return 1!==n.length&&this._additionalDrives.has(n[0])?o.PathExt.join(n.slice(1).join(":"),...t.slice(1)):o.PathExt.removeSlash(e)}normalize(e){let t=e.split(":");return 1===t.length?o.PathExt.normalize(e):`${t[0]}:${o.PathExt.normalize(t.slice(1).join(":"))}`}resolvePath(e,t){let n=this.driveName(e),s=this.localPath(e),r=o.PathExt.resolve("/",s,t);return n?`${n}:${r}`:r}driveName(e){let t=e.split("/")[0].split(":");return 1===t.length?"":this._additionalDrives.has(t[0])?t[0]:""}get(e,t){let[n,s]=this._driveForPath(e);return n.get(s,t).then(e=>{let t=[];if("directory"!==e.type||!e.content)return{...e,path:this._toGlobalPath(n,s),serverPath:e.path};for(let s of e.content)t.push({...s,path:this._toGlobalPath(n,s.path)});return{...e,path:this._toGlobalPath(n,s),content:t,serverPath:e.path}})}getDownloadUrl(e){let[t,n]=this._driveForPath(e);return t.getDownloadUrl(n)}newUntitled(e={}){if(!e.path)return this._defaultDrive.newUntitled(e);{let t=this.normalize(e.path),[n,s]=this._driveForPath(t);return n.newUntitled({...e,path:s}).then(e=>({...e,path:o.PathExt.join(t,e.name),serverPath:e.path}))}}delete(e){let[t,n]=this._driveForPath(e);return t.delete(n)}rename(e,t){let[n,s]=this._driveForPath(e),[r,i]=this._driveForPath(t);if(n!==r)throw Error("ContentsManager: renaming files must occur within a Drive");return n.rename(s,i).then(e=>({...e,path:this._toGlobalPath(n,i),serverPath:e.path}))}save(e,t={}){let n=this.normalize(e),[s,r]=this._driveForPath(e);return s.save(r,{...t,path:r}).then(e=>({...e,path:n,serverPath:e.path}))}copy(e,t){let[n,s]=this._driveForPath(e),[r,i]=this._driveForPath(t);if(n===r)return n.copy(s,i).then(e=>({...e,path:this._toGlobalPath(n,e.path),serverPath:e.path}));throw Error("Copying files between drives is not currently implemented")}createCheckpoint(e){let[t,n]=this._driveForPath(e);return t.createCheckpoint(n)}listCheckpoints(e){let[t,n]=this._driveForPath(e);return t.listCheckpoints(n)}restoreCheckpoint(e,t){let[n,s]=this._driveForPath(e);return n.restoreCheckpoint(s,t)}deleteCheckpoint(e,t){let[n,s]=this._driveForPath(e);return n.deleteCheckpoint(s,t)}_toGlobalPath(e,t){return e===this._defaultDrive?o.PathExt.removeSlash(t):`${e.name}:${o.PathExt.removeSlash(t)}`}_driveForPath(e){let t=this.driveName(e),n=this.localPath(e);return t?[this._additionalDrives.get(t),n]:[this._defaultDrive,n]}_onFileChanged(e,t){var n,s;if(e===this._defaultDrive)this._fileChanged.emit(t);else{let r=null,i=null;null!=(n=t.newValue)&&n.path&&(r={...t.newValue,path:this._toGlobalPath(e,t.newValue.path)}),null!=(s=t.oldValue)&&s.path&&(i={...t.oldValue,path:this._toGlobalPath(e,t.oldValue.path)}),this._fileChanged.emit({type:t.type,newValue:r,oldValue:i})}}};var p=class{constructor(e={}){var t,n,s;this._isDisposed=!1,this._fileChanged=new l.Signal(this),this.name=null!=(t=e.name)?t:"Default",this._apiEndpoint=null!=(n=e.apiEndpoint)?n:c,this.serverSettings=null!=(s=e.serverSettings)?s:h.ServerConnection.makeSettings(),this._restContentProvider=new _({...e,apiEndpoint:this._apiEndpoint,serverSettings:this.serverSettings}),e.defaultContentProvider?this.contentProviderRegistry=new g({defaultProvider:e.defaultContentProvider}):this.contentProviderRegistry=new g,this.contentProviderRegistry.fileChanged.connect((e,t)=>{this._fileChanged.emit(t)})}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,l.Signal.clearData(this))}async get(e,t){let n=this.contentProviderRegistry.getProvider(null==t?void 0:t.contentProviderId);return n?n.get(e,t):await this._restContentProvider.get(e,t)}getDownloadUrl(e){let t=this.serverSettings.baseUrl,n=o.URLExt.join(t,d,o.URLExt.encodeParts(e)),s="";try{s=document.cookie}catch{}let r=s.match("\\b_xsrf=([^;]*)\\b");if(r){let e=new URL(n);e.searchParams.append("_xsrf",r[1]),n=e.toString()}return Promise.resolve(n)}async newUntitled(e={}){var n;let s="{}";e&&(e.ext&&(e.ext=t.normalizeExtension(e.ext)),s=JSON.stringify(e));let r=this.serverSettings,i=this._getUrl(null!=(n=e.path)?n:""),o={method:"POST",body:s},a=await h.ServerConnection.makeRequest(i,o,r);if(201!==a.status)throw await h.ServerConnection.ResponseError.create(a);let l=await a.json();return u.validateContentsModel(l),this._fileChanged.emit({type:"new",oldValue:null,newValue:l}),l}async delete(e){let t=this._getUrl(e),n=this.serverSettings,s={method:"DELETE"},r=await h.ServerConnection.makeRequest(t,s,n);if(204!==r.status)throw await h.ServerConnection.ResponseError.create(r);this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t){let n=this.serverSettings,s=this._getUrl(e),r={method:"PATCH",body:JSON.stringify({path:t})},i=await h.ServerConnection.makeRequest(s,r,n);if(200!==i.status)throw await h.ServerConnection.ResponseError.create(i);let o=await i.json();return u.validateContentsModel(o),this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:o}),o}async save(e,t={}){let n=this.contentProviderRegistry.getProvider(null==t?void 0:t.contentProviderId),s;return s=n?await n.save(e,t):await this._restContentProvider.save(e,t),this._fileChanged.emit({type:"save",oldValue:null,newValue:s}),s}async copy(e,t){let n=this.serverSettings,s=this._getUrl(t),r={method:"POST",body:JSON.stringify({copy_from:e})},i=await h.ServerConnection.makeRequest(s,r,n);if(201!==i.status)throw await h.ServerConnection.ResponseError.create(i);let o=await i.json();return u.validateContentsModel(o),this._fileChanged.emit({type:"new",oldValue:null,newValue:o}),o}async createCheckpoint(e){let t=this._getUrl(e,"checkpoints"),n={method:"POST"},s=await h.ServerConnection.makeRequest(t,n,this.serverSettings);if(201!==s.status)throw await h.ServerConnection.ResponseError.create(s);let r=await s.json();return u.validateCheckpointModel(r),r}async listCheckpoints(e){let t=this._getUrl(e,"checkpoints"),n=await h.ServerConnection.makeRequest(t,{},this.serverSettings);if(200!==n.status)throw await h.ServerConnection.ResponseError.create(n);let s=await n.json();if(!Array.isArray(s))throw Error("Invalid Checkpoint list");for(let e=0;e<s.length;e++)u.validateCheckpointModel(s[e]);return s}async restoreCheckpoint(e,t){let n=this._getUrl(e,"checkpoints",t),s={method:"POST"},r=await h.ServerConnection.makeRequest(n,s,this.serverSettings);if(204!==r.status)throw await h.ServerConnection.ResponseError.create(r)}async deleteCheckpoint(e,t){let n=this._getUrl(e,"checkpoints",t),s={method:"DELETE"},r=await h.ServerConnection.makeRequest(n,s,this.serverSettings);if(204!==r.status)throw await h.ServerConnection.ResponseError.create(r)}_getUrl(...e){let t=e.map(e=>o.URLExt.encodeParts(e)),n=this.serverSettings.baseUrl;return o.URLExt.join(n,this._apiEndpoint,...t)}};e.Drive=p,function(e){e.normalizeExtension=function(e){return e.length>0&&0!==e.indexOf(".")&&(e=`.${e}`),e}}(t||(t={}));var g=class{constructor(e){this._providers=new Map,this._fileChanged=new l.Signal(this),null!=e&&e.defaultProvider&&this.register("default",e.defaultProvider)}register(e,t){if(this._providers.has(e))throw Error(`Provider with ${e} identifier was already registered on this drive`);this._providers.set(e,t);let n=(e,t)=>{this._fileChanged.emit(t)};return t.fileChanged&&t.fileChanged.connect(n),new a.DisposableDelegate(()=>{t.fileChanged&&t.fileChanged.disconnect(n),this._providers.has(e)&&this._providers.delete(e)})}getProvider(e){if(!e)return null;let t=this._providers.get(e);if(!t)throw Error(`Provider ${e} is not registered`);return t}get fileChanged(){return this._fileChanged}};e.ContentProviderRegistry=g;var _=class{constructor(e){this._options=e}async get(e,t){let n=this._getUrl(e);if(t){"notebook"===t.type&&delete t.format;let e=t.content?"1":"0",s=t.hash?"1":"0",r={...t,content:e,hash:s};n+=o.URLExt.objectToQueryString(r)}let s=this._options.serverSettings,r=await h.ServerConnection.makeRequest(n,{},s);if(200!==r.status)throw await h.ServerConnection.ResponseError.create(r);let i=await r.json();return u.validateContentsModel(i),i}async save(e,t={}){let n=this._options.serverSettings,s=this._getUrl(e),r={method:"PUT",body:new File([JSON.stringify(t)],"data.json",{type:"application/json"})},i=await h.ServerConnection.makeRequest(s,r,n);if(200!==i.status&&201!==i.status)throw await h.ServerConnection.ResponseError.create(i);let o=await i.json();return u.validateContentsModel(o),o}_getUrl(...e){let t=e.map(e=>o.URLExt.encodeParts(e)),n=this._options.serverSettings.baseUrl;return o.URLExt.join(n,this._options.apiEndpoint,...t)}};e.RestContentProvider=_}),He=R((e,t)=>{!function(n,s){"object"==typeof e&&void 0!==t?s(e,Y(),ee()):"function"==typeof define&&define.amd?define(["exports","@lumino/coreutils","@lumino/signaling"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_polling={},n.lumino_coreutils,n.lumino_signaling)}(e,function(e,t,n){var s;class r{constructor(e){var r;this._disposed=new n.Signal(this),this._lingered=0,this._tick=new t.PromiseDelegate,this._ticked=new n.Signal(this),this._factory=e.factory,this._linger=null!=(r=e.linger)?r:s.DEFAULT_LINGER,this._standby=e.standby||s.DEFAULT_STANDBY,this._state={...s.DEFAULT_STATE,timestamp:new Date().getTime()};let i=e.frequency||{},o=Math.max(i.interval||0,i.max||0,s.DEFAULT_FREQUENCY.max);this.frequency={...s.DEFAULT_FREQUENCY,...i,max:o},this.name=e.name||s.DEFAULT_NAME,"auto"in e&&!e.auto||setTimeout(()=>this.start())}get disposed(){return this._disposed}get frequency(){return this._frequency}set frequency(e){if(this.isDisposed||t.JSONExt.deepEqual(e,this.frequency||{}))return;let{backoff:n,interval:s,max:i}=e;if(s=Math.round(s),i=Math.round(i),"number"==typeof n&&n<1)throw Error("Poll backoff growth factor must be at least 1");if((s<0||s>i)&&s!==r.NEVER)throw Error("Poll interval must be between 0 and max");if(i>r.MAX_INTERVAL&&i!==r.NEVER)throw Error(`Max interval must be less than ${r.MAX_INTERVAL}`);this._frequency={backoff:n,interval:s,max:i}}get isDisposed(){return"disposed"===this.state.phase}get standby(){return this._standby}set standby(e){this.isDisposed||this.standby===e||(this._standby=e)}get state(){return this._state}get tick(){return this._tick.promise}get ticked(){return this._ticked}async *[Symbol.asyncIterator](){for(;!this.isDisposed;)yield this.state,await this.tick.catch(()=>{})}dispose(){this.isDisposed||(this._state={...s.DISPOSED_STATE,timestamp:new Date().getTime()},this._tick.promise.catch(e=>{}),this._tick.reject(Error(`Poll (${this.name}) is disposed.`)),this._disposed.emit(void 0),n.Signal.clearData(this))}refresh(){return this.schedule({cancel:({phase:e})=>"refreshed"===e,interval:r.IMMEDIATE,phase:"refreshed"})}async schedule(e={}){if(this.isDisposed||e.cancel&&e.cancel(this.state))return;let n=this._tick,s=new t.PromiseDelegate,i={interval:this.frequency.interval,payload:null,phase:"standby",timestamp:new Date().getTime(),...e};if(this._state=i,this._tick=s,clearTimeout(this._timeout),this._ticked.emit(this.state),n.resolve(this),await n.promise,i.interval===r.NEVER){this._timeout=void 0;return}let o=()=>{this.isDisposed||this.tick!==s.promise||this._execute()};this._timeout=setTimeout(o,i.interval)}start(){return this.schedule({cancel:({phase:e})=>"constructed"!==e&&"standby"!==e&&"stopped"!==e,interval:r.IMMEDIATE,phase:"started"})}stop(){return this.schedule({cancel:({phase:e})=>"stopped"===e,interval:r.NEVER,phase:"stopped"})}get hidden(){return s.hidden}_execute(){let e="function"==typeof this.standby?this.standby():this.standby;if("never"===e?e=!1:"when-hidden"===e&&(this.hidden?e=++this._lingered>this._linger:(this._lingered=0,e=!1)),e)return void this.schedule();let t=this.tick;this._factory(this.state).then(e=>{this.isDisposed||this.tick!==t||this.schedule({payload:e,phase:"rejected"===this.state.phase?"reconnected":"resolved"})}).catch(e=>{this.isDisposed||this.tick!==t||this.schedule({interval:s.sleep(this.frequency,this.state),payload:e,phase:"rejected"})})}}!function(e){e.IMMEDIATE=0,e.MAX_INTERVAL=0x7fffffff,e.NEVER=1/0}(r||(r={})),function(e){function t(t,s){let{backoff:i,interval:o,max:a}=t;if(o===r.NEVER)return o;let l=!0===i?e.DEFAULT_BACKOFF:!1===i?1:i;return Math.min(a,n(o,s.interval*l))}function n(e,t){return e=Math.ceil(e),Math.floor(Math.random()*((t=Math.floor(t))-e+1))+e}e.DEFAULT_BACKOFF=3,e.DEFAULT_FREQUENCY={backoff:!0,interval:1e3,max:3e4},e.DEFAULT_LINGER=1,e.DEFAULT_NAME="unknown",e.DEFAULT_STANDBY="when-hidden",e.DEFAULT_STATE={interval:r.NEVER,payload:null,phase:"constructed",timestamp:new Date(0).getTime()},e.DISPOSED_STATE={interval:r.NEVER,payload:null,phase:"disposed",timestamp:new Date(0).getTime()},e.sleep=t,e.hidden="undefined"!=typeof document&&(document.addEventListener("visibilitychange",()=>{e.hidden="hidden"===document.visibilityState}),document.addEventListener("pagehide",()=>{e.hidden="hidden"===document.visibilityState}),"hidden"===document.visibilityState)}(s||(s={}));class i{constructor(e,n=500){this.args=void 0,this.payload=null,this.limit=n,this.poll=new r({auto:!1,factory:async()=>{let{args:t}=this;return this.args=void 0,e(...t)},frequency:{backoff:!1,interval:r.NEVER,max:r.NEVER},standby:"never"}),this.payload=new t.PromiseDelegate,this.poll.ticked.connect((e,n)=>{let{payload:s}=this;if("resolved"===n.phase){this.payload=new t.PromiseDelegate,s.resolve(n.payload);return}if("rejected"===n.phase||"stopped"===n.phase){this.payload=new t.PromiseDelegate,s.promise.catch(e=>{}),s.reject(n.payload);return}},this)}get isDisposed(){return null===this.payload}dispose(){this.isDisposed||(this.args=void 0,this.payload=null,this.poll.dispose())}async stop(){return this.poll.stop()}}class o extends i{invoke(...e){return this.args=e,this.poll.schedule({interval:this.limit,phase:"invoked"}),this.payload.promise}}class a extends i{constructor(e,t){super(e,"number"==typeof t?t:t&&t.limit),this._trailing=!1,"number"!=typeof t&&t&&"trailing"===t.edge&&(this._trailing=!0),this._interval=this._trailing?this.limit:r.IMMEDIATE}invoke(...e){let t="invoked"!==this.poll.state.phase;return(t||this._trailing)&&(this.args=e),t&&this.poll.schedule({interval:this._interval,phase:"invoked"}),this.payload.promise}}e.Debouncer=o,e.Poll=r,e.RateLimiter=i,e.Throttler=a})}),gs=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EventManager=void 0;var t=te(),n=He(),s=ee(),r=de(),i="api/events";e.EventManager=class{constructor(e={}){var t,i;this._socket=null,this.serverSettings=null!=(t=e.serverSettings)?t:r.ServerConnection.makeSettings(),this._poll=new n.Poll({factory:()=>this._subscribe(),standby:null!=(i=e.standby)?i:"when-hidden"}),this._stream=new s.Stream(this),this._poll.start()}get isDisposed(){return this._poll.isDisposed}get stream(){return this._stream}dispose(){if(this.isDisposed)return;this._poll.dispose();let e=this._socket;e&&(this._socket=null,e.onopen=()=>{},e.onerror=()=>{},e.onmessage=()=>{},e.onclose=()=>{},e.close()),s.Signal.clearData(this),this._stream.stop()}async emit(e){let{serverSettings:n}=this,{baseUrl:s}=n,{makeRequest:o,ResponseError:a}=r.ServerConnection,l=t.URLExt.join(s,i),h={body:JSON.stringify(e),method:"POST"},u=await o(l,h,n);if(204!==u.status)throw new a(u)}_subscribe(){return new Promise((e,n)=>{if(this.isDisposed)return;let{appendToken:s,token:r,WebSocket:o,wsUrl:a}=this.serverSettings,l=t.URLExt.join(a,i,"subscribe");s&&""!==r&&(l+=`?token=${encodeURIComponent(r)}`);let h=this._socket=new o(l),u=this._stream;h.onclose=()=>n(Error("EventManager socket closed")),h.onmessage=e=>e.data&&u.emit(JSON.parse(e.data))})}}}),ms=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&t(s,e,r);return n(s,e),s};Object.defineProperty(e,"__esModule",{value:!0}),e.CommHandler=e.CommsOverSubshells=void 0;var r,i=Y(),o=rn(),a=s(Ze());!function(e){e.Disabled="disabled",e.PerComm="perComm",e.PerCommTarget="perCommTarget"}(r||(e.CommsOverSubshells=r={}));var l=class e extends o.DisposableDelegate{constructor(e,t,n,s,o){super(s),this._subshellStarted=new i.PromiseDelegate,this._subshellId=null,this._target="",this._id="",this._id=t,this._target=e,this._kernel=n,this._kernel.statusChanged.connect(()=>{"restarting"===this._kernel.status&&this._cleanSubshells()}),this.commsOverSubshells=null!=o?o:r.PerCommTarget}get commId(){return this._id}get targetName(){return this._target}get subshellId(){return this._subshellId}get subshellStarted(){return this._subshellStarted.promise}get commsOverSubshells(){return this._commsOverSubshells}set commsOverSubshells(e){this._commsOverSubshells=e,this._commsOverSubshells===r.Disabled?this._maybeCloseSubshell():this._maybeStartSubshell()}get onClose(){return this._onClose}set onClose(e){this._onClose=e}get onMsg(){return this._onMsg}set onMsg(e){this._onMsg=e}open(e,t,n=[]){if(this.isDisposed||this._kernel.isDisposed)throw Error("Cannot open");let s=a.createMessage({msgType:"comm_open",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,target_name:this._target,data:null!=e?e:{}},metadata:t,buffers:n});return this._kernel.sendShellMessage(s,!1,!0)}send(e,t,n=[],s=!0){if(this.isDisposed||this._kernel.isDisposed)throw Error("Cannot send");let r=a.createMessage({msgType:"comm_msg",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,data:e},metadata:t,buffers:n});return this._kernel.sendShellMessage(r,!1,s)}close(e,t,n=[]){if(this.isDisposed||this._kernel.isDisposed)throw Error("Cannot close");let s=a.createMessage({msgType:"comm_close",channel:"shell",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,data:null!=e?e:{}},metadata:t,buffers:n}),r=this._kernel.sendShellMessage(s,!1,!0),i=this._onClose;return i&&i(a.createMessage({msgType:"comm_close",channel:"iopub",username:this._kernel.username,session:this._kernel.clientId,subshellId:this._subshellId||this._kernel.subshellId,content:{comm_id:this._id,data:null!=e?e:{}},metadata:t,buffers:n})),this.dispose(),r}dispose(){this._maybeCloseSubshell(),super.dispose()}_cleanSubshells(){let t=this._kernel.id;e._commTargetSubShellsId.hasOwnProperty(t)&&delete e._commTargetSubShellsId[t]}async _maybeStartSubshell(){if(await this._kernel.info,!this._kernel.supportsSubshells)return;if(this._commsOverSubshells===r.PerComm){let e=await this._kernel.requestCreateSubshell({}).done;this._subshellId=e.content.subshell_id,this._subshellStarted.resolve();return}let t=this._kernel.id;e._commTargetSubShellsId.hasOwnProperty(t)||(e._commTargetSubShellsId[t]={});let n=e._commTargetSubShellsId[t];n[this._target]?this._subshellId=await n[this._target]:(n[this._target]=this._kernel.requestCreateSubshell({}).done.then(e=>(this._subshellId=e.content.subshell_id,this._subshellId)),await n[this._target]),this._subshellStarted.resolve()}_maybeCloseSubshell(){if(this._commsOverSubshells!==r.PerComm){this._subshellId=null;return}this._subshellId&&"dead"!==this._kernel.status&&this._kernel.requestDeleteSubshell({subshell_id:this._subshellId},!0),this._subshellId=null}};e.CommHandler=l,l._commTargetSubShellsId={}}),gr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),fn=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateMessage=i,e.validateModel=a,e.validateModels=l;var t=lt(),n=["username","version","session","msg_id","msg_type"],s={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function r(e){for(let s=0;s<n.length;s++)(0,t.validateProperty)(e,n[s],"string")}function i(e){(0,t.validateProperty)(e,"metadata","object"),(0,t.validateProperty)(e,"content","object"),(0,t.validateProperty)(e,"channel","string"),r(e.header),"iopub"===e.channel&&o(e)}function o(e){if("iopub"===e.channel){let n=s[e.header.msg_type];if(void 0===n)return;let r=Object.keys(n),i=e.content;for(let e=0;e<r.length;e++){let s=n[r[e]];Array.isArray(s)||(s=[s]),(0,t.validateProperty)(i,r[e],...s)}}}function a(e){(0,t.validateProperty)(e,"name","string"),(0,t.validateProperty)(e,"id","string")}function l(e){if(!Array.isArray(e))throw Error("Invalid kernel list");e.forEach(e=>a(e))}}),pn=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelAPIClient=e.KERNEL_SERVICE_URL=void 0,e.listRunning=r,e.startNew=i,e.restartKernel=o,e.interruptKernel=a,e.shutdownKernel=l,e.getKernelModel=h;var t=de(),n=te(),s=fn();async function r(i=t.ServerConnection.makeSettings()){let o=n.URLExt.join(i.baseUrl,e.KERNEL_SERVICE_URL),a=await t.ServerConnection.makeRequest(o,{},i);if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();return(0,s.validateModels)(l),l}async function i(r={},o=t.ServerConnection.makeSettings()){let a=n.URLExt.join(o.baseUrl,e.KERNEL_SERVICE_URL),l={method:"POST",body:JSON.stringify(r)},h=await t.ServerConnection.makeRequest(a,l,o);if(201!==h.status)throw await t.ServerConnection.ResponseError.create(h);let u=await h.json();return(0,s.validateModel)(u),u}async function o(r,i=t.ServerConnection.makeSettings()){let a=n.URLExt.join(i.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(r),"restart"),l={method:"POST"},h=await t.ServerConnection.makeRequest(a,l,i);if(200!==h.status)throw await t.ServerConnection.ResponseError.create(h);let u=await h.json();(0,s.validateModel)(u)}async function a(s,r=t.ServerConnection.makeSettings()){let i=n.URLExt.join(r.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(s),"interrupt"),o={method:"POST"},l=await t.ServerConnection.makeRequest(i,o,r);if(204!==l.status)throw await t.ServerConnection.ResponseError.create(l)}async function l(s,r=t.ServerConnection.makeSettings()){let i=n.URLExt.join(r.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(s)),o={method:"DELETE"},a=await t.ServerConnection.makeRequest(i,o,r);if(404===a.status)console.warn(`The kernel "${s}" does not exist on the server`);else if(204!==a.status)throw await t.ServerConnection.ResponseError.create(a)}async function h(r,i=t.ServerConnection.makeSettings()){let o=n.URLExt.join(i.baseUrl,e.KERNEL_SERVICE_URL,encodeURIComponent(r)),a=await t.ServerConnection.makeRequest(o,{},i);if(404===a.status)return;if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();return(0,s.validateModel)(l),l}e.KERNEL_SERVICE_URL="api/kernels",e.KernelAPIClient=class{constructor(e={}){var n;this.serverSettings=null!=(n=e.serverSettings)?n:t.ServerConnection.makeSettings()}async listRunning(){return r(this.serverSettings)}async getModel(e){return h(e,this.serverSettings)}async startNew(e={}){return i(e,this.serverSettings)}async restart(e){return o(e,this.serverSettings)}async interrupt(e){return a(e,this.serverSettings)}async shutdown(e){return l(e,this.serverSettings)}}}),Er=R(e=>{var t,n=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),s=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t};Object.defineProperty(e,"__esModule",{value:!0}),e.KernelShellFutureHandler=e.KernelControlFutureHandler=e.KernelFutureHandler=void 0;var i=Y(),o=rn(),a=r(Ze()),l=class extends o.DisposableDelegate{constructor(e,n,s,r,o){super(e),this._status=0,this._stdin=t.noOp,this._iopub=t.noOp,this._reply=t.noOp,this._done=new i.PromiseDelegate,this._hooks=new t.HookList,this._disposeOnDone=!0,this._msg=n,s||this._setFlag(t.KernelFutureFlag.GotReply),this._disposeOnDone=r,this._kernel=o}get msg(){return this._msg}get done(){return this._done.promise}get onReply(){return this._reply}set onReply(e){this._reply=e}get onIOPub(){return this._iopub}set onIOPub(e){this._iopub=e}get onStdin(){return this._stdin}set onStdin(e){this._stdin=e}registerMessageHook(e){if(this.isDisposed)throw Error("Kernel future is disposed");this._hooks.add(e)}removeMessageHook(e){this.isDisposed||this._hooks.remove(e)}sendInputReply(e,t){this._kernel.sendInputReply(e,t)}dispose(){this._stdin=t.noOp,this._iopub=t.noOp,this._reply=t.noOp,this._hooks=null,this._testFlag(t.KernelFutureFlag.IsDone)||(this._done.promise.catch(()=>{}),this._done.reject(Error(`Canceled future for ${this.msg.header.msg_type} message before replies were done`))),super.dispose()}async handleMsg(e){switch(e.channel){case"control":case"shell":e.channel===this.msg.channel&&e.parent_header.msg_id===this.msg.header.msg_id&&await this._handleReply(e);break;case"stdin":await this._handleStdin(e);break;case"iopub":await this._handleIOPub(e)}}async _handleReply(e){let n=this._reply;n&&await n(e),this._replyMsg=e,this._setFlag(t.KernelFutureFlag.GotReply),this._testFlag(t.KernelFutureFlag.GotIdle)&&this._handleDone()}async _handleStdin(e){this._kernel.hasPendingInput=!0;let t=this._stdin;t&&await t(e)}async _handleIOPub(e){let n=await this._hooks.process(e),s=this._iopub;n&&s&&await s(e),a.isStatusMsg(e)&&"idle"===e.content.execution_state&&(this._setFlag(t.KernelFutureFlag.GotIdle),this._testFlag(t.KernelFutureFlag.GotReply)&&this._handleDone())}_handleDone(){this._testFlag(t.KernelFutureFlag.IsDone)||(this._setFlag(t.KernelFutureFlag.IsDone),this._done.resolve(this._replyMsg),this._disposeOnDone&&this.dispose())}_testFlag(e){return(this._status&e)!=0}_setFlag(e){this._status|=e}};e.KernelFutureHandler=l,e.KernelControlFutureHandler=class extends l{},e.KernelShellFutureHandler=class extends l{},function(e){let t;e.noOp=()=>{};let n="function"==typeof requestAnimationFrame?requestAnimationFrame:setImmediate;class s{constructor(){this._hooks=[]}add(e){this.remove(e),this._hooks.push(e)}remove(e){let t=this._hooks.indexOf(e);t>=0&&(this._hooks[t]=null,this._scheduleCompact())}async process(e){let t;await this._processing;let n=new i.PromiseDelegate;this._processing=n.promise;for(let s=this._hooks.length-1;s>=0;s--){let r=this._hooks[s];if(null!==r){try{t=await r(e)}catch(e){t=!0,console.error(e)}if(!1===t)return n.resolve(void 0),!1}}return n.resolve(void 0),!0}_scheduleCompact(){this._compactScheduled||(this._compactScheduled=!0,n(()=>{this._processing=this._processing.then(()=>{this._compactScheduled=!1,this._compact()})}))}_compact(){let e=0;for(let t=0,n=this._hooks.length;t<n;t++){let n=this._hooks[t];null===this._hooks[t]?e++:this._hooks[t-e]=n}this._hooks.length-=e}}e.HookList=s,function(e){e[e.GotReply=1]="GotReply",e[e.GotIdle=2]="GotIdle",e[e.IsDone=4]="IsDone",e[e.DisposeOnDone=8]="DisposeOnDone"}(t=e.KernelFutureFlag||(e.KernelFutureFlag={}))}(t||(t={}))}),Rr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateSpecModel=n,e.validateSpecModels=s;var t=lt();function n(e){let n=e.spec;if(!n)throw Error("Invalid kernel spec");(0,t.validateProperty)(e,"name","string"),(0,t.validateProperty)(e,"resources","object"),(0,t.validateProperty)(n,"language","string"),(0,t.validateProperty)(n,"display_name","string"),(0,t.validateProperty)(n,"argv","array");let s=null;n.hasOwnProperty("metadata")&&((0,t.validateProperty)(n,"metadata","object"),s=n.metadata);let r=null;return n.hasOwnProperty("env")&&((0,t.validateProperty)(n,"env","object"),r=n.env),{name:e.name,resources:e.resources,language:n.language,display_name:n.display_name,argv:n.argv,metadata:s,env:r}}function s(e){if(!e.hasOwnProperty("kernelspecs"))throw Error("No kernelspecs found");let t=Object.keys(e.kernelspecs),s=Object.create(null),r=e.default;for(let r=0;r<t.length;r++){let i=e.kernelspecs[t[r]];try{s[t[r]]=n(i)}catch{console.warn(`Removing errant kernel spec: ${t[r]}`)}}if(!(t=Object.keys(s)).length)throw Error("No valid kernelspecs found");return r&&"string"==typeof r&&r in s||(r=t[0],console.warn(`Default kernel not found, using '${t[0]}'`)),{default:r,kernelspecs:s}}}),_t=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelSpecAPIClient=void 0,e.getSpecs=i;var t=de(),n=Rr(),s=te(),r="api/kernelspecs";async function i(e=t.ServerConnection.makeSettings()){let o=s.URLExt.join(e.baseUrl,r),a=await t.ServerConnection.makeRequest(o,{},e);if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();return(0,n.validateSpecModels)(l)}e.KernelSpecAPIClient=class{constructor(e={}){var n;this.serverSettings=null!=(n=e.serverSettings)?n:t.ServerConnection.makeSettings()}async get(){return i(this.serverSettings)}}}),Cs=R(e=>{var t,n=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),s=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t};Object.defineProperty(e,"__esModule",{value:!0}),e.KernelConnection=void 0;var i=te(),o=Y(),a=ee(),l=Ae(),h=ms(),u=r(Ze()),c=Er(),d=r(fn()),p=pn(),g=_t(),_=te(),f=3e3,m="_RESTARTING_",v="";e.KernelConnection=class e{constructor(e){var n,s,r,h,c,_,f,m;this._createSocket=(e=!0)=>{this._errorIfDisposed(),this._clearSocket(),this._updateConnectionStatus("connecting");let n=this.serverSettings,s=i.URLExt.join(n.wsUrl,p.KERNEL_SERVICE_URL,encodeURIComponent(this._id)),r=s.replace(/^((?:\w+:)?\/\/)(?:[^@\/]+@)/,"$1");console.debug(`Starting WebSocket: ${r}`);let o=i.URLExt.join(s,"channels?session_id="+encodeURIComponent(this._clientId)),a=n.token;n.appendToken&&""!==a&&(o+=`&token=${encodeURIComponent(a)}`);let h=e?this._supportedProtocols:[];this._ws=new n.WebSocket(o,h),this._ws.binaryType="arraybuffer";let u=!1,c=async e=>{var n,s;if(!this._isDisposed){this._reason="",this._model=void 0;try{let t=await this._kernelAPIClient.getModel(this._id);this._model=t,(null==t?void 0:t.execution_state)==="dead"?this._updateStatus("dead"):this._onWSClose(e)}catch(r){r instanceof l.ServerConnection.NetworkError||(null==(n=r.response)?void 0:n.status)===503||(null==(s=r.response)?void 0:s.status)===424?setTimeout(c,1e3*t.getRandomIntInclusive(10,30),e):(this._reason="Kernel died unexpectedly",this._updateStatus("dead"))}}},d=async e=>{u||(u=!0,await c(e))};this._ws.onmessage=this._onWSMessage,this._ws.onopen=this._onWSOpen,this._ws.onclose=d,this._ws.onerror=d},this._onWSOpen=e=>{if(""!==this._ws.protocol&&!this._supportedProtocols.includes(this._ws.protocol))throw console.log("Server selected unknown kernel wire protocol:",this._ws.protocol),this._updateStatus("dead"),Error(`Unknown kernel wire protocol:  ${this._ws.protocol}`);this._selectedProtocol=this._ws.protocol,this._ws.onclose=this._onWSClose,this._ws.onerror=this._onWSClose,this._updateConnectionStatus("connected")},this._onWSMessage=e=>{let t;try{t=this.serverSettings.serializer.deserialize(e.data,this._ws.protocol),d.validateMessage(t)}catch(e){throw e.message=`Kernel message validation error: ${e.message}`,e}this._kernelSession=t.header.session,this._msgChain=this._msgChain.then(()=>this._handleMessage(t)).catch(e=>{e.message.startsWith("Canceled future for ")&&console.error(e)}),this._anyMessage.emit({msg:t,direction:"recv"})},this._onWSClose=e=>{this.isDisposed||this._reconnect()},this._id="",this._name="",this._status="unknown",this._connectionStatus="connecting",this._kernelSession="",this._isDisposed=!1,this._ws=null,this._username="",this._reconnectLimit=7,this._reconnectAttempt=0,this._reconnectTimeout=null,this._supportedProtocols=Object.values(u.supportedKernelWebSocketProtocols),this._selectedProtocol="",this._commsOverSubshells=l.CommsOverSubshells.PerCommTarget,this._futures=new Map,this._comms=new Map,this._targetRegistry=Object.create(null),this._info=new o.PromiseDelegate,this._pendingMessages=[],this._statusChanged=new a.Signal(this),this._connectionStatusChanged=new a.Signal(this),this._disposed=new a.Signal(this),this._iopubMessage=new a.Signal(this),this._anyMessage=new a.Signal(this),this._pendingInput=new a.Signal(this),this._unhandledMessage=new a.Signal(this),this._displayIdToParentIds=new Map,this._msgIdToDisplayIds=new Map,this._msgChain=Promise.resolve(),this._hasPendingInput=!1,this._reason="",this._noOp=()=>{},this._supportsSubshells=!1,this._name=e.model.name,this._id=e.model.id,this.serverSettings=null!=(n=e.serverSettings)?n:l.ServerConnection.makeSettings(),this._kernelAPIClient=null!=(s=e.kernelAPIClient)?s:new p.KernelAPIClient({serverSettings:this.serverSettings}),this._kernelSpecAPIClient=null!=(r=e.kernelSpecAPIClient)?r:new g.KernelSpecAPIClient({serverSettings:this.serverSettings}),this._clientId=null!=(h=e.clientId)?h:o.UUID.uuid4(),this._username=null!=(c=e.username)?c:"",this.handleComms=null==(_=e.handleComms)||_,this._commsOverSubshells=null!=(f=e.commsOverSubshells)?f:l.CommsOverSubshells.PerCommTarget,this._subshellId=null!=(m=e.subshellId)?m:null,this._createSocket()}get disposed(){return this._disposed}get commsOverSubshells(){return this._commsOverSubshells}set commsOverSubshells(e){for(let[t,n]of(this._commsOverSubshells=e,this._comms))n.commsOverSubshells=e}get statusChanged(){return this._statusChanged}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get model(){return this._model||{id:this.id,name:this.name,reason:this._reason}}get anyMessage(){return this._anyMessage}get pendingInput(){return this._pendingInput}get id(){return this._id}get name(){return this._name}get username(){return this._username}get clientId(){return this._clientId}get subshellId(){return this._subshellId}set subshellId(e){this._subshellId=e}get status(){return this._status}get connectionStatus(){return this._connectionStatus}get isDisposed(){return this._isDisposed}get info(){return this._info.promise}get spec(){return this._specPromise||(this._specPromise=this._kernelSpecAPIClient.get().then(e=>e.kernelspecs[this._name])),this._specPromise}get supportsSubshells(){return this._supportsSubshells}clone(t={}){return new e({model:this.model,username:this.username,serverSettings:this.serverSettings,handleComms:!1,kernelAPIClient:this._kernelAPIClient,commsOverSubshells:l.CommsOverSubshells.Disabled,...t})}dispose(){if(this.isDisposed)return;let e=()=>{this._isDisposed=!0,this._disposed.emit(),this._updateConnectionStatus("disconnected"),this._clearKernelState(),this._pendingMessages=[],this._clearSocket(),a.Signal.clearData(this)};null!==this._subshellId?this.requestDeleteSubshell({subshell_id:this._subshellId},!0).onReply=t=>{e()}:e()}sendShellMessage(e,t=!1,n=!0){return this._sendKernelShellControl(c.KernelShellFutureHandler,e,t,n)}sendControlMessage(e,t=!1,n=!0){return this._sendKernelShellControl(c.KernelControlFutureHandler,e,t,n)}_sendKernelShellControl(e,t,n=!1,s=!0){this._sendMessage(t),this._anyMessage.emit({msg:t,direction:"send"});let r=new e(()=>{let e=t.header.msg_id;this._futures.delete(e);let n=this._msgIdToDisplayIds.get(e);n&&(n.forEach(t=>{let n=this._displayIdToParentIds.get(t);if(n){let s=n.indexOf(e);if(-1===s)return;1===n.length?this._displayIdToParentIds.delete(t):(n.splice(s,1),this._displayIdToParentIds.set(t,n))}}),this._msgIdToDisplayIds.delete(e))},t,n,s,this);return this._futures.set(t.header.msg_id,r),r}_sendMessage(e,t=!0){if("dead"===this.status)throw Error("Kernel is dead");if((this._kernelSession===v||this._kernelSession===m)&&u.isInfoRequestMsg(e))if("connected"===this.connectionStatus)return void this._ws.send(this.serverSettings.serializer.serialize(e,this._ws.protocol));else throw Error("Could not send message: status is not connected");if(t&&this._pendingMessages.length>0)return void this._pendingMessages.push(e);if("connected"===this.connectionStatus&&this._kernelSession!==m)this._ws.send(this.serverSettings.serializer.serialize(e,this._ws.protocol));else if(t)this._pendingMessages.push(e);else throw Error("Could not send message")}async interrupt(){if(this.hasPendingInput=!1,"dead"===this.status)throw Error("Kernel is dead");return this._kernelAPIClient.interrupt(this.id)}async restart(){if("dead"===this.status)throw Error("Kernel is dead");this._updateStatus("restarting"),this._clearKernelState(),this._kernelSession=m,await this._kernelAPIClient.restart(this.id),await this.reconnect(),this.hasPendingInput=!1}reconnect(){this._errorIfDisposed();let e=new o.PromiseDelegate,t=(n,s)=>{"connected"===s?(e.resolve(),this.connectionStatusChanged.disconnect(t,this)):"disconnected"===s&&(e.reject(Error("Kernel connection disconnected")),this.connectionStatusChanged.disconnect(t,this))};return this.connectionStatusChanged.connect(t,this),this._reconnectAttempt=0,this._reconnect(),e.promise}async shutdown(){"dead"!==this.status&&await this._kernelAPIClient.shutdown(this.id),this.handleShutdown()}handleShutdown(){this._updateStatus("dead"),this.dispose()}async requestKernelInfo(){let e=u.createMessage({msgType:"kernel_info_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:{}}),n;try{n=await t.handleShellMessage(this,e)}catch(e){if(this.isDisposed)return;throw e}if(this._errorIfDisposed(),!n)return;if(void 0===n.content.status&&(n.content.status="ok"),"ok"!==n.content.status)return this._info.reject("Kernel info reply errored"),n;this._info.resolve(n.content),this._kernelSession=n.header.session;let s=n.content.supported_features;return this._supportsSubshells=void 0!==s&&s.includes("kernel subshells"),n}requestComplete(e){let n=u.createMessage({msgType:"complete_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return t.handleShellMessage(this,n)}requestInspect(e){let n=u.createMessage({msgType:"inspect_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return t.handleShellMessage(this,n)}requestHistory(e){let n=u.createMessage({msgType:"history_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return t.handleShellMessage(this,n)}requestExecute(e,t=!0,n){let s={silent:!1,store_history:!0,user_expressions:{},allow_stdin:!0,stop_on_error:!1},r=u.createMessage({msgType:"execute_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:{...s,...e},metadata:n});return this.sendShellMessage(r,!0,t)}requestDebug(e,t=!0){let n=u.createMessage({msgType:"debug_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestCreateSubshell(e,t=!0){if(!this.supportsSubshells)throw Error("Kernel subshells are not supported");let n=u.createMessage({msgType:"create_subshell_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestDeleteSubshell(e,t=!0){if(!this.supportsSubshells)throw Error("Kernel subshells are not supported");let n=u.createMessage({msgType:"delete_subshell_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestListSubshell(e,t=!0){if(!this.supportsSubshells)throw Error("Kernel subshells are not supported");let n=u.createMessage({msgType:"list_subshell_request",channel:"control",username:this._username,session:this._clientId,content:e});return this.sendControlMessage(n,!0,t)}requestIsComplete(e){let n=u.createMessage({msgType:"is_complete_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return t.handleShellMessage(this,n)}requestCommInfo(e){let n=u.createMessage({msgType:"comm_info_request",channel:"shell",username:this._username,session:this._clientId,subshellId:this._subshellId,content:e});return t.handleShellMessage(this,n)}sendInputReply(e,t){let n=u.createMessage({msgType:"input_reply",channel:"stdin",username:this._username,session:this._clientId,content:e});n.parent_header=t,this._sendMessage(n),this._anyMessage.emit({msg:n,direction:"send"}),this.hasPendingInput=!1}createComm(e,t=o.UUID.uuid4()){if(!this.handleComms)throw Error("Comms are disabled on this kernel connection");if(this._comms.has(t))throw Error("Comm is already created");let n=new h.CommHandler(e,t,this,()=>{this._unregisterComm(t)},this._commsOverSubshells);return this._comms.set(t,n),n}hasComm(e){return this._comms.has(e)}registerCommTarget(e,t){this.handleComms&&(this._targetRegistry[e]=t)}removeCommTarget(e,t){this.handleComms&&!this.isDisposed&&this._targetRegistry[e]===t&&delete this._targetRegistry[e]}registerMessageHook(e,t){var n;let s=null==(n=this._futures)?void 0:n.get(e);s&&s.registerMessageHook(t)}removeMessageHook(e,t){var n;let s=null==(n=this._futures)?void 0:n.get(e);s&&s.removeMessageHook(t)}removeInputGuard(){this.hasPendingInput=!1}async _handleDisplayId(e,t){var n,s;let r=t.parent_header.msg_id,i=this._displayIdToParentIds.get(e);if(i){let e={header:o.JSONExt.deepCopy(t.header),parent_header:o.JSONExt.deepCopy(t.parent_header),metadata:o.JSONExt.deepCopy(t.metadata),content:o.JSONExt.deepCopy(t.content),channel:t.channel,buffers:t.buffers?t.buffers.slice():[]};e.header.msg_type="update_display_data",await Promise.all(i.map(async t=>{let n=this._futures&&this._futures.get(t);n&&await n.handleMsg(e)}))}if("update_display_data"===t.header.msg_type)return!0;-1===(i=null!=(n=this._displayIdToParentIds.get(e))?n:[]).indexOf(r)&&i.push(r),this._displayIdToParentIds.set(e,i);let a=null!=(s=this._msgIdToDisplayIds.get(r))?s:[];return -1===a.indexOf(r)&&a.push(r),this._msgIdToDisplayIds.set(r,a),!1}_clearSocket(){null!==this._ws&&(this._ws.onopen=this._noOp,this._ws.onclose=this._noOp,this._ws.onerror=this._noOp,this._ws.onmessage=this._noOp,this._ws.close(),this._ws=null)}_updateStatus(e){this._status===e||"dead"===this._status||(this._status=e,t.logKernelStatus(this),this._statusChanged.emit(e),"dead"===e&&this.dispose())}_sendPending(){for(;"connected"===this.connectionStatus&&this._kernelSession!==m&&this._pendingMessages.length>0;)this._sendMessage(this._pendingMessages[0],!1),this._pendingMessages.shift()}_clearKernelState(){this._kernelSession="",this._pendingMessages=[],this._futures.forEach(e=>{e.dispose()}),this._comms.forEach(e=>{e.dispose()}),this._msgChain=Promise.resolve(),this._futures=new Map,this._comms=new Map,this._displayIdToParentIds.clear(),this._msgIdToDisplayIds.clear()}_assertCurrentMessage(e){if(this._errorIfDisposed(),e.header.session!==this._kernelSession)throw Error(`Canceling handling of old message: ${e.header.msg_type}`)}async _handleCommOpen(e){this._assertCurrentMessage(e);let n=e.content,s=new h.CommHandler(n.target_name,n.comm_id,this,()=>{this._unregisterComm(n.comm_id)},this.commsOverSubshells);this._comms.set(n.comm_id,s);try{await (await t.loadObject(n.target_name,n.target_module,this._targetRegistry))(s,e)}catch(e){throw s.close(),console.error("Exception opening new comm"),e}}async _handleCommClose(e){this._assertCurrentMessage(e);let t=e.content,n=this._comms.get(t.comm_id);if(!n)return void console.error("Comm not found for comm id "+t.comm_id);this._unregisterComm(n.commId);let s=n.onClose;s&&await s(e),n.dispose()}async _handleCommMsg(e){this._assertCurrentMessage(e);let t=e.content,n=this._comms.get(t.comm_id);if(!n)return;let s=n.onMsg;s&&await s(e)}_unregisterComm(e){this._comms.delete(e)}_updateConnectionStatus(e){if(this._connectionStatus!==e){if(this._connectionStatus=e,"connecting"!==e&&(this._reconnectAttempt=0,clearTimeout(this._reconnectTimeout)),"dead"!==this.status)if("connected"===e){let e=this._kernelSession===m,t=this.requestKernelInfo(),n=!1,s=()=>{n||(n=!0,e&&this._kernelSession===m&&(this._kernelSession=""),clearTimeout(r),this._pendingMessages.length>0&&this._sendPending())};t.then(s);let r=setTimeout(s,f)}else this._updateStatus("unknown");this._connectionStatusChanged.emit(e)}}async _handleMessage(e){var t,n;let s=!1;if(e.parent_header&&"iopub"===e.channel&&(u.isDisplayDataMsg(e)||u.isUpdateDisplayDataMsg(e)||u.isExecuteResultMsg(e))){let n=(null!=(t=e.content.transient)?t:{}).display_id;n&&(s=await this._handleDisplayId(n,e),this._assertCurrentMessage(e))}if(!s&&e.parent_header){let t=e.parent_header,s=null==(n=this._futures)?void 0:n.get(t.msg_id);if(s)await s.handleMsg(e),this._assertCurrentMessage(e);else{let n=t.session===this.clientId;"iopub"!==e.channel&&n&&this._unhandledMessage.emit(e)}}if("iopub"===e.channel){switch(e.header.msg_type){case"status":{if(JSON.parse(_.PageConfig.getOption("untracked_message_types")||"[]").includes(e.parent_header.msg_type))break;let t=e.content.execution_state;"restarting"===t&&Promise.resolve().then(async()=>{this._updateStatus("autorestarting"),this._clearKernelState(),await this.reconnect()}),this._updateStatus(t);break}case"comm_open":this.handleComms&&await this._handleCommOpen(e);break;case"comm_msg":this.handleComms&&await this._handleCommMsg(e);break;case"comm_close":this.handleComms&&await this._handleCommClose(e)}this.isDisposed||(this._assertCurrentMessage(e),this._iopubMessage.emit(e))}}_reconnect(){if(this._errorIfDisposed(),clearTimeout(this._reconnectTimeout),this._reconnectAttempt<this._reconnectLimit){this._updateConnectionStatus("connecting");let e=t.getRandomIntInclusive(0,1e3*(Math.pow(2,this._reconnectAttempt)-1));console.warn(`Connection lost, reconnecting in ${Math.floor(e/1e3)} seconds.`);let n=""!==this._selectedProtocol;this._reconnectTimeout=setTimeout(this._createSocket,e,n),this._reconnectAttempt+=1}else this._updateConnectionStatus("disconnected");this._clearSocket()}_errorIfDisposed(){if(this.isDisposed)throw Error("Kernel connection is disposed")}get hasPendingInput(){return this._hasPendingInput}set hasPendingInput(e){this._hasPendingInput=e,this._pendingInput.emit(e)}},function(e){e.logKernelStatus=function(e){switch(e.status){case"idle":case"busy":case"unknown":return;default:console.debug(`Kernel: ${e.status} (${e.id})`)}},e.handleShellMessage=async function(e,t){return e.sendShellMessage(t,!0).done},e.loadObject=function(e,t,n){return new Promise((s,r)=>{if(t){if("undefined"==typeof requirejs)throw Error("requirejs not found");requirejs([t],n=>{void 0===n[e]?r(Error(`Object '${e}' not found in module '${t}'`)):s(n[e])},r)}else null!=n&&n[e]?s(n[e]):r(Error(`Object '${e}' not found in registry`))})},e.getRandomIntInclusive=function(e,t){return e=Math.ceil(e),Math.floor(Math.random()*((t=Math.floor(t))-e+1))+e}}(t||(t={}))}),Nr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelManager=void 0;var t=He(),n=ee(),s=Ae(),r=$e(),i=pn(),o=Cs(),a=_t(),l=class extends r.BaseManager{constructor(e={}){var r,o,l;super(e),this._commsOverSubshells=s.CommsOverSubshells.PerCommTarget,this._isReady=!1,this._kernelConnections=new Set,this._models=new Map,this._runningChanged=new n.Signal(this),this._connectionFailure=new n.Signal(this),this._kernelAPIClient=null!=(r=e.kernelAPIClient)?r:new i.KernelAPIClient({serverSettings:this.serverSettings}),this._kernelSpecAPIClient=null!=(o=e.kernelSpecAPIClient)?o:new a.KernelSpecAPIClient({serverSettings:this.serverSettings}),this._pollModels=new t.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:KernelManager#models",standby:null!=(l=e.standby)?l:"when-hidden"}),this._ready=(async()=>{await this._pollModels.start(),await this._pollModels.tick,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._models.clear(),this._kernelConnections.forEach(e=>e.dispose()),this._pollModels.dispose(),super.dispose())}connectTo(e){var t;let{id:n}=e.model,s=null==(t=e.handleComms)||t;if(void 0===e.handleComms){for(let e of this._kernelConnections)if(e.id===n&&e.handleComms){s=!1;break}}e.commsOverSubshells=this._commsOverSubshells;let r=new o.KernelConnection({handleComms:s,...e,serverSettings:this.serverSettings,kernelAPIClient:this._kernelAPIClient,kernelSpecAPIClient:this._kernelSpecAPIClient});return this._onStarted(r),this._models.has(n)||this.refreshRunning().catch(()=>{}),r}running(){return this._models.values()}get runningCount(){return this._models.size}get commsOverSubshells(){return this._commsOverSubshells}set commsOverSubshells(e){for(let t of(this._commsOverSubshells=e,this._kernelConnections))t.commsOverSubshells=e}async refreshRunning(){await this._pollModels.refresh(),await this._pollModels.tick}async startNew(e={},t={}){let n=await this._kernelAPIClient.startNew(e);return this.connectTo({...t,model:n})}async shutdown(e){await this._kernelAPIClient.shutdown(e),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all([...this._models.keys()].map(e=>this._kernelAPIClient.shutdown(e))),await this.refreshRunning()}async findById(e){return this._models.has(e)||await this.refreshRunning(),this._models.get(e)}async requestRunning(){var e,t;let n;try{n=await this._kernelAPIClient.listRunning()}catch(n){throw(n instanceof s.ServerConnection.NetworkError||(null==(e=n.response)?void 0:e.status)===503||(null==(t=n.response)?void 0:t.status)===424)&&this._connectionFailure.emit(n),n}this.isDisposed||this._models.size===n.length&&n.every(e=>{let t=this._models.get(e.id);return!!t&&t.connections===e.connections&&t.execution_state===e.execution_state&&t.last_activity===e.last_activity&&t.name===e.name&&t.reason===e.reason&&t.traceback===e.traceback})||(this._models=new Map(n.map(e=>[e.id,e])),this._kernelConnections.forEach(e=>{this._models.has(e.id)||e.handleShutdown()}),this._runningChanged.emit(n))}_onStarted(e){this._kernelConnections.add(e),e.statusChanged.connect(this._onStatusChanged,this),e.disposed.connect(this._onDisposed,this)}_onDisposed(e){this._kernelConnections.delete(e),this.refreshRunning().catch(()=>{})}_onStatusChanged(e,t){"dead"===t&&this.refreshRunning().catch(()=>{})}};e.KernelManager=l,function(e){class t extends e{constructor(){super(...arguments),this._readyPromise=new Promise(()=>{})}get isActive(){return!1}get parentReady(){return super.ready}async startNew(e={},t={}){return Promise.reject(Error("Not implemented in no-op Kernel Manager"))}connectTo(e){throw Error("Not implemented in no-op Kernel Manager")}async shutdown(e){return Promise.reject(Error("Not implemented in no-op Kernel Manager"))}get ready(){return this.parentReady.then(()=>this._readyPromise)}async requestRunning(){return Promise.resolve()}}e.NoopManager=t}(l||(e.KernelManager=l={}))}),Ms=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&t(s,e,r);return n(s,e),s},r=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.CommsOverSubshells=e.KernelConnection=e.KernelAPI=e.KernelMessage=e.Kernel=void 0;var i=ms();Object.defineProperty(e,"CommsOverSubshells",{enumerable:!0,get:function(){return i.CommsOverSubshells}}),e.Kernel=s(gr()),e.KernelMessage=s(Ze()),e.KernelAPI=s(pn());var o=Cs();Object.defineProperty(e,"KernelConnection",{enumerable:!0,get:function(){return o.KernelConnection}}),r(Nr(),e)}),Fr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),zr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KernelSpecManager=void 0;var t=Y(),n=He(),s=ee(),r=$e(),i=_t();e.KernelSpecManager=class extends r.BaseManager{constructor(e={}){var t,r;super(e),this._isReady=!1,this._connectionFailure=new s.Signal(this),this._specs=null,this._specsChanged=new s.Signal(this),this._kernelSpecAPIClient=null!=(t=e.kernelSpecAPIClient)?t:new i.KernelSpecAPIClient({serverSettings:this.serverSettings}),this._ready=Promise.all([this.requestSpecs()]).then(e=>{}).catch(e=>{}).then(()=>{this.isDisposed||(this._isReady=!0)}),this._pollSpecs=new n.Poll({auto:!1,factory:()=>this.requestSpecs(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@jupyterlab/services:KernelSpecManager#specs",standby:null!=(r=e.standby)?r:"when-hidden"}),this.ready.then(()=>{this._pollSpecs.start()})}get isReady(){return this._isReady}get ready(){return this._ready}get specs(){return this._specs}get specsChanged(){return this._specsChanged}get connectionFailure(){return this._connectionFailure}dispose(){this._pollSpecs.dispose(),super.dispose()}async refreshSpecs(){await this._pollSpecs.refresh(),await this._pollSpecs.tick}async requestSpecs(){let e=await this._kernelSpecAPIClient.get();this.isDisposed||t.JSONExt.deepEqual(e,this._specs)||(this._specs=e,this._specsChanged.emit(e))}}}),Is=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&t(s,e,r);return n(s,e),s},r=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.KernelSpecAPI=e.KernelSpec=void 0,e.KernelSpec=s(Fr()),e.KernelSpecAPI=s(_t()),r(zr(),e)}),Wr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BuildManager=void 0;var t=te(),n=de(),s="api/build";e.BuildManager=class{constructor(e={}){var t;this.serverSettings=null!=(t=e.serverSettings)?t:n.ServerConnection.makeSettings()}get isAvailable(){return"true"===t.PageConfig.getOption("buildAvailable").toLowerCase()}get shouldCheck(){return"true"===t.PageConfig.getOption("buildCheck").toLowerCase()}getStatus(){let{_url:e,serverSettings:t}=this;return n.ServerConnection.makeRequest(e,{},t).then(e=>{if(200!==e.status)throw new n.ServerConnection.ResponseError(e);return e.json()}).then(e=>{if("string"!=typeof e.status||"string"!=typeof e.message)throw Error("Invalid data");return e})}build(){let{_url:e,serverSettings:t}=this,s={method:"POST"};return n.ServerConnection.makeRequest(e,s,t).then(e=>{if(400===e.status)throw new n.ServerConnection.ResponseError(e,"Build aborted");if(200!==e.status){let t=`Build failed with ${e.status}.

        If you are experiencing the build failure after installing an extension (or trying to include previously installed extension after updating JupyterLab) please check the extension repository for new installation instructions as many extensions migrated to the prebuilt extensions system which no longer requires rebuilding JupyterLab (but uses a different installation procedure, typically involving a package manager such as 'pip' or 'conda').

        If you specifically intended to install a source extension, please run 'jupyter lab build' on the server for full output.`;throw new n.ServerConnection.ResponseError(e,t)}})}cancel(){let{_url:e,serverSettings:t}=this,s={method:"DELETE"};return n.ServerConnection.makeRequest(e,s,t).then(e=>{if(204!==e.status)throw new n.ServerConnection.ResponseError(e)})}get _url(){let{baseUrl:e,appUrl:n}=this.serverSettings;return t.URLExt.join(e,n,s)}}}),Ts=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NbConvertManager=void 0;var t=te(),n=de(),s=Y(),r="api/nbconvert",i="nbconvert";e.NbConvertManager=class{constructor(e={}){var t;this._exportFormats=null,this.serverSettings=null!=(t=e.serverSettings)?t:n.ServerConnection.makeSettings()}async fetchExportFormats(){this._requestingFormats=new s.PromiseDelegate,this._exportFormats=null;let e=this.serverSettings.baseUrl,i=t.URLExt.join(e,r),{serverSettings:o}=this,a=await n.ServerConnection.makeRequest(i,{},o);if(200!==a.status)throw await n.ServerConnection.ResponseError.create(a);let l=await a.json(),h={};return Object.keys(l).forEach(function(e){let t=l[e].output_mimetype;h[e]={output_mimetype:t}}),this._exportFormats=h,this._requestingFormats.resolve(h),h}async getExportFormats(e=!0){return this._requestingFormats?this._requestingFormats.promise:e||!this._exportFormats?await this.fetchExportFormats():this._exportFormats}async exportAs(e){let{format:n,path:s}=e,{download:r=!1}=e.exporterOptions||{},o=this.serverSettings.baseUrl,a=t.URLExt.encodeParts(s),l=t.URLExt.join(o,i,n,a);r&&(l+="?download=true"),null==window||window.open(l,"_blank","noopener")}}}),Hr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),Gr=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateModel=s,e.updateLegacySessionModel=r,e.validateModels=i;var t=fn(),n=lt();function s(e){(0,n.validateProperty)(e,"id","string"),(0,n.validateProperty)(e,"type","string"),(0,n.validateProperty)(e,"name","string"),(0,n.validateProperty)(e,"path","string"),(0,n.validateProperty)(e,"kernel","object"),(0,t.validateModel)(e.kernel)}function r(e){void 0===e.path&&void 0!==e.notebook&&(e.path=e.notebook.path,e.type="notebook",e.name="")}function i(e){if(!Array.isArray(e))throw Error("Invalid session list");e.forEach(e=>s(e))}}),Cn=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionAPIClient=e.SESSION_SERVICE_URL=void 0,e.listRunning=r,e.getSessionUrl=i,e.shutdownSession=o,e.getSessionModel=a,e.startSession=l,e.updateSession=h;var t=de(),n=te(),s=Gr();async function r(i=t.ServerConnection.makeSettings()){let o=n.URLExt.join(i.baseUrl,e.SESSION_SERVICE_URL),a=await t.ServerConnection.makeRequest(o,{},i);if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();if(!Array.isArray(l))throw Error("Invalid Session list");return l.forEach(e=>{(0,s.updateLegacySessionModel)(e),(0,s.validateModel)(e)}),l}function i(t,s){let r=n.URLExt.join(t,e.SESSION_SERVICE_URL),i=n.URLExt.join(r,s);if(!i.startsWith(r))throw Error("Can only be used for services requests");return i}async function o(e,n=t.ServerConnection.makeSettings()){var s;let r=i(n.baseUrl,e),a={method:"DELETE"},l=await t.ServerConnection.makeRequest(r,a,n);if(404===l.status)console.warn(null!=(s=(await l.json()).message)?s:`The session "${e}"" does not exist on the server`);else{if(410===l.status)throw new t.ServerConnection.ResponseError(l,"The kernel was deleted but the session was not");if(204!==l.status)throw await t.ServerConnection.ResponseError.create(l)}}async function a(e,n=t.ServerConnection.makeSettings()){let r=i(n.baseUrl,e),o=await t.ServerConnection.makeRequest(r,{},n);if(200!==o.status)throw await t.ServerConnection.ResponseError.create(o);let l=await o.json();return(0,s.updateLegacySessionModel)(l),(0,s.validateModel)(l),l}async function l(r,i=t.ServerConnection.makeSettings()){let o=n.URLExt.join(i.baseUrl,e.SESSION_SERVICE_URL),a={method:"POST",body:JSON.stringify(r)},h=await t.ServerConnection.makeRequest(o,a,i);if(201!==h.status)throw await t.ServerConnection.ResponseError.create(h);let u=await h.json();return(0,s.updateLegacySessionModel)(u),(0,s.validateModel)(u),u}async function h(e,n=t.ServerConnection.makeSettings()){let r=i(n.baseUrl,e.id),o={method:"PATCH",body:JSON.stringify(e)},a=await t.ServerConnection.makeRequest(r,o,n);if(200!==a.status)throw await t.ServerConnection.ResponseError.create(a);let l=await a.json();return(0,s.updateLegacySessionModel)(l),(0,s.validateModel)(l),l}e.SESSION_SERVICE_URL="api/sessions",e.SessionAPIClient=class{constructor(e){var n;this.serverSettings=null!=(n=e.serverSettings)?n:t.ServerConnection.makeSettings()}async listRunning(){return r(this.serverSettings)}async getModel(e){return a(e,this.serverSettings)}async startNew(e){return l(e,this.serverSettings)}async shutdown(e){return o(e,this.serverSettings)}async update(e){return h(e,this.serverSettings)}}}),to=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionConnection=void 0;var t=ee(),n=Ae(),s=Y(),r=Cn();e.SessionConnection=class{constructor(e){var i,o,a,l,h;this._id="",this._path="",this._name="",this._type="",this._kernel=null,this._isDisposed=!1,this._disposed=new t.Signal(this),this._kernelChanged=new t.Signal(this),this._statusChanged=new t.Signal(this),this._connectionStatusChanged=new t.Signal(this),this._pendingInput=new t.Signal(this),this._iopubMessage=new t.Signal(this),this._unhandledMessage=new t.Signal(this),this._anyMessage=new t.Signal(this),this._propertyChanged=new t.Signal(this),this._id=e.model.id,this._name=e.model.name,this._path=e.model.path,this._type=e.model.type,this._username=null!=(i=e.username)?i:"",this._clientId=null!=(o=e.clientId)?o:s.UUID.uuid4(),this._connectToKernel=e.connectToKernel,this._kernelConnectionOptions=null!=(a=e.kernelConnectionOptions)?a:{},this.serverSettings=null!=(l=e.serverSettings)?l:n.ServerConnection.makeSettings(),this._sessionAPIClient=null!=(h=e.sessionAPIClient)?h:new r.SessionAPIClient({serverSettings:this.serverSettings}),this.setupKernel(e.model.kernel)}get disposed(){return this._disposed}get kernelChanged(){return this._kernelChanged}get statusChanged(){return this._statusChanged}get connectionStatusChanged(){return this._connectionStatusChanged}get pendingInput(){return this._pendingInput}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get anyMessage(){return this._anyMessage}get propertyChanged(){return this._propertyChanged}get id(){return this._id}get kernel(){return this._kernel}get path(){return this._path}get type(){return this._type}get name(){return this._name}get model(){return{id:this.id,kernel:this.kernel&&{id:this.kernel.id,name:this.kernel.name},path:this._path,type:this._type,name:this._name}}get isDisposed(){return this._isDisposed}update(e){let t=this.model;if(this._path=e.path,this._name=e.name,this._type=e.type,null===this._kernel&&null!==e.kernel||null!==this._kernel&&null===e.kernel||null!==this._kernel&&null!==e.kernel&&this._kernel.id!==e.kernel.id){null!==this._kernel&&this._kernel.dispose();let t=this._kernel||null;this.setupKernel(e.kernel);let n=this._kernel||null;this._kernelChanged.emit({name:"kernel",oldValue:t,newValue:n})}this._handleModelChange(t)}dispose(){if(!this.isDisposed){if(this._isDisposed=!0,this._disposed.emit(),this._kernel){this._kernel.dispose();let e=this._kernel;this._kernel=null;let t=this._kernel;this._kernelChanged.emit({name:"kernel",oldValue:e,newValue:t})}t.Signal.clearData(this)}}async setPath(e){if(this.isDisposed)throw Error("Session is disposed");await this._patch({path:e})}async setName(e){if(this.isDisposed)throw Error("Session is disposed");await this._patch({name:e})}async setType(e){if(this.isDisposed)throw Error("Session is disposed");await this._patch({type:e})}async changeKernel(e){if(this.isDisposed)throw Error("Session is disposed");return await this._patch({kernel:e}),this.kernel}async shutdown(){if(this.isDisposed)throw Error("Session is disposed");await this._sessionAPIClient.shutdown(this.id),this.dispose()}setupKernel(e){if(null===e){this._kernel=null;return}let t=this._connectToKernel({...this._kernelConnectionOptions,model:e,username:this._username,clientId:this._clientId,serverSettings:this.serverSettings});this._kernel=t,t.statusChanged.connect(this.onKernelStatus,this),t.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),t.pendingInput.connect(this.onPendingInput,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.anyMessage.connect(this.onAnyMessage,this)}onKernelStatus(e,t){this._statusChanged.emit(t)}onKernelConnectionStatus(e,t){this._connectionStatusChanged.emit(t)}onPendingInput(e,t){this._pendingInput.emit(t)}onIOPubMessage(e,t){this._iopubMessage.emit(t)}onUnhandledMessage(e,t){this._unhandledMessage.emit(t)}onAnyMessage(e,t){this._anyMessage.emit(t)}async _patch(e){let t=await this._sessionAPIClient.update({...e,id:this._id});return this.update(t),t}_handleModelChange(e){e.name!==this._name&&this._propertyChanged.emit("name"),e.type!==this._type&&this._propertyChanged.emit("type"),e.path!==this._path&&this._propertyChanged.emit("path")}}}),so=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SessionManager=void 0;var t=He(),n=ee(),s=de(),r=$e(),i=to(),o=Cn(),a=class extends r.BaseManager{constructor(e){var s,r;super(e),this._isReady=!1,this._sessionConnections=new Set,this._models=new Map,this._runningChanged=new n.Signal(this),this._connectionFailure=new n.Signal(this),this._connectToKernel=e=>this._kernelManager.connectTo(e),this._kernelManager=e.kernelManager,this._sessionAPIClient=null!=(s=e.sessionAPIClient)?s:new o.SessionAPIClient({serverSettings:e.serverSettings}),this._pollModels=new t.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:SessionManager#models",standby:null!=(r=e.standby)?r:"when-hidden"}),this._ready=(async()=>{await this._pollModels.start(),await this._pollModels.tick,this._kernelManager.isActive&&await this._kernelManager.ready,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){this.isDisposed||(this._models.clear(),this._sessionConnections.forEach(e=>e.dispose()),this._pollModels.dispose(),super.dispose())}connectTo(e){let t=new i.SessionConnection({...e,connectToKernel:this._connectToKernel,serverSettings:this.serverSettings,sessionAPIClient:this._sessionAPIClient});return this._onStarted(t),this._models.has(e.model.id)||this.refreshRunning().catch(()=>{}),t}running(){return this._models.values()}async refreshRunning(){await this._pollModels.refresh(),await this._pollModels.tick}async startNew(e,t={}){let n=await this._sessionAPIClient.startNew(e);return await this.refreshRunning(),this.connectTo({...t,model:n})}async shutdown(e){await this._sessionAPIClient.shutdown(e),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all([...this._models.keys()].map(e=>this._sessionAPIClient.shutdown(e))),await this.refreshRunning()}async stopIfNeeded(e){try{let t=(await this._sessionAPIClient.listRunning()).filter(t=>t.path===e);if(1===t.length){let e=t[0].id;await this.shutdown(e)}}catch{}}async findById(e){return this._models.has(e)||await this.refreshRunning(),this._models.get(e)}async findByPath(e){for(let t of this._models.values())if(t.path===e)return t;for(let t of(await this.refreshRunning(),this._models.values()))if(t.path===e)return t}async requestRunning(){var e,t;let n;try{n=await this._sessionAPIClient.listRunning()}catch(n){throw(n instanceof s.ServerConnection.NetworkError||(null==(e=n.response)?void 0:e.status)===503||(null==(t=n.response)?void 0:t.status)===424)&&this._connectionFailure.emit(n),n}this.isDisposed||this._models.size===n.length&&n.every(e=>{var t,n,s,r;let i=this._models.get(e.id);return!!i&&(null==(t=i.kernel)?void 0:t.id)===(null==(n=e.kernel)?void 0:n.id)&&(null==(s=i.kernel)?void 0:s.name)===(null==(r=e.kernel)?void 0:r.name)&&i.name===e.name&&i.path===e.path&&i.type===e.type})||(this._models=new Map(n.map(e=>[e.id,e])),this._sessionConnections.forEach(e=>{this._models.has(e.id)?e.update(this._models.get(e.id)):e.dispose()}),this._runningChanged.emit(n))}_onStarted(e){this._sessionConnections.add(e),e.disposed.connect(this._onDisposed,this),e.propertyChanged.connect(this._onChanged,this),e.kernelChanged.connect(this._onChanged,this)}_onDisposed(e){this._sessionConnections.delete(e),this.refreshRunning().catch(()=>{})}_onChanged(){this.refreshRunning().catch(()=>{})}};e.SessionManager=a,function(e){class t extends e{constructor(){super(...arguments),this._readyPromise=new Promise(()=>{})}get isActive(){return!1}get parentReady(){return super.ready}async startNew(e,t={}){return Promise.reject(Error("Not implemented in no-op Session Manager"))}connectTo(e){throw Error("Not implemented in no-op Session Manager")}get ready(){return this.parentReady.then(()=>this._readyPromise)}async shutdown(e){return Promise.reject(Error("Not implemented in no-op Session Manager"))}async requestRunning(){return Promise.resolve()}}e.NoopManager=t}(a||(e.SessionManager=a={}))}),As=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&t(s,e,r);return n(s,e),s},r=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.SessionAPI=e.Session=void 0,e.Session=s(Hr()),e.SessionAPI=s(Cn()),r(so(),e)}),oo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DataConnector=void 0,e.DataConnector=class{async list(e){throw Error("DataConnector#list method has not been implemented.")}async remove(e){throw Error("DataConnector#remove method has not been implemented.")}async save(e,t){throw Error("DataConnector#save method has not been implemented.")}}}),lo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),uo=R((e,t)=>{!function(n,s){"object"==typeof e&&void 0!==t?s(e):"function"==typeof define&&define.amd?define(["exports"],s):s((n="undefined"!=typeof globalThis?globalThis:n||self).lumino_properties={})}(e,function(e){var t;class n{constructor(e){this._pid=t.nextPID(),this.name=e.name,this._create=e.create,this._coerce=e.coerce||null,this._compare=e.compare||null,this._changed=e.changed||null}get(e){let n=t.ensureMap(e);return this._pid in n?n[this._pid]:n[this._pid]=this._createValue(e)}set(e,n){let s,r=t.ensureMap(e);s=this._pid in r?r[this._pid]:r[this._pid]=this._createValue(e);let i=this._coerceValue(e,n);this._maybeNotify(e,s,r[this._pid]=i)}coerce(e){let n,s=t.ensureMap(e);n=this._pid in s?s[this._pid]:s[this._pid]=this._createValue(e);let r=this._coerceValue(e,n);this._maybeNotify(e,n,s[this._pid]=r)}_createValue(e){return(0,this._create)(e)}_coerceValue(e,t){let n=this._coerce;return n?n(e,t):t}_compareValue(e,t){let n=this._compare;return n?n(e,t):e===t}_maybeNotify(e,t,n){let s=this._changed;s&&!this._compareValue(t,n)&&s(e,t,n)}}!function(e){e.clearData=function(e){t.ownerData.delete(e)}}(n||(n={})),function(e){function t(t){let n=e.ownerData.get(t);return n||(n=Object.create(null),e.ownerData.set(t,n),n)}e.ownerData=new WeakMap,e.nextPID=(()=>{let e=0;return()=>`pid-${`${Math.random()}`.slice(2)}-${e++}`})(),e.ensureMap=t}(t||(t={})),e.AttachedProperty=n})}),fo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RestorablePool=void 0;var t,n=Y(),s=uo(),r=ee();e.RestorablePool=class{constructor(e){this._added=new r.Signal(this),this._current=null,this._currentChanged=new r.Signal(this),this._hasRestored=!1,this._isDisposed=!1,this._objects=new Set,this._restore=null,this._restored=new n.PromiseDelegate,this._updated=new r.Signal(this),this.namespace=e.namespace}get added(){return this._added}get current(){return this._current}set current(e){this._current!==e&&null!==e&&this._objects.has(e)&&(this._current=e,this._currentChanged.emit(this._current))}get currentChanged(){return this._currentChanged}get isDisposed(){return this._isDisposed}get restored(){return this._restored.promise}get size(){return this._objects.size}get updated(){return this._updated}async add(e){var n,s;if(e.isDisposed){let t="A disposed object cannot be added.";throw console.warn(t,e),Error(t)}if(this._objects.has(e)){let t="This object already exists in the pool.";throw console.warn(t,e),Error(t)}if(this._objects.add(e),e.disposed.connect(this._onInstanceDisposed,this),!t.injectedProperty.get(e)){if(this._restore){let{connector:r}=this._restore,i=this._restore.name(e);if(i){let o=`${this.namespace}:${i}`,a=null==(s=(n=this._restore).args)?void 0:s.call(n,e);t.nameProperty.set(e,o),await r.save(o,{data:a})}}this._added.emit(e)}}dispose(){this.isDisposed||(this._current=null,this._isDisposed=!0,this._objects.clear(),r.Signal.clearData(this))}find(e){for(let t of this._objects.values())if(e(t))return t}forEach(e){this._objects.forEach(e)}filter(e){let t=[];return this.forEach(n=>{e(n)&&t.push(n)}),t}inject(e){return t.injectedProperty.set(e,!0),this.add(e)}has(e){return this._objects.has(e)}async restore(e){if(this._hasRestored)throw Error("This pool has already been restored.");this._hasRestored=!0;let{command:t,connector:n,registry:s,when:r}=e,i=this.namespace,o=r?[n.list(i)].concat(r):[n.list(i)];this._restore=e;let[a]=await Promise.all(o),l=await Promise.all(a.ids.map(async(e,r)=>{let i=a.values[r],o=i&&i.data;return void 0===o?n.remove(e):s.execute(t,o).catch(()=>n.remove(e))}));return this._restored.resolve(),l}async save(e){var n,s;let r=t.injectedProperty.get(e);if(!this._restore||!this.has(e)||r)return;let{connector:i}=this._restore,o=this._restore.name(e),a=t.nameProperty.get(e),l=o?`${this.namespace}:${o}`:"";if(a&&a!==l&&await i.remove(a),t.nameProperty.set(e,l),l){let t=null==(s=(n=this._restore).args)?void 0:s.call(n,e);await i.save(l,{data:t})}a!==l&&this._updated.emit(e)}_onInstanceDisposed(e){if(this._objects.delete(e),e===this._current&&(this._current=null,this._currentChanged.emit(this._current)),t.injectedProperty.get(e)||!this._restore)return;let{connector:n}=this._restore,s=t.nameProperty.get(e);s&&n.remove(s)}},function(e){e.injectedProperty=new s.AttachedProperty({name:"injected",create:()=>!1}),e.nameProperty=new s.AttachedProperty({name:"name",create:()=>""})}(t||(t={}))}),_o=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StateDB=void 0;var t=ee(),n=class e{constructor(n={}){this._changed=new t.Signal(this);let{connector:s,transform:r}=n;this._connector=s||new e.Connector,r?this._ready=r.then(e=>{let{contents:t,type:n}=e;switch(n){case"cancel":default:return;case"clear":return this._clear();case"merge":return this._merge(t||{});case"overwrite":return this._overwrite(t||{})}}):this._ready=Promise.resolve(void 0)}get changed(){return this._changed}async clear(){await this._ready,await this._clear()}async fetch(e){return await this._ready,this._fetch(e)}async list(e){return await this._ready,this._list(e)}async remove(e){await this._ready,await this._remove(e),this._changed.emit({id:e,type:"remove"})}async save(e,t){await this._ready,await this._save(e,t),this._changed.emit({id:e,type:"save"})}async toJSON(){await this._ready;let{ids:e,values:t}=await this._list();return t.reduce((t,n,s)=>(t[e[s]]=n,t),{})}async _clear(){await Promise.all((await this._list()).ids.map(e=>this._remove(e)))}async _fetch(e){let t=await this._connector.fetch(e);if(t)return JSON.parse(t).v}async _list(e=""){let{ids:t,values:n}=await this._connector.list(e);return{ids:t,values:n.map(e=>JSON.parse(e).v)}}async _merge(e){await Promise.all(Object.keys(e).map(t=>e[t]&&this._save(t,e[t])))}async _overwrite(e){await this._clear(),await this._merge(e)}async _remove(e){return this._connector.remove(e)}async _save(e,t){return this._connector.save(e,JSON.stringify({v:t}))}};e.StateDB=n,function(e){class t{constructor(){this._storage={}}async fetch(e){return this._storage[e]}async list(e=""){return Object.keys(this._storage).reduce((t,n)=>((""===e||e===n.split(":")[0])&&(t.ids.push(n),t.values.push(this._storage[n])),t),{ids:[],values:[]})}async remove(e){delete this._storage[e]}async save(e,t){this._storage[e]=t}}e.Connector=t}(n||(e.StateDB=n={}))}),po=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IStateDB=void 0,e.IStateDB=new(Y()).Token("@jupyterlab/coreutils:IStateDB",`A service for the JupyterLab state database.
  Use this if you want to store data that will persist across page loads.
  See "state database" for more information.`)}),xs=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(oo(),e),n(lo(),e),n(fo(),e),n(_o(),e),n(po(),e)}),zs=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SettingManager=void 0;var t,n=te(),s=xs(),r=de(),i="api/settings";e.SettingManager=class extends s.DataConnector{constructor(e={}){var t;super(),this.serverSettings=null!=(t=e.serverSettings)?t:r.ServerConnection.makeSettings()}async fetch(e){if(!e)throw Error("Plugin `id` parameter is required for settings fetch.");let{serverSettings:n}=this,{baseUrl:s,appUrl:i}=n,{makeRequest:o,ResponseError:a}=r.ServerConnection,l=s+i,h=t.url(l,e),u=await o(h,{},n);if(200!==u.status)throw await a.create(u);return u.json()}async list(e){var n,s,i,o;let{serverSettings:a}=this,{baseUrl:l,appUrl:h}=a,{makeRequest:u,ResponseError:c}=r.ServerConnection,d=l+h,p=t.url(d,"","ids"===e),g=await u(p,{},a);if(200!==g.status)throw new c(g);let _=await g.json(),f=null!=(s=null==(n=null==_?void 0:_.settings)?void 0:n.map(e=>e.id))?s:[],m=[];return e||(m=null!=(o=null==(i=null==_?void 0:_.settings)?void 0:i.map(e=>(e.data={composite:{},user:{}},e)))?o:[]),{ids:f,values:m}}async save(e,n){let{serverSettings:s}=this,{baseUrl:i,appUrl:o}=s,{makeRequest:a,ResponseError:l}=r.ServerConnection,h=i+o,u=t.url(h,e),c={body:JSON.stringify({raw:n}),method:"PUT"},d=await a(u,c,s);if(204!==d.status)throw new l(d)}},function(e){e.url=function(e,t,s){let r=s?n.URLExt.objectToQueryString({ids_only:!0}):"",o=n.URLExt.join(e,i),a=n.URLExt.join(o,t);if(!a.startsWith(o))throw Error("Can only be used for workspaces requests");return`${a}${r}`}}(t||(t={}))}),Rt=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalAPIClient=e.TERMINAL_SERVICE_URL=void 0,e.isAvailable=r,e.startNew=i,e.listRunning=o,e.shutdownTerminal=a;var t,n=te(),s=de();function r(){return"true"===String(n.PageConfig.getOption("terminalsAvailable")).toLowerCase()}async function i(r=s.ServerConnection.makeSettings(),o,a){t.errorIfNotAvailable();let l=n.URLExt.join(r.baseUrl,e.TERMINAL_SERVICE_URL),h={method:"POST",body:JSON.stringify({name:o,cwd:a})},u=await s.ServerConnection.makeRequest(l,h,r);if(200!==u.status)throw await s.ServerConnection.ResponseError.create(u);return await u.json()}async function o(r=s.ServerConnection.makeSettings()){t.errorIfNotAvailable();let i=n.URLExt.join(r.baseUrl,e.TERMINAL_SERVICE_URL),a=await s.ServerConnection.makeRequest(i,{},r);if(200!==a.status)throw await s.ServerConnection.ResponseError.create(a);let l=await a.json();if(!Array.isArray(l))throw Error("Invalid terminal list");return l}async function a(r,i=s.ServerConnection.makeSettings()){var o;t.errorIfNotAvailable();let l=n.URLExt.join(i.baseUrl,e.TERMINAL_SERVICE_URL),h=n.URLExt.join(l,r);if(!h.startsWith(l))throw Error("Can only be used for terminal requests");let u={method:"DELETE"},c=await s.ServerConnection.makeRequest(h,u,i);if(404===c.status)console.warn(null!=(o=(await c.json()).message)?o:`The terminal session "${r}"" does not exist on the server`);else if(204!==c.status)throw await s.ServerConnection.ResponseError.create(c)}e.TERMINAL_SERVICE_URL="api/terminals",e.TerminalAPIClient=class{constructor(e={}){var t;this.serverSettings=null!=(t=e.serverSettings)?t:s.ServerConnection.makeSettings()}get isAvailable(){return r()}async startNew(e={}){let{name:t,cwd:n}=e;return i(this.serverSettings,t,n)}async listRunning(){return o(this.serverSettings)}async shutdown(e){return a(e,this.serverSettings)}},function(e){e.errorIfNotAvailable=function(){if(!r())throw Error("Terminals Unavailable")}}(t||(t={}))}),yo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isAvailable=void 0;var t=Rt();Object.defineProperty(e,"isAvailable",{enumerable:!0,get:function(){return t.isAvailable}})}),wo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalConnection=void 0;var t,n=te(),s=Y(),r=ee(),i=Ae(),o=Rt();e.TerminalConnection=class e{constructor(e){var t,s;this._createSocket=()=>{this._errorIfDisposed(),this._clearSocket(),this._updateConnectionStatus("connecting");let e=this._name,t=this.serverSettings,s=n.URLExt.join(t.wsUrl,"terminals","websocket",encodeURIComponent(e)),r=t.token;t.appendToken&&""!==r&&(s+=`?token=${encodeURIComponent(r)}`),this._ws=new t.WebSocket(s),this._ws.onmessage=this._onWSMessage,this._ws.onclose=this._onWSClose,this._ws.onerror=this._onWSClose},this._onWSMessage=e=>{if(this._isDisposed)return;let t=JSON.parse(e.data);if("disconnect"===t[0]&&this.dispose(),"connecting"===this._connectionStatus){"setup"===t[0]&&this._updateConnectionStatus("connected");return}this._messageReceived.emit({type:t[0],content:t.slice(1)})},this._onWSClose=e=>{console.warn(`Terminal websocket closed: ${e.code}`),this.isDisposed||this._reconnect()},this._connectionStatus="connecting",this._connectionStatusChanged=new r.Signal(this),this._isDisposed=!1,this._disposed=new r.Signal(this),this._messageReceived=new r.Signal(this),this._reconnectTimeout=null,this._ws=null,this._noOp=()=>{},this._reconnectLimit=7,this._reconnectAttempt=0,this._pendingMessages=[],this._name=e.model.name,this.serverSettings=null!=(t=e.serverSettings)?t:i.ServerConnection.makeSettings(),this._terminalAPIClient=null!=(s=e.terminalAPIClient)?s:new o.TerminalAPIClient({serverSettings:this.serverSettings}),this._createSocket()}get disposed(){return this._disposed}get messageReceived(){return this._messageReceived}get name(){return this._name}get model(){return{name:this._name}}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._updateConnectionStatus("disconnected"),this._clearSocket(),r.Signal.clearData(this))}send(e){this._sendMessage(e)}_sendMessage(e,t=!0){if(!(this._isDisposed||!e.content))if("connected"===this.connectionStatus&&this._ws){let t=[e.type,...e.content];this._ws.send(JSON.stringify(t))}else if(t)this._pendingMessages.push(e);else throw Error(`Could not send message: ${JSON.stringify(e)}`)}_sendPending(){for(;"connected"===this.connectionStatus&&this._pendingMessages.length>0;)this._sendMessage(this._pendingMessages[0],!1),this._pendingMessages.shift()}reconnect(){this._errorIfDisposed();let e=new s.PromiseDelegate,t=(n,s)=>{"connected"===s?(e.resolve(),this.connectionStatusChanged.disconnect(t,this)):"disconnected"===s&&(e.reject(Error("Terminal connection disconnected")),this.connectionStatusChanged.disconnect(t,this))};return this.connectionStatusChanged.connect(t,this),this._reconnectAttempt=0,this._reconnect(),e.promise}_reconnect(){if(this._errorIfDisposed(),clearTimeout(this._reconnectTimeout),this._reconnectAttempt<this._reconnectLimit){this._updateConnectionStatus("connecting");let e=t.getRandomIntInclusive(0,1e3*(Math.pow(2,this._reconnectAttempt)-1));console.error(`Connection lost, reconnecting in ${Math.floor(e/1e3)} seconds.`),this._reconnectTimeout=setTimeout(this._createSocket,e),this._reconnectAttempt+=1}else this._updateConnectionStatus("disconnected");this._clearSocket()}_clearSocket(){null!==this._ws&&(this._ws.onopen=this._noOp,this._ws.onclose=this._noOp,this._ws.onerror=this._noOp,this._ws.onmessage=this._noOp,this._ws.close(),this._ws=null)}async shutdown(){await this._terminalAPIClient.shutdown(this.name),this.dispose()}clone(){return new e({model:this.model,serverSettings:this.serverSettings,terminalAPIClient:this._terminalAPIClient})}_updateConnectionStatus(e){this._connectionStatus!==e&&(this._connectionStatus=e,"connecting"!==e&&(this._reconnectAttempt=0,clearTimeout(this._reconnectTimeout)),"connected"===e&&this._sendPending(),this._connectionStatusChanged.emit(e))}_errorIfDisposed(){if(this.isDisposed)throw Error("Terminal connection is disposed")}get connectionStatusChanged(){return this._connectionStatusChanged}get connectionStatus(){return this._connectionStatus}},function(e){e.getRandomIntInclusive=function(e,t){return e=Math.ceil(e),Math.floor(Math.random()*((t=Math.floor(t))-e+1))+e}}(t||(t={}))}),bo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalManager=void 0;var t=He(),n=ee(),s=Ae(),r=$e(),i=Rt(),o=wo(),a=class extends r.BaseManager{constructor(e={}){var s,r;if(super(e),this._isReady=!1,this._names=[],this._terminalConnections=new Set,this._runningChanged=new n.Signal(this),this._connectionFailure=new n.Signal(this),this._terminalAPIClient=null!=(s=e.terminalAPIClient)?s:new i.TerminalAPIClient({serverSettings:this.serverSettings}),!this.isAvailable()){this._ready=Promise.reject("Terminals unavailable"),this._ready.catch(e=>{});return}let o=this._pollModels=new t.Poll({auto:!1,factory:()=>this.requestRunning(),frequency:{interval:1e4,backoff:!0,max:3e5},name:"@jupyterlab/services:TerminalManager#models",standby:null!=(r=e.standby)?r:"when-hidden"});this._ready=(async()=>{await o.start(),await o.tick,this._isReady=!0})()}get isReady(){return this._isReady}get ready(){return this._ready}get runningChanged(){return this._runningChanged}get connectionFailure(){return this._connectionFailure}dispose(){var e;this.isDisposed||(this._names.length=0,this._terminalConnections.forEach(e=>e.dispose()),null==(e=this._pollModels)||e.dispose(),super.dispose())}isAvailable(){return this._terminalAPIClient.isAvailable}connectTo(e){let t=new o.TerminalConnection({...e,serverSettings:this.serverSettings,terminalAPIClient:this._terminalAPIClient});return this._onStarted(t),this._names.includes(e.model.name)||this.refreshRunning().catch(()=>{}),t}running(){return this._models[Symbol.iterator]()}async refreshRunning(){this._pollModels&&(await this._pollModels.refresh(),await this._pollModels.tick)}async startNew(e={}){let{name:t,cwd:n}=e,s=await this._terminalAPIClient.startNew({name:t,cwd:n});return await this.refreshRunning(),this.connectTo({model:s})}async shutdown(e){await this._terminalAPIClient.shutdown(e),await this.refreshRunning()}async shutdownAll(){await this.refreshRunning(),await Promise.all(this._names.map(e=>this._terminalAPIClient.shutdown(e))),await this.refreshRunning()}async requestRunning(){var e,t;let n;try{n=await this._terminalAPIClient.listRunning()}catch(n){throw(n instanceof s.ServerConnection.NetworkError||(null==(e=n.response)?void 0:e.status)===503||(null==(t=n.response)?void 0:t.status)===424)&&this._connectionFailure.emit(n),n}if(this.isDisposed)return;let r=n.map(({name:e})=>e).sort();r!==this._names&&(this._names=r,this._terminalConnections.forEach(e=>{r.includes(e.name)||e.dispose()}),this._runningChanged.emit(this._models))}_onStarted(e){this._terminalConnections.add(e),e.disposed.connect(this._onDisposed,this)}_onDisposed(e){this._terminalConnections.delete(e),this.refreshRunning().catch(()=>{})}get _models(){return this._names.map(e=>({name:e}))}};e.TerminalManager=a,function(e){class t extends e{constructor(){super(...arguments),this._readyPromise=new Promise(()=>{})}get isActive(){return!1}get parentReady(){return super.ready}get ready(){return this.parentReady.then(()=>this._readyPromise)}async startNew(e){return Promise.reject(Error("Not implemented in no-op Terminal Manager"))}connectTo(e){throw Error("Not implemented in no-op Terminal Manager")}async shutdown(e){return Promise.reject(Error("Not implemented in no-op Terminal Manager"))}async requestRunning(){return Promise.resolve()}}e.NoopManager=t}(a||(e.TerminalManager=a={}))}),Hs=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&t(s,e,r);return n(s,e),s},r=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.TerminalAPI=e.Terminal=void 0,e.Terminal=s(yo()),e.TerminalAPI=s(Rt()),r(bo(),e)}),Eo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),Gs=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UserAPIClient=void 0;var t=de(),n=te(),s="api/me";e.UserAPIClient=class{constructor(e={}){var n;this.serverSettings=null!=(n=e.serverSettings)?n:t.ServerConnection.makeSettings()}async get(){let{baseUrl:e}=this.serverSettings,{makeRequest:r,ResponseError:i}=t.ServerConnection,o=n.URLExt.join(e,s),a=await r(o,{},this.serverSettings);if(200!==a.status)throw await i.create(a);return await a.json()}}}),ko=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UserManager=void 0;var t,n=Y(),s=He(),r=ee(),i=$e(),o=Gs(),a="@jupyterlab/services:UserManager#user";e.UserManager=class extends i.BaseManager{constructor(e={}){var t,n;super(e),this._isReady=!1,this._userChanged=new r.Signal(this),this._connectionFailure=new r.Signal(this),this._userApiClient=null!=(t=e.userApiClient)?t:new o.UserAPIClient({serverSettings:this.serverSettings}),this._ready=this.requestUser().then(()=>{this.isDisposed||(this._isReady=!0)}).catch(e=>new Promise(()=>{})),this._pollUser=new s.Poll({auto:!1,factory:()=>this.requestUser(),frequency:{interval:61e3,backoff:!0,max:3e5},name:a,standby:null!=(n=e.standby)?n:"when-hidden"}),this.ready.then(()=>{this._pollUser.start()})}get isReady(){return this._isReady}get ready(){return this._ready}get identity(){return this._identity}get permissions(){return this._permissions}get userChanged(){return this._userChanged}get connectionFailure(){return this._connectionFailure}dispose(){this._pollUser.dispose(),super.dispose()}async refreshUser(){await this._pollUser.refresh(),await this._pollUser.tick}async requestUser(){if(this.isDisposed)return;let e={identity:this._identity,permissions:this._permissions},s=await this._userApiClient.get(),r=s.identity,{localStorage:i}=window,o=i.getItem(a);if(o&&(!r.initials||!r.color)){let e=JSON.parse(o);r.initials=r.initials||e.initials||r.name.substring(0,1),r.color=r.color||e.color||t.getRandomColor()}n.JSONExt.deepEqual(s,e)||(this._identity=r,this._permissions=s.permissions,i.setItem(a,JSON.stringify(r)),this._userChanged.emit(s))}},function(e){let t=["var(--jp-collaborator-color1)","var(--jp-collaborator-color2)","var(--jp-collaborator-color3)","var(--jp-collaborator-color4)","var(--jp-collaborator-color5)","var(--jp-collaborator-color6)","var(--jp-collaborator-color7)"];e.getRandomColor=()=>t[Math.floor(Math.random()*t.length)]}(t||(t={}))}),Zs=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var s={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&t(s,e,r);return n(s,e),s},r=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.UserAPI=e.User=void 0,e.User=s(Eo()),e.UserAPI=s(Gs()),r(ko(),e)}),ti=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceManager=void 0;var t,n=te(),s=xs(),r=de(),i="api/workspaces";e.WorkspaceManager=class extends s.DataConnector{constructor(e={}){var t;super(),this.serverSettings=null!=(t=e.serverSettings)?t:r.ServerConnection.makeSettings()}async fetch(e){let{serverSettings:n}=this,{baseUrl:s,appUrl:i}=n,{makeRequest:o,ResponseError:a}=r.ServerConnection,l=s+i,h=t.url(l,e),u=await o(h,{},n);if(200!==u.status)throw await a.create(u);return u.json()}async list(){let{serverSettings:e}=this,{baseUrl:n,appUrl:s}=e,{makeRequest:i,ResponseError:o}=r.ServerConnection,a=n+s,l=t.url(a,""),h=await i(l,{},e);if(200!==h.status)throw await o.create(h);return(await h.json()).workspaces}async remove(e){let{serverSettings:n}=this,{baseUrl:s,appUrl:i}=n,{makeRequest:o,ResponseError:a}=r.ServerConnection,l=s+i,h=t.url(l,e),u=await o(h,{method:"DELETE"},n);if(204!==u.status)throw await a.create(u)}async save(e,n){let{serverSettings:s}=this,{baseUrl:i,appUrl:o}=s,{makeRequest:a,ResponseError:l}=r.ServerConnection,h=i+o,u=t.url(h,e),c={body:JSON.stringify(n),method:"PUT"},d=await a(u,c,s);if(204!==d.status)throw await l.create(d)}},function(e){e.url=function(e,t){let s=n.URLExt.join(e,i),r=n.URLExt.join(s,t);if(!r.startsWith(s))throw Error("Can only be used for workspaces requests");return r}}(t||(t={}))}),jo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ServiceManager=void 0;var t=ee(),n=Wr(),s=_s(),r=gs(),i=Ms(),o=Is(),a=Ts(),l=de(),h=As(),u=zs(),c=Hs(),d=Zs(),p=ti();e.ServiceManager=class{constructor(e={}){var g,_;this._isDisposed=!1,this._connectionFailure=new t.Signal(this),this._isReady=!1;let f=e.defaultDrive,m=null!=(g=e.serverSettings)?g:l.ServerConnection.makeSettings(),v={defaultDrive:f,serverSettings:m,standby:null!=(_=e.standby)?_:"when-hidden"};this.serverSettings=m,this.contents=e.contents||new s.ContentsManager(v),this.events=e.events||new r.EventManager(v),this.kernels=e.kernels||new i.KernelManager(v),this.sessions=e.sessions||new h.SessionManager({...v,kernelManager:this.kernels}),this.settings=e.settings||new u.SettingManager(v),this.terminals=e.terminals||new c.TerminalManager(v),this.builder=e.builder||new n.BuildManager(v),this.workspaces=e.workspaces||new p.WorkspaceManager(v),this.nbconvert=e.nbconvert||new a.NbConvertManager(v),this.kernelspecs=e.kernelspecs||new o.KernelSpecManager(v),this.user=e.user||new d.UserManager(v),this.kernelspecs.connectionFailure.connect(this._onConnectionFailure,this),this.sessions.connectionFailure.connect(this._onConnectionFailure,this),this.terminals.connectionFailure.connect(this._onConnectionFailure,this);let y=[this.sessions.ready,this.kernelspecs.ready];this.terminals.isAvailable()&&y.push(this.terminals.ready),this._readyPromise=Promise.all(y).then(()=>{this._isReady=!0})}get connectionFailure(){return this._connectionFailure}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,t.Signal.clearData(this),this.contents.dispose(),this.events.dispose(),this.sessions.dispose(),this.terminals.dispose())}get isReady(){return this._isReady}get ready(){return this._readyPromise}_onConnectionFailure(e,t){this._connectionFailure.emit(t)}}}),Uo=R(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IWorkspaceManager=e.IUserManager=e.ITerminalManager=e.IServiceManager=e.ISettingManager=e.ISessionManager=e.IServerSettings=e.INbConvertManager=e.IKernelSpecManager=e.IKernelManager=e.IEventManager=e.IDefaultDrive=e.IDefaultContentProvider=e.IContentsManager=e.IConfigSectionManager=e.IConnectionStatus=void 0;var t=Y();e.IConnectionStatus=new t.Token("@jupyterlab/application:IConnectionStatus","A service providing the application connection status."),e.IConfigSectionManager=new t.Token("@jupyterlab/services:IConfigSectionManager","A service providing the config section manager."),e.IContentsManager=new t.Token("@jupyterlab/services:IContentsManager","The contents manager token."),e.IDefaultContentProvider=new t.Token("@jupyterlab/services:IDefaultContentProvider","The default content provider for the contents manager."),e.IDefaultDrive=new t.Token("@jupyterlab/services:IDefaultDrive","The default drive for the contents manager."),e.IEventManager=new t.Token("@jupyterlab/services:IEventManager","The event manager token."),e.IKernelManager=new t.Token("@jupyterlab/services:IKernelManager","The kernel manager token."),e.IKernelSpecManager=new t.Token("@jupyterlab/services:IKernelSpecManager","The kernel spec manager token."),e.INbConvertManager=new t.Token("@jupyterlab/services:INbConvertManager","The nbconvert manager token."),e.IServerSettings=new t.Token("@jupyterlab/services:IServerSettings","The server settings for the application."),e.ISessionManager=new t.Token("@jupyterlab/services:ISessionManager","The session manager token."),e.ISettingManager=new t.Token("@jupyterlab/services:ISettingManager","The setting manager token."),e.IServiceManager=new t.Token("@jupyterlab/services:IServiceManager","The service manager for the application."),e.ITerminalManager=new t.Token("@jupyterlab/services:ITerminalManager","The terminal manager token."),e.IUserManager=new t.Token("@jupyterlab/services:IUserManager","The user manager token."),e.IWorkspaceManager=new t.Token("@jupyterlab/services:IWorkspaceManager","The workspace manager token.")}),Ae=R(e=>{var t=e&&e.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),n=e&&e.__exportStar||function(e,n){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(n,s)||t(n,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),n($e(),e),n(rr(),e),n(or(),e),n(_s(),e),n(gs(),e),n(Ms(),e),n(Is(),e),n(jo(),e),n(de(),e),n(As(),e),n(zs(),e),n(Hs(),e),n(Uo(),e),n(Zs(),e),n(ti(),e),n(Ts(),e)});function Ao(e){return"node"in e}var No=ri(()=>{}),Fo={};ta(Fo,{BLOCK_SIZE:()=>Iu,ContentsAPI:()=>zn,DRIVE_SEPARATOR:()=>xo,DriveFS:()=>qt,DriveFSEmscriptenNodeOps:()=>Kn,DriveFSEmscriptenStreamOps:()=>Fn,ServiceWorkerContentsAPI:()=>Vn});var Lo,xo,Iu,Ru,ku,xn,Fn,Kn,zn,Vn,qt,si=ri(()=>{Lo=$n(Y()),No(),xo=":",Iu=4096,Ru=new TextEncoder,ku=new TextDecoder("utf-8"),xn={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0},Fn=class{constructor(e){this.fs=e}open(e){var t;let n=this.fs.realPath(e.node);if(this.fs.FS.isFile(e.node.mode))try{e.file=this.fs.API.get(n)}catch{let s=null!=(t=e.flags)?t:e.shared.flags,r="string"==typeof s?parseInt(s,10):s,i=!0;if((r&=8191)in xn&&(i=xn[r]),i)e.node=this.fs.node_ops.mknod(e.node.parent,e.node.name,e.node.mode,0),e.file=this.fs.API.get(n);else throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT)}}close(e){var t;if(!this.fs.FS.isFile(e.node.mode)||!e.file)return;let n=this.fs.realPath(e.node),s=null!=(t=e.flags)?t:e.shared.flags,r="string"==typeof s?parseInt(s,10):s,i=!0;(r&=8191)in xn&&(i=xn[r]),i&&this.fs.API.put(n,e.file),e.file=void 0}read(e,t,n,s,r){if(s<=0||void 0===e.file||r>=(e.file.data.length||0))return 0;let i=Math.min(e.file.data.length-r,s);return t.set(e.file.data.subarray(r,r+i),n),i}write(e,t,n,s,r){var i;if(s<=0||void 0===e.file)return 0;let o=Date.now();if(e.node.timestamp=o,e.node.atime=o,e.node.mtime=o,e.node.ctime=o,r+s>((null==(i=e.file)?void 0:i.data.length)||0)){let t=e.file.data?e.file.data:new Uint8Array;e.file.data=new Uint8Array(r+s),e.file.data.set(t)}return e.file.data.set(t.subarray(n,n+s),r),s}llseek(e,t,n){var s;let r=t;if(1===n)r+=null!=(s=e.position)?s:e.shared.position;else if(2===n&&this.fs.FS.isFile(e.node.mode))if(void 0!==e.file)r+=e.file.data.length;else throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);if(r<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return r}},Kn=class{constructor(e){this.node=e=>Ao(e)?e.node:e,this.getattr=e=>{let t=this.node(e);return{...this.fs.API.getattr(this.fs.realPath(t)),mode:t.mode,ino:t.id}},this.setattr=(e,t)=>{let n=this.node(e);for(let[e,s]of Object.entries(t))switch(e){case"mode":n.mode=s;break;case"timestamp":n.timestamp=s;break;case"atime":n.atime=s;break;case"mtime":n.mtime=s;break;case"ctime":n.ctime=s;break;case"size":{let e=s,t=this.fs.realPath(n);if(this.fs.FS.isFile(n.mode)&&e>=0){let n;try{n=this.fs.API.get(t)}catch{break}let s=n.data?n.data:new Uint8Array;e!==s.length&&(e<s.length?n.data=n.data.slice(0,e):(n.data=new Uint8Array(e),n.data.set(s)),this.fs.API.put(t,n))}else console.warn("setattr size of",e,"on",n,"not yet implemented");break}case"dontFollow":break;default:console.warn("setattr",e,"of",s,"on",n,"not yet implemented")}},this.lookup=(e,t)=>{let n=this.node(e),s=this.fs.PATH.join2(this.fs.realPath(n),t),r=this.fs.API.lookup(s);if(!r.ok)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);return this.fs.createNode(n,t,r.mode,0)},this.mknod=(e,t,n,s)=>{let r=this.node(e),i=this.fs.PATH.join2(this.fs.realPath(r),t);return this.fs.API.mknod(i,n),this.fs.createNode(r,t,n,s)},this.rename=(e,t,n)=>{let s=this.node(e),r=this.node(t);this.fs.API.rename(s.parent?this.fs.PATH.join2(this.fs.realPath(s.parent),s.name):s.name,this.fs.PATH.join2(this.fs.realPath(r),n)),s.name=n,s.parent=r},this.unlink=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.rmdir=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.readdir=e=>this.fs.API.readdir(this.fs.realPath(this.node(e))),this.symlink=(e,t,n)=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)},this.readlink=e=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL)},this.fs=e}},zn=class{constructor(e){this._driveName=e.driveName,this._mountpoint=e.mountpoint,this.FS=e.FS,this.ERRNO_CODES=e.ERRNO_CODES}lookup(e){return this.request({method:"lookup",path:this.normalizePath(e)})}getmode(e){return this.request({method:"getmode",path:this.normalizePath(e)})}mknod(e,t){return this.request({method:"mknod",path:this.normalizePath(e),data:{mode:t}})}rename(e,t){return this.request({method:"rename",path:this.normalizePath(e),data:{newPath:this.normalizePath(t)}})}readdir(e){let t=this.request({method:"readdir",path:this.normalizePath(e)});return t.push("."),t.push(".."),t}rmdir(e){return this.request({method:"rmdir",path:this.normalizePath(e)})}get(e){let t=this.request({method:"get",path:this.normalizePath(e)});if(!t)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);let n=t.content,s=t.format;switch(s){case"json":case"text":return{data:Ru.encode(n),format:s};case"base64":{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return{data:r,format:s}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(e,t){switch(t.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:ku.decode(t.data)}});case"base64":{let n="";for(let e=0;e<t.data.byteLength;e++)n+=String.fromCharCode(t.data[e]);return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:btoa(n)}})}}}getattr(e){let t=this.request({method:"getattr",path:this.normalizePath(e)}),n=new Date(0);return t.atime=t.atime?new Date(t.atime):n,t.mtime=t.mtime?new Date(t.mtime):n,t.ctime=t.ctime?new Date(t.ctime):n,t.size=t.size||0,t}normalizePath(e){return e.startsWith(this._mountpoint)&&(e=e.slice(this._mountpoint.length)),this._driveName&&(e=`${this._driveName}${xo}${e}`),e}},Vn=class extends zn{constructor(e){super(e),this._baseUrl=e.baseUrl,this._browsingContextId=e.browsingContextId||""}request(e){let t=new XMLHttpRequest;t.open("POST",encodeURI(this.endpoint),!1);let n=Lo.UUID.uuid4(),s={data:{...e,requestId:n},browsingContextId:this._browsingContextId,requestId:n};try{t.send(JSON.stringify(s))}catch(e){console.error(e)}if(t.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(t.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}},qt=class{constructor(e){this.FS=e.FS,this.PATH=e.PATH,this.ERRNO_CODES=e.ERRNO_CODES,this.API=this.createAPI(e),this.driveName=e.driveName,this.node_ops=new Kn(this),this.stream_ops=new Fn(this)}createAPI(e){if(!e.browsingContextId||!e.baseUrl)throw Error("Cannot create service-worker API without current browsingContextId");return new Vn(e)}mount(e){return this.createNode(null,e.mountpoint,16895,0)}createNode(e,t,n,s){let r=this.FS;if(!r.isDir(n)&&!r.isFile(n))throw new r.ErrnoError(this.ERRNO_CODES.EINVAL);let i=r.createNode(e,t,n,s);return i.node_ops=this.node_ops,i.stream_ops=this.stream_ops,i}getMode(e){return this.API.getmode(e)}realPath(e){let t=[],n=e;for(t.push(n.name);n.parent!==n;)n=n.parent,t.push(n.name);return t.reverse(),this.PATH.join.apply(null,t)}}}),ai=Symbol("Comlink.proxy"),sa=Symbol("Comlink.endpoint"),ia=Symbol("Comlink.releaseProxy"),Hn=Symbol("Comlink.finalizer"),jt=Symbol("Comlink.thrown"),li=e=>"object"==typeof e&&null!==e||"function"==typeof e,ra={canHandle:e=>li(e)&&e[ai],serialize(e){let{port1:t,port2:n}=new MessageChannel;return Lt(e,t),[n,[n]]},deserialize:e=>(e.start(),ca(e))},oa={canHandle:e=>li(e)&&jt in e,serialize({value:e}){let t;return[t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize(e){throw e.isError?Object.assign(Error(e.value.message),e.value):e.value}},ci=new Map([["proxy",ra],["throw",oa]]);function aa(e,t){for(let n of e)if(t===n||"*"===n||n instanceof RegExp&&n.test(t))return!0;return!1}function Lt(e,t=globalThis,n=["*"]){t.addEventListener("message",function s(r){if(!r||!r.data)return;if(!aa(n,r.origin))return void console.warn(`Invalid origin '${r.origin}' for comlink proxy`);let{id:i,type:o,path:a}=Object.assign({path:[]},r.data),l=(r.data.argumentList||[]).map(We),h;try{let t=a.slice(0,-1).reduce((e,t)=>e[t],e),n=a.reduce((e,t)=>e[t],e);switch(o){case"GET":h=n;break;case"SET":t[a.slice(-1)[0]]=We(r.data.value),h=!0;break;case"APPLY":h=n.apply(t,l);break;case"CONSTRUCT":{let e=new n(...l);h=_a(e)}break;case"ENDPOINT":{let{port1:t,port2:n}=new MessageChannel;Lt(e,n),h=fa(t,[t])}break;case"RELEASE":h=void 0;break;default:return}}catch(e){h={value:e,[jt]:0}}Promise.resolve(h).catch(e=>({value:e,[jt]:0})).then(n=>{let[r,a]=Nt(n);t.postMessage(Object.assign(Object.assign({},r),{id:i}),a),"RELEASE"===o&&(t.removeEventListener("message",s),ui(t),Hn in e&&"function"==typeof e[Hn]&&e[Hn]())}).catch(e=>{let[n,s]=Nt({value:TypeError("Unserializable return value"),[jt]:0});t.postMessage(Object.assign(Object.assign({},n),{id:i}),s)})}),t.start&&t.start()}function la(e){return"MessagePort"===e.constructor.name}function ui(e){la(e)&&e.close()}function ca(e,t){let n=new Map;return e.addEventListener("message",function(e){let{data:t}=e;if(!t||!t.id)return;let s=n.get(t.id);if(s)try{s(t)}finally{n.delete(t.id)}}),Jn(e,n,[],t)}function Tt(e){if(e)throw Error("Proxy has been released and is not useable")}function di(e){return Xe(e,new Map,{type:"RELEASE"}).then(()=>{ui(e)})}var Ut=new WeakMap,At="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(Ut.get(e)||0)-1;Ut.set(e,t),0===t&&di(e)});function ua(e,t){let n=(Ut.get(t)||0)+1;Ut.set(t,n),At&&At.register(e,t,e)}function da(e){At&&At.unregister(e)}function Jn(e,t,n=[],s=function(){}){let r=!1,i=new Proxy(s,{get(s,o){if(Tt(r),o===ia)return()=>{da(i),di(e),t.clear(),r=!0};if("then"===o){if(0===n.length)return{then:()=>i};let s=Xe(e,t,{type:"GET",path:n.map(e=>e.toString())}).then(We);return s.then.bind(s)}return Jn(e,t,[...n,o])},set(s,i,o){Tt(r);let[a,l]=Nt(o);return Xe(e,t,{type:"SET",path:[...n,i].map(e=>e.toString()),value:a},l).then(We)},apply(s,i,o){Tt(r);let a=n[n.length-1];if(a===sa)return Xe(e,t,{type:"ENDPOINT"}).then(We);if("bind"===a)return Jn(e,t,n.slice(0,-1));let[l,h]=oi(o);return Xe(e,t,{type:"APPLY",path:n.map(e=>e.toString()),argumentList:l},h).then(We)},construct(s,i){Tt(r);let[o,a]=oi(i);return Xe(e,t,{type:"CONSTRUCT",path:n.map(e=>e.toString()),argumentList:o},a).then(We)}});return ua(i,e),i}function ha(e){return Array.prototype.concat.apply([],e)}function oi(e){let t=e.map(Nt);return[t.map(e=>e[0]),ha(t.map(e=>e[1]))]}var hi=new WeakMap;function fa(e,t){return hi.set(e,t),e}function _a(e){return Object.assign(e,{[ai]:!0})}function Nt(e){for(let[t,n]of ci)if(n.canHandle(e)){let[s,r]=n.serialize(e);return[{type:"HANDLER",name:t,value:s},r]}return[{type:"RAW",value:e},hi.get(e)||[]]}function We(e){switch(e.type){case"HANDLER":return ci.get(e.name).deserialize(e.value);case"RAW":return e.value}}function Xe(e,t,n,s){return new Promise(r=>{let i=pa();t.set(i,r),e.start&&e.start(),e.postMessage(Object.assign({id:i},n),s)})}function pa(){return[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Ko=$n(te()),zo=$n(Ae());si();var Bn=class{constructor(){this._options=null,this._initializer=null,this._pyodide=null,this._localPath="",this._driveName="",this._driveFS=null,this._sendWorkerMessage=()=>{},this._logMessage=()=>{},this._initialized=new Promise((e,t)=>{this._initializer={resolve:e,reject:t}})}async initialize(e){var t;if(this._options=e,e.location.includes(":")){let t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initFilesystem(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null==(t=this._initializer)||t.resolve()}async initRuntime(e){let{pyodideUrl:t,indexUrl:n}=e,s;t.endsWith(".mjs")?s=(await __webpack_require__(745)(t)).loadPyodide:(importScripts(t),s=self.loadPyodide),this._pyodide=await s({indexURL:n,stdout:e=>{console.log(e),this._logMessage({type:"text",level:"info",data:e})},stderr:e=>{console.error(e),this._logMessage({type:"text",level:"critical",data:e})},...e.loadPyodideOptions}),this._pyodide._api.on_fatal=async e=>{let t="";t="Exit"===e.name?"Pyodide has exited and can no longer be used.":`Pyodide has suffered a fatal error. Please report this to the Pyodide maintainers.
The cause of the error was: ${e.name}
${e.message}
Stack trace:
${e.stack}`,this._logMessage({type:"text",level:"critical",data:t})}}async initPackageManager(e){if(!this._options)throw Error("Uninitialized");let{pipliteWheelUrl:t,disablePyPIFallback:n,pipliteUrls:s,loadPyodideOptions:r}=this._options,i=(r||{}).packages||[];i.includes("micropip")||await this._pyodide.loadPackage(["micropip"]),i.includes("piplite")||await this._pyodide.runPythonAsync(`
      import micropip
      await micropip.install('${t}', keep_going=True)
    `),await this._pyodide.runPythonAsync(`
      import piplite.piplite
      piplite.piplite._PIPLITE_DISABLE_PYPI = ${n?"True":"False"}
      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(s)}
    `)}async initKernel(e){let t=(e.loadPyodideOptions||{}).packages||[],n=[];for(let e of["sqlite3","ipykernel","comm","pyodide_kernel","jedi","ipython"])t.includes(e)||n.push(`await piplite.install('${e}', keep_going=True)`);n.push("import pyodide_kernel"),e.mountDrive&&this._localPath&&n.push("import os",`os.chdir("${this._localPath}")`),await this._pyodide.runPythonAsync(n.join(`
`))}async initGlobals(e){let{globals:t}=this._pyodide;this._kernel=t.get("pyodide_kernel").kernel_instance.copy(),this._stdout_stream=t.get("pyodide_kernel").stdout_stream.copy(),this._stderr_stream=t.get("pyodide_kernel").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:n,PATH:s,ERRNO_CODES:r}=this._pyodide,{baseUrl:i}=e,{DriveFS:o}=await Promise.resolve().then(()=>(si(),Fo)),a=new o({FS:n,PATH:s,ERRNO_CODES:r,baseUrl:i,driveName:this._driveName,mountpoint:t,browsingContextId:this._browsingContextId});n.mkdirTree(t),n.mount(a,{},t),n.chdir(t),this._driveFS=a}}mapToObject(e){let t=e instanceof Array?[]:{};for(let[n,s]of e instanceof Map?e.entries():Object.entries(e))t[n]=s instanceof Map||s instanceof Array?this.mapToObject(s):s;return t}formatResult(e){if(!(e instanceof this._pyodide.ffi.PyProxy))return e;let t=e.toJs();return this.mapToObject(t)}registerWorkerMessageCallback(e){this._sendWorkerMessage=e}registerLogMessageCallback(e){this._logMessage=e}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);let n=(e,t,n)=>{let s={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_result"})},s=(e,t,n)=>{let s={ename:e,evalue:t,traceback:n};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"execute_error"})},r=e=>{let t={wait:this.formatResult(e)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},i=(e,t,n)=>{let s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"display_data"})},o=(e,t,n)=>{let s={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(n)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:s,type:"update_display_data"})},a=(e,t)=>{let n={name:this.formatResult(e),text:this.formatResult(t)};this._sendWorkerMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"stream"})};this._stdout_stream.publish_stream_callback=a,this._stderr_stream.publish_stream_callback=a,this._interpreter.display_pub.clear_output_callback=r,this._interpreter.display_pub.display_data_callback=i,this._interpreter.display_pub.update_display_data_callback=o,this._interpreter.displayhook.publish_execution_result=n,this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);let l=await this._kernel.run(e.code),h=this.formatResult(l);return"error"===h.status&&s(h.ename,h.evalue,h.traceback),h}async complete(e,t){await this.setup(t);let n=this._kernel.complete(e.code,e.cursor_pos);return this.formatResult(n)}async inspect(e,t){await this.setup(t);let n=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level);return this.formatResult(n)}async isComplete(e,t){await this.setup(t);let n=this._kernel.is_complete(e.code);return this.formatResult(n)}async commInfo(e,t){await this.setup(t);let n=this._kernel.comm_info(e.target_name);return{comms:this.formatResult(n),status:"ok"}}async commOpen(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_open(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commMsg(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async commClose(e,t){await this.setup(t);let n=this._kernel.comm_manager.comm_close(this._pyodide.toPy(null),this._pyodide.toPy(null),this._pyodide.toPy(e));return this.formatResult(n)}async inputReply(e,t){}getpass(e){return e=void 0===e?"":e,this.sendInputRequest(e,!0)}input(e){return e=void 0===e?"":e,this.sendInputRequest(e,!1)}async sendComm(e,t,n,s,r){this._sendWorkerMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(n),ident:this.formatResult(s),buffers:this.formatResult(r),parentHeader:this.formatResult(this._kernel._parent_header).header})}},ii=class extends Bn{constructor(){super(),this._sendWorkerMessage=e=>{postMessage({_kernelMessage:e})},this._logMessage=e=>{postMessage({_logMessage:e})}}async initFilesystem(e){if(e.mountDrive){let t="/drive",{FS:n,PATH:s,ERRNO_CODES:r}=this._pyodide,{baseUrl:i,browsingContextId:o}=e,a=new qt({FS:n,PATH:s,ERRNO_CODES:r,baseUrl:i,driveName:this._driveName,mountpoint:t,browsingContextId:o});n.mkdirTree(t),n.mount(a,{},t),n.chdir(t),this._driveFS=a}}sendInputRequest(e,t){var n,s;let r=this.formatResult(this._kernel._parent_header).header,i=zo.KernelMessage.createMessage({channel:"stdin",msgType:"input_request",session:null!=(n=null==r?void 0:r.session)?n:"",parentHeader:r,content:{prompt:e,password:t}});try{if(!this._options)throw Error("Kernel options not set");let{baseUrl:e,browsingContextId:t}=this._options;if(!t)throw Error("Kernel browsingContextId not set");let n=new XMLHttpRequest,r=Ko.URLExt.join(e,"/api/stdin/kernel");n.open("POST",r,!1);let o=JSON.stringify({browsingContextId:t,data:i});n.send(o);let a=JSON.parse(n.response);if("error"in a)throw Error(a.error);return null==(s=a.content)?void 0:s.value}catch(e){console.warn(`Failed to request stdin via service worker: ${e}`);return}}},Ou=new ii;Lt(Ou)},745(e){function t(e){return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=745,e.exports=t}}]);
//# sourceMappingURL=6.121ab45129df72c4.js.map?v=121ab45129df72c4