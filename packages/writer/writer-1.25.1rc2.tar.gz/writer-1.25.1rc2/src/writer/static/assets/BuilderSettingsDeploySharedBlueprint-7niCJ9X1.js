import{d as P,an as q,ap as T,i as y,a as g,V as A,u as F,X as O,c as d,r as B,Y as j,w as z,o as E,b as U,z as m,g as _,x as f,aw as $,s as G,G as K,a6 as R,a3 as X,S as Y,ax as H,_ as J}from"./index-US7PsP1n.js";import{W as D}from"./WdsFieldWrapper-Cu7E8Pu-.js";const L={class:"DeploySharedBlueprint"},Q=P({__name:"BuilderSettingsDeploySharedBlueprint",props:q({blueprintId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const r=v,l=T(v,"modelValue"),s=y(g.core),I=y(g.builderManager),{pushToast:o}=A(),{setContentValue:p,extractBlueprintComponents:w}=H(s,I),x=F(s),{writerApi:C}=O(),h=d(()=>s.getComponentById(r.blueprintId)),S=d(()=>{var e,t;return((t=(e=h.value)==null?void 0:e.content)==null?void 0:t.key)||"Shared Blueprint"}),V=d(()=>{var e,t;return((t=(e=h.value)==null?void 0:e.content)==null?void 0:t.deployedDescription)||""}),a=B({name:"",description:""}),u=j({}),i=B(!1);function k(){const e={};return a.value.name.trim()||(e.name="Name is required"),a.value.description.trim()||(e.description="Description is required"),u.value=e,Object.keys(e).length===0}function W(e){r.blueprintId&&e.trim()&&p(r.blueprintId,"key",e.trim())}async function M(){if(!k())return;const e=s.writerOrgId.value;if(!e){o({type:"error",message:"Organization ID is required. Please set up your environment variable."});return}i.value=!0;try{const t=w(r.blueprintId),n=await C.publishSharedBlueprint(e,{title:a.value.name.trim(),description:a.value.description.trim(),components:t,metadata:{}});p(r.blueprintId,"publishedSnippetId",n.snippet_id),p(r.blueprintId,"deployedDescription",a.value.description.trim()),o({type:"success",message:`Blueprint "${a.value.name.trim()}" published successfully`}),x.track("blueprints_shared_published"),c(),l.value=!1;try{await s.init()}catch{o({type:"error",message:"Blueprint published but failed to reload. Please refresh the page."})}}catch(t){o({type:"error",message:`Error publishing blueprint: ${t instanceof Error?t.message:String(t)}`})}finally{i.value=!1}}function b(){i.value||(c(),l.value=!1)}function c(){a.value={name:S.value,description:V.value},u.value={}}const N=d(()=>[{desc:"Cancel",fn:b},{desc:i.value?"Publishing...":"Publish",fn:M,disabled:i.value}]);return z(l,e=>{e&&c()}),(e,t)=>l.value?(E(),U(X,{key:0,actions:N.value,title:"Publish Blueprint","display-close-button":"",onClose:b},{default:m(()=>[_("div",L,[f(D,{label:"Name",required:""},{default:m(()=>[f($,{modelValue:a.value.name,"onUpdate:modelValue":[t[0]||(t[0]=n=>a.value.name=n),W],placeholder:"e.g., Data Fetch Pipeline",error:u.value.name},null,8,["modelValue","error"])]),_:1}),f(D,{label:"Description",required:""},{default:m(()=>[G(_("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>a.value.description=n),placeholder:"Describe what this shared blueprint does",class:K(["DeploySharedBlueprint__textarea",{"DeploySharedBlueprint__textarea--error":u.value.description}])},null,2),[[R,a.value.description]])]),_:1})])]),_:1},8,["actions"])):Y("",!0)}}),ae=J(Q,[["__scopeId","data-v-5d159c5c"]]);export{ae as default};
