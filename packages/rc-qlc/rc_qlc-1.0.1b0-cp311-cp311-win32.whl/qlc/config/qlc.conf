# ============================================================================
# QLC Global configuration file sourced by all workflows
# ============================================================================
# Part of QLC (Quick Look Content) v1.0.1-beta
# An Automated Model-Observation Comparison Suite Optimized for CAMS
#
# Documentation:
#   - Online Docs:   https://docs.researchconcepts.io/qlc/latest/
#   - Workflows:     https://docs.researchconcepts.io/qlc/latest/user-guide/workflows/
#   - Variables:     https://docs.researchconcepts.io/qlc/latest/user-guide/variable-system/
#   - Configuration: https://docs.researchconcepts.io/qlc/latest/user-guide/configuration/
#
# Description:
#   QLC uses a hierarchical configuration system with global defaults, workflow-specific settings, 
#   and command-line overrides. This main configuration file defines paths, default parameters, 
#   and system-wide settings. All workflow configurations inherit these settings and can 
#   override them as needed.
#
# New in v1.0.1-beta:
#   - Table-driven variable mapping (7,855 variables available)
#   - Simplified variable syntax (O3 instead of sfc_O3,203.210,...)
#   - GHOST network integration (7 networks, 282 variables)
#   - CSV observation support (AMoN, CastNet, NNDMN)
#   - Native GRIB support with forecast step preservation
#   - Enhanced CLI with named arguments and mode flags
#
# Copyright (c) 2018-2025 ResearchConcepts io GmbH. All Rights Reserved.
# Questions/Comments: qlc Team @ ResearchConcepts io GmbH <qlc@researchconcepts.io>
# ============================================================================
#----------------------------------------------------------------------
#----------------------- QLC version to be used -----------------------
QLC_VERSION="VERSION"
#----------------------------------------------------------------------
#----------------------- Path definitions -----------------------------
#----------------------------------------------------------------------
# Use QLCHOME if already set by runtime detection, otherwise default to $HOME/qlc
# This allows automatic switching between PyPI and dev installations
QLC_HOME="${QLCHOME:-$HOME/qlc}"
DATA_PATH="${QLC_HOME}/data"
SCRIPTS_PATH="${QLC_HOME}/bin"
WORKING_DIRECTORY="${QLC_HOME}"
MARS_RETRIEVAL_DIRECTORY="${QLC_HOME}/Results"
ANALYSIS_DIRECTORY="${QLC_HOME}/Analysis"
PLOTS_DIRECTORY="${QLC_HOME}/Plots"
TEX_DIRECTORY="${QLC_HOME}/Presentations"
#----------------------------------------------------------------------
#----------------------- PDF presentation and info  -------------------
#----------------------------------------------------------------------
TEAM_PREFIX="CAMS" # without underscore
EVALUATION_PREFIX="EVAL"
MODEL_RESOLUTION="T511L137"
TIME_RESOLUTION="03hh"
#----------------------------------------------------------------------
# User specific configuration files
CONFIG_DIR="${QLC_HOME}/config"
#----------------------------------------------------------------------
#--------------------- Tex PDF presentation and info  -----------------
#----------------------------------------------------------------------
# Plot file format (e.g., jpg, png, svg, pdf) 
PLOTEXTENSION="png"
#----------------------------------------------------------------------
# TeX plot layout configuration (for multi-experiment comparisons)
# Controls how many plots appear on each TeX page in C1-GLOB analysis
# Options: 1 (one plot per page), 2 (two plots per page), 
#          4 (four plots per page), 6 (six plots per page - default)
# Default: 6 (backward compatible - all plots of two exp on one page)
TEX_PLOTS_PER_PAGE=6
#TEX_PLOTS_PER_PAGE=1  # Separate page for each plot
#----------------------------------------------------------------------
#----------------------- VERTICAL RANGE DEFINITIONS -------------------
#----------------------------------------------------------------------
# Define vertical ranges for plotting/analysis of different atmospheric regions
# These can be overridden in workflow-specific config files
#
# IMPORTANT: These are for plotting/analysis AFTER MARS retrieval
#   - PL_LEVELIST/ML_LEVELIST (in [MARS_DEFAULTS]) define what to RETRIEVE from MARS
#   - PL_VRANGE/ML_VRANGE (below) define what subset to PLOT/ANALYZE
#
# Format: PL_VRANGE="min,max,name" for Pressure Levels (hPa)
#         ML_VRANGE="min,max,name" for Model Levels (layer indices)
#
# The script will automatically convert:
#   - Pressure levels: "100,300,UTLS" becomes selection "100:300" (hPa)
#   - Model levels:    "35,55,UTLS" becomes selection "35:55" (layer indices)
#
# Usage: Vertical ranges are automatically selected based on levtype
#        detected from filename (e.g., _pl_ uses PL_VRANGE, _ml_ uses ML_VRANGE)
#
# Note: PL_VRANGE should be a subset of PL_LEVELIST, ML_VRANGE a subset of ML_LEVELIST
#----------------------------------------------------------------------

# Default vertical ranges for IFS L137/L139 (level 1=top, 137/139=surface)
# UTLS: Upper Troposphere Lower Stratosphere (100-300 hPa, ~16-9 km altitude)
PL_VRANGE="100,300,UTLS"
ML_VRANGE="35,55,UTLS"

# Additional vertical ranges (override in workflow configs):
# Troposphere (300-1000 hPa, surface to upper troposphere, ~9 km to surface)
# PL_VRANGE="300,1000,TROP"
# ML_VRANGE="55,137,TROP"

# Stratosphere (1-100 hPa, tropopause to upper stratosphere, top to ~16 km)
# PL_VRANGE="1,100,STRAT"
# ML_VRANGE="1,35,STRAT"

# Lower Troposphere (700-1000 hPa, boundary layer to mid-troposphere, ~3 km to surface)
# PL_VRANGE="700,1000,LOWTROP"
# ML_VRANGE="100,137,LOWTROP"

#----------------------------------------------------------------------
# END OF VERTICAL RANGE DEFINITIONS
#----------------------------------------------------------------------
#----------------------- DEFAULT SETTINGS -----------------------------
#----------------------------------------------------------------------
# Default settings for QLC operations (can be overridden via command line or workflow configs)
#
# Default region (used when no region specified)
# Options: Globe, EU, US, Asia, Africa, etc.
REGION="${REGION:-Globe}"

# Default observation data path (used when --obs_path not specified)
# Path structure: <OBS_PATH>/<obsbase>/<obsname>/<version>/<date>/[file.format]
OBS_PATH="${OBS_PATH:-$HOME/qlc/obs/data}"

# Default observation dataset version (used when not specified in workflow or command line)
OBS_DATASET_VERSION="${OBS_DATASET_VERSION:-latest}"

# Default station radius for collocation (degrees)
# Determines how close model grid point must be to station location
STATION_RADIUS_DEG="${STATION_RADIUS_DEG:-0.5}"

# Default paths for CLI-based synthetic region creation
# These are used when creating regions from command-line parameters (--region, --observation)
# without a matching workflow configuration
DEFAULT_OBS_PATH="${DEFAULT_OBS_PATH:-${QLC_HOME}/obs/data/ver0d}"
DEFAULT_OBS_DATASET_VERSION="${DEFAULT_OBS_DATASET_VERSION:-latest}"
DEFAULT_STATION_RADIUS_DEG="${DEFAULT_STATION_RADIUS_DEG:-0.5}"

# Default spatial interpolation method
# Options: nearest, linear, cubic
SPATIAL_INTERP_METHOD="${SPATIAL_INTERP_METHOD:-nearest}"

# Default temporal interpolation method
# Options: (empty for no interpolation), linear, nearest
TEMPORAL_INTERP_METHOD="${TEMPORAL_INTERP_METHOD:-}"

# Default model level (for vertical profile analysis)
# Set to null or leave empty for all levels
MODEL_LEVEL="${MODEL_LEVEL:-}"

# Default station type
# Options: concentration, deposition, both
STATION_TYPE="${STATION_TYPE:-concentration}"

# Default save plot format(s) - can be comma-separated for multiple formats
# Options: pdf, png, svg, jpg
# Example: SAVE_PLOT_FORMAT="pdf,png" will generate both formats
SAVE_PLOT_FORMAT="${SAVE_PLOT_FORMAT:-pdf}"

# Default save data format
# Options: nc (NetCDF), csv
SAVE_DATA_FORMAT="${SAVE_DATA_FORMAT:-nc}"

# Default read data format
# Options: nc (NetCDF), csv
READ_DATA_FORMAT="${READ_DATA_FORMAT:-nc}"

# Enable/disable diff plots by default
ENABLE_DIFF_PLOTS="${ENABLE_DIFF_PLOTS:-true}"

# Use log scale by default for applicable plots
USE_LOG_SCALE="${USE_LOG_SCALE:-true}"

# Use normalized scale by default for difference plots
USE_NORMALIZED_SCALE="${USE_NORMALIZED_SCALE:-true}"

# Show statistics on maps by default
MAP_SHOW_STATS="${MAP_SHOW_STATS:-true}"

# Map projection for global plots
# Options: Robinson, PlateCarree, Mollweide, EqualEarth
# Regional plots automatically use Lambert Conformal or Albers Equal Area
MAP_PROJECTION="${MAP_PROJECTION:-Robinson}"

# Use publication-style formatting by default
PUBLICATION_STYLE="${PUBLICATION_STYLE:-true}"

# Enable multiprocessing by default
MULTIPROCESSING="${MULTIPROCESSING:-false}"

# Number of threads for parallel processing
N_THREADS="${N_THREADS:-1}"

# Debug mode
DEBUG="${DEBUG:-false}"
DEBUG_EXTENDED="${DEBUG_EXTENDED:-false}"

#----------------------------------------------------------------------
# END OF DEFAULT SETTINGS
#----------------------------------------------------------------------
# IMPORTANT: Bash sourcing stops here!
# The sections below are Python INI format and will cause bash syntax errors.
# When bash scripts source this file, they will stop at the 'return 0' statement.
# Python parser reads the entire file including bash variables and INI sections.
#----------------------------------------------------------------------
return 0  # Stop bash sourcing here - Python INI sections follow
#======================================================================

#======================================================================
#----------------------- QLC VARIABLE REGISTRY ------------------------
#----------------------------------------------------------------------
# 
# Format: variable_id,grib_param,description
# 
# - variable_id: Exact name used in commands (e.g., sfc_O3, pl_O3, ml_NH4)
#   Format: {levtype}_{varname}
#   levtype: sfc (surface), pl (pressure levels), ml (model levels)
# 
# - grib_param: ECMWF GRIB parameter code (e.g., 203.210 for O3)
# 
# - description: Human-readable variable description
#
# Usage Examples:
#   Command line: -vars=sfc_O3,sfc_NO2,sfc_PM2.5
#   Workflow config: MARS_RETRIEVALS=("sfc_O3" "sfc_NO2" "pl_O3")
#   Variable groups: MARS_RETRIEVALS=("@EAC5_SFC" "@EAC5_PL")
#
# Notes:
# - Variable ID is what you see and what you use (no hidden conversions)
# - NetCDF variable names are auto-detected during GRIB to NetCDF conversion
# - Each MARS retrieval creates one file per variable
# - Lines starting with # are comments
# - Empty lines are ignored
#
# Parameter database
# https://codes.ecmwf.int/grib/param-db/
#----------------------------------------------------------------------
#----------------------------------------------------------------------
#
[VARIABLE_REGISTRY]

# Surface Variables (sfc_*)
# -------------------------
# Reactive Gases
#sfc_O3,203.210,Ozone
# sfc_NO2,121.210,Nitrogen Dioxide
# sfc_SO2,122.210,Sulphur Dioxide
# sfc_HNO3,6.217,Nitric Acid
# sfc_NH3,19.217,Ammonia

# Aerosols
# sfc_PM1,72.210,Particulate Matter 1 micrometer
# sfc_PM2.5,73.210,Particulate Matter 2.5 micrometers
# sfc_PM10,74.210,Particulate Matter 10 micrometers
# sfc_AOD,207.210,Aerosol Optical Depth at 550nm

# Aerosol Components
# sfc_NH4,249.210,Ammonium (fine mode, IFS-AER)
# sfc_SO4,11.210,Sulphate (fine mode, IFS-AER)
# sfc_NO3a,247.210,Nitrate (fine mode, IFS-AER)
# sfc_NO3c,248.210,Nitrate (coarse mode, IFS-AER)

# sfc_N_as,1.212,Aerosol Number (accumulation mode, IFS-HAMM7)
# sfc_SO4_as,2.212,Sulphate (accumulation mode, IFS-HAMM7)
# sfc_NH4_as,35.212,Ammonium (accumulation mode, IFS-HAMM7)
# sfc_NO3_as,36.212,Nitrate (accumulation mode, IFS-HAMM7)

# Meteorological Fields
# sfc_T,130,Temperature
# sfc_SH,133,Specific Humidity
# sfc_RH,157,Relative Humidity

# Pressure Level Variables (pl_*)
# --------------------------------
# Note: Pressure levels typically: 1000/950/925/900/850/800/700/600/500/400/300/250/200/150/100/70/50/30/20/10/5/1
# 
# Reactive Gases
# pl_O3,203.210,Ozone
# pl_NH3,19.217,Ammonia
# pl_HNO3,6.217,Nitric Acid
# pl_SO2,122.210,Sulphur Dioxide

# Aerosol Components
# pl_NH4,249.210,Ammonium (fine mode, IFS-AER)
# pl_SO4,11.210,Sulphate (fine mode, IFS-AER)
# pl_NO3a,247.210,Nitrate (fine mode, IFS-AER)
# pl_NO3c,248.210,Nitrate (coarse mode, IFS-AER)

# pl_N_as,1.212,Aerosol Number (accumulation mode, IFS-HAMM7)
# pl_SO4_as,2.212,Sulphate (accumulation mode, IFS-HAMM7)
# pl_NH4_as,35.212,Ammonium (accumulation mode, IFS-HAMM7)
# pl_NO3_as,36.212,Nitrate (accumulation mode, IFS-HAMM7)

# Model Level Variables (ml_*)
# -----------------------------
# Aerosol Chemistry Diagnostics
# ml_NH4,249.210,Ammonium (fine mode, IFS-AER)
# ml_SO4,11.210,Sulphate (fine mode, IFS-AER)
# ml_NO3a,247.210,Nitrate (fine mode, IFS-AER)
# ml_NO3b,248.210,Nitrate (coarse mode, IFS-AER)

# pH Diagnostics
# ml_pHcloud,51.212,Cloud pH
# ml_pHrain,52.212,Rain pH
# ml_pHaer,22.210,Aerosol pH

# Special Diagnostics
# ml_EQdiag,210025,E4C Equilibrium Diagnostic
# ml_PSC,25.210,Polar Stratospheric Cloud Frequency

#----------------------------------------------------------------------
# END OF VARIABLE REGISTRY
#----------------------------------------------------------------------

#----------------------------------------------------------------------
#----------------------- VARIABLE GROUPS ------------------------------
#----------------------------------------------------------------------
# Define variable groups for convenient multi-variable selection
# 
# Format: GROUP_NAME=var1,var2,var3,...
# 
# Usage:
#   Command line: -vars=@EAC5_SFC
#   Config file: MARS_RETRIEVALS=("@EAC5_SFC" "@EAC5_PL")
#
# You can define custom groups for your specific workflows
#----------------------------------------------------------------------

[VARIABLE_GROUPS]

# Comprehensive Analysis Groups
# EAC5_SFC=sfc_PM2.5,sfc_PM10,sfc_O3,sfc_NO2,sfc_SO2,sfc_HNO3,sfc_NH3,sfc_NH4,sfc_NO3,sfc_SO4,sfc_AOD
# EAC5_PL=pl_O3,pl_NH3,pl_HNO3,pl_SO2

# Specific Component Groups
# AEROSOL_SFC=sfc_PM1,sfc_PM2.5,sfc_PM10,sfc_AOD
# GAS_SFC=sfc_O3,sfc_NO2,sfc_SO2,sfc_HNO3,sfc_NH3
# METEO_SFC=sfc_T,sfc_SH,sfc_RH

# Custom Groups (add your own)
# EXAMPLE_MY_GASES=sfc_O3,sfc_NO2,pl_O3
# EXAMPLE_AEROSOL_COMPLETE=sfc_PM1,sfc_PM2.5,sfc_PM10,sfc_NH4,sfc_NO3,sfc_SO4

#----------------------------------------------------------------------
# END OF VARIABLE GROUPS
#----------------------------------------------------------------------

#----------------------------------------------------------------------
#----------------------- MARS RETRIEVAL DEFAULTS ----------------------
#----------------------------------------------------------------------
# Default parameters for MARS data retrievals
# 
# These are the base defaults used for all MARS retrievals.
# They can be overridden at three levels:
#
# 1. Here (Global defaults) - applies to all workflows
# 2. Workflow config - override per workflow (e.g., eac5, qpy, test)
# 3. Command line - override for quick testing (-grid=, -step=, -time=, etc.)
#
# Override priority: Command Line > Workflow Config > Global Defaults
#
# Usage Examples:
#   # Use defaults
#   qlc exp1 exp2 2019-01-01 2019-12-31 eac5 -vars=sfc_O3
#   
#   # Override grid resolution on command line
#   qlc exp1 exp2 2019-01-01 2019-12-31 eac5 -vars=sfc_O3 -grid=0.5/0.5
#   
#   # Override multiple parameters
#   qlc exp1 exp2 2019-01-01 2019-12-31 eac5 -vars=@EAC5_SFC -step=0/to/48/by/6 -time=12:00:00
#
# Available command-line overrides:
#   -class=XX        MARS class (rd, nl, de, be, ea)
#   -type=XX         Forecast type (fc, an, cf)
#   -stream=XX       Data stream (oper, enfo, da, wave, scda)
#   -grid=X/Y        Grid resolution (e.g., 1.0/1.0, 0.5/0.5, 0.25/0.25)
#   -time=HH:MM:SS   Forecast base time (00:00:00, 06:00:00, 12:00:00, 18:00:00)
#   -step=X          Forecast steps (0, 0/to/21/by/3, 12/24, 0/to/240/by/6)
#   -levelist=X      Pressure levels (e.g., 850, 100/150/200/400/700/850/925/1000)

# Note: LEVTYPE, PARAM, DATE, EXPVER are set automatically per variable
#----------------------------------------------------------------------

[MARS_DEFAULTS]

# MARS Class - determines which database to retrieve from
# Common values:
#   rd - Research Department (most experiments)
#   od - Operational Data
#   ea - ERA reanalysis
#   nl - Netherlands
#   de - Germany
CLASS=rd

# Forecast Type
# Values: fc (forecast), an (analysis), cf (control forecast)
TYPE=fc

# Data Stream
# Values: oper (operational), enfo (ensemble forecast), da (data assimilation)
STREAM=oper

# Grid Resolution (degrees)
# Examples: 1.0/1.0 (coarse), 0.5/0.5 (medium), 0.25/0.25 (fine)
GRID=0.5/0.5

# Forecast Base Time (UTC)
# Common values: 00:00:00, 06:00:00, 12:00:00, 18:00:00
TIME=00:00:00

# Forecast Steps (hours from base time)
# Surface (sfc): 0/to/21/by/3  (0,3,6,9,12,15,18,21)
# Pressure (pl): 12/24  (12-hour and 24-hour forecasts)
# Model levels (ml): 0/to/21/by/3
# 
# For longer forecasts: 0/to/240/by/6
STEP_SFC=0/to/21/by/3
STEP_PL=0/to/21/by/3
STEP_ML=0/to/21/by/3

# Pressure Levels (hPa) - used for pressure level (pl) variable retrievals
# Defines which pressure levels to retrieve from MARS for _pl variables
# Order: top (10 hPa) to surface (1000 hPa) 
# Examples:
#   Long list:  1/5/10/20/30/50/70/100/150/200/250/300/400/500/600/700/800/850/900/925/950/1000
#   Short list: 10/50/100/150/200/400/700/850/925/1000
#   Range:      1/to/1000 (retrieves all standard levels in range)
#   Single:     850
# PL_LEVELIST=1/to/1000
PL_LEVELIST=10/50/100/150/200/400/700/850/925/1000

# Model Levels - used for model level (ml) variable retrievals
# Defines which model levels to retrieve from MARS for _ml variables
# For IFS L137: Level 1=top (stratosphere), Level 137=surface
# Examples:
#   All levels:  1/to/137 (typical - retrieve all levels)
#   UTLS only:   35/to/55 (just UTLS region)
#   Custom:      1/20/40/60/100/137
ML_LEVELIST=1/to/137

#----------------------------------------------------------------------
# Advanced MARS Parameters (Optional - add as needed)
#----------------------------------------------------------------------
# The Python parser will include ANY parameter you add here in MARS requests.
# Just add: PARAMETER_NAME=value
#
# Examples of advanced parameters:
#
# Spatial:
#   RESOL=AV        # Automatic resolution
#   AREA=90/-180/-90/180  # North/West/South/East (global)
#   AREA=60/-10/35/10     # Europe subset
#
# Ensemble forecasts:
#   NUMBER=0/to/50   # Ensemble members
#   ORIGIN=ecmf      # Originating center
#   SYSTEM=5         # Ensemble system version
#
# Statistical post-processing:
#   METHOD=1         # Statistical method
#   QUANTILE=0.5     # Median quantile
#   FREQUENCY=24     # Frequency in hours
#
# Advanced retrieval:
#   PRODUCT=0        # Product definition
#   ACCURACY=24      # Packing accuracy (bits)
#   PADDING=0        # Grid padding
#
# Uncomment and modify as needed:
# RESOL=AV
# AREA=90/-180/-90/180
# NUMBER=
# ACCURACY=24

#----------------------------------------------------------------------
# END OF MARS DEFAULTS
#----------------------------------------------------------------------

