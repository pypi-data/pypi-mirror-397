"use strict";(self.webpackChunk_jupytercad_jupytercad_lab=self.webpackChunk_jupytercad_jupytercad_lab||[]).push([[484],{484(e,t,a){a.r(t),a.d(t,{default:()=>f});var o=a(451),n=a(477),r=a(584),d=a(875),i=a(684),s=a(591),l=a(491),c=a(827),u=a(230),g=a(247),h=a(173),p=a(805),y=a(292),m=a(389),C=a(223);const M="@jupytercad/jupytercad-core:jupytercad-settings";class j extends h.JupyterYModel{}class k extends g.Panel{constructor(e){super(),this.onResize=()=>{this._jcadWidget&&u.MessageLoop.sendMessage(this._jcadWidget,g.Widget.ResizeMessage.UnknownSize)},this._buildWidget=e=>{const{commands:t,workerRegistry:a,model:n,externalCommands:r,tracker:d}=e,i=new o.JupyterCadPanel({model:n,workerRegistry:a});let s;n.filePath&&(s=new o.ToolbarWidget({commands:t,model:n,externalCommands:(null==r?void 0:r.getCommands())||[]})),this._jcadWidget=new o.JupyterCadOutputWidget({model:n,content:i,toolbar:s}),this.addWidget(this._jcadWidget),null==d||d.add(this._jcadWidget)};const{model:t}=e;this.addClass("jupytercad-notebook-widget"),this._buildWidget(e),t.sharedModel.changed.connect((t,a)=>{a.stateChange&&a.stateChange.forEach(t=>{var a;"path"===t.name&&(null===(a=this.layout)||void 0===a||a.removeWidget(this._jcadWidget),this._jcadWidget.dispose(),this._buildWidget(e))})})}get jcadWidget(){return this._jcadWidget}}const W={id:"jupytercad:yjswidget-plugin",autoStart:!0,requires:[n.IJCadWorkerRegistryToken],optional:[n.IJCadExternalCommandRegistryToken,n.IJupyterCadDocTracker,h.IJupyterYWidgetManager,l.ICollaborativeContentProvider,C.ISettingRegistry],activate:async(e,t,a,o,r,d,i)=>{let s=null;if(i)try{s=await i.load(M),console.log(`Loaded settings for ${M}`,s)}catch(e){console.warn(`Failed to load settings for ${M}`,e)}r?r.registerWidget("@jupytercad:widget",class extends j{async initialize(t){const{path:a,format:o,contentType:r}=t,s=o;if(!d)throw(0,c.showErrorMessage)("Error using the JupyterCAD Python API","You cannot use the JupyterCAD Python API without a collaborative drive. You need to install a package providing collaboration features (e.g. jupyter-collaboration)."),new Error("Failed to create the YDoc without a collaborative drive");let l="";const u=e.shell.currentWidget;(u instanceof m.NotebookPanel||u instanceof p.ConsolePanel)&&(l=u.sessionContext.path);let g="";if(a){g=y.PathExt.join(y.PathExt.dirname(l),a);try{await e.serviceManager.contents.get(g)}catch(t){await e.serviceManager.contents.save(g,{content:btoa("{}"),format:"base64"})}}else g=y.PathExt.join(y.PathExt.dirname(l),"unsaved_project");const C=d.sharedModelFactory.createNew({path:g,format:s,contentType:r,collaborative:!0});this.jupyterCADModel=new n.JupyterCadModel({sharedModel:C,settingRegistry:i}),this.jupyterCADModel.contentsManager=e.serviceManager.contents,this.jupyterCADModel.filePath=g,this.ydoc=this.jupyterCADModel.sharedModel.ydoc,this.sharedModel=new h.JupyterYDoc(t,this.ydoc)}},class{constructor(n,r){this.yModel=n,this.node=r;const d=new k({commands:e.commands,externalCommands:a,model:n.jupyterCADModel,workerRegistry:t,tracker:o});u.MessageLoop.sendMessage(d,g.Widget.Msg.BeforeAttach),r.appendChild(d.node),u.MessageLoop.sendMessage(d,g.Widget.Msg.AfterAttach)}}):console.error("Missing IJupyterYWidgetManager token!")}};var v=a(590);const w="jupytercad",f=[{id:"jupytercad:lab:main-menu",autoStart:!0,requires:[n.IJupyterCadDocTracker,n.IJCadFormSchemaRegistryToken,n.IJCadWorkerRegistryToken],optional:[i.IMainMenu,s.ITranslator,d.ICompletionProviderManager],activate:(e,t,a,n,r,d,i)=>{console.log("jupytercad:lab:main-menu is activated!"),d=null!=d?d:s.nullTranslator;(0,o.addCommands)(e,t,d,a,n,i),r&&function(e,t){e.fileMenu.addItem({command:o.CommandIDs.exportJcad}),e.editMenu.undoers.redo.add({id:o.CommandIDs.redo,isEnabled:t}),e.editMenu.undoers.undo.add({id:o.CommandIDs.undo,isEnabled:t})}(r,()=>null!==t.currentWidget&&t.currentWidget===e.shell.currentWidget)}},{id:"jupytercad:lab:controlpanel",autoStart:!0,requires:[r.ILayoutRestorer,n.IJupyterCadDocTracker,n.IAnnotationToken,n.IJCadFormSchemaRegistryToken],optional:[l.ICollaborativeContentProvider,v.IForkManagerToken],activate:(e,t,a,n,r,d,i)=>{const s=new o.ControlPanelModel({tracker:a}),l=new o.LeftPanelWidget({model:s,tracker:a,formSchemaRegistry:r});l.id="jupytercad::leftControlPanel",l.title.caption="JupyterCad Control Panel",l.title.icon=o.logoIcon;const c=new o.RightPanelWidget({model:s,tracker:a,annotationModel:n,forkManager:i,collaborativeContentProvider:d});c.id="jupytercad::rightControlPanel",c.title.caption="JupyterCad Control Panel",c.title.icon=o.logoIcon,t&&(t.add(l,`${w}-left`),t.add(c,`${w}-right`)),e.shell.add(l,"left",{rank:2e3}),e.shell.add(c,"right",{rank:2e3,activate:!1})}},W]}}]);