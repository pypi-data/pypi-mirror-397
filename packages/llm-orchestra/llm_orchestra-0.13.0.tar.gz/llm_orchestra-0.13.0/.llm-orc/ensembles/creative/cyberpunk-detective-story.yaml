name: cyberpunk-detective-story
description: |
  Interactive cyberpunk detective story demonstrating creative script-LLM collaboration.
  Shows how the same primitives enable entertainment applications.

agents:
  # Initialize game state and story context
  - name: story-initialization
    script: primitives/file-ops/write_file.py
    parameters:
      path: "game_state.json"
      content: |
        {
          "location": "Neo-Tokyo District 7",
          "time": "2087, 23:42",
          "player_name": "Detective",
          "health": 100,
          "investigation_points": 0,
          "inventory": ["neural_scanner", "plasma_gun", "encrypted_data_chip"],
          "current_scene": "crime_scene_arrival"
        }
  
  # Main story loop for interactive gameplay
  - name: story-loop
    script: primitives/control-flow/loop_until.py
    depends_on: [story-initialization]
    parameters:
      condition: "game_completed"
      max_iterations: 50   # Prevent infinite loops
      
  # Get player input for each story beat
  - name: player-input
    script: primitives/user-interaction/get_user_input.py
    depends_on: [story-loop]
    parameters:
      prompt: |
        CYBERPUNK DETECTIVE - Neo-Tokyo 2087
        ===================================
        
        What do you do next?
        
        Type 'help' for available actions, 'quit' to exit.
        
        >
      timeout: 300  # 5 minute timeout for player input
      
  # Process player action and update game state
  - name: game-state-update
    script: primitives/data-transform/json_extract.py
    depends_on: [player-input]
    parameters:
      input_file: "game_state.json"
      action_processor: true
      
  # Generate atmospheric narrative response
  - name: narrative-generation
    model_profile: story-narrator
    system_prompt: |
      You are narrating a cyberpunk detective story set in Neo-Tokyo 2087.
      
      Setting: Neon-lit streets, corporate megastructures, underground hacker dens.
      Tone: Atmospheric, noir, technologically advanced but gritty.
      Style: Descriptive but concise, engaging second-person narration.
      
      Based on the player's action and current game state, generate:
      1. Atmospheric description of what happens
      2. Any new information discovered
      3. Consequences of the player's choice
      4. What the player sees/hears/experiences next
      
      Keep responses engaging and move the story forward.
    depends_on: [game-state-update]
    
  # Game master manages overall story flow and state
  - name: game-master
    model_profile: game-master
    system_prompt: |
      You manage the overall game flow for this cyberpunk detective story.
      
      Responsibilities:
      1. Track investigation progress and story beats
      2. Determine when story branches or major events occur
      3. Manage NPC interactions and clue revelations
      4. Decide when to end scenes or introduce new elements
      5. Ensure story coherence and pacing
      
      Based on the narrative generated and current state, decide what 
      happens next in the story.
    depends_on: [narrative-generation]
    
  # Save progress after each story beat
  - name: save-progress
    script: primitives/file-ops/write_file.py
    depends_on: [game-master]
    parameters:
      path: "game_save.json"
      mode: "update"  # Update existing save file