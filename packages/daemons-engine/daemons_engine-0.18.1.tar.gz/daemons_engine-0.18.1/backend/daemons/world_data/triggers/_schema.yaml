# Trigger Schema Documentation
# Reference for content creators defining triggers
# Triggers are event-driven actions that respond to player/world events

# NOTE: Triggers can be defined in three places:
# 1. Room YAML files (room-specific triggers)
# 2. Area YAML files (area-wide triggers)
# 3. Standalone trigger YAML files (reusable/complex triggers)

# Required Fields
# ===============
id: string
  # Unique identifier for this trigger
  # Example: "newcomer_welcome", "search_clouds", "bright_light_reveals_passage"

event: string
  # What event activates this trigger
  # Options:
  #   on_enter - player enters the room/area
  #   on_exit - player leaves the room/area
  #   on_command - player types a matching command
  #   on_kill - player kills an NPC
  #   on_pickup - player picks up an item
  #   on_drop - player drops an item
  #   on_time - triggers at specific time of day
  #   on_interval - triggers every N seconds
  # Example: "on_enter"

# Event-Specific Fields
# ====================
command_pattern: string (required if event = "on_command")
  # Pattern to match against player command
  # Supports wildcards with *
  # Example: "search*" (matches "search", "search clouds", etc.)

time: string (required if event = "on_time")
  # Time of day in HH:MM format (24-hour)
  # Example: "06:00" (dawn), "18:00" (dusk)

interval: int (required if event = "on_interval")
  # Seconds between trigger fires
  # Example: 300 (every 5 minutes)

# Conditions (Optional)
# ====================
conditions: array (default: [])
  # List of conditions that must ALL be true for trigger to fire
  # If empty, trigger always fires when event occurs
  # Each condition is a dictionary with 'type' and parameters

  # Condition Types:

  # flag_set - check player flag value
  #   type: flag_set
  #   flag: string (flag name)
  #   expected: bool or string or int (expected value)

  # level - check player level
  #   type: level
  #   min_level: int
  #   max_level: int (optional)

  # has_item - check player inventory
  #   type: has_item
  #   item_id: string (template_id)
  #   quantity: int (optional, default: 1)

  # has_quest - check if player has quest
  #   type: has_quest
  #   quest_id: string

  # quest_status - check quest completion status
  #   type: quest_status
  #   quest_id: string
  #   status: string (active, completed, failed)

  # time_range - check time of day
  #   type: time_range
  #   start_hour: int (0-23)
  #   end_hour: int (0-23)

  # visibility_level - check room lighting (Phase 11)
  #   type: visibility_level
  #   params:
  #     level: string (pitch_black, dim, normal, bright, enhanced)

  # faction_standing - check faction reputation
  #   type: faction_standing
  #   faction_id: string
  #   min_standing: int

  # class_check - check player class
  #   type: class_check
  #   class_id: string

# Actions (Required)
# ==================
actions: array
  # List of actions to execute when trigger fires
  # Actions execute in order
  # Each action is a dictionary with 'type' and parameters

  # Action Types:

  # message_player - send message to player
  #   type: message_player
  #   message: string (text to display)
  #   OR
  #   params:
  #     text: string

  # message_room - send message to all in room
  #   type: message_room
  #   message: string

  # set_flag - set player flag
  #   type: set_flag
  #   flag: string (flag name)
  #   value: bool or string or int
  #   OR
  #   params:
  #     flag_name: string
  #     value: any

  # give_item - add item to player inventory
  #   type: give_item
  #   item_id: string (template_id)
  #   quantity: int (optional, default: 1)

  # remove_item - remove item from player inventory
  #   type: remove_item
  #   item_id: string (template_id)
  #   quantity: int (optional, default: 1)

  # spawn_npc - create NPC instance
  #   type: spawn_npc
  #   template_id: string (npc template)
  #   room_id: string (optional, defaults to current room)

  # despawn_npc - remove NPC instance
  #   type: despawn_npc
  #   npc_id: string (instance id)

  # ========== Exit/Door Actions ==========
  
  # open_exit - add a new exit or reveal a hidden one (legacy, use reveal_exit for hidden exits)
  #   type: open_exit
  #   direction: string (north, south, secret, etc.)
  #   target_room: string (room_id)
  #   OR
  #   params:
  #     direction: string
  #     target_room: string

  # close_exit - completely remove an exit (makes it invisible)
  #   type: close_exit
  #   direction: string

  # reveal_exit - make a hidden exit visible (for secret passages)
  #   type: reveal_exit
  #   params:
  #     direction: string (the hidden exit direction to reveal)
  #     target_room: string (optional, overrides the hidden exit's target)

  # hide_exit - hide an exit again (reverse of reveal_exit)
  #   type: hide_exit
  #   params:
  #     direction: string (the exit direction to hide)

  # ========== Door Actions ==========
  # Doors are visible exits that can be opened/closed/locked
  # Unlike hidden exits, closed doors are shown as "north [closed]"
  
  # open_door - open a closed door (must be unlocked first)
  #   type: open_door
  #   params:
  #     direction: string (the exit with the door to open)

  # close_door - close an open door
  #   type: close_door
  #   params:
  #     direction: string (the exit with the door to close)

  # lock_door - lock a door (also closes it)
  #   type: lock_door
  #   params:
  #     direction: string (the exit with the door to lock)
  #     key_item_id: string (optional, item template ID that can unlock this door)

  # unlock_door - unlock a locked door
  #   type: unlock_door
  #   params:
  #     direction: string (the exit with the door to unlock)

  # set_door - create or configure a door with full control
  #   type: set_door
  #   params:
  #     direction: string (required, the exit direction for the door)
  #     is_open: bool (optional, default: true)
  #     is_locked: bool (optional, default: false)
  #     key_item_id: string (optional, item that can unlock this door)
  #     door_name: string (optional, custom name like "iron gate")

  # teleport_player - move player to different room
  #   type: teleport_player
  #   room_id: string

  # heal_player - restore health
  #   type: heal_player
  #   amount: int

  # damage_player - deal damage
  #   type: damage_player
  #   amount: int

  # grant_experience - award XP
  #   type: grant_experience
  #   amount: int

  # start_quest - give player a quest
  #   type: start_quest
  #   quest_id: string

  # complete_quest - mark quest as complete
  #   type: complete_quest
  #   quest_id: string

  # play_sound - trigger sound effect
  #   type: play_sound
  #   sound_id: string

  # change_room_description - modify room text
  #   type: change_room_description
  #   description: string

# Trigger Control (Optional)
# ==========================
max_fires: int (optional, default: unlimited)
  # Maximum number of times this trigger can fire
  # After reaching max_fires, trigger becomes inactive
  # Example: 1 (one-time trigger)

cooldown: int (optional, default: 0)
  # Seconds before trigger can fire again (per-player)
  # Example: 60 (1 minute cooldown)

enabled: bool (optional, default: true)
  # Whether this trigger is active
  # Set to false to disable without deleting
  # Example: true

permanent: bool (optional, default: false)
  # Whether trigger state persists across server restarts
  # If true, fire_count saved to database (trigger_state table)
  # Example: false

scope: string (optional, default: "player")
  # Who this trigger applies to
  # Options:
  #   player - trigger state tracked per player
  #   room - trigger state shared by all players in room
  #   area - trigger state shared by all in area
  #   global - trigger state shared across entire server
  # Example: "player"

# Optional Metadata
# ================
description: string (optional)
  # Human-readable description of what this trigger does
  # For documentation purposes
  # Example: "Reveals hidden passage when player searches in bright light"

# Complete Examples
# =================

# Example 1: One-Time Welcome Message
# -----------------------------------
# id: newcomer_welcome
# event: on_enter
# conditions:
#   - type: flag_set
#     flag: visited_origin
#     expected: false
# actions:
#   - type: message_player
#     message: "You sense this is a place of beginnings."
#   - type: set_flag
#     flag: visited_origin
#     value: true
# max_fires: 1

# Example 2: Command-Based Search
# -------------------------------
# id: search_clouds
# event: on_command
# command_pattern: "search*"
# conditions: []
# actions:
#   - type: message_player
#     message: "You search through the misty clouds but find nothing."

# Example 3: Level-Gated Secret
# -----------------------------
# id: high_level_secret
# event: on_command
# command_pattern: "examine wall"
# conditions:
#   - type: level
#     min_level: 10
# actions:
#   - type: message_player
#     message: "Your experienced eyes notice a hidden switch!"
#   - type: open_exit
#     params:
#       direction: secret
#       destination: room_hidden_vault

# Example 4: Light-Dependent Discovery (Phase 11)
# -----------------------------------------------
# id: bright_light_reveals_passage
# event: on_command
# command_pattern: "search*"
# description: "Searching in bright light reveals hidden passage"
# conditions:
#   - type: visibility_level
#     params:
#       level: enhanced
# actions:
#   - type: message_player
#     params:
#       text: "The brilliant light reveals a hidden door!"
#   - type: open_exit
#     params:
#       direction: secret
#       destination: room_hidden_chamber
#   - type: set_flag
#     params:
#       flag_name: secret_revealed
#       value: true
# max_fires: 1
# enabled: true

# Example 5: Quest Item Pickup
# ----------------------------
# id: quest_item_trigger
# event: on_pickup
# conditions:
#   - type: has_quest
#     quest_id: quest_find_ancient_relic
# actions:
#   - type: message_player
#     message: "This is the ancient relic you were searching for!"
#   - type: grant_experience
#     amount: 100

# Example 6: Time-Based Event
# ---------------------------
# id: midnight_spawn
# event: on_time
# time: "00:00"
# actions:
#   - type: spawn_npc
#     template_id: npc_ghost
#   - type: message_room
#     message: "A ghostly figure materializes from the darkness!"
# scope: room

# Example 7: Boss Kill Reward
# ---------------------------
# id: boss_defeated_celebration
# event: on_kill
# conditions: []
# actions:
#   - type: message_room
#     message: "The ancient evil has been vanquished!"
#   - type: grant_experience
#     amount: 1000
#   - type: give_item
#     item_id: item_legendary_sword
#     quantity: 1
