# NPC Template Schema Documentation
# Reference for content creators defining new NPC templates
# Database Model: NpcTemplate (backend/app/models.py)

# Required Fields
# ===============
id: string
  # Unique identifier for the NPC template (prefix with 'npc_')
  # Example: "npc_goblin_scout", "npc_wandering_merchant"

name: string
  # Display name of the NPC
  # Example: "Goblin Scout", "Wandering Merchant"

description: string
  # Detailed flavor text describing the NPC's appearance
  # Supports multi-line text with proper YAML formatting (use | or >)
  # Example: "A small, green-skinned creature with beady yellow eyes..."

# NPC Classification
# =================
npc_type: string (default: "hostile")
  # Basic behavior archetype
  # Options: "hostile", "neutral", "friendly", "merchant", "quest_giver"
  # Example: "hostile"

# Base Stats (Combat-Ready)
# =========================
level: int (default: 1)
  # NPC level (affects difficulty and rewards)
  # Example: 1

max_health: int (default: 50)
  # Maximum hit points
  # Example: 30

armor_class: int (default: 10)
  # Defense rating (higher = harder to hit)
  # Example: 8

# Primary Attributes
# ==================
strength: int (default: 10)
  # Physical power (affects melee damage)
  # Example: 8

dexterity: int (default: 10)
  # Agility and reflexes (affects dodge, ranged attacks)
  # Example: 14

intelligence: int (default: 10)
  # Mental acuity (affects magic damage, skill checks)
  # Example: 6

# Combat Properties (Phase 4.5)
# =============================
attack_damage_min: int (default: 1)
  # Minimum damage per attack
  # Example: 2

attack_damage_max: int (default: 5)
  # Maximum damage per attack
  # Example: 6

attack_speed: float (default: 3.0)
  # Seconds between attacks
  # Lower = faster attacks
  # Example: 2.5

experience_reward: int (default: 10)
  # XP granted to players when NPC is killed
  # Example: 15

# AI Behavior Configuration
# =========================
behavior: array or dictionary (default: [])
  # Defines how the NPC acts in the world
  # Can be an array of behavior tags OR a dictionary with detailed settings

  # Array Format (Simple Tags):
  #   - wanders_sometimes      # 10% chance to wander each tick
  #   - wanders_often          # 30% chance to wander
  #   - aggressive             # Attacks players on sight
  #   - cowardly               # Flees at 20% health
  #   - loner                  # Doesn't call for help
  #   - social                 # Calls nearby allies
  #   - guard                  # Stays in spawn room
  #   - merchant               # Offers trade interface

  # Dictionary Format (Detailed Config):
  #   wanders: bool
  #   wander_chance: float (0.0-1.0)
  #   aggro_on_sight: bool
  #   flees_at_health_percent: int (0-100)
  #   calls_for_help: bool
  #   help_radius: int (rooms)
  #   respects_factions: bool

  # Example (array):
  #   - wanders_sometimes
  #   - aggressive
  #   - cowardly

  # Example (dictionary):
  #   wanders: true
  #   wander_chance: 0.1
  #   aggro_on_sight: true
  #   flees_at_health_percent: 20
  #   calls_for_help: false

# Loot Table (Phase 4.5)
# =====================
loot_table: array (default: [])
  # Items this NPC can drop when killed
  # Each entry is a dictionary with:
  #   template_id: string - item template ID
  #   quantity: int or array [min, max] - how many drop
  #   chance: float (0.0-1.0) - probability of dropping

  # Example:
  #   - template_id: item_gold_coins
  #     quantity: [1, 5]      # Drops 1-5 gold coins
  #     chance: 0.8           # 80% chance
  #   - template_id: item_rusty_dagger
  #     quantity: 1
  #     chance: 0.15          # 15% chance

# Flavor and Metadata
# ===================
idle_messages: array of strings (default: [])
  # Random messages the NPC says/emotes when idle
  # Adds atmosphere and personality
  # Example:
  #   - "The goblin scout sniffs the air suspiciously."
  #   - "The goblin mutters something in its guttural tongue."
  #   - "The goblin scratches at its leather armor."

keywords: array of strings (default: [])
  # Keywords for targeting this NPC with commands
  # Used by "attack", "talk", "examine" commands
  # Example: ["goblin", "scout", "creature"]

# Database Mapping Notes
# ======================
# This YAML schema maps to the NpcTemplate SQLAlchemy model in backend/app/models.py
# All fields are stored in the 'npc_templates' database table
# behavior, loot_table, idle_messages, and keywords are stored as JSON

# Behavior Tag Reference
# ======================
# wanders_sometimes   -> wander_chance: 0.1 (10%)
# wanders_often       -> wander_chance: 0.3 (30%)
# aggressive          -> aggro_on_sight: true (attacks after player enters room)
# attacks_on_sight    -> instant_aggro: true (attacks immediately, before player can react)
# cowardly            -> flees_at_health_percent: 20
# brave               -> flees_at_health_percent: 0 (never flees)
# loner               -> calls_for_help: false
# social              -> calls_for_help: true, help_radius: 3
# guard               -> wanders: false, aggro_on_sight: true
# peaceful            -> aggro_on_sight: false
# merchant            -> npc_type should be "merchant"

# Complete Example: Hostile NPC
# =============================
# id: npc_goblin_scout
# name: Goblin Scout
# description: >
#   A small, green-skinned creature with beady yellow eyes and pointed ears.
#   It clutches a rusty dagger and watches you with a mixture of curiosity and malice.
#   Scraps of leather armor barely cover its wiry frame.
# npc_type: hostile
# level: 1
# max_health: 30
# armor_class: 8
# strength: 8
# dexterity: 14
# intelligence: 6
# attack_damage_min: 2
# attack_damage_max: 6
# attack_speed: 2.5
# experience_reward: 15
# behavior:
#   - wanders_sometimes
#   - aggressive
#   - cowardly
#   - loner
# loot_table:
#   - template_id: item_gold_coins
#     quantity: [1, 5]
#     chance: 0.8
#   - template_id: item_rusty_dagger
#     quantity: 1
#     chance: 0.15
# idle_messages:
#   - "The goblin scout sniffs the air suspiciously."
#   - "The goblin mutters something in its guttural tongue."
#   - "The goblin scratches at its leather armor."
#   - "The goblin's eyes dart around nervously."
# keywords:
#   - goblin
#   - scout
#   - creature

# Complete Example: Friendly Merchant
# ===================================
# id: npc_wandering_merchant
# name: Wandering Merchant
# description: >
#   A cheerful human merchant with a large pack on their back.
#   They smile warmly and gesture to their wares.
# npc_type: merchant
# level: 5
# max_health: 100
# armor_class: 12
# strength: 10
# dexterity: 12
# intelligence: 14
# attack_damage_min: 0
# attack_damage_max: 0
# attack_speed: 3.0
# experience_reward: 0
# behavior:
#   - wanders_often
#   - peaceful
#   - merchant
# loot_table: []
# idle_messages:
#   - "The merchant hums a cheerful tune."
#   - "The merchant rearranges their wares."
#   - "The merchant calls out, 'Fine goods for sale!'"
# keywords:
#   - merchant
#   - trader
#   - vendor

# =============================================================================
# PHASE 14: NPC ABILITY SYSTEM
# =============================================================================
# NPCs can now have character classes and use abilities just like players.
# These fields are OPTIONAL - NPCs without them work exactly as before.

# Class & Abilities (Phase 14)
# ============================
class_id: string (optional, default: null)
  # Character class for this NPC (from world_data/classes/*.yaml)
  # When set, the NPC gets a CharacterSheet with resources and abilities
  # Example: "warrior", "mage", "rogue"

default_abilities: array of strings (optional, default: [])
  # Ability IDs this NPC knows (from world_data/abilities/*.yaml)
  # Must be valid ability IDs that exist in the ability templates
  # NPC will learn these abilities regardless of level requirements
  # Example: ["fireball", "arcane_bolt", "mana_shield"]

ability_loadout: array of strings (optional, default: [])
  # Ability IDs in the NPC's "action bar" for AI to use
  # Should be a subset of default_abilities
  # AI behaviors use this to decide which abilities to cast
  # Example: ["fireball", "arcane_bolt"]

ai_behavior: string (optional, default: null)
  # Combat AI behavior script for ability usage
  # Controls how the NPC decides when to use abilities vs basic attacks
  # Options:
  #   "caster_ai"        - Balanced caster: defensive when hurt, offensive otherwise
  #   "caster_tactical"  - Tactical caster: uses AoE when multiple enemies, adapts
  #   "brute_ai"         - Melee fighter: uses power attacks, manages rage/stamina
  #   "berserker_ai"     - Always aggressive: enrages below 50% HP
  # Example: "caster_ai"

# Complete Example: NPC Mage with Abilities
# =========================================
# id: npc_goblin_shaman
# name: Goblin Shaman
# description: >
#   A hunched goblin clutching a staff adorned with bones and feathers.
#   Faint wisps of magical energy crackle around its gnarled fingers.
# npc_type: hostile
# level: 5
# max_health: 60
# armor_class: 10
# strength: 6
# dexterity: 10
# intelligence: 14
# attack_damage_min: 3
# attack_damage_max: 8
# attack_speed: 3.5
# experience_reward: 35
# class_id: mage                        # <-- Phase 14: Has mage class
# default_abilities:                    # <-- Phase 14: Knows these abilities
#   - arcane_bolt
#   - fireball
#   - mana_shield
# ability_loadout:                      # <-- Phase 14: Uses these in combat
#   - fireball
#   - arcane_bolt
# ai_behavior: caster_ai                # <-- Phase 14: Uses caster AI
# behavior:
#   - aggressive
#   - social
# loot_table:
#   - template_id: item_gold_coins
#     quantity: [5, 15]
#     chance: 0.9
# idle_messages:
#   - "The shaman mutters an incantation under its breath."
#   - "Sparks of green energy dance between the shaman's fingers."
# keywords:
#   - goblin
#   - shaman
#   - caster
#   - mage

# Complete Example: NPC Warrior with Abilities
# ============================================
# id: npc_skeleton_champion
# name: Skeleton Champion
# description: >
#   A towering skeletal warrior clad in rusted plate armor.
#   It grips a massive two-handed axe, eye sockets burning with unholy fire.
# npc_type: hostile
# level: 8
# max_health: 150
# armor_class: 16
# strength: 16
# dexterity: 8
# intelligence: 4
# attack_damage_min: 12
# attack_damage_max: 20
# attack_speed: 4.0
# experience_reward: 75
# class_id: warrior                     # <-- Phase 14: Has warrior class
# default_abilities:                    # <-- Phase 14: Knows these abilities
#   - power_attack
#   - shield_bash
#   - whirlwind
# ability_loadout:                      # <-- Phase 14: Uses these in combat
#   - power_attack
#   - shield_bash
# ai_behavior: brute_ai                 # <-- Phase 14: Uses brute AI
# behavior:
#   - aggressive
#   - brave
#   - guard
# loot_table:
#   - template_id: item_gold_coins
#     quantity: [20, 50]
#     chance: 1.0
# idle_messages:
#   - "The skeleton champion's bones rattle as it shifts its weight."
#   - "Unholy flames flicker in the champion's empty eye sockets."
# keywords:
#   - skeleton
#   - champion
#   - undead
#   - warrior

# =============================================================================
# PHASE 17.5: FAUNA SYSTEM
# =============================================================================
# NPCs can be marked as fauna for ecological wildlife simulation.
# Fauna have special spawning rules, activity periods, and migration behaviors.

# Fauna Fields (Phase 17.5)
# =========================
is_fauna: bool (optional, default: false)
  # Marks this NPC as wildlife fauna rather than a humanoid/monster
  # Fauna follow different spawning and behavior rules
  # Example: true

fauna_data: dictionary (optional, default: null)
  # Fauna-specific properties for ecological behavior
  # Only used when is_fauna: true
  # Contains the following fields:

fauna_type: string (required for fauna)
  # Biological classification
  # Options: "mammal", "bird", "reptile", "amphibian", "fish", "insect", "arachnid"
  # Example: "mammal"

biome_tags: array of strings
  # Biomes where this fauna naturally spawns
  # Should match biome fauna_tags from biome definitions
  # Example: ["forest", "grassland"]

temperature_tolerance: array [min, max]
  # Temperature range (Fahrenheit) the fauna can survive
  # Example: [20, 90]

activity_period: string (default: "always")
  # When the fauna is active
  # Options: "diurnal" (day), "nocturnal" (night), "crepuscular" (dawn/dusk), "always"
  # Example: "crepuscular"

diet: string (default: "herbivore")
  # Ecological role for predator-prey dynamics
  # Options: "herbivore", "carnivore", "omnivore", "scavenger"
  # Example: "herbivore"

prey_tags: array of strings
  # Fauna tags this creature hunts (carnivores/omnivores)
  # Example: ["prey", "rabbit", "deer"]

predator_tags: array of strings
  # Fauna tags of creatures that hunt this one
  # Used for fleeing behavior
  # Example: ["wolf", "bear", "carnivore"]

fauna_tags: array of strings
  # Tags for this fauna (for matching prey_tags/predator_tags)
  # Example: ["herbivore", "deer", "prey", "ungulate"]

pack_size: array [min, max]
  # How many spawn together (default: [1, 1] for solitary)
  # Example: [3, 7] for wolf packs

pack_leader_template: string (optional)
  # Template ID for pack leader variant (e.g., alpha wolf)
  # Example: "npc_alpha_wolf"

territorial: bool (default: false)
  # Whether fauna defends territory
  # Example: true

territory_radius: int (default: 3)
  # Rooms from spawn point for territory (when territorial)
  # Example: 5

migratory: bool (default: false)
  # Whether fauna migrates seasonally
  # Example: true

migration_seasons: array of strings
  # Seasons when fauna is absent (migrated away)
  # Options: "spring", "summer", "fall", "winter"
  # Example: ["winter"]

migration_tendency: float (default: 0.05)
  # Chance per tick to explore/migrate to adjacent areas
  # Example: 0.1

aggression: float (default: 0.0)
  # Likelihood to attack players (0.0-1.0)
  # 0.0 = passive, 1.0 = attacks on sight
  # Example: 0.7 for wolves

flee_threshold: float (default: 0.25)
  # Health percentage at which fauna flees
  # Example: 0.5 (flee at 50% health)

# Complete Example: Herbivore Fauna
# =================================
# id: npc_deer
# name: Deer
# description: >
#   A graceful woodland deer with a soft brown coat and alert dark eyes.
#   It watches you warily, ready to bolt at the first sign of danger.
# npc_type: neutral
# level: 2
# max_health: 40
# armor_class: 12
# strength: 10
# dexterity: 16
# intelligence: 2
# attack_damage_min: 3
# attack_damage_max: 6
# attack_speed: 2.0
# experience_reward: 10
# is_fauna: true                              # <-- Phase 17.5: Mark as fauna
# fauna_data:                                 # <-- Phase 17.5: Fauna properties
#   fauna_type: mammal
#   biome_tags: [forest, grassland, meadow]
#   temperature_tolerance: [20, 90]
#   activity_period: crepuscular              # Active at dawn/dusk
#   diet: herbivore
#   prey_tags: []                             # Doesn't hunt
#   predator_tags: [wolf, bear, cougar]       # Flees from these
#   fauna_tags: [herbivore, deer, prey, ungulate]
#   pack_size: [1, 4]                         # Small groups
#   territorial: false
#   migratory: true
#   migration_seasons: [winter]               # Gone in winter
#   aggression: 0.0                           # Never attacks
#   flee_threshold: 0.5                       # Flees at 50% health
# behavior:
#   - peaceful
#   - cowardly
# loot_table: []                              # Abstract death - no loot
# idle_messages:
#   - "The deer raises its head, ears swiveling."
#   - "The deer nibbles on some grass."
#   - "The deer's tail twitches nervously."
# keywords:
#   - deer
#   - doe
#   - buck

# Complete Example: Predator Fauna
# ================================
# id: npc_wolf
# name: Wolf
# description: >
#   A powerful gray wolf with thick fur and piercing amber eyes.
#   It moves with quiet confidence, muscles rippling beneath its coat.
# npc_type: hostile
# level: 4
# max_health: 65
# armor_class: 13
# strength: 14
# dexterity: 14
# intelligence: 4
# attack_damage_min: 6
# attack_damage_max: 12
# attack_speed: 2.5
# experience_reward: 25
# is_fauna: true                              # <-- Phase 17.5: Mark as fauna
# fauna_data:                                 # <-- Phase 17.5: Fauna properties
#   fauna_type: mammal
#   biome_tags: [forest, tundra, mountain]
#   temperature_tolerance: [0, 80]
#   activity_period: nocturnal                # Active at night
#   diet: carnivore
#   prey_tags: [deer, rabbit, prey]           # Hunts these
#   predator_tags: []                         # Apex predator
#   fauna_tags: [carnivore, wolf, predator, canine]
#   pack_size: [3, 7]                         # Runs in packs
#   pack_leader_template: npc_alpha_wolf
#   territorial: true
#   territory_radius: 5
#   migratory: false
#   aggression: 0.7                           # Usually attacks
#   flee_threshold: 0.2                       # Brave - flees at 20%
# behavior:
#   - aggressive
#   - social
# loot_table: []                              # Abstract death - no loot
# idle_messages:
#   - "The wolf's ears perk up at a distant sound."
#   - "The wolf licks its chops."
#   - "A low growl rumbles in the wolf's throat."
# keywords:
#   - wolf
#   - canine
