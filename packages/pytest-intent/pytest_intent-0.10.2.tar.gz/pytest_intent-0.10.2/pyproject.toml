[project]
name = "pytest-intent"
version = "0.10.2"
description = "A pytest plugin for tracking requirement coverage."
authors = [{ name = "celestialorb", email = "chris.m.busby@gmail.com" }]
license = "Elastic-2.0"
license-files = ["LICENSE*.md"]
readme = "README.md"

[tool.poetry]
packages = [{ include = "intent" }]

[tool.poetry.dependencies]
python = "^3.10,<3.14"
pytest = "^9.0.0"
doorstop = "^3.0.2"
pytest-harvest = "^1.10.5"
rich-click = "^1.9.4"

[tool.poetry.group.dev.dependencies]
ruff = "^0.8"
poethepoet = "^0.37.0"
pytest-repeat = "^0.9.4"
twine = "^6.2.0"
pytest-cov = "^7.0.0"
pytest-xdist = "^3.8.0"
jinja2 = "^3.1"
markdown-pdf = "^1.10"
pyhanko = "^0.20.0"

[tool.poetry.plugins."pytest11"]
"intent" = "intent"

[tool.poetry.scripts]
pytest-intent = "intent.cli:main"

[tool.pytest.ini_options]
testpaths = ["tests"]
pythonpath = ["."]

[tool.poe.tasks.format]
cmd = "ruff format"

[tool.poe.tasks.lint]
cmd = """
ruff check
"""

[tool.poe.tasks.build]
cmd = """
poetry build
    --output ${POE_ROOT}/.ci/artifacts/dist
    -vvv
"""

[tool.poe.tasks.test]
cmd = """
pytest
    --cov=intent
    --cov-report=term
    --cov-report=xml:${POE_ROOT}/.ci/artifacts/coverage.xml
    --dist=load
    --intent-coverage-report=${POE_ROOT}/.ci/artifacts/requirements.json
    --numprocesses=auto
"""

[tool.poe.tasks.install]
cmd = """
pip install
    --editable ${POE_ROOT}
    --verbose
"""

[tool.poe.tasks.publish]
cmd = """
twine upload
    --repository ${PYPI_REPOSITORY:-testpypi}
    --non-interactive
    --verbose
    .ci/artifacts/dist/*
"""

[tool.poe.tasks.license]
cmd = """
python tools/license/cli.py
"""
help = "Manage commercial licenses (subcommands: generate, list, verify)"

[tool.ruff]
namespace-packages = ["tests"]

[tool.ruff.lint]
select = ["ALL"]
ignore = [
    # Ignore Ruff's warning about redundant open modes, we like to be explicit.
    "UP015",
]

fixable = ["ALL"]
unfixable = []

[tool.ruff.lint.per-file-ignores]
"tests/*.py" = ["S101", "PLR2004"]
"tools/*.py" = ["C901", "PLR0913"]

[tool.ruff.lint.pydocstyle]
convention = "google"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
