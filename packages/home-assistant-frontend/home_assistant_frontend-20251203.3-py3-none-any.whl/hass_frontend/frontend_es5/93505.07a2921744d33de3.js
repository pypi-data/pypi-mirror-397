"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["93505"],{23528:function(e,t,a){a.a(e,async function(e,r){try{a.d(t,{$3:function(){return b},$O:function(){return x},$j:function(){return p},ED:function(){return o},JE:function(){return S},OQ:function(){return W},PU:function(){return q},Ph:function(){return m},Uf:function(){return C},W1:function(){return y},Wr:function(){return u},Z:function(){return d},gF:function(){return f},iY:function(){return v},jU:function(){return c},nN:function(){return k},p3:function(){return _},pJ:function(){return g},r_:function(){return i},sz:function(){return h}});a(74423),a(23792),a(18111),a(13579),a(62953);var s=a(28978),l=a(380),n=e([l]);l=(n.then?(await n)():n)[0];var o=function(e){return e[e.NONE=0]="NONE",e[e.ARITHMETIC=1]="ARITHMETIC",e[e.CIRCULAR=2]="CIRCULAR",e}({});const c=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],i=["L","gal","ft³","m³","CCF","MCF"],d=e=>e.sendMessagePromise({type:"recorder/info"}),_=(e,t)=>e.callWS({type:"recorder/list_statistic_ids",statistic_type:t}),u=(e,t)=>e.callWS({type:"recorder/get_statistics_metadata",statistic_ids:t}),h=(e,t,a,r,s="hour",l,n)=>e.callWS({type:"recorder/statistics_during_period",start_time:t.toISOString(),end_time:null==a?void 0:a.toISOString(),statistic_ids:r,period:s,units:l,types:n}),g=(e,t,a,r)=>e.callWS({type:"recorder/statistic_during_period",statistic_id:t,units:r,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar?Object.assign(Object.assign({},"week"===a.calendar.period?{first_weekday:(0,l.D)(e.locale).substring(0,3)}:{}),a.calendar):void 0,rolling_window:a.rolling_window}),m=e=>e.callWS({type:"recorder/validate_statistics"}),y=(e,t,a,r)=>e.callWS({type:"recorder/update_statistics_metadata",statistic_id:t,unit_of_measurement:a,unit_class:r}),b=(e,t)=>e.callWS({type:"recorder/clear_statistics",statistic_ids:t}),p=e=>{let t=null;if(!e)return null;for(const a of e)null!==a.change&&void 0!==a.change&&(null===t?t=a.change:t+=a.change);return t},f=(e,t)=>{let a=null;for(const r of t){if(!(r in e))continue;const t=p(e[r]);null!==t&&(null===a?a=t:a+=t)}return a},v=(e,t)=>e.some(e=>void 0!==e[t]&&null!==e[t]),$=["mean","min","max"],w=["sum","state","change"],k=(e,t)=>!(!$.includes(t)||0===e.mean_type)||!(!w.includes(t)||!e.has_sum),C=(e,t,a,r,s)=>{const l=new Date(a).toISOString();return e.callWS({type:"recorder/adjust_sum_statistics",statistic_id:t,start_time:l,adjustment:r,adjustment_unit_of_measurement:s})},x=(e,t,a)=>{const r=e.states[t];return r?(0,s.u)(r):(null==a?void 0:a.name)||t},S=(e,t,a)=>{let r;var s;t&&(r=null===(s=e.states[t])||void 0===s?void 0:s.attributes.unit_of_measurement);return void 0===r?null==a?void 0:a.statistics_unit_of_measurement:r},W=e=>e.includes(":"),q=e=>e.callWS({type:"recorder/update_statistics_issues"});r()}catch(c){r(c)}})},18427:function(e,t,a){a.d(t,{g:function(){return l}});a(42762);var r=a(79468),s=a(39274);function l(e,t,a,l,n,o){const c=e.getPropertyValue(n+"-"+o).trim(),i=c.length>0?c:e.getPropertyValue(n).trim();let d=(0,r.RQ)(i);return 0===c.length&&o&&(d=(0,r.v2)((0,r.BE)(t?(0,s.T)((0,r.Nc)((0,r.xp)(d)),o):(0,s.d)((0,r.Nc)((0,r.xp)(d)),o)))),l?d+=a?"32":"7F":a&&(d+="7F"),d}},24408:function(e,t,a){a.a(e,async function(e,r){try{a.r(t),a.d(t,{HuiEnergySourcesTableCard:function(){return Z}});a(74423),a(23792),a(18111),a(22489),a(61701),a(13579),a(53921),a(62953);var s=a(40445),l=a(68560),n=a(96196),o=a(77845),c=a(94333),i=a(6415),d=a(20058),_=a(18427),u=(a(76776),a(38114)),h=a(23528),g=a(54706),m=a(784),y=a(1087),b=e([d,u,h]);[d,u,h]=b.then?(await b)():b;let p,f,v,$,w,k,C,x,S,W,q,R,M,O,z,I,j,E,D,T=e=>e;const V={grid_return:"--energy-grid-return-color",grid_consumption:"--energy-grid-consumption-color",battery_in:"--energy-battery-in-color",battery_out:"--energy-battery-out-color",solar:"--energy-solar-color",gas:"--energy-gas-color",water:"--energy-water-color"};class Z extends((0,g.E)(n.WF)){hassSubscribe(){var e;return[(0,u.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe(e=>{this._data=e})]}getCardSize(){return 3}setConfig(e){this._config=e}shouldUpdate(e){return(0,m.xP)(this,e)||e.size>1||!e.has("hass")}_renderRow(e,t,a,r,s,l,o,u,g,m,y){var b;return(0,n.qy)(p||(p=T`<tr class="mdc-data-table__row ${0}" @click="${0}" .entity="${0}"> <td class="mdc-data-table__cell cell-bullet"> <div class="bullet" style="${0}"></div> </td> <th class="mdc-data-table__cell" scope="row"> ${0} </th> ${0} <td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} ${0} </td> ${0} </tr>`),(0,c.H)({clickable:!(0,h.OQ)(a)}),this._handleMoreInfo,a,(0,i.W)({borderColor:(0,_.g)(e,this.hass.themes.darkMode,!1,!1,V[t],r),backgroundColor:(0,_.g)(e,this.hass.themes.darkMode,!0,!1,V[t],r)}),(0,h.$O)(this.hass,a,null===(b=this._data)||void 0===b?void 0:b.statsMetadata[a]),y?(0,n.qy)(f||(f=T`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} ${0} </td> ${0}`),(0,d.ZV)(l,this.hass.locale),o,m?(0,n.qy)(v||(v=T`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==g?(0,d.ZV)(g,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):""):"",(0,d.ZV)(s,this.hass.locale),o,m?(0,n.qy)($||($=T` <td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==u?(0,d.ZV)(u,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):"")}_renderTotalRow(e,t,a,r,s,l,o,c,_,u){return(0,n.qy)(w||(w=T` <tr class="mdc-data-table__row ${0}"> <td class="mdc-data-table__cell cell-bullet"> ${0} </td> <th class="mdc-data-table__cell" scope="row">${0}</th> ${0} <td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td> ${0} </tr>`),_&&!u?"":"total",_?(0,n.qy)(k||(k=T`<div class="bullet" style="${0}"></div>`),(0,i.W)({borderColor:_.border,backgroundColor:_.background})):n.s6,e,c?(0,n.qy)(C||(C=T`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td> ${0}`),null===a?"":`${(0,d.ZV)(a,this.hass.locale)} ${r}`,o?(0,n.qy)(x||(x=T`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==l?(0,d.ZV)(l,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):""):"",null===t?"":`${(0,d.ZV)(t,this.hass.locale)} ${r}`,o?(0,n.qy)(S||(S=T`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==s?(0,d.ZV)(s,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):"")}render(){var e,t,a,r,s,l,o,c,i;if(!this.hass||!this._config)return n.s6;if(!this._data)return(0,n.qy)(W||(W=T`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));let d=0,g=0,m=0,y=!1,b=0,p=0,f=0;const v={gas:0,water:0,solar:0},$={gas:0,water:0,solar:0},w={gas:0,water:0},k={gas:0,water:0},C={gas:!1,water:!1},x=(0,u.E$)(this._data.prefs),S=null===(e=this._config)||void 0===e?void 0:e.types,D=S?Object.fromEntries(Object.entries(x).filter(([e])=>S.includes(e))):x,Z=getComputedStyle(this),U=!!(null!==(t=D.grid)&&void 0!==t&&t[0].flow_from.some(e=>e.stat_cost||e.entity_energy_price||e.number_energy_price)||null!==(a=D.grid)&&void 0!==a&&a[0].flow_to.some(e=>e.stat_compensation||e.entity_energy_price||e.number_energy_price)||null!==(r=D.gas)&&void 0!==r&&r.some(e=>e.stat_cost||e.entity_energy_price||e.number_energy_price)||null!==(s=D.water)&&void 0!==s&&s.some(e=>e.stat_cost||e.entity_energy_price||e.number_energy_price)),N={solar:"kWh",gas:this._data.gasUnit,water:this._data.waterUnit},P=void 0!==this._data.statsCompare,F=(e,t)=>{const a=(0,h.$j)(this._data.stats[e]),r=P&&(0,h.$j)(this._data.statsCompare[e]),s=t&&(0,h.$j)(this._data.stats[t])||0,l=P&&t&&(0,h.$j)(this._data.statsCompare[t])||0;return null!==a||P&&null!==r?{hasData:!0,energy:a||0,energyCompare:r||0,cost:s,costCompare:l}:{hasData:!1,energy:a||0,energyCompare:r||0,cost:s,costCompare:l}},H=this._config.show_only_totals,A=e=>{var t;return(0,n.qy)(q||(q=T` ${0} ${0}`),null===(t=D[e])||void 0===t?void 0:t.map((t,a)=>{const r=e in C&&(t.stat_cost||this._data.info.cost_sensors[t.stat_energy_from]),{hasData:s,energy:l,energyCompare:o,cost:c,costCompare:i}=F(t.stat_energy_from,r||null);return s||c||i?(v[e]+=l,$[e]+=o,r&&(C[e]=!0,w[e]+=c,k[e]+=i),H?n.s6:this._renderRow(Z,e,t.stat_energy_from,a,l,o,N[e],r?c:null,r?i:null,U,P)):n.s6}),D[e]?this._renderTotalRow(this.hass.localize(`ui.panel.lovelace.cards.energy.energy_sources_table.${e}_total`),v[e],$[e],N[e],C[e]?w[e]:null,C[e]?k[e]:null,U,P,H?{border:(0,_.g)(Z,this.hass.themes.darkMode,!1,!1,V[e],0),background:(0,_.g)(Z,this.hass.themes.darkMode,!0,!1,V[e],0)}:void 0):"")};return(0,n.qy)(R||(R=T` <ha-card> ${0} <div class="mdc-data-table"> <div class="mdc-data-table__table-container"> <table class="mdc-data-table__table" aria-label="Energy sources"> <thead> <tr class="mdc-data-table__header-row"> <th class="mdc-data-table__header-cell"></th> <th class="mdc-data-table__header-cell" role="columnheader" scope="col"> ${0} </th> ${0} <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th> ${0} </tr> </thead> <tbody class="mdc-data-table__content"> ${0} ${0} ${0} ${0} ${0} ${0} ${0} ${0} </tbody> </table> </div> </div> </ha-card>`),this._config.title?(0,n.qy)(M||(M=T`<h1 class="card-header">${0}</h1>`),this._config.title):"",this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.source"),P?(0,n.qy)(O||(O=T`<th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th> ${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.previous_energy"),U?(0,n.qy)(z||(z=T`<th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th>`),this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.previous_cost")):""):"",this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.energy"),U?(0,n.qy)(I||(I=T` <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th>`),this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.cost")):"",A("solar"),null===(l=D.battery)||void 0===l?void 0:l.map((e,t)=>{const{hasData:a,energy:r,energyCompare:s}=F(e.stat_energy_from,null),{hasData:l,energy:o,energyCompare:c}=F(e.stat_energy_to,null);return a||l?(m+=r-o,f+=s-c,H?n.s6:(0,n.qy)(j||(j=T` ${0}${0}`),this._renderRow(Z,"battery_out",e.stat_energy_from,t,r,s,"kWh",null,null,U,P),this._renderRow(Z,"battery_in",e.stat_energy_to,t,-o,-c,"kWh",null,null,U,P))):n.s6}),D.battery?this._renderTotalRow(this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.battery_total"),m,f,"kWh",null,null,U,P,H?{border:(0,_.g)(Z,this.hass.themes.darkMode,!1,!1,V.battery_out,0),background:(0,_.g)(Z,this.hass.themes.darkMode,!0,!1,V.battery_out,0)}:void 0):"",null===(o=D.grid)||void 0===o?void 0:o.map(e=>(0,n.qy)(E||(E=T`${0} ${0}`),e.flow_from.map((e,t)=>{const a=e.stat_cost||this._data.info.cost_sensors[e.stat_energy_from],{hasData:r,energy:s,energyCompare:l,cost:o,costCompare:c}=F(e.stat_energy_from,a||null);return r||o||c?(d+=s,b+=l,a&&(y=!0,g+=o,p+=c),H?n.s6:this._renderRow(Z,"grid_consumption",e.stat_energy_from,t,s,l,"kWh",o,c,U,P)):n.s6}),e.flow_to.map((e,t)=>{const a=e.stat_compensation||this._data.info.cost_sensors[e.stat_energy_to],{hasData:r,energy:s,energyCompare:l,cost:o,costCompare:c}=F(e.stat_energy_to,a||null);return r||o||c?(d-=s,b-=l,null!==a&&(y=!0,g-=o,p-=c),H?n.s6:this._renderRow(Z,"grid_return",e.stat_energy_to,t,-s,-l,"kWh",-o,-c,U,P)):n.s6}))),D.grid&&(null!==(c=D.grid)&&void 0!==c&&null!==(c=c[0].flow_from)&&void 0!==c&&c.length||null!==(i=D.grid)&&void 0!==i&&null!==(i=i[0].flow_to)&&void 0!==i&&i.length)?this._renderTotalRow(this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.grid_total"),d,b,"kWh",y?g:null,y?p:null,U,P,H?{border:(0,_.g)(Z,this.hass.themes.darkMode,!1,!1,V.grid_consumption,0),background:(0,_.g)(Z,this.hass.themes.darkMode,!0,!1,V.grid_consumption,0)}:void 0):"",A("gas"),A("water"),[C.gas,C.water,y].filter(Boolean).length>1?this._renderTotalRow(this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.total_costs"),null,null,"",w.gas+g+w.water,k.gas+p+k.water,U,P,void 0,!0):"")}_handleMoreInfo(e){var t;const a=null===(t=e.currentTarget)||void 0===t?void 0:t.entity;a&&!(0,h.OQ)(a)&&(0,y.r)(this,"hass-more-info",{entityId:a})}static get styles(){return(0,n.AH)(D||(D=T`${0} .mdc-data-table{width:100%;border:0}.mdc-data-table__cell,.mdc-data-table__header-cell{color:var(--primary-text-color);border-bottom-color:var(--divider-color);text-align:var(--float-start)}.mdc-data-table__row:not(.mdc-data-table__row--selected):hover{background-color:rgba(var(--rgb-primary-text-color),.04)}.clickable{cursor:pointer}.total{--mdc-typography-body2-font-weight:var(--ha-font-weight-medium)}.total .mdc-data-table__cell{border-top:1px solid var(--divider-color)}ha-card{max-height:100%;overflow:auto}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.cell-bullet{width:32px;padding-right:0;padding-inline-end:0;padding-inline-start:16px;direction:var(--direction)}.bullet{border-width:1px;border-style:solid;border-radius:var(--ha-border-radius-sm);height:16px;width:32px}.mdc-data-table__cell--numeric{direction:ltr}`),(0,n.iz)(l))}constructor(...e){super(...e),this.hassSubscribeRequiredHostProps=["_config"]}}(0,s.__decorate)([(0,o.MZ)({attribute:!1})],Z.prototype,"hass",void 0),(0,s.__decorate)([(0,o.wk)()],Z.prototype,"_config",void 0),(0,s.__decorate)([(0,o.wk)()],Z.prototype,"_data",void 0),Z=(0,s.__decorate)([(0,o.EM)("hui-energy-sources-table-card")],Z),r()}catch(p){r(p)}})}}]);
//# sourceMappingURL=93505.07a2921744d33de3.js.map