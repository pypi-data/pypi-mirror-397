"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["6434"],{75428:function(t,e,i){i.d(e,{D:function(){return r}});var n=i(75158),s=i.n(n);const r=t=>s()(t,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},23528:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{$3:function(){return v},$O:function(){return T},$j:function(){return m},ED:function(){return o},JE:function(){return x},OQ:function(){return O},PU:function(){return j},Ph:function(){return f},Uf:function(){return $},W1:function(){return y},Wr:function(){return _},Z:function(){return l},gF:function(){return p},iY:function(){return b},jU:function(){return c},nN:function(){return E},p3:function(){return d},pJ:function(){return g},r_:function(){return u},sz:function(){return h}});i(74423),i(23792),i(18111),i(13579),i(62953);var s=i(28978),r=i(380),a=t([r]);r=(a.then?(await a)():a)[0];var o=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const c=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],u=["L","gal","ft³","m³","CCF","MCF"],l=t=>t.sendMessagePromise({type:"recorder/info"}),d=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),_=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),h=(t,e,i,n,s="hour",r,a)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==i?void 0:i.toISOString(),statistic_ids:n,period:s,units:r,types:a}),g=(t,e,i,n)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:n,fixed_period:i.fixed_period?{start_time:i.fixed_period.start instanceof Date?i.fixed_period.start.toISOString():i.fixed_period.start,end_time:i.fixed_period.end instanceof Date?i.fixed_period.end.toISOString():i.fixed_period.end}:void 0,calendar:i.calendar?Object.assign(Object.assign({},"week"===i.calendar.period?{first_weekday:(0,r.D)(t.locale).substring(0,3)}:{}),i.calendar):void 0,rolling_window:i.rolling_window}),f=t=>t.callWS({type:"recorder/validate_statistics"}),y=(t,e,i,n)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:i,unit_class:n}),v=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),m=t=>{let e=null;if(!t)return null;for(const i of t)null!==i.change&&void 0!==i.change&&(null===e?e=i.change:e+=i.change);return e},p=(t,e)=>{let i=null;for(const n of e){if(!(n in t))continue;const e=m(t[n]);null!==e&&(null===i?i=e:i+=e)}return i},b=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),S=["mean","min","max"],w=["sum","state","change"],E=(t,e)=>!(!S.includes(e)||0===t.mean_type)||!(!w.includes(e)||!t.has_sum),$=(t,e,i,n,s)=>{const r=new Date(i).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:r,adjustment:n,adjustment_unit_of_measurement:s})},T=(t,e,i)=>{const n=t.states[e];return n?(0,s.u)(n):(null==i?void 0:i.name)||e},x=(t,e,i)=>{let n;var s;e&&(n=null===(s=t.states[e])||void 0===s?void 0:s.attributes.unit_of_measurement);return void 0===n?null==i?void 0:i.statistics_unit_of_measurement:n},O=t=>t.includes(":"),j=t=>t.callWS({type:"recorder/update_statistics_issues"});n()}catch(c){n(c)}})},97372:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{Gs:function(){return w},JR:function(){return k},RR:function(){return O},TI:function(){return E},od:function(){return T},ok:function(){return I}});i(46449),i(23792),i(44114),i(26910),i(93514),i(18111),i(22489),i(7588),i(61701),i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698),i(62953);var s=i(66708),r=i(6946),a=i(57279),o=i(98487),c=i(33977),u=i(56434),l=i(49134),d=i(35660),_=i(81977),h=i(35932),g=i(92913),f=i(77972),y=i(20058),v=i(72487),m=i(30162),p=i(75428),b=t([v,m,y]);function w(t,e){let i=new Date(e);return t>2&&0===i.getHours()&&(i=(0,s.O)(i,1)),i.setMinutes(0,0,0),t>35&&i.setDate(1),t>2&&i.setHours(0),i.getTime()}function E(t){return t>35?"month":t>2?"day":"hour"}function $(t){let e;return i=>{const n=Math.max(1,-Math.floor(Math.log10(Math.abs(i-(null!=e?e:i)||1))));return e=i,(0,y.ZV)(i,t,{maximumFractionDigits:n})}}function T(t,e,i,n,s,a,o,c){const u=(0,r.c)(e,t),l=void 0!==a&&void 0!==o,d=l&&t.getFullYear()!==a.getFullYear();return{xAxis:{type:"time",min:t,max:w(u,e)},yAxis:{type:"value",name:s,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:$(i)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:t=>{if(Array.isArray(t)){const e=[],r=[];return t.forEach(t=>{var i;null!==(i=t.seriesId)&&void 0!==i&&i.startsWith("compare-")?r.push(t):e.push(t)}),[e,r].map(t=>x(t,i,n,u,l,d,s,c)).filter(Boolean).join("<br><br>")}return x([t],i,n,u,l,d,s,c)}}}}function x(t,e,i,n,s,r,o,c){var u,l,d,_;if(null===(u=t[0])||void 0===u||!u.value)return"";const h=new Date(null!==(l=null===(d=t[0].value)||void 0===d?void 0:d[2])&&void 0!==l?l:null===(_=t[0].value)||void 0===_?void 0:_[0]);let g;n>=89?g=`${(0,v.fr)(h,e,i)}`:n>0?g=`${(r?v.kz:v.sl)(h,e,i)}`:(g=`${s?`${(r?v.kz:v.sl)(h,e,i)}: `:""}${(0,m.fU)(h,e,i)}`,"bar"===t[0].componentSubType&&(g+=` – ${(0,m.fU)((0,a.L)(h,1),e,i)}`));const f=`<h4 style="text-align: center; margin: 0;">${g}</h4>`;let b=0,S=0,w=0,E=0;const $=t.map(t=>{var i;const n=null===(i=t.value)||void 0===i?void 0:i[1],s=(0,y.ZV)(n,e,n<.1?{maximumFractionDigits:3}:void 0);return"0"!==s&&("bar"===t.componentSubType&&(n>0?(b+=n,S++):(w+=n,E++)),`${t.marker} ${(0,p.D)(t.seriesName)}: <div style="direction:ltr; display: inline;">${s} ${o}</div>`)}).filter(Boolean);let T="";return 0!==b&&S>1&&c&&(T+=`<br><b>${c(b)}</b>`),0!==w&&E>1&&c&&(T+=`<br><b>${c(w)}</b>`),$.length>0?`${f}${$.join("<br>")}${T}`:""}function O(t){Array.from(new Set(t.map(t=>t.data.map(t=>Number(t[0]))).flat())).sort((t,e)=>t-e).forEach((e,i)=>{const n={},s={};for(let d=t.length-1;d>=0;d--){var r,a,o,c,u;const _=t[d].data[i],h=_&&"object"==typeof _&&"value"in _?_:{value:_},g=null===(r=h.value)||void 0===r?void 0:r[0],f=null!==(a=t[d].stack)&&void 0!==a?a:"";var l;if(void 0!==g)if(Number(g)!==e)null===(l=t[d].data)||void 0===l||l.splice(i,0,{value:[e,0],itemStyle:{borderWidth:0}});else 0===(null===(o=h.value)||void 0===o?void 0:o[1])?t[d].data[i]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderWidth:0})}):!n[f]&&(null===(c=h.value)||void 0===c?void 0:c[1])>0?(t[d].data[i]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[4,4,0,0]})}),n[f]=!0):!s[f]&&(null===(u=h.value)||void 0===u?void 0:u[1])<0&&(t[d].data[i]=Object.assign(Object.assign({},h),{},{itemStyle:Object.assign(Object.assign({},h.itemStyle),{},{borderRadius:[0,0,4,4]})}),s[f]=!0)}})}function j(t){var e;return Number(null===(e=(t&&"object"==typeof t&&"value"in t?t:{value:t}).value)||void 0===e?void 0:e[0])}function k(t){const e=Array.from(new Set(t.map(t=>t.data.map(t=>j(t))).flat())).sort((t,e)=>t-e);return t.forEach(t=>{const i=new Map;t.data.forEach(t=>{const e=t&&"object"==typeof t&&"value"in t?t:{value:t},n=j(t);Number.isNaN(n)||i.set(n,e)}),t.data=e.map(t=>{var e;return null!==(e=i.get(t))&&void 0!==e?e:[t,0]})}),t}function I(t,e){if(!e)return t=>t;const i=(0,o.V)(t,e);if(0!==i&&t.getTime()===(0,c.D)(t).getTime())return t=>(0,u.e)(t,i);const n=(0,l.W)(t,e);if(0!==n&&t.getTime()===(0,d.w)(t).getTime())return t=>(0,_.P)(t,n);const s=(0,r.c)(t,e);if(0!==s&&t.getTime()===(0,h.o)(t).getTime())return t=>(0,g.f)(t,s);const a=t.getTime()-e.getTime();return t=>(0,f.A)(t,a)}[v,m,y]=b.then?(await b)():b,n()}catch(S){n(S)}})},3515:function(t,e,i){i.a(t,async function(t,n){try{i.r(e),i.d(e,{DEFAULT_DAYS_TO_SHOW:function(){return w},HuiStatisticsGraphCard:function(){return E}});i(16280),i(23792),i(18111),i(20116),i(7588),i(61701),i(3362),i(62953);var s=i(40445),r=i(6946),a=i(66708),o=i(96196),c=i(77845),u=i(94333),l=(i(76776),i(38114)),d=i(23528),_=i(37642),h=i(13632),g=i(784),f=i(20939),y=i(97372),v=t([l,y,d]);[l,y,d]=v.then?(await v)():v;let m,p,b,S=t=>t;const w=30;class E extends o.WF{static async getConfigElement(){return await Promise.all([i.e("44533"),i.e("92769"),i.e("44966"),i.e("38919"),i.e("80445"),i.e("19260"),i.e("24049"),i.e("51486"),i.e("93945")]).then(i.bind(i,9562)),document.createElement("hui-statistics-graph-card-editor")}static getStubConfig(t,e,i){const n=(0,h.B)(t,1,e,i,["sensor"],t=>"state_class"in t.attributes);return{type:"statistics-graph",entities:n.length?[n[0]]:[]}}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}connectedCallback(){var t;super.connectedCallback(),this.hasUpdated&&(null!==(t=this._config)&&void 0!==t&&t.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}_subscribeEnergy(){var t;this._energySub||(this._energySub=(0,l.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()}))}_unsubscribeEnergy(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}getCardSize(){var t,e,i;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(e=this._config)&&void 0!==e&&e.hide_legend?0:(null===(i=this._entities)||void 0===i?void 0:i.length)||0)}getGridOptions(){return{columns:12,min_columns:6,min_rows:3}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");this._entities=t.entities?(0,f.L)(t.entities,!1):[],this._entityIds=this._entities.map(t=>t.entity),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t,this._computeNames()}_computeNames(){this.hass&&this._config&&(this._names={},this._entities.forEach(t=>{const e=this.hass.states[t.entity];this._names[t.entity]=(0,_.v)(this.hass,e,t.name)||t.entity}))}shouldUpdate(t){return(0,g.pY)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),!this._config||!t.has("_config"))return;const e=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&(null==e?void 0:e.collection_key)!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("hass")&&this._computeNames(),t.has("_config")&&(null==e?void 0:e.entities)!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||(null==e?void 0:e.stat_types)===this._config.stat_types&&(null==e?void 0:e.days_to_show)===this._config.days_to_show&&(null==e?void 0:e.period)===this._config.period&&(null==e?void 0:e.unit)===this._config.unit||this._setFetchStatisticsTimer()}async _setFetchStatisticsTimer(t=!1){var e;clearInterval(this._interval),this._interval=0,t&&await this._getStatisticsMetaData(this._entityIds),await this._getStatistics(),null!==(e=this._config)&&void 0!==e&&e.energy_date_selection||(this._interval=window.setInterval(()=>this._getStatistics(),this._intervalTimeout))}get _period(){var t,e;return null!==(t=null===(e=this._config)||void 0===e?void 0:e.period)&&void 0!==t?t:this._energyStart&&this._energyEnd?(0,y.TI)((0,r.c)(this._energyEnd,this._energyStart)):void 0}render(){var t,e;if(!this.hass||!this._config)return o.s6;const i="number"==typeof(null===(t=this._config.grid_options)||void 0===t?void 0:t.rows);return(0,o.qy)(m||(m=S` <ha-card> ${0} <div class="content ${0}"> <statistics-chart .hass="${0}" .isLoadingData="${0}" .statisticsData="${0}" .metadata="${0}" .period="${0}" .chartType="${0}" .statTypes="${0}" .names="${0}" .unit="${0}" .minYAxis="${0}" .maxYAxis="${0}" .startTime="${0}" .endTime="${0}" .fitYData="${0}" .hideLegend="${0}" .logarithmicScale="${0}" .daysToShow="${0}" .height="${0}" .expandLegend="${0}"></statistics-chart> </div> </ha-card> `),this._config.title?(0,o.qy)(p||(p=S`<h1 class="card-header">${0}</h1>`),this._config.title):o.s6,(0,u.H)({"has-header":!!this._config.title,"has-rows":!(null===(e=this._config.grid_options)||void 0===e||!e.rows)}),this.hass,!this._statistics,this._statistics,this._metadata,this._period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._energyStart,this._energyEnd&&this._energyStart?(0,y.Gs)((0,r.c)(this._energyEnd,this._energyStart),this._energyEnd):void 0,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1,this._energyStart&&this._energyEnd?(0,r.c)(this._energyEnd,this._energyStart):this._config.days_to_show||w,i?"100%":void 0,this._config.expand_legend)}get _intervalTimeout(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}async _getStatisticsMetaData(t){const e=await(0,d.Wr)(this.hass,t),i={};e.forEach(t=>{i[t.statistic_id]=t}),this._metadata=i}async _getStatistics(){var t;const e=null!==(t=this._energyStart)&&void 0!==t?t:(0,a.O)(new Date,24*(this._config.days_to_show||w)+1),i=this._energyEnd;try{let t;if(this._config.unit&&this._metadata){const e=Object.values(this._metadata).find(t=>(0,d.JE)(this.hass,null==t?void 0:t.statistic_id,t)===this._config.unit);e&&(t=e.unit_class,this._unit=this._config.unit)}if(!t&&this._metadata){const e=this._metadata[this._entityIds[0]];t=null==e?void 0:e.unit_class,this._unit=t&&(0,d.JE)(this.hass,e.statistic_id,e)||void 0}const n=t?{[t]:this._unit}:void 0,s=await(0,d.sz)(this.hass,e,i,this._entityIds,this._period,n,this._statTypes);this._statistics={},this._entities.forEach(t=>{const e=t.entity;e in s&&(this._statistics[e]=s[e])})}catch(n){this._statistics=void 0}}constructor(...t){super(...t),this._entities=[],this._entityIds=[],this._names={}}}E.styles=(0,o.AH)(b||(b=S`ha-card{display:flex;flex-direction:column;height:100%}.card-header{padding-bottom:0}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}`)),(0,s.__decorate)([(0,c.MZ)({attribute:!1})],E.prototype,"hass",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_config",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_statistics",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_metadata",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_unit",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_energyStart",void 0),(0,s.__decorate)([(0,c.wk)()],E.prototype,"_energyEnd",void 0),E=(0,s.__decorate)([(0,c.EM)("hui-statistics-graph-card")],E),n()}catch(m){n(m)}})},13611:function(t,e,i){var n=i(46518),s=i(22195),r=i(62106),a=i(43724),o=TypeError,c=Object.defineProperty,u=s.self!==s;try{if(a){var l=Object.getOwnPropertyDescriptor(s,"self");!u&&l&&l.get&&l.enumerable||r(s,"self",{get:function(){return s},set:function(t){if(this!==s)throw new o("Illegal invocation");c(s,"self",{value:t,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else n({global:!0,simple:!0,forced:u},{self:s})}catch(d){}},56434:function(t,e,i){i.d(e,{e:function(){return s}});var n=i(81977);function s(t,e,i){return(0,n.P)(t,12*e,i)}},98487:function(t,e,i){i.d(e,{V:function(){return a}});i(23792),i(62953);var n=i(74816),s=i(95785);function r(t,e,i){const[s,r]=(0,n.x)(null==i?void 0:i.in,t,e);return s.getFullYear()-r.getFullYear()}function a(t,e,i){const[a,o]=(0,n.x)(null==i?void 0:i.in,t,e),c=(0,s.z)(a,o),u=Math.abs(r(a,o));a.setFullYear(1584),o.setFullYear(1584);const l=c*(u-+((0,s.z)(a,o)===-c));return 0===l?0:l}}}]);
//# sourceMappingURL=6434.b8ac4289aaaa54ef.js.map