"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["11384"],{40235:function(t,a,e){e.a(t,async function(t,s){try{e.r(a),e.d(a,{HuiPowerSourcesGraphCard:function(){return S}});e(23792),e(44114),e(72712),e(18111),e(7588),e(61701),e(18237),e(13579),e(3362),e(62953);var r=e(40445),o=e(73684),i=e(40600),n=e(81859),c=e(96196),h=e(77845),l=e(94333),d=e(22786),p=e(71578),u=e(44439),g=(e(76776),e(38114)),_=e(54706),y=e(784),f=e(97372),v=e(79468),b=t([u,g,f]);[u,g,f]=b.then?(await b)():b;let m,w,$,k,D=t=>t;class S extends((0,_.E)(c.WF)){hassSubscribe(){var t;return[(0,g.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>this._getStatistics(t))]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,y.xP)(this,t)||t.size>1||!t.has("hass")}render(){return this.hass&&this._config?(0,c.qy)(m||(m=D` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}"></ha-chart-base> ${0} </div> </ha-card> `),this._config.title?(0,c.qy)(w||(w=D`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,l.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd,this._legendData),this._chartData.some(t=>t.data.length)?c.s6:(0,c.qy)($||($=D`<div class="no-data"> ${0} </div>`),(0,o.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):c.s6}async _getStatistics(t){var a;const e=[];this._legendData=[];const s={solar:{stats:[],color:"--energy-solar-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.solar")},grid:{stats:[],color:"--energy-grid-consumption-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.grid")},battery:{stats:[],color:"--energy-battery-out-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.battery")}},r=getComputedStyle(this);for(const i of t.prefs.energy_sources)"solar"!==i.type?"battery"!==i.type?"grid"===i.type&&i.power&&s.grid.stats.push(...i.power.map(t=>t.stat_rate)):i.stat_rate&&s.battery.stats.push(i.stat_rate):i.stat_rate&&s.solar.stats.push(i.stat_rate);const o={type:"line",smooth:.4,smoothMonotone:"x",lineStyle:{width:1}},n=Date.now();Object.keys(s).forEach((a,i)=>{if(s[a].stats.length){const c=r.getPropertyValue(s[a].color),h=(0,v.xp)(c),{positive:l,negative:d}=this._processData(s[a].stats.map(a=>{var e;const s=null!==(e=t.stats[a])&&void 0!==e?e:[],r=(0,g.h4)(this.hass.states[a]);return void 0!==r&&s.push({start:n,end:n,mean:r}),s}));e.push(Object.assign(Object.assign({},o),{},{id:a,name:s[a].name,color:c,stack:"positive",areaStyle:{color:new p.LinearGradient(0,0,0,1,[{offset:0,color:`rgba(${h[0]}, ${h[1]}, ${h[2]}, 0.75)`},{offset:1,color:`rgba(${h[0]}, ${h[1]}, ${h[2]}, 0.25)`}])},data:l,z:3-i})),"solar"!==a&&e.push(Object.assign(Object.assign({},o),{},{id:`${a}-negative`,name:s[a].name,color:c,stack:"negative",areaStyle:{color:new p.LinearGradient(0,1,0,0,[{offset:0,color:`rgba(${h[0]}, ${h[1]}, ${h[2]}, 0.75)`},{offset:1,color:`rgba(${h[0]}, ${h[1]}, ${h[2]}, 0.25)`}])},data:d,z:4-i})),this._legendData.push({id:a,secondaryIds:"solar"!==a?[`${a}-negative`]:[],name:s[a].name,itemStyle:{color:`rgba(${h[0]}, ${h[1]}, ${h[2]}, 0.75)`,borderColor:c}})}}),this._start=t.start,this._end=t.end||(0,i.o)(),this._chartData=(0,f.JR)(e);const c=[];null===(a=this._chartData[0])||void 0===a||a.data.forEach((t,a)=>{const e="object"==typeof t&&"value"in t?t.value[0]:t[0];c[a]=[e,0],this._chartData.forEach(t=>{const e="object"==typeof t.data[a]&&"value"in t.data[a]?t.data[a].value[1]:t.data[a][1];c[a][1]+=e})}),this._chartData.push(Object.assign(Object.assign({},o),{},{id:"usage",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.usage"),color:r.getPropertyValue("--primary-text-color"),lineStyle:{type:[7,2],width:1.5},data:c,z:5})),this._legendData.push({id:"usage",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.usage"),itemStyle:{color:r.getPropertyValue("--primary-text-color")}})}_processData(t){const a={};t.forEach(t=>{t.forEach(t=>{var e;if(null==t.mean)return;const s=(t.start+t.end)/2;a[s]=[...null!==(e=a[s])&&void 0!==e?e:[],t.mean]})});const e=[],s=[];return Object.entries(a).forEach(([t,a])=>{const r=Number(t),o=a.reduce((t,a)=>t+a,0);e.push([r,Math.max(0,o)]),s.push([r,Math.min(0,o)])}),{positive:e,negative:s}}constructor(...t){super(...t),this._chartData=[],this._start=(0,n.R)(),this._end=(0,i.o)(),this.hassSubscribeRequiredHostProps=["_config"],this._createOptions=(0,d.A)((t,a,e,s,r,o,i)=>{var n;return Object.assign(Object.assign({},(0,f.od)(t,a,e,s,"kW",r,o)),{},{legend:{show:!1!==(null===(n=this._config)||void 0===n?void 0:n.show_legend),type:"custom",data:i}})})}}S.styles=(0,c.AH)(k||(k=D`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:var(--ha-space-4)}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:var(--ha-space-8);margin-inline-start:var(--ha-space-8);margin-inline-end:initial;box-sizing:border-box}`)),(0,r.__decorate)([(0,h.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,r.__decorate)([(0,h.wk)()],S.prototype,"_config",void 0),(0,r.__decorate)([(0,h.wk)()],S.prototype,"_chartData",void 0),(0,r.__decorate)([(0,h.wk)()],S.prototype,"_legendData",void 0),(0,r.__decorate)([(0,h.wk)()],S.prototype,"_start",void 0),(0,r.__decorate)([(0,h.wk)()],S.prototype,"_end",void 0),(0,r.__decorate)([(0,h.wk)()],S.prototype,"_compareStart",void 0),(0,r.__decorate)([(0,h.wk)()],S.prototype,"_compareEnd",void 0),S=(0,r.__decorate)([(0,h.EM)("hui-power-sources-graph-card")],S),s()}catch(m){s(m)}})},71578:function(t,a,e){e.r(a),e.d(a,{LinearGradient:function(){return b.A}});var s=e(88648),r=e(59126),o=e(25636),i=e(2403),n=e(3650),c=e(30137),h=e(69913),l=e(43401),d=e(87370),p=e(57610),u=e(44390),g=e(11069),_=e(88132),y=e(6036),f=e(88298),v=e(15490),b=e(67665);s.Y([o.a,i.a,n.a,c.a,h.a,l.a,d.a,p.a,u.a,g.a,y._,f.i,v.a,_.a]),a.default=r},43382:function(t,a,e){e.d(a,{A:function(){return r}});var s=e(51039);function r(t){return(0,s.w)(t,Date.now())}},83309:function(t,a,e){e.d(a,{r:function(){return o}});e(23792),e(62953);var s=e(74816),r=e(35932);function o(t,a,e){const[o,i]=(0,s.x)(null==e?void 0:e.in,t,a);return+(0,r.o)(o)===+(0,r.o)(i)}},73684:function(t,a,e){e.d(a,{c:function(){return i}});var s=e(51039),r=e(43382),o=e(83309);function i(t,a){return(0,o.r)((0,s.w)((null==a?void 0:a.in)||t,t),(0,r.A)((null==a?void 0:a.in)||t))}}}]);
//# sourceMappingURL=11384.7c079ab3400107a2.js.map