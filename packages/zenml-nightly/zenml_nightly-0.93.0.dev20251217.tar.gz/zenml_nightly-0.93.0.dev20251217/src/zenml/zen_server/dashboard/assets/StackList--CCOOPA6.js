import{j as e}from"./@radix-DGuLZ9Nd.js";import{S as T}from"./plus-BjxzjZ9E.js";import{S as E}from"./refresh-DNxZUtB4.js";import{P as O}from"./Pagination-2lWLXiuP.js";import{S as P}from"./SearchField-DS1lx7M6.js";import{s as u}from"./index-DeaVGGBZ.js";import{bm as I,bn as z,D as F,bv as U,bk as w,bl as _,B as j,c5 as M,i as B,j as L,e as d,A as S,h as b,a1 as m,k as R,s as q,r as x,aI as H,J as Q,F as $,G,H as J,w as K,x as W,N as V,O as X,Q as Y,R as Z,U as N,bu as ee,aK as se,aJ as te,a4 as ae}from"./index-DHfBZI1k.js";import{b as y,c as ne,h as re}from"./@tanstack-B6Lqf40n.js";import{f as ie,L as f,c as ce}from"./@react-router-edahAHd8.js";import{z as o}from"./@zod-2qqdh1cM.js";import{C as g}from"./CodeSnippet-DWvTxFp3.js";import{C as le}from"./CollapsibleCard-Bpe4J0WI.js";import{R as oe,S as de}from"./resizable-sheet-O3M3qni0.js";import{e as v}from"./components-Br2ezRib.js";import{a as l}from"./@monaco-editor-CuNQBT0l.js";import{N as k}from"./NumberBox-rvnKTr3e.js";import{C as me}from"./ComponentBadge-BFgGPKGS.js";import{I as xe}from"./Infobox-D7-NPcgU.js";import{A as ue}from"./action-cell-Biol8Lia.js";import{S as pe}from"./trash-Dp8wQrEE.js";import{D as he,a as je}from"./DeleteAlertDialog-DdUiWXzk.js";const h=1,fe=o.object({page:o.coerce.number().min(h).optional().default(h).catch(h),name:o.string().optional(),operator:o.enum(["and","or"]).optional()});function ge(){const[t]=ie(),{page:s,name:a,operator:n}=fe.parse({page:t.get("page")||void 0,name:t.get("name")||void 0});return{page:s,name:a,logical_operator:n}}const C=l.createContext(null);function ye({children:t}){const[s,a]=l.useState([]);return e.jsx(C.Provider,{value:{integrations:s,setIntegrations:a},children:t})}function D(){const t=l.useContext(C);if(t===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return t}function A({name:t,...s}){return e.jsxs(I,{...s,children:[e.jsx(z,{children:e.jsx(F,{children:"Update Stack"})}),e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(Ne,{action:"update"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(U,{className:"text-text-sm text-theme-text-secondary",children:"Update a stack"}),e.jsx(g,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack update ${t} -o NEW_ORCHESTRATOR_NAME`})]})]})]})}function Ne({action:t}){function s(){switch(t){case"delete":return"delete";case"update":return"update";case"describe":return"get details of"}}return e.jsx(xe,{children:e.jsx("div",{className:"flex w-full flex-wrap justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold",children:"We are working on the new Stacks experience."}),e.jsxs("p",{className:"truncate text-text-sm",children:["Meanwhile you can use the CLI to ",s()," your stack."]})]})})})}function ve({name:t}){const[s,a]=l.useState(!1);return e.jsxs(w,{open:s,onOpenChange:a,children:[e.jsx(_,{asChild:!0,children:e.jsx(j,{type:"button",size:"sm",intent:"primary",emphasis:"subtle",children:e.jsx(M,{})})}),e.jsx(A,{name:t,className:"lg:min-w-[600px]"})]})}function ke({children:t,stackId:s,stackName:a}){const[n,r]=l.useState(!1);return e.jsxs(B,{open:n,onOpenChange:r,children:[e.jsx(L,{children:t}),e.jsx(oe,{className:"overflow-y-auto",children:e.jsxs(ye,{children:[e.jsx(de,{}),e.jsx(we,{stackId:s}),e.jsx(Ce,{name:a}),e.jsx(Se,{stackId:s})]})})]})}function we({stackId:t}){const s=y({...u.stackDetail(t)});return s.isError?null:s.isPending?e.jsx("div",{className:"p-5",children:e.jsx(d,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex min-w-[10rem] items-center justify-between border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{type:"square",size:"lg",className:"shrink-0",children:e.jsx(b,{size:"lg",children:s.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton grid grid-cols-1 items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 truncate text-text-sm text-theme-text-secondary",children:s.data.id}),e.jsx(m,{copyText:s.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:s.data.name})})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ve,{name:s.data.name})})]})}function Se({stackId:t}){const{setIntegrations:s}=D(),a=y({...u.stackDetail(t)});if(l.useEffect(()=>{if(!a.data)return;const i=v(a.data.metadata?.components).map(c=>c.body?.integration).filter(c=>!!c&&c!=="built-in"&&c!=="custom");i.length>=1&&s(c=>Array.from(new Set([...c,...i])))},[a.data]),a.isError)return null;if(a.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(d,{className:"h-[300px] w-full"})});const n=v(a.data.metadata?.components);return e.jsx("ul",{className:"space-y-5 p-5",children:n.map(r=>e.jsx("li",{children:e.jsx(be,{component:r})},r.id))})}function be({component:t}){return e.jsxs(R,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{width:32,height:32,alt:`${t.resources?.flavor?.body?.display_name} logo`,src:q(t.body?.logo_url||"")}),e.jsxs("div",{children:[e.jsx(f,{to:x.components.detail(t.id),className:"text-text-xl",children:t.name}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:t.id.split("-")[0]}),e.jsx(m,{copyText:t.id})]})]})]}),e.jsx(f,{to:x.components.overview,children:e.jsx(me,{type:t.body?.type||"orchestrator",children:H(t.body?.type||"")})})]})}function Ce({name:t}){const{integrations:s}=D();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(le,{title:e.jsx("span",{className:"text-text-lg",children:"Set this stack"}),initialOpen:!0,children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(g,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${t}`})]})]}),s.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(g,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${s.join(" ")}`})]})]})]})})})}function De({deleteHandler:t,open:s,setOpen:a}){return e.jsx(Q,{open:s,onOpenChange:a,children:e.jsx(he,{title:"Delete Stack",handleDelete:t,children:e.jsxs(je,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})}function Ae({name:t,open:s,setOpen:a}){return e.jsx(w,{open:s,onOpenChange:a,children:e.jsx(A,{name:t,className:"lg:min-w-[600px]"})})}async function Te({stackId:t},s){const a=$(J.stacks.detail(t)),n=await fetch(a,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const r=await n.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>`Error while deleting stack ${t}`);throw new G({status:n.status,statusText:n.statusText,message:r})}return n.json()}function Ee(t){return ne({...t,mutationFn:async({stackId:s})=>Te({stackId:s})})}function Oe(t,s){const{toast:a}=K(),n=re(),r=ce(),i=Ee({onSuccess:async()=>{n.invalidateQueries({queryKey:u.all}),r(x.stacks.overview),s?.()},onError:p=>{a({status:"error",emphasis:"subtle",icon:e.jsx(W,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:p.message,rounded:!0})}});function c(){i.mutate({stackId:t})}return{handleDelete:c,deleteStack:i}}function Pe({name:t,id:s}){const[a,n]=l.useState(!1),[r,i]=l.useState(!1),{handleDelete:c,deleteStack:p}=Oe(s,()=>n(!1));return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{name:t,open:r,setOpen:i}),e.jsx(De,{deleteHandler:c,open:a,setOpen:n}),e.jsxs(V,{children:[e.jsx(X,{asChild:!0,children:e.jsx(Y,{children:e.jsx("span",{className:"sr-only",children:"Open stack actions"})})}),e.jsxs(Z,{className:"z-10",align:"end",sideOffset:1,children:[e.jsxs(N,{onClick:()=>i(!0),className:"cursor-pointer space-x-2",children:[e.jsx(ee,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]}),e.jsxs(N,{disabled:p.isPending,onClick:()=>n(!0),className:"cursor-pointer space-x-2",children:[e.jsx(pe,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}function Ie(){const t=[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:a,id:n}=s();return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(S,{type:"square",size:"md",className:"shrink-0",children:e.jsx(b,{size:"md",children:a[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{stackName:a,stackId:n,children:e.jsx("h2",{className:"grid grid-cols-1 text-text-md font-semibold",children:e.jsx("span",{className:"truncate",children:a})})}),e.jsx(m,{copyText:a})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:n.split("-")[0]}),e.jsx(m,{copyText:n})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>s.body?.created,cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(se,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>s.resources?.user?.name,cell:({row:s})=>{const a=s.original.resources?.user;return a?e.jsx(te,{avatarUrl:a.body?.avatar_url??void 0,username:a.name,isServiceAccount:!!a.body?.is_service_account}):null}},{id:"actions",header:"",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{id:a,name:n}=s();return e.jsx(ue,{children:e.jsx(Pe,{name:n,id:a})})}}];return l.useMemo(()=>t,[])}function ss({fixedQueryParams:t={}}){const s=ge(),a=Ie(),{refetch:n,data:r}=y({...u.stackList({...s,sort_by:"desc:updated",...t}),throwOnError:!0});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(P,{searchParams:s}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(j,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>n(),children:[e.jsx(E,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(j,{size:"md",asChild:!0,children:e.jsxs(f,{to:x.stacks.create.index,children:[e.jsx(T,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:r?e.jsx(ae,{columns:a,data:r.items}):e.jsx(d,{className:"h-[500px] w-full"})}),r?r.total_pages>1&&e.jsx(O,{searchParams:s,paginate:r}):e.jsx(d,{className:"h-[36px] w-[300px]"})]})]})})}export{ss as S};
