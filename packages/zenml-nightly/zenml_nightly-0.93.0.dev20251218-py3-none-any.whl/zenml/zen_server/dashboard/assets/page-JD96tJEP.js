import{j as e,aB as Tr,aC as Er,aD as ss,v as Lr,aE as Rr,aF as Or}from"./@radix-DGuLZ9Nd.js";import{a as h,W as fs}from"./@monaco-editor-CuNQBT0l.js";import{a6 as it,E as Ae,G as Me,F as Le,H as Re,w as bt,N as Rt,O as Ot,B as E,R as Dt,U as at,a7 as rs,J as Pt,a8 as gs,a9 as js,aa as ys,ab as bs,ac as vs,ad as Ns,e as S,a5 as Dr,ae as Pr,r as Be,af as zr,x as Ne,ag as Ar,Q as Mr,ah as Ir,a3 as Cs,X as vt,$ as ge,C as Ze,o as Ge,q as Je,t as Ye,Y as ae,Z as G,_ as J,a0 as Y,ai as ws,a1 as Te,aj as Ss,ak as Vr,al as Fr,am as $r,an as Br,ao as qr,ap as Hr,aq as Ur,ar as qe,as as nt,m as zt,I as At,at as Nt,au as ks,av as _s,aw as Ts,ax as Es,ay as Ls,az as Rs,aA as Os,aB as Ds,aC as Ps,aD as zs,aE as Fe,aF as Kr,b as lt,aG as Qr,T as Ke,a2 as Ct,aH as Wr,aI as Zr,aJ as Mt,aK as $e,aL as As,aM as Gr,aN as It,aO as ce,aP as de,d as Ms,aQ as ue,c as Jr,k as Is,aR as Vs,aS as Fs,a as Yr,aT as Vt,aU as wt,aV as Xr,s as ea,M as ta,aW as sa,aX as ra,aY as as,aZ as aa,a_ as na,a$ as ia,b0 as ft,b1 as $s,b2 as la,i as oa,b3 as Bs,b4 as Ft,b5 as ca,b6 as da,b7 as ua}from"./index-DHfBZI1k.js";import{S as St}from"./refresh-DNxZUtB4.js";import{S as Oe}from"./chevron-down-C9YWkVDM.js";import{c as $t,h as ot,b as De,j as ha}from"./@tanstack-B6Lqf40n.js";import{u as te}from"./pipeline-run-detail-query-DKpK4Sg5.js";import{R as gt}from"./run-name-B1DU_O7E.js";import{S as ma}from"./trash-Dp8wQrEE.js";import{S as qs}from"./plus-BjxzjZ9E.js";import{D as xa,a as pa}from"./DeleteAlertDialog-DdUiWXzk.js";import{u as fa}from"./delete-run-CyJrOaNd.js";import{c as Bt,a as Ie,L as ct,f as Hs}from"./@react-router-edahAHd8.js";import{S as Us,a as qt}from"./download-01-C2rE72Kp.js";import{S as Ks}from"./code-browser-BX_ce4O2.js";import{S as dt}from"./logs-D7KycftW.js";import{S as Ht}from"./scrolling-tabs-list-BcD1VYV1.js";import{E as Ut}from"./react-error-boundary.esm-CeAkc9cj.js";import{N as he,a as ga,K as R,b as be,V as ve}from"./KeyValue-pMy8DBFv.js";import{u as Qs,D as Ws}from"./docker-image-collapsible-BQ-gPNe9.js";import{C as we}from"./CodeSnippet-DWvTxFp3.js";import{g as ja,a as Zs,b as Gs}from"./code-snippets-Cro2ORGr.js";import{E as le}from"./EmptyState-BrB0SxKR.js";import{E as Pe}from"./Error-avNgYyhO.js";import{S as Js}from"./expand-full-h75BCAl0.js";import{S as ya}from"./SearchField-DS1lx7M6.js";import{S as Ys}from"./alert-triangle-DTrw87FZ.js";import{z as jt,u as ba,t as va}from"./@zod-2qqdh1cM.js";import{S as Xs}from"./check-Dbdrcavu.js";import{C as Ee,a as Na,b as Ca}from"./CollapsibleCard-Bpe4J0WI.js";import{I as Kt}from"./Infobox-D7-NPcgU.js";import{P as Qt}from"./pipeline-link-A-4bNAsN.js";import{R as er}from"./RepoBadge-LvM-kMDK.js";import{S as wa}from"./schedule-tag-DvMBMSL7.js";import{D as Sa}from"./deployment-status-tag-CFG_a1MF.js";import{S as tr}from"./stack-info-full-C-7kO0b_.js";import{u as sr}from"./stack-detail-query-B8BVRHRf.js";import{S as ka,a as _a,C as Ta}from"./ComponentIcon-D2oU0Tt4.js";import{S as Ea,a as yt}from"./dataflow-2-tGxvLWVU.js";import{H as ns,P as is,u as rr,B as La,a as Ra,b as Oa,c as Da,d as Pa}from"./@reactflow-BVD3Tc7O.js";import{S as Wt,R as za}from"./resizable-sheet-O3M3qni0.js";import{S as Aa}from"./clock-COypnJ_0.js";import{E as Ma,w as Ia}from"./@elkjs-CmhuJAjY.js";import{P as Va,a as ls,b as Fa}from"./react-resizable-panels.browser-0v9wo-oN.js";import"./eye-off-DGkKmlMW.js";import"./eye-CuzpINsY.js";import"./constants-Dj_C1ZPH.js";import"./bar-chart-square-check-BAWR96En.js";import"./layout-BBB8hotd.js";import"./transform-DsIiQtL0.js";import"./chevron-right-double-DLhLU36B.js";async function $a({runId:t,queries:s={include_steps:!1}}){const r=it(s).toString(),a=Le(Re.runs.refresh(t))+(r?`?${r}`:""),n=await Ae(a,{method:"POST"});if(!n.ok){const i=await n.json().then(l=>Array.isArray(l.detail)?l.detail[1]:l.detail).catch(()=>`Error while refreshing run ${t}`);throw new Me({status:n.status,statusText:n.statusText,message:i})}return n.json()}function Ba(t){return $t({...t,mutationFn:async s=>$a({runId:s.runId,queries:s.queries})})}function qa(t){const{toast:s}=bt(),r=ot();return Ba({onSuccess:async()=>{await r.invalidateQueries({queryKey:["runs"]}),s({rounded:!0,status:"success",emphasis:"subtle",description:"The run has been refreshed successfully"}),t(!1)},onError:n=>{s({rounded:!0,status:"error",emphasis:"subtle",description:n.message}),t(!1)}})}function Ha({runId:t}){const[s,r]=h.useState(!1),{isPending:a,mutate:n}=qa(r);return e.jsxs(Rt,{open:s,onOpenChange:r,children:[e.jsx(Ot,{asChild:!0,children:e.jsxs(E,{intent:"primary",emphasis:"subtle",size:"sm",className:"flex aspect-square items-center justify-center rounded-l-sharp border-l-0 p-0",children:[e.jsx(Oe,{width:20,height:20,className:"size-4 shrink-0"}),e.jsx("span",{className:"sr-only",children:"Open run refresh menu"})]})}),e.jsxs(Dt,{align:"end",className:"max-w-[100px] lg:max-w-[320px]",children:[e.jsx(at,{className:"hover:cursor-pointer",icon:e.jsx(rs,{width:24,height:24,className:"size-5 shrink-0"}),onSelect:i=>{i.preventDefault(),n({runId:t,queries:{include_steps:!1}})},disabled:a,children:e.jsxs("div",{className:"space-y-0.25",children:[e.jsx("p",{children:"Deep Refresh"}),e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"Queries the orchestrator directly. Takes longer but ensures most up-to-date data"})]})}),e.jsx(at,{className:"hover:cursor-pointer",icon:e.jsx(rs,{width:24,height:24,className:"size-5 shrink-0"}),onSelect:i=>{i.preventDefault(),n({runId:t,queries:{include_steps:!0}})},disabled:a,children:e.jsxs("div",{className:"space-y-0.25",children:[e.jsx("p",{children:"Step Refresh"}),e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"Include steps in the refresh. Takes longer but ensures most up-to-date data"})]})})]})]})}function Ua({runId:t}){const{refetch:s}=te({runId:t});return e.jsxs("div",{className:"flex",children:[e.jsxs(E,{className:"rounded-r-sharp",intent:"primary",emphasis:"subtle",size:"sm",onClick:()=>s(),children:[e.jsx(St,{className:"size-4 shrink-0 fill-theme-text-brand"}),"Refresh"]}),e.jsx(Ha,{runId:t})]})}const ar=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{d:"M21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21C16.9706 21 21 16.9706 21 12ZM15 9.59961C15 9.30333 14.9988 9.14095 14.9893 9.02441C14.9889 9.01992 14.9877 9.01575 14.9873 9.01172C14.9836 9.01138 14.9797 9.01108 14.9756 9.01074C14.8591 9.00122 14.6967 9 14.4004 9H9.59961C9.30333 9 9.14095 9.00122 9.02441 9.01074C9.01996 9.01111 9.01572 9.01135 9.01172 9.01172C9.01135 9.01572 9.01111 9.01996 9.01074 9.02441C9.00122 9.14095 9 9.30333 9 9.59961V14.4004C9 14.6967 9.00122 14.8591 9.01074 14.9756C9.01108 14.9797 9.01138 14.9836 9.01172 14.9873C9.01575 14.9877 9.01992 14.9889 9.02441 14.9893C9.14095 14.9988 9.30333 15 9.59961 15H14.4004C14.6967 15 14.8591 14.9988 14.9756 14.9893C14.9797 14.9889 14.9836 14.9876 14.9873 14.9873C14.9876 14.9836 14.9889 14.9797 14.9893 14.9756C14.9988 14.8591 15 14.6967 15 14.4004V9.59961ZM23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12ZM17 14.4004C17 14.6638 17.0011 14.9219 16.9834 15.1387C16.9694 15.3099 16.9406 15.5042 16.8691 15.7051L16.7822 15.9082C16.6145 16.2374 16.3592 16.5129 16.0459 16.7051L15.9082 16.7822C15.6369 16.9204 15.3672 16.9647 15.1387 16.9834C14.9219 17.0011 14.6638 17 14.4004 17H9.59961C9.33622 17 9.07814 17.0011 8.86133 16.9834C8.69005 16.9694 8.49576 16.9406 8.29492 16.8691L8.0918 16.7822C7.76256 16.6145 7.48707 16.3592 7.29492 16.0459L7.21777 15.9082C7.07956 15.6369 7.0353 15.3672 7.0166 15.1387C6.99889 14.9219 7 14.6638 7 14.4004V9.59961C7 9.33622 6.99889 9.07814 7.0166 8.86133C7.0353 8.63282 7.07956 8.36306 7.21777 8.0918L7.29492 7.9541C7.48707 7.64085 7.76256 7.38555 8.0918 7.21777L8.29492 7.13086C8.49576 7.05937 8.69005 7.03062 8.86133 7.0166C9.07814 6.99889 9.33622 7 9.59961 7H14.4004C14.6638 7 14.9219 6.99889 15.1387 7.0166C15.3672 7.0353 15.6369 7.07956 15.9082 7.21777L16.0459 7.29492C16.3144 7.45963 16.5404 7.68558 16.7051 7.9541L16.7822 8.0918L16.8691 8.29492C16.9406 8.49576 16.9694 8.69005 16.9834 8.86133C17.0011 9.07814 17 9.33622 17 9.59961V14.4004Z"}));async function Ka({runId:t,params:s}){const r=it(s).toString(),a=await Ae(Le(Re.runs.stop(t))+(r?`?${r}`:""),{method:"POST"});if(!a.ok){const n=await a.json().then(i=>i.detail).catch(()=>`Failed to delete run ${t}`);throw new Me({status:a.status,statusText:a.statusText,message:n})}return a.json()}function Qa(t){return $t({mutationFn:Ka,...t})}function nr(t){const{toast:s}=bt(),r=ot();return{stopRunQuery:Qa({onSuccess:()=>{r.invalidateQueries({queryKey:["runs"]}),t()},onError:n=>{s({rounded:!0,status:"error",emphasis:"subtle",description:e.jsx("div",{children:n.message})}),t()}})}}function ir({open:t,setOpen:s,handleStop:r,isPending:a,children:n}){return e.jsx(Pt,{open:t,onOpenChange:s,children:e.jsxs(gs,{children:[e.jsx(js,{children:e.jsx(ys,{children:"Stop Run"})}),e.jsx(bs,{className:"overflow-hidden p-5",children:n}),e.jsxs(vs,{className:"gap-[10px]",children:[e.jsx(Ns,{asChild:!0,children:e.jsx(E,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsxs(E,{onClick:r,className:"flex items-center gap-1",disabled:a,intent:"primary",type:"submit",children:[a&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),"Stop"]})]})]})})}function Wa({open:t,setOpen:s,runId:r}){const{stopRunQuery:{mutate:a,isPending:n}}=nr(()=>s(!1));function i(){a({runId:r,params:{graceful:!0}})}return e.jsx(ir,{open:t,setOpen:s,handleStop:i,isPending:n,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:"This will stop the run gracefully and allow the current step to finish."}),e.jsx("div",{children:"Are you sure you want to stop the run?"})]})})}function Za({open:t,setOpen:s,runId:r}){const{stopRunQuery:{mutate:a,isPending:n}}=nr(()=>s(!1));function i(){a({runId:r,params:{graceful:!1}})}return e.jsx(ir,{open:t,setOpen:s,handleStop:i,isPending:n,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{children:"This will stop the run immediately and won't allow the current step to finish."}),e.jsx("div",{children:"Are you sure you want to stop the run right now?"})]})})}function Ga({runId:t,isActive:s}){const[r,a]=h.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(E,{disabled:!s,intent:"secondary",size:"sm",className:"group whitespace-nowrap rounded-r-sharp",onClick:()=>a(!0),emphasis:"subtle",children:[e.jsx(ar,{className:"h-4 w-4 shrink-0 fill-theme-text-primary transition-all duration-200 group-disabled:fill-neutral-300"}),"Stop"]}),e.jsx(Wa,{open:r,setOpen:a,runId:t})]})}function Ja({runId:t,isActive:s}){const[r,a]=h.useState(!1),[n,i]=h.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(Za,{open:n,setOpen:i,runId:t}),e.jsxs(Rt,{open:r,onOpenChange:a,children:[e.jsx(Ot,{asChild:!0,children:e.jsxs(E,{disabled:!s,intent:"secondary",emphasis:"subtle",size:"sm",className:"group flex aspect-square items-center justify-center rounded-l-sharp border-l-0 p-0",children:[e.jsx(Oe,{width:20,height:20,className:"size-4 shrink-0 fill-theme-text-primary transition-all duration-200 group-disabled:fill-neutral-300"}),e.jsx("span",{className:"sr-only",children:"Open stop run menu"})]})}),e.jsx(Dt,{className:"max-w-[100px] lg:max-w-[320px]",children:e.jsx(at,{className:"hover:cursor-pointer",icon:e.jsx(ar,{width:24,height:24,className:"size-5 shrink-0"}),onSelect:()=>{i(!0)},children:e.jsxs("div",{className:"space-y-0.25",children:[e.jsx("p",{children:"Stop immediately"}),e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"Stops the run immediately. This won't allow the current step to finish."})]})})})]})]})}function Ya({runId:t}){const s=te({runId:t});if(s.isError)return null;if(s.isPending)return e.jsx(S,{className:"h-6 w-[100px]"});const r=s.data.body?.status,a=s.data.metadata?.orchestrator_run_id,n=(r==="running"||r==="initializing"||r==="provisioning")&&!!a;return e.jsxs("div",{className:"flex",children:[e.jsx(Ga,{runId:t,isActive:n}),e.jsx(Ja,{runId:t,isActive:n})]})}function Xa(t){const{setBreadcrumbs:s}=Dr();h.useEffect(()=>{t&&(t.resources?.pipeline?s([Pr,{label:t.resources.pipeline.name||"",href:Be.projects.pipelines.detail.runs(t.resources.pipeline.id)},{label:e.jsx(gt,{name:t.name,index:t.body?.index}),href:"#"}]):s([zr,{label:e.jsx(gt,{name:t.name,index:t.body?.index}),href:Be.projects.runs.detail(t.id)}]))},[s,t])}function en({open:t,setOpen:s}){const{toast:r}=bt(),a=Bt(),n=ot(),{runId:i}=Ie(),{mutate:l}=fa({onSuccess:async()=>{n.invalidateQueries({queryKey:["runs"]}),r({status:"success",emphasis:"subtle",icon:e.jsx(Ar,{className:"h-5 w-5 shrink-0 fill-success-700"}),description:"Run deleted successfully",rounded:!0}),s(!1),a(Be.projects.pipelines.overview)},onError:m=>{r({status:"error",emphasis:"subtle",icon:e.jsx(Ne,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:m.message,rounded:!0})}});async function d(){l({runId:i})}return e.jsx(Pt,{open:t,onOpenChange:s,children:e.jsx(xa,{title:"Delete Run",handleDelete:()=>d(),children:e.jsxs(pa,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."}),e.jsx("p",{children:"Deleting a run here does not guarantee that this run will get deleted in the underlying orchestrator."})]})})})}function tn({runId:t}){const[s,r]=h.useState(!1),[a,n]=h.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(en,{setOpen:r,open:s}),e.jsxs(Rt,{open:a,onOpenChange:n,children:[e.jsx(Ot,{asChild:!0,children:e.jsx(Mr,{children:e.jsx("span",{className:"sr-only",children:"Open run actions"})})}),e.jsxs(Dt,{className:"z-10",align:"end",sideOffset:1,children:[e.jsx(at,{asChild:!0,className:"space-x-2",children:e.jsxs(ct,{to:Be.projects.runs.createSnapshot(t),children:[e.jsx(qs,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"New Snapshot"})]})}),e.jsxs(at,{onClick:()=>r(!0),className:"space-x-2",children:[e.jsx(ma,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}function sn(){const{runId:t}=Ie(),{data:s,isSuccess:r}=te({runId:t},{throwOnError:!0});return Xa(s),e.jsxs(Ir,{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-1 truncate",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Cs,{className:`h-5 w-5 shrink-0 ${vt(s?.body?.status)}`}),e.jsx("h1",{className:"min-w-0 truncate text-display-xs font-semibold",children:e.jsx(gt,{name:s?.name??"",index:s?.body?.index})}),e.jsx(ge,{className:"h-5 w-5 shrink-0",status:s?.body?.status})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx(S,{className:"h-6 w-[250px]"}),e.jsx(S,{className:"h-5 w-5"})]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ua,{runId:t}),e.jsx(Ya,{runId:t}),e.jsx(tn,{runId:t})]})]})}const rn=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21 2C21.5523 2 22 2.44772 22 3V21C22 21.5523 21.5523 22 21 22C20.4477 22 20 21.5523 20 21V3C20 2.44772 20.4477 2 21 2ZM9.29289 4.29289C9.68342 3.90237 10.3166 3.90237 10.7071 4.29289L17.7071 11.2929C17.8946 11.4804 18 11.7348 18 12C18 12.2652 17.8946 12.5196 17.7071 12.7071L10.7071 19.7071C10.3166 20.0976 9.68342 20.0976 9.29289 19.7071C8.90237 19.3166 8.90237 18.6834 9.29289 18.2929L14.5858 13H3C2.44772 13 2 12.5523 2 12C2 11.4477 2.44772 11 3 11H14.5858L9.29289 5.70711C8.90237 5.31658 8.90237 4.68342 9.29289 4.29289Z"})),lr=t=>h.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.29292 1.29292C2.56075 1.02509 2.95692 0.931566 3.31625 1.05134L6.31626 2.05134C6.7246 2.18746 7.00003 2.5696 7.00003 3.00003V5.58581L10.11 8.69574C10.0377 8.30745 10 7.9077 10 7.50003C10 3.91018 12.9102 1.00003 16.5 1.00003C17.6867 1.00003 18.8019 1.31894 19.7614 1.87638C20.0298 2.03232 20.2105 2.30406 20.2506 2.61187C20.2907 2.91968 20.1856 3.22865 19.9661 3.44815L17.3385 6.07576C17.1288 6.28544 17.0146 6.40072 16.9389 6.48989C16.9359 6.49344 16.9331 6.49682 16.9304 6.50003C16.9331 6.50323 16.9359 6.50661 16.9389 6.51016C17.0146 6.59933 17.1288 6.71461 17.3385 6.92429L17.5758 7.16155C17.7854 7.37123 17.9007 7.48541 17.9899 7.56111C17.9934 7.56412 17.9968 7.56696 18 7.56962C18.0032 7.56696 18.0066 7.56412 18.0102 7.56111C18.0993 7.48541 18.2146 7.37123 18.4243 7.16155L20.8822 4.70364C21.1187 4.46713 21.4578 4.36452 21.7858 4.43023C22.1137 4.49594 22.3871 4.72126 22.5142 5.03063C22.8277 5.7933 23 6.62779 23 7.50003C23 10.5046 20.9614 13.0331 18.1919 13.7777L21.2071 16.7928C22.4261 18.0117 22.4261 19.9881 21.2071 21.207C19.9882 22.426 18.0119 22.426 16.7929 21.207L12.0001 16.4142L7.20713 21.2071C5.98818 22.4261 4.01187 22.4261 2.79292 21.2071C1.57397 19.9882 1.57397 18.0119 2.79292 16.7929L9.08581 10.5L5.58581 7.00003H3.00003C2.5696 7.00003 2.18746 6.7246 2.05134 6.31626L1.05134 3.31625C0.931566 2.95692 1.02509 2.56075 1.29292 2.29292L2.29292 1.29292ZM5.00003 5.00003V3.72079L3.27012 3.14415L3.14415 3.27012L3.72079 5.00003H5.00003ZM11.2062 11.2081L4.20714 18.2071C3.76923 18.645 3.76923 19.355 4.20714 19.7929C4.64504 20.2308 5.35502 20.2308 5.79292 19.7929L12.9499 12.6359C12.9689 12.617 12.9882 12.5975 13.0079 12.5776C13.0487 12.5366 13.0913 12.4937 13.1355 12.4504L13.2326 12.3533C13.3452 12.2406 13.4665 12.1456 13.5937 12.0668C13.6314 12.0423 13.6697 12.0194 13.7087 11.9985C13.8064 11.9462 13.9249 11.8887 14.0691 11.8448C14.2133 11.8009 14.3438 11.7827 14.4541 11.7718C14.4756 11.7696 14.497 11.768 14.5184 11.7668C14.7885 11.7445 15.0574 11.7719 15.3055 11.84C15.4095 11.8686 15.515 11.8935 15.622 11.9146C15.6224 11.9147 15.6228 11.9148 15.6233 11.9149C15.6427 11.9187 15.6621 11.9224 15.6816 11.926C15.8091 11.9493 15.9384 11.9674 16.0696 11.9798C16.211 11.9932 16.3546 12 16.5 12C18.9853 12 21 9.98531 21 7.50003C21 7.47163 20.9998 7.44329 20.9992 7.41502L19.816 8.5983C19.6375 8.77679 19.4637 8.95062 19.3045 9.08579C19.1297 9.23422 18.9078 9.39379 18.6181 9.48793C18.2164 9.61844 17.7837 9.61844 17.382 9.48793C17.0923 9.39379 16.8704 9.23422 16.6955 9.08579C16.5363 8.95062 16.3625 8.7768 16.1841 8.59832L15.9017 8.31596C15.7233 8.13751 15.5494 7.96373 15.4143 7.80452C15.2658 7.62967 15.1063 7.40778 15.0121 7.11806C14.8816 6.71637 14.8816 6.28368 15.0121 5.88199C15.1063 5.59228 15.2658 5.37038 15.4143 5.19554C15.5494 5.03633 15.7232 4.86255 15.9017 4.68412L17.4792 3.10665C17.1643 3.03685 16.8367 3.00003 16.5 3.00003C14.0147 3.00003 12 5.01475 12 7.50003C12 7.80093 12.0294 8.09398 12.0852 8.37677L12.0888 8.39527C12.1337 8.62253 12.1727 8.82052 12.1978 8.97939C12.2214 9.12834 12.2493 9.33506 12.2283 9.54599C12.2173 9.65623 12.1991 9.78675 12.1552 9.93093C12.1114 10.0751 12.0538 10.1937 12.0015 10.2913C11.8581 10.5594 11.6197 10.7962 11.4224 10.9921C11.4025 11.0119 11.3831 11.0312 11.3642 11.0501L11.2081 11.2062C11.2078 11.2065 11.2074 11.2068 11.2071 11.2071C11.2068 11.2074 11.2065 11.2078 11.2062 11.2081ZM13.4143 15L18.2071 19.7928C18.645 20.2307 19.355 20.2307 19.7929 19.7928C20.2308 19.3549 20.2308 18.6449 19.7929 18.207L15.5109 13.9251C15.4187 13.911 15.3272 13.895 15.2363 13.8771C14.9852 13.8275 14.825 13.7961 14.7082 13.7777C14.6855 13.7741 14.667 13.7714 14.652 13.7694C14.6484 13.7726 14.6444 13.7762 14.64 13.7802C14.5816 13.8331 14.5053 13.9089 14.3727 14.0416C14.3699 14.0444 14.367 14.0472 14.3642 14.0501L13.4143 15Z"}));function an({runId:t}){const[s,r]=h.useState(!0),a=ja(t);return e.jsxs(Ze,{open:s,onOpenChange:r,children:[e.jsx(Ge,{className:"flex items-center gap-[10px]",children:e.jsxs(Je,{className:"flex w-full items-center gap-[10px]",children:[e.jsx(Oe,{className:` ${s?"":"-rotate-90"} h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`}),"Code"]})}),e.jsxs(Ye,{className:"border-t border-theme-border-moderate bg-theme-surface-primary px-5 py-3",children:[e.jsx("p",{className:"mb-2 text-theme-text-secondary",children:"Get config programmatically"}),e.jsx(we,{fullWidth:!0,highlightCode:!0,wrap:!0,code:a})]})]})}const os="python_packages";function nn({run:t}){const[s,r]=h.useState(!0),a=t.metadata?.orchestrator_environment,n=t.metadata?.client_environment,i=cs(a??{}),l=cs(n??{});return e.jsxs(Ze,{open:s,onOpenChange:r,children:[e.jsx(Ge,{intent:"primary",className:"flex items-center gap-[10px]",children:e.jsxs(Je,{className:"flex w-full items-center gap-[10px]",children:[e.jsx(Oe,{className:` ${s?"":"-rotate-90"} h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`}),"Environment"]})}),e.jsxs(Ye,{className:"space-y-3 border-t border-theme-border-moderate bg-theme-surface-primary px-5 py-3",children:[e.jsx(he,{isInitialOpen:!0,intent:"secondary",title:e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{asChild:!0,children:e.jsx("span",{children:"Client Environment"})}),e.jsxs(Y,{className:"max-w-[200px] whitespace-normal xl:max-w-[300px]",children:["Environment where you start your pipeline run by calling the pipeline function."," ",e.jsx("a",{rel:"noopener noreferrer",className:"link",href:"https://docs.zenml.io/user-guides/best-practices/configure-python-environments#client-environment-or-the-runner-environment",target:"_blank",children:"Learn more about client environments"})]})]})}),data:l}),e.jsx(he,{isInitialOpen:!0,intent:"secondary",title:e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{asChild:!0,children:e.jsx("span",{children:"Execution Environment"})}),e.jsxs(Y,{className:"max-w-[200px] whitespace-normal xl:max-w-[300px]",children:["Environment where your ZenML steps get executed."," ",e.jsx("a",{rel:"noopener noreferrer",className:"link",href:"https://docs.zenml.io/user-guides/best-practices/configure-python-environments#execution-environments",target:"_blank",children:"Learn more about exectuion environments"})]})]})}),data:i})]})]})}function cs(t){const s=t[os];return typeof s=="string"?{...t,[os]:s.split(`
`).map(r=>r.trim())}:t}function ln({snapshotId:t}){const[s,r]=h.useState(!0),{isLoading:a,isError:n,data:i}=De({...ws.detail(t),enabled:!!t});return t?a?e.jsx(S,{className:"h-[150px] w-full"}):n?null:e.jsx(he,{isInitialOpen:!0,title:"Pipeline Parameters",data:i?.metadata?.pipeline_spec?.parameters}):e.jsxs(Ze,{open:s,onOpenChange:r,children:[e.jsxs(Ge,{intent:"primary",className:"flex items-center gap-[10px]",children:[e.jsx(Je,{children:e.jsx(Oe,{className:` ${s?"":"-rotate-90"} h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`})}),"Pipeline Parameters"]}),e.jsx(Ye,{className:"border-t border-theme-border-moderate bg-theme-surface-primary px-5 py-3",children:e.jsx(ga,{})})]})}function on({runId:t}){const{data:s,isError:r,isPending:a}=te({runId:t,queryParams:{include_python_packages:!0}},{throwOnError:!0}),{data:n}=Qs({buildId:s?.resources?.build?.id},{enabled:!!s?.resources?.build?.id});return r?null:a?e.jsxs("div",{className:"space-y-5",children:[e.jsx(S,{className:"h-[56px] w-full"}),e.jsx(S,{className:"h-[56px] w-full"}),e.jsx(S,{className:"h-[56px] w-full"}),e.jsx(S,{className:"h-[56px] w-full"})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-5",children:[e.jsx(ln,{snapshotId:s.resources?.snapshot?.id??void 0}),n?.metadata?.images?.orchestrator&&e.jsx(Ws,{data:n?.metadata?.images?.orchestrator}),e.jsx(an,{runId:t}),e.jsx(nn,{run:s}),e.jsx(he,{isInitialOpen:!0,title:"Cache Policy",sortKeysAlphabetically:!1,data:s.metadata?.config.cache_policy??void 0}),e.jsx(he,{isInitialOpen:!0,title:"Resources",data:s.metadata?.config.settings?.resources||{}}),e.jsx(he,{isInitialOpen:!0,title:"Retry",data:s.metadata?.config.retry??void 0}),e.jsx(he,{isInitialOpen:!0,title:"Substitutions",data:s.metadata?.config.substitutions}),e.jsx(he,{isInitialOpen:!0,title:"Extra",data:s.metadata?.config.extra})]})}function Xe({title:t,subtitle:s}){return e.jsx(le,{icon:e.jsx(dt,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2 text-display-xs font-semibold",children:t}),e.jsx("p",{className:"text-lg text-theme-text-secondary",children:s})]})})}function cn({error:t}){if(!(t instanceof Error))throw t;return e.jsx(Xe,{title:"Error displaying logs",subtitle:t.message})}const dn=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{d:"M4 14H10M10 14V20M10 14L3 21M20 10H14M14 10V4M14 10L21 3",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}));function un(t){if(!Array.isArray(t)||t.length===0)return[];const s=new Map;for(let a=0;a<t.length;a++){const n=t[a],l=(n.total_chunks??1)>1||n.chunk_index!=null?n.id?`id:${n.id}`:`k:${n.timestamp??""}|${n.level??""}|${n.module??""}|${n.filename??""}|${n.lineno??""}`:`single:${a}`,d=s.get(l);d?d.push(n):s.set(l,[n])}const r=[];return s.forEach(a=>{if(a.length===1&&(a[0].total_chunks??1)<=1&&a[0].chunk_index==null){r.push(a[0]);return}const n=a.slice().sort((l,d)=>(l.chunk_index??0)-(d.chunk_index??0)),i={...n[0]};i.message=n.map(l=>l.message??"").join(""),delete i.chunk_index,delete i.total_chunks,r.push(i)}),r}function or(t){return un(t).map(r=>{const a=`[${cr[r.level||20]}] [${r.timestamp}] ${r.message}`;return{...r,originalEntry:a}})}const cr={0:"",10:"DEBUG",20:"INFO",30:"WARNING",40:"ERROR",50:"CRITICAL"},hn=t=>{switch(t){case 10:return"bg-neutral-400";case 20:return"bg-blue-500";case 30:return"bg-warning-500";case 40:return"bg-error-500";case 50:return"bg-error-700";default:return"bg-neutral-400"}},mn=t=>Ss(t).toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});function xn({entry:t,searchTerm:s,isCurrentMatch:r,textWrapEnabled:a,highlightedMessage:n}){const{timestamp:i,level:l,message:d,originalEntry:m}=t,u=i?mn(i):"",p=hn(l??void 0),y=f=>{if(!s)return f;const b=new RegExp(`(${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return f.split(b).map((M,O)=>M.toLowerCase()===s.toLowerCase()?e.jsx("span",{className:`${r?"bg-warning-200 text-warning-900":"bg-warning-100 text-warning-800"} inline-block rounded-sm px-1`,children:M},O):M)};return e.jsxs("div",{className:"group/copybutton flex w-full items-start space-x-3 border-b border-theme-border-minimal px-4 py-1 font-mono text-text-sm font-normal transition-colors hover:bg-theme-surface-secondary",children:[e.jsxs("div",{className:"flex max-h-6 w-12 flex-shrink-0 items-center",children:[e.jsx("div",{className:`h-4 w-[2px] rounded-sm ${p} mr-2`}),e.jsx("span",{className:"text-xs text-theme-text-tertiary",children:cr[l??20]})]}),e.jsx("div",{className:"w-[178px] flex-shrink-0 text-theme-text-secondary",children:u}),e.jsx("div",{className:`flex-1 text-theme-text-primary ${a?"min-w-0 whitespace-pre-wrap break-words":"whitespace-nowrap"}`,children:n||y(d)}),e.jsx("div",{className:"flex flex-shrink-0 items-center",children:e.jsx(Te,{copyText:m,copyTitle:"Copy log line"})})]})}const pn=[{value:10,label:"Debug",icon:e.jsx(Ur,{className:"size-3 shrink-0 fill-neutral-400"})},{value:20,label:"Info",icon:e.jsx(qe,{className:"size-3 shrink-0 fill-blue-500"})},{value:30,label:"Warning",icon:e.jsx(Ys,{className:"size-3 shrink-0 fill-warning-500"})},{value:40,label:"Error",icon:e.jsx(Ne,{className:"size-3 shrink-0 fill-error-500"})},{value:50,label:"Critical",icon:e.jsx(Ne,{className:"size-3 shrink-0 fill-error-700"})}],dr=h.forwardRef(({...t},s)=>e.jsxs(Vr,{...t,children:[e.jsx(Fr,{ref:s,className:"h-7 w-full truncate border border-[#D0D5DD] bg-theme-surface-primary p-2 text-left text-text-md",children:e.jsx($r,{className:"data-[placeholder]:text-theme-text-secondary",placeholder:"Select a role..."})}),e.jsx(Br,{className:"",children:e.jsx(qr,{viewportClassName:"max-h-[300px]",children:pn.map((r,a)=>e.jsx(Hr,{className:"rounded-sm p-2",value:r.value.toString(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[r.icon,r.label]})},a))})})]}));dr.displayName="LogLevelSelect";function ds({onSearchChange:t,onReload:s,onCopyAll:r,onDownload:a,searchQuery:n="",currentMatchIndex:i=0,totalMatches:l=0,onPreviousMatch:d,onNextMatch:m,logLevel:u,setLogLevel:p}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-theme-surface-secondary",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ya,{searchParams:{},inMemoryHandler:t,placeholder:"Search logs..."}),n&&e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("span",{className:"text-sm whitespace-nowrap text-theme-text-secondary",children:l>0?`${i+1} of ${l}`:"No matches"}),e.jsx(E,{className:"aspect-square",size:"sm",emphasis:"minimal",onClick:d,disabled:l===0,title:"Previous match",children:e.jsx(nt,{className:"h-4 w-4 shrink-0 rotate-90 fill-theme-text-tertiary"})}),e.jsx(E,{className:"aspect-square",size:"sm",emphasis:"minimal",onClick:m,disabled:l===0,title:"Next match",children:e.jsx(nt,{className:"h-4 w-4 shrink-0 -rotate-90 fill-theme-text-tertiary"})})]}),e.jsx(dr,{value:u.toString(),onValueChange:y=>p(Number(y))})]}),e.jsx(ae,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tt,{icon:e.jsx(St,{className:"h-4 w-4 fill-theme-text-primary"}),tooltip:"Reload logs",onClick:s}),e.jsx(Tt,{icon:e.jsx(zt,{className:"h-4 w-4 fill-theme-text-primary"}),tooltip:"Copy all displayed logs",onClick:r}),e.jsx(Tt,{icon:e.jsx(Us,{className:"h-4 w-4 fill-theme-text-primary"}),tooltip:"Download logs as file",onClick:a})]})})]})})})}function Tt({icon:t,tooltip:s,onClick:r}){return e.jsxs(G,{delayDuration:200,children:[e.jsx(J,{children:e.jsx(E,{size:"md",emphasis:"subtle",intent:"secondary",onClick:r,className:"flex aspect-square items-center justify-center bg-theme-surface-primary p-0",children:t})}),e.jsx(Y,{children:s})]})}function fn(t){const[s,r]=h.useState(""),[a,n]=h.useState(!1),[i,l]=h.useState(0),{filteredLogs:d,matches:m}=h.useMemo(()=>{if(!s.trim())return{filteredLogs:t,matches:[]};const N=a?s:s.toLowerCase(),M=[],O=[];return t.forEach(I=>{const se=a?I.message:I.message.toLowerCase(),q=[];let me=0;for(;me<se.length;){const je=se.indexOf(N,me);if(je===-1)break;q.push(je),me=je+1}q.length>0&&(M.push(I),q.forEach((je,xe)=>{O.push({logIndex:M.length-1,matchIndex:xe,startIndex:je,endIndex:je+N.length})}))}),{filteredLogs:M,matches:O}},[t,s,a]);h.useMemo(()=>{l(0)},[]);const u=m.length,p=h.useCallback(()=>{u>0&&l(N=>(N+1)%u)},[u]),y=h.useCallback(()=>{u>0&&l(N=>(N-1+u)%u)},[u]),f=h.useCallback(()=>{r(""),l(0)},[]),b=h.useCallback((N,M)=>{if(!s.trim())return N;const O=[];let I=0;return m.filter(q=>q.logIndex===M).forEach((q,me)=>{q.startIndex>I&&O.push(N.slice(I,q.startIndex));const xe=m.findIndex(A=>A.logIndex===q.logIndex&&A.matchIndex===q.matchIndex)===i?"bg-warning-200 text-warning-900":"bg-warning-100 text-warning-800";O.push(fs.createElement("span",{key:`match-${M}-${me}`,className:`${xe} inline-block rounded-sm px-1`},N.slice(q.startIndex,q.endIndex))),I=q.endIndex}),I<N.length&&O.push(N.slice(I)),O.length>0?O:N},[s,m,i]);return{searchQuery:s,setSearchQuery:r,caseSensitive:a,setCaseSensitive:n,filteredLogs:d,matches:m,currentMatchIndex:i,totalMatches:u,goToNextMatch:p,goToPreviousMatch:y,clearSearch:f,highlightText:b}}function gn(t){const[s,r]=h.useState(20),a=h.useMemo(()=>t.filter(n=>n.level&&n.level>=s),[t,s]);return{selectedLogLevel:s,filteredLogs:a,setSelectedLogLevel:r}}function jn(t,s){const r=h.useMemo(()=>jt.object({page:jt.coerce.number().int().transform(n=>{const i=Math.floor(n);return isNaN(i)||i<1?1:i>s?s:i}).catch(1)}),[s]);return{form:ba({resolver:va(r),defaultValues:{page:t}})}}const yn=100;function ur({logs:t,reloadLogs:s,itemsPerPage:r=yn}){const[a,n]=h.useState(1),[i,l]=h.useState(!0),{filteredLogs:d,selectedLogLevel:m,setSelectedLogLevel:u}=gn(t),{searchQuery:p,setSearchQuery:y,filteredLogs:f,currentMatchIndex:b,totalMatches:N,goToNextMatch:M,goToPreviousMatch:O,highlightText:I}=fn(d),se=f,q=Math.ceil(se.length/r),me=(a-1)*r,je=me+r,xe=se.slice(me,je),{form:A}=jn(a,q),o=h.useCallback(C=>{n(C),A.setValue("page",C)},[A]);function c(C){o(C.page)}fs.useEffect(()=>{o(1)},[p]);const x=()=>{o(Math.max(a-1,1))},j=()=>{o(Math.min(a+1,q))},g=()=>{o(1)},L=()=>{o(q)},U=()=>{const C=us(t);navigator.clipboard.writeText(C).catch(F=>{console.error("Failed to copy logs:",F)})},oe=()=>{const C=us(t),F=new Blob([C],{type:"text/plain"}),w=URL.createObjectURL(F),K=document.createElement("a");K.href=w,K.download=`logs-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(w)},pe=()=>{l(C=>!C)};return!t||f.length===0?e.jsxs("div",{className:"flex h-full flex-col space-y-5",children:[e.jsx(ds,{logLevel:m,setLogLevel:u,onSearchChange:y,onReload:s,onCopyAll:U,onDownload:oe,searchQuery:p,currentMatchIndex:b,totalMatches:N,onPreviousMatch:O,onNextMatch:M}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Xe,{title:"No logs found",subtitle:"No logs available to display."})})]}):e.jsxs("div",{className:"flex h-full flex-col space-y-5",children:[e.jsx(ds,{logLevel:m,setLogLevel:u,onSearchChange:y,onReload:s,onCopyAll:U,onDownload:oe,searchQuery:p,currentMatchIndex:b,totalMatches:N,onPreviousMatch:O,onNextMatch:M}),e.jsxs("div",{className:"flex-1 overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-theme-surface-tertiary",children:e.jsxs("div",{className:"flex w-full min-w-[600px] space-x-3 bg-theme-surface-tertiary px-4 py-1 font-medium text-theme-text-secondary",children:[e.jsx("div",{className:"flex w-12 flex-shrink-0 items-center",children:e.jsx("span",{className:"text-text-sm font-semibold",children:"Type"})}),e.jsx("div",{className:"w-[178px] flex-shrink-0",children:e.jsx("span",{className:"text-text-sm font-semibold",children:"Time"})}),e.jsx("div",{className:"flex min-w-0 flex-1 items-center justify-between",children:e.jsx("span",{className:"text-text-sm font-semibold",children:"Event"})}),e.jsxs("div",{className:"flex flex-shrink-0 items-center",children:[" ",e.jsx(E,{onClick:pe,size:"sm",emphasis:"subtle",intent:"secondary",className:"ml-2 h-5 w-5 rounded-sm bg-theme-surface-primary p-0.25",title:i?"Unwrap text":"Wrap text",children:i?e.jsx(dn,{className:"h-4 w-4 shrink-0 text-theme-text-tertiary hover:text-theme-text-secondary"}):e.jsx(Js,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary hover:fill-theme-text-secondary"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-x-auto overflow-y-auto",children:e.jsx("div",{className:i?"min-w-full":"flex w-full min-w-full",children:e.jsx("div",{className:"flex-1 bg-theme-surface-primary",children:xe.map((C,F)=>{const w=me+F;return e.jsx(xn,{entry:C,searchTerm:p,textWrapEnabled:i,highlightedMessage:I(C.message,w)},C.id)})})})}),q>1&&e.jsx("div",{className:"border-t border-theme-border-minimal bg-theme-surface-secondary px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-theme-text-secondary",children:["Showing ",me+1," to"," ",Math.min(me+r,se.length)," of"," ",se.length," logs"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"bg-theme-surface-primary",size:"md",intent:"secondary",emphasis:"subtle",onClick:g,disabled:a===1,children:"First"}),e.jsx(E,{className:"bg-theme-surface-primary",size:"md",intent:"secondary",emphasis:"subtle",onClick:x,disabled:a===1,children:"Previous"}),e.jsxs("form",{onSubmit:A.handleSubmit(c),className:"text-sm flex items-center gap-1 text-theme-text-secondary",children:["Page",e.jsx(At,{...A.register("page"),className:"w-10"}),"of ",q]}),e.jsx(E,{className:"bg-theme-surface-primary",size:"md",intent:"secondary",emphasis:"subtle",onClick:j,disabled:a===q,children:"Next"}),e.jsx(E,{className:"bg-theme-surface-primary",size:"md",intent:"secondary",emphasis:"subtle",onClick:L,disabled:a===q,children:"Last"})]})]})})]})]})}function us(t){return t.map(s=>s.originalEntry).join(`
`)}function hr(){return e.jsx("section",{className:"flex h-[calc(100vh_-_270px)] items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"relative mb-2 flex items-center justify-center",children:[e.jsx(Nt,{className:"h-[120px] w-[120px]"}),e.jsx(bn,{})]}),e.jsx("h2",{className:"my-3 text-center text-display-xs font-semibold",children:"Loading the Logs"}),e.jsxs("p",{className:"text-center text-text-lg text-theme-text-secondary",children:["It can take up to a few minutes. ",e.jsx("br",{})," Please wait while we fetch logs from the artifact store."]})]})})}function bn(){return e.jsx("div",{className:"absolute rounded-rounded bg-primary-25 p-3",children:e.jsx(dt,{className:"h-7 w-7 fill-primary-400"})})}function mr({sources:t,selectedSource:s,setSelectedSource:r}){const[a,n]=h.useState(!1);return e.jsxs(ks,{modal:!0,open:a,onOpenChange:n,children:[e.jsx(_s,{asChild:!0,children:e.jsxs(E,{intent:"secondary",emphasis:"subtle",className:"flex items-center gap-0.5 bg-theme-surface-primary capitalize",size:"md",children:[s,e.jsx(Oe,{width:24,height:24,className:"fill-text-primary shrink-0"})]})}),e.jsx(Ts,{className:"px-0",align:"start",children:e.jsxs(Es,{defaultValue:s,className:"rounded-sharp",children:[e.jsx(Ls,{className:"m-0",placeholder:"Search sources...",children:e.jsx(At,{className:"w-full",inputSize:"sm"})}),e.jsxs(Rs,{children:[e.jsx(Os,{children:"No source found."}),e.jsx(Ds,{className:"max-h-[300px] overflow-y-auto",children:t.map(i=>{const l=i.split("/").pop();return e.jsxs(Ps,{keywords:[l??""],className:"group capitalize data-[selected=true]:rounded-sharp",value:i,onSelect:()=>{r(i),n(!1)},children:[i===s?e.jsx(Xs,{width:16,height:16,className:"shrink-0 fill-theme-text-tertiary group-data-[selected=true]:fill-theme-text-brand"}):e.jsx(dt,{width:16,height:16,className:"shrink-0 fill-theme-text-tertiary group-data-[selected=true]:fill-theme-text-brand"}),l]},i)})})]})]})})]})}function vn({runId:t,queries:s}){return["runs",t,"logs",s]}async function Nn({runId:t,queries:s}){const r=it(s).toString(),a=Le(Re.runs.logs(t))+(r?`?${r}`:""),n=await Ae(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok){const i=await n.json().then(l=>Array.isArray(l.detail)?l.detail[1]:l.detail).catch(()=>`Error while fetching logs for run ${t}`);throw new Me({status:n.status,statusText:n.statusText,message:i})}return n.json()}function Cn(t,s){return De({queryKey:vn(t),queryFn:()=>Nn(t),...s})}function wn({runId:t}){const{data:s,isError:r,isPending:a}=te({runId:t});if(a)return e.jsx(S,{className:"h-[200px] w-full"});if(r)return e.jsx("p",{children:"Error loading logs"});const i=s.resources?.log_collection?.map(l=>l.body?.source).filter(l=>l!=null&&l!=null)??[];return i.length<1?e.jsx(Xe,{title:"This pipeline run has no logs",subtitle:"It looks like there are no logs associated with this pipeline run"}):e.jsx(Sn,{sources:i,runId:t})}function Sn({sources:t,runId:s}){const[r,a]=h.useState(t[0]);return e.jsxs("section",{className:"space-y-5",children:[t.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Logs source:"}),t.length>1?e.jsx(mr,{sources:t,selectedSource:r,setSelectedSource:a}):e.jsx("span",{className:"font-semibold capitalize",children:r})]}),e.jsx(kn,{selectedSource:r,runId:s})]})}function kn({selectedSource:t,runId:s}){const r=Cn({runId:s,queries:{source:t}}),a=h.useMemo(()=>r.data?or(r.data):[],[r.data]);return r.isPending?e.jsx(hr,{}):r.isError?e.jsx(Pe,{err:r.error}):r.data.length===0?e.jsx(Xe,{title:"This pipeline run has no logs",subtitle:"It looks like there are no logs associated with this pipeline run"}):e.jsx("div",{className:"h-full w-full",children:e.jsx(ur,{logs:a,reloadLogs:()=>r.refetch()})})}function Zt({metadata:t}){const s=Object.entries(t||{}).filter(([r,a])=>zs(a));return e.jsx(e.Fragment,{children:s.map(([r,a],n)=>e.jsx(he,{data:a,title:r},n))})}function Gt({metadata:t,title:s}){const r=/^<class\s+'.*'>$/,a=Object.entries(t).filter(([i,l])=>!zs(l));if(a.length===0)return null;a.sort((i,l)=>i[0].localeCompare(l[0]));const n=a.reduce((i,[l,d])=>(i[l]=d,i),{});return e.jsx("div",{children:e.jsx(Ee,{headerClassName:"flex items-center gap-2",headerChildren:e.jsx(Na,{copyText:JSON.stringify(n)}),initialOpen:!0,title:s||"Uncategorized",children:e.jsx("dl",{className:"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:a.map(([i,l],d)=>e.jsx(R,{label:e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{className:"cursor-default truncate",children:i}),e.jsx(Y,{className:"max-w-[480px]",children:i})]})}),value:e.jsx(e.Fragment,{children:Fe(l)&&r.test(l)?e.jsx(we,{className:"py-1",highlightCode:!0,code:l}):Fe(l)&&Kr(l)?e.jsx("a",{className:"underline transition-all duration-200 hover:decoration-transparent",href:l,target:"_blank",rel:"noopener noreferrer",children:l}):e.jsx("div",{className:"whitespace-normal",children:Fe(l)?l:JSON.stringify(l)})})},d))})})})}function _n({runId:t}){const{data:s,isError:r}=te({runId:t},{throwOnError:!0});return r?e.jsx("p",{children:"Failed to fetch pipeline run"}):s&&Object.entries(s.metadata?.run_metadata||{}).length<1?e.jsx(le,{icon:e.jsx(lt,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2 text-display-xs font-semibold",children:"No metadata found"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"There are no metadata available."})]})}):e.jsxs("section",{className:"flex flex-col gap-5",children:[s?e.jsx(Gt,{metadata:s.metadata?.run_metadata}):e.jsx(S,{className:"h-[200px] w-full"}),s?e.jsx(Zt,{metadata:s.metadata?.run_metadata}):e.jsx(S,{className:"h-[200px] w-full"})]})}function Tn(){return e.jsx(Kt,{className:"truncate",intent:"error",children:e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsx("p",{className:"truncate",children:"Pipeline run failed. Check orchestrator logs for error details and troubleshooting steps."}),e.jsx(E,{intent:"danger",asChild:!0,children:e.jsx("a",{href:"#orchestrator-collapsible",children:"Review"})})]})})}function En(){return e.jsx(Kt,{className:"truncate",children:e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsx("p",{children:"Pipeline run initializing. Check orchestrator URL and logs for real-time status updates."}),e.jsx(E,{asChild:!0,children:e.jsx("a",{href:"#orchestrator-collapsible",children:"Review"})})]})})}function Ln({runId:t}){const{data:s,isError:r,isPending:a}=te({runId:t}),n=s?.metadata?.run_metadata,i=n?.orchestrator_url,l=n?.orchestrator_logs_url;return r?null:a?e.jsx(S,{className:"h-[100px]"}):s.body?.status==="initializing"&&(l||i)?e.jsx(En,{}):s.body?.status==="failed"&&l?e.jsx(Tn,{}):null}function Rn({deploymentId:t}){const s=De(Qr.detail(t));if(s.isPending)return e.jsx(S,{className:"h-6 w-[100px]"});if(s.isError)return"Not available";const r=s.data;return e.jsx(ct,{to:Be.projects.deployments.detail.overview(t),children:e.jsx(Sa,{size:"sm",status:r.body?.status??void 0})})}function On({runId:t}){const[s,r]=h.useState(!0),[a]=Hs(),n=Bt(),{data:i,isError:l,isPending:d}=te({runId:t},{throwOnError:!0});if(h.useEffect(()=>{if(!a.get("tab")){const N=new URL(window.location.href);N.searchParams.set("tab","overview");const M=`${N.pathname}${N.search}`;n(M,{replace:!0})}},[a,n]),l)return null;if(d)return e.jsx(S,{className:"h-[200px] w-full"});const m=i.body?.status_reason,u=i.metadata?.config.execution_mode,p=i.resources?.source_snapshot,y=i.metadata?.trigger_info?.deployment_id,f=i.resources?.schedule;return e.jsxs(Ze,{open:s,onOpenChange:r,children:[e.jsx(Ge,{className:"flex items-center gap-[10px]",children:e.jsxs(Je,{className:"flex w-full items-center gap-[10px]",children:[e.jsx(Oe,{className:` ${s?"":"-rotate-90"} h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`}),e.jsx("span",{children:"Details"})]})}),e.jsx(Ye,{className:"border-t border-theme-border-moderate bg-theme-surface-primary px-5 py-3",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsx(be,{children:"Id"}),e.jsx(ve,{children:e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[i.id,e.jsx(Te,{copyText:i.id})]})}),e.jsx(be,{children:"Status"}),e.jsx(ve,{children:(()=>{const b=e.jsxs(Ke,{className:"inline-flex items-center gap-0.5",emphasis:"subtle",color:Ct(i.body?.status),children:[e.jsx(ge,{className:"fill-current",status:i.body?.status}),m??i.body?.status]});return m?e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{children:b}),e.jsx(Y,{children:i.body?.status})]})}):b})()}),e.jsx(be,{children:"Pipeline"}),e.jsx(ve,{children:i.resources?.pipeline?e.jsx(Qt,{pipelineId:i.resources?.pipeline?.id,pipelineName:i.resources?.pipeline?.name}):"Not available"}),e.jsx(R,{label:"Snapshot",value:p&&p.name?e.jsx(Wr,{snapshotId:p.id,snapshotName:p.name}):"Not available"}),e.jsx(R,{label:"Deployment",value:y?e.jsx(Rn,{deploymentId:y}):"Not available"}),e.jsx(be,{children:"Execution Mode"}),e.jsx(ve,{children:u?Zr(u):"Not available"}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center space-x-0.5 truncate",children:[e.jsx("span",{className:"truncate",children:"Repository/Commit"}),e.jsx(ae,{children:e.jsxs(G,{children:[e.jsxs(J,{className:"cursor-default",children:[e.jsx(qe,{className:"h-3 w-3 fill-theme-text-secondary"}),e.jsx("span",{className:"sr-only",children:"Info"})]}),e.jsx(Y,{className:"w-full max-w-md whitespace-normal",children:"Git hash of code repository. Only set if pipeline was run in a clean git repository connected to your ZenML server."})]})})]})}),e.jsx(ve,{className:"h-auto",children:i.resources?.code_reference?e.jsx(er,{repositoryId:i.resources?.code_reference.body?.code_repository.id,commit:i.resources?.code_reference.body?.commit}):"Not available"}),f&&e.jsx(R,{label:"Triggered by",value:e.jsx(wa,{})}),e.jsx(be,{className:i.metadata?.code_path?"col-span-3":"",children:e.jsxs("div",{className:"flex items-center space-x-0.5 truncate",children:[e.jsx("span",{children:"Code Path"}),e.jsx(ae,{children:e.jsxs(G,{children:[e.jsxs(J,{className:"cursor-default",children:[e.jsx(qe,{className:"h-3 w-3 fill-theme-text-secondary"}),e.jsx("span",{className:"sr-only",children:"Info"})]}),e.jsx(Y,{className:"w-full max-w-md whitespace-normal",children:"Path to where code was uploaded in the artifact store. Only set on a pipeline with a non-local orchestrator and if Repository/Commit is not set"})]})})]})}),e.jsx(ve,{className:i.metadata?.code_path?"col-span-3 h-auto":"",children:i.metadata?.code_path?e.jsx(we,{className:"overflow-hidden",code:i.metadata.code_path}):"Not available"}),e.jsx(be,{children:"Author"}),e.jsx(ve,{children:e.jsx("div",{className:"inline-flex items-center gap-1",children:e.jsx(Mt,{avatarUrl:i.resources?.user?.body?.avatar_url??void 0,username:i.resources?.user?.name??"Unknown",isServiceAccount:!!i.resources?.user?.body?.is_service_account})})}),e.jsx(be,{children:"Start Time"}),e.jsx(ve,{children:i.metadata?.start_time?e.jsx($e,{dateString:i.metadata?.start_time}):"Not available"}),e.jsx(be,{children:"End Time"}),e.jsx(ve,{children:i.metadata?.end_time?e.jsx($e,{dateString:i.metadata?.end_time}):"Not available"}),e.jsx(be,{children:"Duration"}),e.jsx(ve,{children:i.metadata?.start_time&&i.metadata?.end_time?As(i.metadata?.start_time,i.metadata?.end_time):"Not available"})]})})]})}function xr(){return e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(Ke,{color:"yellow",className:"flex items-center gap-0.5",rounded:!1,emphasis:"subtle",children:[e.jsx(Ys,{className:"h-4 w-4 shrink-0 fill-current"}),"Login Required"]})}),e.jsx(Y,{children:e.jsxs("p",{children:["You must be logged in for this link to work.",e.jsx("br",{}),"Please ensure you're signed in before accessing."]})})]})})}function Dn({runId:t}){const[s,r]=h.useState(!0),{data:a,isError:n,isPending:i}=te({runId:t}),l=a?.metadata?.run_metadata,d=l?.orchestrator_url,m=a?.metadata?.orchestrator_run_id,u=l?.orchestrator_logs_url;return n?null:i?e.jsx(S,{className:"h-[200px]"}):e.jsxs(Ze,{open:s,onOpenChange:r,children:[e.jsx(Ge,{className:"flex items-center gap-[10px]",children:e.jsxs(Je,{className:"flex w-full",children:[e.jsx(Oe,{className:` ${s?"":"-rotate-90"} mr-2 h-5 w-5 rounded-md fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200`}),e.jsx("p",{id:"orchestrator-collapsible",children:"Orchestrator"})]})}),e.jsx(Ye,{className:"space-y-3 border-t border-theme-border-moderate bg-theme-surface-primary px-5 py-3",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsx(R,{label:"Orchestrator URL",value:d&&Fe(d)?e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("a",{className:"truncate text-theme-text-brand underline transition-all duration-200 hover:decoration-transparent",rel:"noopener noreferrer",target:"_blank",href:d,children:d}),e.jsx(Te,{copyText:d})]}):"Not available"}),e.jsx(R,{label:"Orchestrator Logs",value:u&&Fe(u)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xr,{}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("a",{className:"truncate text-theme-text-brand underline transition-all duration-200 hover:decoration-transparent",rel:"noopener noreferrer",target:"_blank",href:u,children:u}),e.jsx(Te,{copyText:u})]})]}):"Not available"}),e.jsx(R,{label:"Orchestrator Run ID",value:m?e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[m,e.jsx(Te,{copyText:m})]}):"Not available"})]})})]})}function Pn({runId:t}){const[s,r]=h.useState(!0),{data:a,isError:n,isPending:i}=te({runId:t});if(n)return null;if(i)return e.jsx(S,{className:"h-[200px]"});const l=a.resources?.schedule;if(!l)return null;const d=l.body?.cron_expression,m=l.body?.start_time,u=l.body?.end_time,p=l.body?.interval_second,y=l.body?.catchup,f=l.body?.run_once_start_time;return e.jsxs(Ze,{open:s,onOpenChange:r,children:[e.jsx(Ge,{className:"flex items-center gap-[10px]",children:e.jsxs(Je,{className:"flex w-full items-center gap-2",children:[e.jsx(Ca,{open:s}),e.jsx("p",{id:"schedule-collapsible",children:"Schedule"})]})}),e.jsx(Ye,{className:"space-y-3 border-t border-theme-border-moderate bg-theme-surface-primary px-5 py-3",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsx(R,{label:"Cron",value:d?e.jsx("p",{children:d}):"Not available"}),e.jsx(R,{label:"Start Time",value:m?e.jsx("p",{children:e.jsx($e,{dateString:m})}):"Not available"}),e.jsx(R,{label:"End Time",value:u?e.jsx("p",{children:e.jsx($e,{dateString:u})}):"Not available"}),e.jsx(R,{label:"Interval",value:p?e.jsxs("p",{children:[p," seconds"]}):"Not available"}),e.jsx(R,{label:"Catchup",value:Gr(y)?e.jsx("p",{children:y?"Yes":"No"}):"Not available"}),e.jsx(R,{label:"Run Once Start Time",value:f?e.jsx("p",{children:e.jsx($e,{dateString:f})}):"Not available"})]})})]})}function zn({runId:t}){return e.jsxs("div",{className:"grid grid-cols-1 gap-5",children:[e.jsx(Ln,{runId:t}),e.jsx(On,{runId:t}),e.jsx(Dn,{runId:t}),e.jsx(Pn,{runId:t})]})}function mt({title:t,description:s}){return e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:t}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:s})]})})}function An({runId:t}){const{data:s,isPending:r,isError:a}=te({runId:t}),n=s?.resources?.snapshot?.id,{data:i,isPending:l,isError:d}=De({...ws.detail(n),enabled:!!n});if(a)return e.jsx(mt,{title:"Error Loading Run",description:"Failed to load run details."});if(d)return e.jsx(mt,{title:"Error Loading Snapshot",description:"Failed to load snapshot details."});if(r||l)return e.jsx(S,{className:"h-[250px] w-full"});if(!n)return e.jsx(mt,{title:"No Snapshot",description:"There is no snapshot associated with this run."});const m=i.metadata?.source_code;return m?e.jsx("div",{className:"flex flex-col gap-5",children:e.jsx(Ee,{initialOpen:!0,title:"Pipeline Code",children:e.jsx(we,{fullWidth:!0,highlightCode:!0,wrap:!0,language:"python",code:m})})}):e.jsx(mt,{title:"No Source Code",description:"There is no source code available to display for this pipeline."})}function Mn({runId:t}){const s=te({runId:t},{throwOnError:!0});if(s.isPending)return e.jsx(S,{className:"h-[250px] w-full"});if(s.isError)return e.jsx("p",{children:"Something went wrong fetching the run"});const r=s.data?.resources?.stack?.id;return r?e.jsx(In,{run:s.data,stackId:r}):e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"No Stack"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"There is no stack associated with this run."})]})})}function In({stackId:t,run:s}){const{data:r,isError:a,isPending:n}=sr({stackId:t});if(n)return e.jsx(S,{className:"h-[250px] w-full"});if(a)return e.jsx("p",{children:"Failed to fetch Stack"});const i=s.metadata?.config.settings||{};return e.jsx(tr,{stack:r,objectConfig:i})}function pr({runId:t,selectedTab:s,handleTabChage:r}){return e.jsxs(It,{value:s,onValueChange:r,children:[e.jsxs(Ht,{children:[e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"overview",children:[e.jsx(de,{icon:qe}),e.jsx("span",{children:"Overview"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"stack",children:[e.jsx(de,{icon:Ms}),e.jsx("span",{children:"Stack"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"logs",children:[e.jsx(de,{icon:dt}),e.jsx("span",{children:"Logs"})]}),e.jsxs(ce,{className:"flex items-center gap-2 text-text-md",value:"code",children:[e.jsx(de,{icon:Ks}),e.jsx("span",{children:"Code"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"configuration",children:[e.jsx(de,{icon:lr}),e.jsx("span",{children:"Configuration"})]}),e.jsxs(ce,{className:"flex items-center gap-2 text-text-md",value:"metadata",children:[e.jsx(de,{icon:qt}),e.jsx("span",{children:"Metadata"})]})]}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"overview",children:e.jsx(zn,{runId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"stack",children:e.jsx(Mn,{runId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"logs",children:e.jsx(Ut,{fallbackRender:cn,children:e.jsx(wn,{runId:t})})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"configuration",children:e.jsx(on,{runId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"metadata",children:e.jsx(_n,{runId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"code",children:e.jsx(An,{runId:t})})]})}const Vn=jt.object({tab:jt.enum(["overview","configuration","metadata","stack","logs","code"]).optional().default("overview").catch("overview")});function Fn(){const[t]=Hs(),{tab:s}=Vn.parse({tab:t.get("tab")||void 0});return s}function $n({handlePanelToggle:t}){return e.jsxs("div",{className:"flex items-center gap-4 border-b border-theme-border-moderate bg-theme-surface-primary px-5 py-4",children:[e.jsx(E,{className:"flex h-6 w-6 items-center justify-center bg-transparent p-0.5",intent:"secondary",onClick:()=>t(),children:e.jsx(rn,{className:"h-5 w-5 fill-theme-text-secondary"})}),e.jsx("span",{className:"text-text-xl",children:"Run Insights"})]})}function Bn(){const{runId:t}=Ie(),s=Fn(),r=Bt();function a(n){const i=new URLSearchParams;i.set("tab",n),r(`?${i.toString()}`)}return e.jsx("div",{className:"flex flex-col gap-5 p-5",children:e.jsx(pr,{runId:t,selectedTab:s,handleTabChage:a})})}const qn=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 2C3.55228 2 4 2.44772 4 3V21C4 21.5523 3.55228 22 3 22C2.44772 22 2 21.5523 2 21V3C2 2.44772 2.44772 2 3 2ZM14.7071 4.29289C15.0976 4.68342 15.0976 5.31658 14.7071 5.70711L9.41421 11H21C21.5523 11 22 11.4477 22 12C22 12.5523 21.5523 13 21 13H9.41421L14.7071 18.2929C15.0976 18.6834 15.0976 19.3166 14.7071 19.7071C14.3166 20.0976 13.6834 20.0976 13.2929 19.7071L6.29289 12.7071C5.90237 12.3166 5.90237 11.6834 6.29289 11.2929L13.2929 4.29289C13.6834 3.90237 14.3166 3.90237 14.7071 4.29289Z"}));function Hn({children:t}){return e.jsx("div",{className:"absolute right-4 top-4 flex items-center gap-2",children:t})}function Un({isCollapsed:t,handlePanelToggle:s}){return e.jsx(E,{"aria-label":"Expand details panel",intent:"secondary",className:`h-7 w-7 items-center justify-center border border-neutral-300 bg-theme-surface-primary p-0.5 ${t?"flex":"hidden"}`,onClick:s,children:e.jsx(qn,{className:"h-5 w-5 fill-theme-text-primary"})})}const Kn=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.5971 1.18505C11.8629 1.13038 12.1371 1.13038 12.4029 1.18505C12.7102 1.24824 12.9848 1.40207 13.2032 1.52436C13.2235 1.53575 13.2433 1.54687 13.2627 1.55761L12.7846 2.41823L13.2627 1.55761L20.6627 5.66872C20.6831 5.68009 20.7042 5.6917 20.7258 5.70359C20.9569 5.8309 21.2476 5.99097 21.4707 6.23315L21.1563 6.52296L21.4707 6.23315C21.6637 6.44253 21.8097 6.6907 21.899 6.96105C22.0024 7.27375 22.0011 7.60553 22.0002 7.8694C22.0001 7.89406 22 7.91813 22 7.94153V12.0001C22 12.5524 21.5523 13.0001 21 13.0001C20.4477 13.0001 20 12.5524 20 12.0001V8.69955L17.0029 10.3646C16.992 10.3709 16.9811 10.377 16.9701 10.3829L13 12.5885L13 20.4443C13.3511 20.4447 13.6916 20.6302 13.8742 20.9589C14.1424 21.4417 13.9684 22.0505 13.4856 22.3187L13.2627 22.4426C13.2433 22.4533 13.2235 22.4644 13.2032 22.4758C12.9848 22.5981 12.7102 22.7519 12.4029 22.8151C12.1371 22.8698 11.8629 22.8698 11.5971 22.8151C11.2898 22.7519 11.0152 22.5981 10.7968 22.4758C10.7765 22.4644 10.7567 22.4533 10.7373 22.4426L3.33733 18.3314C3.31688 18.3201 3.2958 18.3085 3.27421 18.2966C3.04308 18.1693 2.75245 18.0092 2.52927 17.767C2.33632 17.5576 2.1903 17.3095 2.10097 17.0391C1.99765 16.7264 1.99886 16.3946 1.99982 16.1308C1.99991 16.1061 2 16.082 2 16.0586V7.94153C2 7.91813 1.99991 7.89406 1.99982 7.8694C1.99886 7.60553 1.99765 7.27375 2.10097 6.96105C2.1903 6.69069 2.33632 6.44253 2.52927 6.23315C2.75244 5.99098 3.04306 5.8309 3.27419 5.7036C3.29579 5.6917 3.31687 5.68009 3.33733 5.66872L3.33733 5.66872L6.99904 3.63444C7.00862 3.62891 7.01828 3.62354 7.02802 3.61834L10.7373 1.55761C10.7567 1.54687 10.7765 1.53575 10.7968 1.52437C11.0152 1.40207 11.2898 1.24824 11.5971 1.18505ZM7.5 5.64404L5.05914 7.00008L12 10.8561L14.4408 9.50006L7.5 5.64404ZM16.5 8.3561L9.55913 4.50008L11.7086 3.30592C11.8602 3.22174 11.9375 3.1792 11.9952 3.15136C11.9969 3.15056 11.9985 3.1498 12 3.14907C12.0015 3.1498 12.0031 3.15056 12.0048 3.15136C12.0625 3.1792 12.1398 3.22173 12.2914 3.30592L18.9408 7.00006L16.5 8.3561ZM11 12.5885L4 8.69959V16.0586C4 16.2416 4.00042 16.3353 4.0045 16.4031C4.00462 16.4051 4.00475 16.407 4.00487 16.4088C4.0064 16.4098 4.00802 16.4108 4.00971 16.4119C4.067 16.4484 4.14867 16.4943 4.30862 16.5831L3.82297 17.4573L4.30862 16.5831L11 20.3006L11 12.5885ZM19 16.0001C17.8954 16.0001 17 16.8955 17 18.0001C17 19.1047 17.8954 20.0001 19 20.0001C20.1046 20.0001 21 19.1047 21 18.0001C21 16.8955 20.1046 16.0001 19 16.0001ZM15 18.0001C15 15.7909 16.7909 14.0001 19 14.0001C21.2091 14.0001 23 15.7909 23 18.0001C23 18.8713 22.7215 19.6775 22.2486 20.3344L22.7071 20.793C23.0976 21.1835 23.0976 21.8167 22.7071 22.2072C22.3166 22.5977 21.6834 22.5977 21.2929 22.2072L20.7052 21.6195C20.1879 21.8636 19.6099 22.0001 19 22.0001C16.7909 22.0001 15 20.2092 15 18.0001Z"})),hs=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.16146 2H17.8385C18.3657 1.99998 18.8205 1.99997 19.195 2.03057C19.5904 2.06287 19.9836 2.13419 20.362 2.32698C20.9265 2.6146 21.3854 3.07354 21.673 3.63803C21.8658 4.01641 21.9371 4.40963 21.9694 4.80497C22 5.17954 22 5.6343 22 6.16144V17.8386C22 18.3657 22 18.8205 21.9694 19.195C21.9371 19.5904 21.8658 19.9836 21.673 20.362C21.3854 20.9265 20.9265 21.3854 20.362 21.673C19.9836 21.8658 19.5904 21.9371 19.195 21.9694C18.8205 22 18.3657 22 17.8386 22H6.16144C5.6343 22 5.17954 22 4.80497 21.9694C4.40963 21.9371 4.01641 21.8658 3.63803 21.673C3.07354 21.3854 2.6146 20.9265 2.32698 20.362C2.13419 19.9836 2.06287 19.5904 2.03057 19.195C1.99997 18.8205 1.99998 18.3657 2 17.8385V6.16146C1.99998 5.63431 1.99997 5.17955 2.03057 4.80497C2.06287 4.40963 2.13419 4.01641 2.32698 3.63803C2.6146 3.07354 3.07354 2.6146 3.63803 2.32698C4.01641 2.13419 4.40963 2.06287 4.80497 2.03057C5.17955 1.99997 5.63431 1.99998 6.16146 2ZM4 10.4649V17.8C4 18.3766 4.00078 18.7488 4.02393 19.0322C4.04612 19.3038 4.0838 19.4045 4.109 19.454C4.20487 19.6422 4.35785 19.7951 4.54601 19.891C4.59546 19.9162 4.69617 19.9539 4.96784 19.9761C5.25117 19.9992 5.62345 20 6.2 20H8L8 15.5681C7.99997 15.3157 7.99994 15.0699 8.01695 14.8618C8.03562 14.6332 8.07969 14.3634 8.21799 14.092C8.40974 13.7157 8.7157 13.4097 9.09202 13.218C9.36344 13.0797 9.63318 13.0356 9.86177 13.0169C10.0699 12.9999 10.3157 13 10.5681 13H13.4319C13.6843 13 13.9301 12.9999 14.1382 13.0169C14.3668 13.0356 14.6366 13.0797 14.908 13.218C15.2843 13.4097 15.5903 13.7157 15.782 14.092C15.9203 14.3634 15.9644 14.6332 15.9831 14.8618C16.0001 15.0699 16 15.3157 16 15.5681L16 20H17.8C18.3766 20 18.7488 19.9992 19.0322 19.9761C19.3038 19.9539 19.4045 19.9162 19.454 19.891C19.6422 19.7951 19.7951 19.6422 19.891 19.454C19.9162 19.4045 19.9539 19.3038 19.9761 19.0322C19.9992 18.7488 20 18.3766 20 17.8V10.4649C19.4117 10.8052 18.7286 11 18 11C16.8053 11 15.7329 10.4762 15 9.64583C14.2671 10.4762 13.1947 11 12 11C10.8053 11 9.73295 10.4762 9 9.64582C8.26706 10.4762 7.19469 11 6 11C5.27143 11 4.58835 10.8052 4 10.4649ZM10 7C10 8.10457 10.8954 9 12 9C13.1046 9 14 8.10457 14 7C14 6.44772 14.4477 6 15 6C15.5523 6 16 6.44772 16 7C16 8.10457 16.8954 9 18 9C19.1046 9 20 8.10457 20 7V6.2C20 5.62345 19.9992 5.25118 19.9761 4.96784C19.9539 4.69617 19.9162 4.59546 19.891 4.54601C19.7951 4.35785 19.6422 4.20487 19.454 4.109C19.4045 4.0838 19.3038 4.04612 19.0322 4.02393C18.7488 4.00078 18.3766 4 17.8 4H6.2C5.62345 4 5.25117 4.00078 4.96784 4.02393C4.69617 4.04612 4.59546 4.0838 4.54601 4.109C4.35785 4.20487 4.20487 4.35785 4.109 4.54601C4.0838 4.59546 4.04612 4.69617 4.02393 4.96784C4.00078 5.25117 4 5.62345 4 6.2V7C4 8.10457 4.89543 9 6 9C7.10457 9 8 8.10457 8 7C8 6.44772 8.44772 6 9 6C9.55229 6 10 6.44772 10 7ZM14 20V15.6C14 15.3035 13.9992 15.1412 13.9897 15.0246C13.9893 15.02 13.9889 15.0156 13.9886 15.0115C13.9844 15.0111 13.98 15.0107 13.9754 15.0103C13.8588 15.0008 13.6965 15 13.4 15H10.6C10.3035 15 10.1412 15.0008 10.0246 15.0103C10.02 15.0107 10.0156 15.0111 10.0114 15.0115C10.0111 15.0156 10.0107 15.02 10.0103 15.0246C10.0008 15.1412 10 15.3035 10 15.6V20H14Z"}));function Jt({artifactType:t,className:s}){switch(t){case"DataAnalysisArtifact":return e.jsx(Kn,{className:s});case"DataArtifact":return e.jsx(_a,{className:s});case"ModelArtifact":return e.jsx(Ea,{className:s});case"SchemaArtifact":return e.jsx(ka,{className:s});case"ServiceArtifact":return e.jsx(hs,{className:s});case"StatisticsArtifact":return e.jsx(hs,{className:s});default:return e.jsx(lt,{className:s})}}function ut({children:t}){return e.jsxs(e.Fragment,{children:[e.jsx(ns,{style:{border:"transparent",top:0,background:"transparent",width:0,height:0},type:"target",position:is.Top}),e.jsx("div",{className:"flex w-[300px] items-center justify-center [&>*]:pointer-events-auto",children:t}),e.jsx(ns,{isConnectable:!1,type:"source",style:{border:"transparent",bottom:0,background:"transparent",width:0,height:0},position:is.Bottom})]})}function fr({className:t,code:s,type:r,...a}){const[n,i]=h.useState(!1),[l,d]=h.useState(!1);function m(u){navigator.clipboard&&(navigator.clipboard.writeText(u),i(!0),d(!0),setTimeout(()=>{d(!1),i(!1)},2e3))}return e.jsx(ae,{children:e.jsxs(G,{open:l,onOpenChange:d,children:[e.jsx(J,{asChild:!0,children:e.jsx("div",{...a,className:Jr("hidden cursor-pointer items-center justify-center transition-all group-hover:flex",t),onClick:u=>{u.stopPropagation(),m(s)}})}),e.jsx(Y,{className:"w-full max-w-md whitespace-normal transition-opacity",children:n?"Copied!":`Copy code to load ${r}`})]})})}const gr=h.createContext(null);function jr({children:t}){const[s,r]=h.useState({isOpen:!1,lastContent:null}),a=h.useCallback(m=>{r({isOpen:!0,lastContent:{type:"step",id:m}})},[]),n=h.useCallback(m=>{r({isOpen:!0,lastContent:{type:"triggered_run",id:m}})},[]),i=h.useCallback(m=>{r({isOpen:!0,lastContent:{type:"artifact",id:m}})},[]),l=h.useCallback(()=>{r(m=>({...m,isOpen:!1}))},[]),d=h.useMemo(()=>({sheetState:s,openStepSheet:a,openArtifactSheet:i,openTriggeredRunSheet:n,closeSheet:l}),[s,a,i,n,l]);return e.jsx(gr.Provider,{value:d,children:t})}function He(){const t=h.useContext(gr);if(!t)throw new Error("useSheetContext must be used within a SheetProvider");return t}function Qn({data:t,selected:s}){const{openArtifactSheet:r}=He();function a(i){const l=i.split(".");return l[l.length-1]}function n(){r(t.artifact_id)}return e.jsx(ut,{children:e.jsxs("button",{onClick:n,"data-selected":!!s,className:"group flex h-[50px] min-w-0 max-w-[300px] items-center justify-center gap-1 rounded-rounded border border-primary-100 bg-primary-25 py-1 pl-1 pr-2 transition-all duration-200 hover:border-primary-400 data-[selected=true]:border-primary-500 data-[selected=true]:bg-primary-500",children:[e.jsx("div",{className:"rounded-rounded bg-primary-50 p-0.5 group-data-[selected=true]:bg-white/20",children:e.jsx(Jt,{className:"h-4 w-4 fill-primary-400 group-data-[selected=true]:fill-theme-text-negative",artifactType:t.type})}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("p",{className:"truncate text-text-sm font-semibold text-theme-text-brand group-data-[selected=true]:text-theme-text-negative",children:t.artifact_name}),e.jsx("p",{className:"truncate text-text-xs text-theme-text-secondary group-data-[selected=true]:text-white/70",children:a(t.data_type)})]}),e.jsxs(fr,{className:"h-4 w-4 shrink-0 rounded-sm hover:bg-primary-100 active:bg-primary-200",code:Zs(t.artifact_id),type:"artifact",children:[e.jsx(zt,{className:"h-3 w-3 fill-primary-400"}),e.jsx("div",{className:"sr-only",children:"Copy code to load artifact"})]})]})})}const Wn=h.memo(Qn),Zn=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.7587 2L8 2C8.55229 2 9 2.44772 9 3C9 3.55229 8.55229 4 8 4H7.8C6.94342 4 6.36113 4.00078 5.91104 4.03755C5.47262 4.07337 5.24842 4.1383 5.09202 4.21799C4.7157 4.40973 4.40973 4.7157 4.21799 5.09202C4.1383 5.24842 4.07337 5.47262 4.03755 5.91104C4.00078 6.36113 4 6.94342 4 7.8V8C4 8.55229 3.55229 9 3 9C2.44772 9 2 8.55229 2 8L2 7.7587C1.99999 6.95373 1.99998 6.28937 2.04419 5.74817C2.09012 5.18608 2.18868 4.66937 2.43597 4.18404C2.81947 3.43139 3.43139 2.81947 4.18404 2.43597C4.66937 2.18868 5.18608 2.09012 5.74817 2.04419C6.28937 1.99998 6.95373 1.99999 7.7587 2ZM18.089 4.03755C17.6389 4.00078 17.0566 4 16.2 4H16C15.4477 4 15 3.55229 15 3C15 2.44772 15.4477 2 16 2L16.2413 2C17.0463 1.99999 17.7106 1.99998 18.2518 2.04419C18.8139 2.09012 19.3306 2.18868 19.816 2.43598C20.5686 2.81947 21.1805 3.43139 21.564 4.18404C21.8113 4.66937 21.9099 5.18608 21.9558 5.74817C22 6.28936 22 6.95372 22 7.75868V8C22 8.55229 21.5523 9 21 9C20.4477 9 20 8.55229 20 8V7.8C20 6.94342 19.9992 6.36113 19.9624 5.91104C19.9266 5.47262 19.8617 5.24842 19.782 5.09202C19.5903 4.7157 19.2843 4.40973 18.908 4.21799C18.7516 4.1383 18.5274 4.07337 18.089 4.03755ZM3 15C3.55229 15 4 15.4477 4 16V16.2C4 17.0566 4.00078 17.6389 4.03755 18.089C4.07337 18.5274 4.1383 18.7516 4.21799 18.908C4.40973 19.2843 4.7157 19.5903 5.09202 19.782C5.24842 19.8617 5.47262 19.9266 5.91104 19.9624C6.36113 19.9992 6.94342 20 7.8 20H8C8.55229 20 9 20.4477 9 21C9 21.5523 8.55229 22 8 22H7.75868C6.95372 22 6.28936 22 5.74817 21.9558C5.18608 21.9099 4.66937 21.8113 4.18404 21.564C3.43139 21.1805 2.81947 20.5686 2.43597 19.816C2.18868 19.3306 2.09012 18.8139 2.04419 18.2518C1.99998 17.7106 1.99999 17.0463 2 16.2413L2 16C2 15.4477 2.44772 15 3 15ZM21 15C21.5523 15 22 15.4477 22 16V16.2413C22 17.0463 22 17.7106 21.9558 18.2518C21.9099 18.8139 21.8113 19.3306 21.564 19.816C21.1805 20.5686 20.5686 21.1805 19.816 21.564C19.3306 21.8113 18.8139 21.9099 18.2518 21.9558C17.7106 22 17.0463 22 16.2413 22H16C15.4477 22 15 21.5523 15 21C15 20.4477 15.4477 20 16 20H16.2C17.0566 20 17.6389 19.9992 18.089 19.9624C18.5274 19.9266 18.7516 19.8617 18.908 19.782C19.2843 19.5903 19.5903 19.2843 19.782 18.908C19.8617 18.7516 19.9266 18.5274 19.9624 18.089C19.9992 17.6389 20 17.0566 20 16.2V16C20 15.4477 20.4477 15 21 15Z"})),kt=t=>h.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 12C4 11.4477 4.44772 11 5 11H19C19.5523 11 20 11.4477 20 12C20 12.5523 19.5523 13 19 13H5C4.44772 13 4 12.5523 4 12Z"}));function Gn(){const{getNodes:t,fitView:s,setViewport:r}=rr(),[a,n]=h.useState(""),[i,l]=h.useState(null),[d,m]=h.useState([]),u=h.useCallback(f=>{s({nodes:[f],maxZoom:1.2})},[s]);h.useEffect(()=>{if(!a){l(null),m([]);return}const b=t().filter(N=>N.data?.step_name?.toLowerCase().includes(a.toLowerCase())||N.data?.artifact_name?.toLowerCase().includes(a.toLowerCase())||N.data?.node_name?.toLowerCase().includes(a.toLowerCase())).sort((N,M)=>{const O=N.position.y-M.position.y;return O!==0?O:N.position.x-M.position.x});m(b),l(null)},[a,t,r]);function p(){if(d.length===0)return;const f=(i??-1)+1;f>=d.length?l(0):l(f);const b=d[f>=d.length?0:f];u(b)}function y(){if(d.length===0)return;const f=(i??d.length)-1;f<0?l(d.length-1):l(f);const b=d[f<0?d.length-1:f];u(b)}return{search:a,setSearch:n,currentIndex:i,filteredNodes:d,zoomNext:p,zoomPrevious:y}}function Jn(t){h.useEffect(()=>{const s=r=>{(navigator.userAgent.toUpperCase().indexOf("MAC")!==-1?r.metaKey:r.ctrlKey)&&r.key.toLowerCase()==="k"&&(r.preventDefault(),t(i=>!i))};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}})}function Yn(){const[t,s]=h.useState(!1),r=h.useRef(null);Jn(s);const{search:a,setSearch:n,currentIndex:i,filteredNodes:l,zoomNext:d,zoomPrevious:m}=Gn();h.useEffect(()=>{if(t&&r.current){const p=setTimeout(()=>{r.current?.focus()},200);return()=>clearTimeout(p)}},[t]);function u(p){p.preventDefault(),d()}return e.jsxs(Is,{"data-state":t?"open":"closed",className:"flex h-7 w-7 items-center gap-1 overflow-hidden rounded-md border-neutral-300 transition-all duration-200 data-[state=open]:w-[350px]",children:[e.jsx(E,{intent:"secondary",emphasis:"subtle",onClick:()=>s(!t),className:"flex aspect-square h-full items-center justify-center border-none border-transparent bg-theme-surface-primary",children:e.jsx(Vs,{className:"size-4 shrink-0 fill-theme-text-primary"})}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:u,className:"relative",children:[e.jsx(Fs,{ref:r,className:"h-5 w-[150px] rounded-sm p-1 pr-5 text-text-xs",placeholder:"Search",value:a,onChange:p=>n(p)}),e.jsxs(E,{type:"button",onClick:()=>n(""),intent:"secondary",emphasis:"subtle",className:"absolute right-0.5 top-1/2 flex aspect-square size-3 -translate-y-1/2 items-center justify-center rounded-sm border-none p-0",children:[e.jsx("span",{className:"sr-only",children:"Clear search"}),e.jsx(Yr,{className:"size-3 shrink-0 fill-theme-text-tertiary group-disabled:fill-theme-text-tertiary/40"})]})]}),e.jsx("p",{className:"whitespace-nowrap text-text-xs text-theme-text-secondary",children:l.length>0?i===null?`${l.length} ${l.length===1?"match":"matches"}`:`${i+1} of ${l.length}`:"No matches"}),e.jsxs("div",{className:"ml-auto flex items-center gap-1 pr-1",children:[e.jsx(E,{disabled:l.length===0,intent:"secondary",size:"sm",className:"group flex aspect-square size-3 items-center justify-center rounded-sm bg-theme-surface-primary",onClick:m,children:e.jsx(nt,{className:"size-3 shrink-0 rotate-90 fill-theme-text-tertiary group-disabled:fill-theme-text-tertiary/40"})}),e.jsx(E,{disabled:l.length===0,intent:"secondary",size:"sm",className:"group flex aspect-square size-3 items-center justify-center rounded-sm bg-theme-surface-primary",onClick:d,children:e.jsx(nt,{className:"size-3 shrink-0 -rotate-90 fill-theme-text-tertiary group-disabled:fill-theme-text-tertiary/40"})})]})]})]})}function Xn({refetch:t,viewSwitcher:s}){const{fitView:r,zoomIn:a,zoomOut:n}=rr();return e.jsxs("div",{"aria-label":"Dag Controls",className:"absolute left-4 top-4 z-10 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s,e.jsx(Yn,{})]}),e.jsxs("div",{className:"w-fit divide-y divide-neutral-300 overflow-hidden rounded-md border border-neutral-300 bg-theme-surface-primary",children:[e.jsx("div",{children:e.jsx(E,{onClick:()=>a(),emphasis:"subtle",className:"rounded-sharp border-none p-0.5",intent:"secondary",children:e.jsx(qs,{className:"h-5 w-5 fill-theme-text-primary"})})}),e.jsx("div",{children:e.jsx(E,{onClick:()=>n(),emphasis:"subtle",className:"rounded-sharp border-none bg-theme-surface-primary p-0.5",intent:"secondary",children:e.jsx(kt,{className:"h-5 w-5 fill-theme-text-primary"})})})]}),e.jsx(E,{className:"h-6 w-6 bg-theme-surface-primary p-0.5",onClick:()=>r(),emphasis:"subtle",intent:"secondary",children:e.jsx(Zn,{className:"h-5 w-5 fill-theme-text-primary"})}),e.jsxs(E,{className:"h-6 w-6 bg-theme-surface-primary p-0.5",onClick:()=>{t()},emphasis:"subtle",intent:"secondary",children:[e.jsx("span",{className:"sr-only",children:"Refresh"}),e.jsx(St,{className:"h-5 w-5 fill-theme-text-primary"})]})]})}const ei=4;function ti(t){const s=h.useMemo(()=>t.data?.points??[],[t.data?.points]),r=h.useMemo(()=>s.reduce((a,n,i)=>{if(i===0)return`M ${n.x},${n.y}`;if(i===s.length-1)return`${a} L ${n.x},${n.y}`;{const l=s[i-1],d=s[i+1],m=n.x-l.x,u=n.y-l.y,p=d.x-n.x,y=d.y-n.y,f=Math.sqrt(m*m+u*u),b=Math.sqrt(p*p+y*y),N=Math.min(ei,f/2,b/2),M=n.x-m/f*N,O=n.y-u/f*N,I=n.x+p/b*N,se=n.y+y/b*N;return`${a} L ${M},${O} Q ${n.x},${n.y} ${I},${se}`}},""),[s]);return s.length?e.jsx(La,{...t,path:r}):null}const yr=h.createContext(null);function si({children:t}){const[s,r]=h.useState(new Set),a=i=>s.has(i),n=i=>{r(l=>{const d=new Set(l);return d.add(i),d})};return e.jsx(yr.Provider,{value:{confirmedVisualizations:s,isVisualizationConfirmed:a,confirmVisualization:n},children:t})}function br(){const t=h.useContext(yr);if(!t)throw new Error("useArtifactLoadConfirmationContext must be used within a VisualizationConfirmProvider");return t}function ri({versionId:t}){return["artifact_versions",t]}async function ai({versionId:t}){const s=Le(Re.artifactVersions.detail(t)),r=await Ae(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(r.status===404&&Vt(),!r.ok)throw new Me({message:`Error while fetching artifact version ${t}`,status:r.status,statusText:r.statusText});return r.json()}function et(t,s){return De({queryKey:ri(t),queryFn:()=>ai(t),...s})}function ni({stepId:t}){return["steps",t]}async function ii({stepId:t}){const s=Le(Re.steps.detail(t)),r=await Ae(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(r.status===404&&Vt(),!r.ok)throw new Me({message:`Error while fetching step ${t}`,status:r.status,statusText:r.statusText});return r.json()}function Ue(t,s){return De({queryKey:ni(t),queryFn:()=>ii(t),...s})}async function li({artifactVersionId:t}){const s=Le(Re.artifactVersions.downloadToken(t)),r=await Ae(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok){const a=await r.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Error while fetching artifact download token");throw new Me({status:r.status,statusText:r.statusText,message:a})}return r.json()}function oi(t){return $t({...t,mutationFn:async s=>li(s)})}function ci({artifactVersionId:t}){const{toast:s}=bt(),r=Le(Re.artifactVersions.data(t)),{mutate:a,isPending:n}=oi({onSuccess:l=>{window.open(`${r}?${new URLSearchParams({token:l})}`,"_blank")},onError:l=>{s({status:"error",emphasis:"subtle",rounded:!0,description:l.message})}});function i(){a({artifactVersionId:t})}return e.jsx(E,{onClick:i,disabled:n,type:"button",children:"Download"})}function di({artifactVersionId:t}){const s=et({versionId:t}),r=s.data?.resources?.producer_pipeline_run_id,a=s.data?.resources?.producer_step_run_id;return s.isPending?e.jsx(S,{className:"h-[500px] w-full"}):s.isError?e.jsx(Pe,{err:s.error}):e.jsx(Ee,{initialOpen:!0,title:"Details",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[r&&e.jsx(hi,{producerRunId:r}),a&&e.jsx(ui,{producerStepId:a}),e.jsx(R,{label:"Materializer",value:e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{className:"cursor-default",children:s.data.body?.materializer.attribute}),e.jsxs(Y,{align:"start",children:[s.data.body?.materializer.module,".",s.data.body?.materializer.attribute]})]})})}),e.jsx(R,{label:"Type",value:s.data.body?.type}),s.data.resources?.user&&e.jsx(R,{label:"Author",value:e.jsx("div",{className:"inline-flex items-center gap-1",children:e.jsx(Mt,{avatarUrl:s.data.resources.user.body?.avatar_url??void 0,username:s.data.resources.user.name,isServiceAccount:!!s.data.resources.user.body?.is_service_account})})}),e.jsx(R,{label:"Updated",value:e.jsx($e,{dateString:s.data.body?.updated||""})})]})})}function ui({producerStepId:t}){const s=Ue({stepId:t});return s.isPending?e.jsx(R,{label:"Producer Step",value:e.jsx(S,{className:"h-5 w-full"})}):s.isError?null:e.jsx(R,{label:"Producer Step",value:e.jsx(e.Fragment,{children:s.data?e.jsxs(Ke,{color:Ct("completed"),className:"inline-flex items-center gap-0.5",rounded:!1,emphasis:"subtle",children:[e.jsx(ge,{className:"mr-1 fill-current",status:"completed"}),s.data.name]}):e.jsx(S,{className:"h-full w-[150px]"})})})}function hi({producerRunId:t}){const s=te({runId:t});if(s.isPending)return e.jsx(R,{label:e.jsx(S,{className:"h-5 w-full"}),value:e.jsx(S,{className:"h-5 w-full"})});if(s.isError)return null;const r=s.data.resources?.pipeline;return e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Pipeline",value:r?e.jsx(Qt,{pipelineId:r.id,pipelineName:r.name}):"Not available"}),e.jsx(R,{label:"Producer Run",value:t?e.jsx(ct,{to:Be.projects.runs.detail(t),children:e.jsxs(Ke,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:Ct(s.data.body?.status),children:[e.jsx(wt,{className:"mr-1 h-4 w-4 fill-current"}),t.split("-")[0]]})}):"Not available"})]})}function mi({artifactVersionId:t}){const{data:s,isPending:r,isError:a,error:n}=et({versionId:t}),i=s?.body?.artifact_store_id;return a?e.jsx(Pe,{err:n}):r?e.jsx(S,{className:"h-[500px] w-full"}):e.jsx(Ee,{initialOpen:!0,title:"Data",children:e.jsxs("dl",{className:"grid w-full grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsxs("dt",{className:"col-span-3 flex items-center justify-between text-theme-text-secondary",children:["Uri",e.jsx(ci,{artifactVersionId:t})]}),e.jsx("dd",{className:"col-span-3 w-full truncate text-neutral-700",children:e.jsx("div",{className:"pb-2",children:e.jsx(we,{fullWidth:!0,code:s.body.uri})})}),i&&e.jsx(R,{label:"Artifact Store",value:e.jsx(pi,{artifactStoreId:i})}),e.jsx(R,{label:"Data Type",value:e.jsx(Ke,{className:"flex w-fit items-center text-theme-text-primary",color:"grey",emphasis:"subtle",rounded:!1,children:e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{className:"cursor-auto",children:s.body?.data_type.attribute}),e.jsxs(Y,{children:[s.body?.data_type.module,".",s.body?.data_type.attribute," "]})]})})})})]})})}function xi({artifactVersionId:t}){return e.jsx(Ee,{initialOpen:!0,title:"Code",children:e.jsx(we,{fullWidth:!0,highlightCode:!0,wrap:!0,code:Zs(t)})})}function pi({artifactStoreId:t}){const s=De({...Xr.componentDetail(t)});if(s.isPending)return e.jsx(S,{className:"h-6 w-12"});if(s.isError)return e.jsx("p",{children:"Error loading artifact store"});const r=s.data,a=Be.components.detail(t),n=r.body?.type||"orchestrator",i=r.body?.logo_url;return e.jsx(ct,{to:a,children:e.jsxs(Ke,{emphasis:"subtle",rounded:!1,className:"flex w-fit items-center gap-0.5 text-theme-text-primary",color:"grey",children:[i?e.jsx("img",{alt:r.name,width:20,height:20,className:"shrink-0 object-contain",src:i}):e.jsx(Ta,{className:"aspect-square h-4 w-4 fill-primary-400 object-contain",type:n}),r.name]})})}function fi({artifactVersionId:t}){const{data:s,isError:r,error:a}=et({versionId:t});return r?e.jsx(Pe,{err:a}):e.jsxs("div",{className:"space-y-5",children:[s?e.jsx(di,{artifactVersionId:s.id}):e.jsx(S,{className:"h-[500px] rounded-md lg:col-span-2"}),s?e.jsx(mi,{artifactVersionId:s.id}):e.jsx(S,{className:"h-[500px] rounded-md lg:col-span-2"}),s?e.jsx(xi,{artifactVersionId:s.id}):e.jsx(S,{className:"h-[500px] rounded-md lg:col-span-2"})]})}function gi({artifactVersionId:t}){const{data:s,isError:r,error:a}=et({versionId:t});return r?e.jsx(Pe,{err:a}):!s?.metadata?.run_metadata||Object.keys(s.metadata.run_metadata).length===0?e.jsx(le,{icon:e.jsx(lt,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2 text-display-xs font-semibold",children:"No metadata found"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"There are no metadata available for this artifact."})]})}):e.jsxs("div",{className:"flex flex-col gap-5",children:[s?e.jsx(Gt,{metadata:s.metadata?.run_metadata}):e.jsx(S,{className:"h-9 w-full"}),s?e.jsx(Zt,{metadata:s.metadata?.run_metadata}):e.jsx(S,{className:"h-9 w-full"})]})}function vr({versionId:t,params:s}){return["artifact_versions",t,"visualize",s]}async function ji({versionId:t,params:s={}},r){const a=it(s).toString(),n=Le(Re.artifactVersions.visualize(t)+(a?`?${a}`:"")),i=await Ae(n,{method:"GET",headers:{"Content-Type":"application/json"},signal:r});if(!i.ok){const l=await i.json().then(d=>Array.isArray(d.detail)?d.detail[1]:d.detail).catch(()=>`Error while fetching artifact visualization for ${t}`);throw new Me({status:i.status,statusText:i.statusText,message:l})}return i.json()}function Yt(t,s){return De({queryKey:vr(t),queryFn:({signal:r})=>ji(t,r),...s})}function yi({content:t}){const s=h.useRef(null);return h.useEffect(()=>{const r=s.current;if(!r)return;let a=null;const n=()=>{if(r.contentWindow){const l=r.contentWindow.document.documentElement.scrollHeight;r.style.height=l?`${l}px`:"100%"}},i=()=>{a&&a.disconnect();const l=r.contentWindow?.document.documentElement;l&&(a=new ResizeObserver(()=>{n()}),a.observe(l),n())};return r.addEventListener("load",i),()=>{r.removeEventListener("load",i),a&&a.disconnect()}},[]),e.jsx("div",{children:e.jsx("iframe",{className:"w-full",title:"Secure HTML Content",ref:s,srcDoc:t})})}function bi({content:t}){return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:ea("data:image/png;base64,"+t),alt:"Visualization for artifact"})})}function vi({content:t}){const s=Ni(t);return e.jsx(we,{fullWidth:!0,highlightCode:!0,code:Fe(s)?s:JSON.stringify(s,null,2)})}function Ni(t){try{return JSON.parse(t)}catch{return t}}const Ci={image:"png",html:"html",markdown:"md",csv:"csv",json:"json"},wi={image:"image/png",html:"text/html",markdown:"text/markdown",csv:"text/csv",json:"application/json"};function Nr({artifactVersionId:t,visualizationIndex:s,artifactName:r}){const a={index:s},{data:n,isSuccess:i}=Yt({versionId:t,params:a},{retry:!1});if(!i)return null;const{type:l,value:d}=n;function m(){const p=atob(d),y=new Array(p.length);for(let b=0;b<p.length;b++)y[b]=p.charCodeAt(b);return new Uint8Array(y)}function u(){try{const p=new Blob([l==="image"?m():d],{type:wi[l]}),y=window.URL.createObjectURL(p),f=document.createElement("a");f.href=y,f.download=`${r}_${s}.`+Ci[l],f.click()}catch(p){console.error(p)}}return e.jsxs(E,{intent:"secondary",emphasis:"subtle",size:"md",className:"flex items-center gap-1 bg-theme-surface-primary",onClick:u,children:[e.jsx(Us,{width:24,height:24,className:"shrink-0 fill-theme-text-primary"}),"Download"]})}function Si({content:t,markdownMode:s}){return s==="raw"?e.jsx(we,{code:t,fullWidth:!0,wrap:!0}):e.jsx(ta,{className:"!prose !max-w-none",markdown:t})}var pt={exports:{}};var ki=pt.exports,ms;function _i(){return ms||(ms=1,function(t,s){((r,a)=>{t.exports=a()})(ki,function r(){var a=typeof self<"u"?self:typeof window<"u"?window:a!==void 0?a:{},n,i=!a.document&&!!a.postMessage,l=a.IS_PAPA_WORKER||!1,d={},m=0,u={};function p(o){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(c){var x=je(c);x.chunkSize=parseInt(x.chunkSize),c.step||c.chunk||(x.chunkSize=null),this._handle=new M(x),(this._handle.streamer=this)._config=x}).call(this,o),this.parseChunk=function(c,x){var j=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<j){let L=this._config.newline;L||(g=this._config.quoteChar||'"',L=this._handle.guessLineEndings(c,g)),c=[...c.split(L).slice(j)].join(L)}this.isFirstChunk&&A(this._config.beforeFirstChunk)&&(g=this._config.beforeFirstChunk(c))!==void 0&&(c=g),this.isFirstChunk=!1,this._halted=!1;var j=this._partialLine+c,g=(this._partialLine="",this._handle.parse(j,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(c=g.meta.cursor,j=(this._finished||(this._partialLine=j.substring(c-this._baseIndex),this._baseIndex=c),g&&g.data&&(this._rowCount+=g.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),l)a.postMessage({results:g,workerId:u.WORKER_ID,finished:j});else if(A(this._config.chunk)&&!x){if(this._config.chunk(g,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=g=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(g.data),this._completeResults.errors=this._completeResults.errors.concat(g.errors),this._completeResults.meta=g.meta),this._completed||!j||!A(this._config.complete)||g&&g.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),j||g&&g.meta.paused||this._nextChunk(),g}this._halted=!0},this._sendError=function(c){A(this._config.error)?this._config.error(c):l&&this._config.error&&a.postMessage({workerId:u.WORKER_ID,error:c,finished:!1})}}function y(o){var c;(o=o||{}).chunkSize||(o.chunkSize=u.RemoteChunkSize),p.call(this,o),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(x){this._input=x,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(c=new XMLHttpRequest,this._config.withCredentials&&(c.withCredentials=this._config.withCredentials),i||(c.onload=xe(this._chunkLoaded,this),c.onerror=xe(this._chunkError,this)),c.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var x,j=this._config.downloadRequestHeaders;for(x in j)c.setRequestHeader(x,j[x])}var g;this._config.chunkSize&&(g=this._start+this._config.chunkSize-1,c.setRequestHeader("Range","bytes="+this._start+"-"+g));try{c.send(this._config.downloadRequestBody)}catch(L){this._chunkError(L.message)}i&&c.status===0&&this._chunkError()}},this._chunkLoaded=function(){c.readyState===4&&(c.status<200||400<=c.status?this._chunkError():(this._start+=this._config.chunkSize||c.responseText.length,this._finished=!this._config.chunkSize||this._start>=(x=>(x=x.getResponseHeader("Content-Range"))!==null?parseInt(x.substring(x.lastIndexOf("/")+1)):-1)(c),this.parseChunk(c.responseText)))},this._chunkError=function(x){x=c.statusText||x,this._sendError(new Error(x))}}function f(o){(o=o||{}).chunkSize||(o.chunkSize=u.LocalChunkSize),p.call(this,o);var c,x,j=typeof FileReader<"u";this.stream=function(g){this._input=g,x=g.slice||g.webkitSlice||g.mozSlice,j?((c=new FileReader).onload=xe(this._chunkLoaded,this),c.onerror=xe(this._chunkError,this)):c=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var g=this._input,L=(this._config.chunkSize&&(L=Math.min(this._start+this._config.chunkSize,this._input.size),g=x.call(g,this._start,L)),c.readAsText(g,this._config.encoding));j||this._chunkLoaded({target:{result:L}})},this._chunkLoaded=function(g){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(g.target.result)},this._chunkError=function(){this._sendError(c.error)}}function b(o){var c;p.call(this,o=o||{}),this.stream=function(x){return c=x,this._nextChunk()},this._nextChunk=function(){var x,j;if(!this._finished)return x=this._config.chunkSize,c=x?(j=c.substring(0,x),c.substring(x)):(j=c,""),this._finished=!c,this.parseChunk(j)}}function N(o){p.call(this,o=o||{});var c=[],x=!0,j=!1;this.pause=function(){p.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){p.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(g){this._input=g,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){j&&c.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),c.length?this.parseChunk(c.shift()):x=!0},this._streamData=xe(function(g){try{c.push(typeof g=="string"?g:g.toString(this._config.encoding)),x&&(x=!1,this._checkIsFinished(),this.parseChunk(c.shift()))}catch(L){this._streamError(L)}},this),this._streamError=xe(function(g){this._streamCleanUp(),this._sendError(g)},this),this._streamEnd=xe(function(){this._streamCleanUp(),j=!0,this._streamData("")},this),this._streamCleanUp=xe(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function M(o){var c,x,j,g,L=Math.pow(2,53),U=-L,oe=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,pe=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,C=this,F=0,w=0,K=!1,_=!1,D=[],v={data:[],errors:[],meta:{}};function X(P){return o.skipEmptyLines==="greedy"?P.join("").trim()==="":P.length===1&&P[0].length===0}function Z(){if(v&&j&&(ye("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),j=!1),o.skipEmptyLines&&(v.data=v.data.filter(function(k){return!X(k)})),ne()){let k=function(W,ee){A(o.transformHeader)&&(W=o.transformHeader(W,ee)),D.push(W)};if(v)if(Array.isArray(v.data[0])){for(var P=0;ne()&&P<v.data.length;P++)v.data[P].forEach(k);v.data.splice(0,1)}else v.data.forEach(k)}function V(k,W){for(var ee=o.header?{}:[],$=0;$<k.length;$++){var B=$,z=k[$],z=((Ce,T)=>(H=>(o.dynamicTypingFunction&&o.dynamicTyping[H]===void 0&&(o.dynamicTyping[H]=o.dynamicTypingFunction(H)),(o.dynamicTyping[H]||o.dynamicTyping)===!0))(Ce)?T==="true"||T==="TRUE"||T!=="false"&&T!=="FALSE"&&((H=>{if(oe.test(H)&&(H=parseFloat(H),U<H&&H<L))return 1})(T)?parseFloat(T):pe.test(T)?new Date(T):T===""?null:T):T)(B=o.header?$>=D.length?"__parsed_extra":D[$]:B,z=o.transform?o.transform(z,B):z);B==="__parsed_extra"?(ee[B]=ee[B]||[],ee[B].push(z)):ee[B]=z}return o.header&&($>D.length?ye("FieldMismatch","TooManyFields","Too many fields: expected "+D.length+" fields but parsed "+$,w+W):$<D.length&&ye("FieldMismatch","TooFewFields","Too few fields: expected "+D.length+" fields but parsed "+$,w+W)),ee}var Q;v&&(o.header||o.dynamicTyping||o.transform)&&(Q=1,!v.data.length||Array.isArray(v.data[0])?(v.data=v.data.map(V),Q=v.data.length):v.data=V(v.data,0),o.header&&v.meta&&(v.meta.fields=D),w+=Q)}function ne(){return o.header&&D.length===0}function ye(P,V,Q,k){P={type:P,code:V,message:Q},k!==void 0&&(P.row=k),v.errors.push(P)}A(o.step)&&(g=o.step,o.step=function(P){v=P,ne()?Z():(Z(),v.data.length!==0&&(F+=P.data.length,o.preview&&F>o.preview?x.abort():(v.data=v.data[0],g(v,C))))}),this.parse=function(P,V,Q){var k=o.quoteChar||'"',k=(o.newline||(o.newline=this.guessLineEndings(P,k)),j=!1,o.delimiter?A(o.delimiter)&&(o.delimiter=o.delimiter(P),v.meta.delimiter=o.delimiter):((k=((W,ee,$,B,z)=>{var Ce,T,H,Ve;z=z||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var Qe=0;Qe<z.length;Qe++){for(var Se,st=z[Qe],ie=0,ke=0,re=0,fe=(H=void 0,new I({comments:B,delimiter:st,newline:ee,preview:10}).parse(W)),ze=0;ze<fe.data.length;ze++)$&&X(fe.data[ze])?re++:(Se=fe.data[ze].length,ke+=Se,H===void 0?H=Se:0<Se&&(ie+=Math.abs(Se-H),H=Se));0<fe.data.length&&(ke/=fe.data.length-re),(T===void 0||ie<=T)&&(Ve===void 0||Ve<ke)&&1.99<ke&&(T=ie,Ce=st,Ve=ke)}return{successful:!!(o.delimiter=Ce),bestDelimiter:Ce}})(P,o.newline,o.skipEmptyLines,o.comments,o.delimitersToGuess)).successful?o.delimiter=k.bestDelimiter:(j=!0,o.delimiter=u.DefaultDelimiter),v.meta.delimiter=o.delimiter),je(o));return o.preview&&o.header&&k.preview++,c=P,x=new I(k),v=x.parse(c,V,Q),Z(),K?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return K},this.pause=function(){K=!0,x.abort(),c=A(o.chunk)?"":c.substring(x.getCharIndex())},this.resume=function(){C.streamer._halted?(K=!1,C.streamer.parseChunk(c,!0)):setTimeout(C.resume,3)},this.aborted=function(){return _},this.abort=function(){_=!0,x.abort(),v.meta.aborted=!0,A(o.complete)&&o.complete(v),c=""},this.guessLineEndings=function(W,k){W=W.substring(0,1048576);var k=new RegExp(O(k)+"([^]*?)"+O(k),"gm"),Q=(W=W.replace(k,"")).split("\r"),k=W.split(`
`),W=1<k.length&&k[0].length<Q[0].length;if(Q.length===1||W)return`
`;for(var ee=0,$=0;$<Q.length;$++)Q[$][0]===`
`&&ee++;return ee>=Q.length/2?`\r
`:"\r"}}function O(o){return o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function I(o){var c=(o=o||{}).delimiter,x=o.newline,j=o.comments,g=o.step,L=o.preview,U=o.fastMode,oe=null,pe=!1,C=o.quoteChar==null?'"':o.quoteChar,F=C;if(o.escapeChar!==void 0&&(F=o.escapeChar),(typeof c!="string"||-1<u.BAD_DELIMITERS.indexOf(c))&&(c=","),j===c)throw new Error("Comment character same as delimiter");j===!0?j="#":(typeof j!="string"||-1<u.BAD_DELIMITERS.indexOf(j))&&(j=!1),x!==`
`&&x!=="\r"&&x!==`\r
`&&(x=`
`);var w=0,K=!1;this.parse=function(_,D,v){if(typeof _!="string")throw new Error("Input must be a string");var X=_.length,Z=c.length,ne=x.length,ye=j.length,P=A(g),V=[],Q=[],k=[],W=w=0;if(!_)return ie();if(U||U!==!1&&_.indexOf(C)===-1){for(var ee=_.split(x),$=0;$<ee.length;$++){if(k=ee[$],w+=k.length,$!==ee.length-1)w+=x.length;else if(v)return ie();if(!j||k.substring(0,ye)!==j){if(P){if(V=[],Ve(k.split(c)),ke(),K)return ie()}else Ve(k.split(c));if(L&&L<=$)return V=V.slice(0,L),ie(!0)}}return ie()}for(var B=_.indexOf(c,w),z=_.indexOf(x,w),Ce=new RegExp(O(F)+O(C),"g"),T=_.indexOf(C,w);;)if(_[w]===C)for(T=w,w++;;){if((T=_.indexOf(C,T+1))===-1)return v||Q.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:V.length,index:w}),Se();if(T===X-1)return Se(_.substring(w,T).replace(Ce,C));if(C===F&&_[T+1]===F)T++;else if(C===F||T===0||_[T-1]!==F){B!==-1&&B<T+1&&(B=_.indexOf(c,T+1));var H=Qe((z=z!==-1&&z<T+1?_.indexOf(x,T+1):z)===-1?B:Math.min(B,z));if(_.substr(T+1+H,Z)===c){k.push(_.substring(w,T).replace(Ce,C)),_[w=T+1+H+Z]!==C&&(T=_.indexOf(C,w)),B=_.indexOf(c,w),z=_.indexOf(x,w);break}if(H=Qe(z),_.substring(T+1+H,T+1+H+ne)===x){if(k.push(_.substring(w,T).replace(Ce,C)),st(T+1+H+ne),B=_.indexOf(c,w),T=_.indexOf(C,w),P&&(ke(),K))return ie();if(L&&V.length>=L)return ie(!0);break}Q.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:V.length,index:w}),T++}}else if(j&&k.length===0&&_.substring(w,w+ye)===j){if(z===-1)return ie();w=z+ne,z=_.indexOf(x,w),B=_.indexOf(c,w)}else if(B!==-1&&(B<z||z===-1))k.push(_.substring(w,B)),w=B+Z,B=_.indexOf(c,w);else{if(z===-1)break;if(k.push(_.substring(w,z)),st(z+ne),P&&(ke(),K))return ie();if(L&&V.length>=L)return ie(!0)}return Se();function Ve(re){V.push(re),W=w}function Qe(re){var fe=0;return fe=re!==-1&&(re=_.substring(T+1,re))&&re.trim()===""?re.length:fe}function Se(re){return v||(re===void 0&&(re=_.substring(w)),k.push(re),w=X,Ve(k),P&&ke()),ie()}function st(re){w=re,Ve(k),k=[],z=_.indexOf(x,w)}function ie(re){if(o.header&&!D&&V.length&&!pe){var fe=V[0],ze={},_t=new Set(fe);let es=!1;for(let We=0;We<fe.length;We++){let _e=fe[We];if(ze[_e=A(o.transformHeader)?o.transformHeader(_e,We):_e]){let rt,ts=ze[_e];for(;rt=_e+"_"+ts,ts++,_t.has(rt););_t.add(rt),fe[We]=rt,ze[_e]++,es=!0,(oe=oe===null?{}:oe)[rt]=_e}else ze[_e]=1,fe[We]=_e;_t.add(_e)}es&&console.warn("Duplicate headers found and renamed."),pe=!0}return{data:V,errors:Q,meta:{delimiter:c,linebreak:x,aborted:K,truncated:!!re,cursor:W+(D||0),renamedHeaders:oe}}}function ke(){g(ie()),V=[],Q=[]}},this.abort=function(){K=!0},this.getCharIndex=function(){return w}}function se(o){var c=o.data,x=d[c.workerId],j=!1;if(c.error)x.userError(c.error,c.file);else if(c.results&&c.results.data){var g={abort:function(){j=!0,q(c.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:me,resume:me};if(A(x.userStep)){for(var L=0;L<c.results.data.length&&(x.userStep({data:c.results.data[L],errors:c.results.errors,meta:c.results.meta},g),!j);L++);delete c.results}else A(x.userChunk)&&(x.userChunk(c.results,g,c.file),delete c.results)}c.finished&&!j&&q(c.workerId,c.results)}function q(o,c){var x=d[o];A(x.userComplete)&&x.userComplete(c),x.terminate(),delete d[o]}function me(){throw new Error("Not implemented.")}function je(o){if(typeof o!="object"||o===null)return o;var c,x=Array.isArray(o)?[]:{};for(c in o)x[c]=je(o[c]);return x}function xe(o,c){return function(){o.apply(c,arguments)}}function A(o){return typeof o=="function"}return u.parse=function(o,c){var x=(c=c||{}).dynamicTyping||!1;if(A(x)&&(c.dynamicTypingFunction=x,x={}),c.dynamicTyping=x,c.transform=!!A(c.transform)&&c.transform,!c.worker||!u.WORKERS_SUPPORTED)return x=null,u.NODE_STREAM_INPUT,typeof o=="string"?(o=(j=>j.charCodeAt(0)!==65279?j:j.slice(1))(o),x=new(c.download?y:b)(c)):o.readable===!0&&A(o.read)&&A(o.on)?x=new N(c):(a.File&&o instanceof File||o instanceof Object)&&(x=new f(c)),x.stream(o);(x=(()=>{var j;return!!u.WORKERS_SUPPORTED&&(j=(()=>{var g=a.URL||a.webkitURL||null,L=r.toString();return u.BLOB_URL||(u.BLOB_URL=g.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",L,")();"],{type:"text/javascript"})))})(),(j=new a.Worker(j)).onmessage=se,j.id=m++,d[j.id]=j)})()).userStep=c.step,x.userChunk=c.chunk,x.userComplete=c.complete,x.userError=c.error,c.step=A(c.step),c.chunk=A(c.chunk),c.complete=A(c.complete),c.error=A(c.error),delete c.worker,x.postMessage({input:o,config:c,workerId:x.id})},u.unparse=function(o,c){var x=!1,j=!0,g=",",L=`\r
`,U='"',oe=U+U,pe=!1,C=null,F=!1,w=((()=>{if(typeof c=="object"){if(typeof c.delimiter!="string"||u.BAD_DELIMITERS.filter(function(D){return c.delimiter.indexOf(D)!==-1}).length||(g=c.delimiter),typeof c.quotes!="boolean"&&typeof c.quotes!="function"&&!Array.isArray(c.quotes)||(x=c.quotes),typeof c.skipEmptyLines!="boolean"&&typeof c.skipEmptyLines!="string"||(pe=c.skipEmptyLines),typeof c.newline=="string"&&(L=c.newline),typeof c.quoteChar=="string"&&(U=c.quoteChar),typeof c.header=="boolean"&&(j=c.header),Array.isArray(c.columns)){if(c.columns.length===0)throw new Error("Option columns is empty");C=c.columns}c.escapeChar!==void 0&&(oe=c.escapeChar+U),c.escapeFormulae instanceof RegExp?F=c.escapeFormulae:typeof c.escapeFormulae=="boolean"&&c.escapeFormulae&&(F=/^[=+\-@\t\r].*$/)}})(),new RegExp(O(U),"g"));if(typeof o=="string"&&(o=JSON.parse(o)),Array.isArray(o)){if(!o.length||Array.isArray(o[0]))return K(null,o,pe);if(typeof o[0]=="object")return K(C||Object.keys(o[0]),o,pe)}else if(typeof o=="object")return typeof o.data=="string"&&(o.data=JSON.parse(o.data)),Array.isArray(o.data)&&(o.fields||(o.fields=o.meta&&o.meta.fields||C),o.fields||(o.fields=Array.isArray(o.data[0])?o.fields:typeof o.data[0]=="object"?Object.keys(o.data[0]):[]),Array.isArray(o.data[0])||typeof o.data[0]=="object"||(o.data=[o.data])),K(o.fields||[],o.data||[],pe);throw new Error("Unable to serialize unrecognized input");function K(D,v,X){var Z="",ne=(typeof D=="string"&&(D=JSON.parse(D)),typeof v=="string"&&(v=JSON.parse(v)),Array.isArray(D)&&0<D.length),ye=!Array.isArray(v[0]);if(ne&&j){for(var P=0;P<D.length;P++)0<P&&(Z+=g),Z+=_(D[P],P);0<v.length&&(Z+=L)}for(var V=0;V<v.length;V++){var Q=(ne?D:v[V]).length,k=!1,W=ne?Object.keys(v[V]).length===0:v[V].length===0;if(X&&!ne&&(k=X==="greedy"?v[V].join("").trim()==="":v[V].length===1&&v[V][0].length===0),X==="greedy"&&ne){for(var ee=[],$=0;$<Q;$++){var B=ye?D[$]:$;ee.push(v[V][B])}k=ee.join("").trim()===""}if(!k){for(var z=0;z<Q;z++){0<z&&!W&&(Z+=g);var Ce=ne&&ye?D[z]:z;Z+=_(v[V][Ce],z)}V<v.length-1&&(!X||0<Q&&!W)&&(Z+=L)}}return Z}function _(D,v){var X,Z;return D==null?"":D.constructor===Date?JSON.stringify(D).slice(1,25):(Z=!1,F&&typeof D=="string"&&F.test(D)&&(D="'"+D,Z=!0),X=D.toString().replace(w,oe),(Z=Z||x===!0||typeof x=="function"&&x(D,v)||Array.isArray(x)&&x[v]||((ne,ye)=>{for(var P=0;P<ye.length;P++)if(-1<ne.indexOf(ye[P]))return!0;return!1})(X,u.BAD_DELIMITERS)||-1<X.indexOf(g)||X.charAt(0)===" "||X.charAt(X.length-1)===" ")?U+X+U:X)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!i&&!!a.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=I,u.ParserHandle=M,u.NetworkStreamer=y,u.FileStreamer=f,u.StringStreamer=b,u.ReadableStreamStreamer=N,a.jQuery&&((n=a.jQuery).fn.parse=function(o){var c=o.config||{},x=[];return this.each(function(L){if(!(n(this).prop("tagName").toUpperCase()==="INPUT"&&n(this).attr("type").toLowerCase()==="file"&&a.FileReader)||!this.files||this.files.length===0)return!0;for(var U=0;U<this.files.length;U++)x.push({file:this.files[U],inputElem:this,instanceConfig:n.extend({},c)})}),j(),this;function j(){if(x.length===0)A(o.complete)&&o.complete();else{var L,U,oe,pe,C=x[0];if(A(o.before)){var F=o.before(C.file,C.inputElem);if(typeof F=="object"){if(F.action==="abort")return L="AbortError",U=C.file,oe=C.inputElem,pe=F.reason,void(A(o.error)&&o.error({name:L},U,oe,pe));if(F.action==="skip")return void g();typeof F.config=="object"&&(C.instanceConfig=n.extend(C.instanceConfig,F.config))}else if(F==="skip")return void g()}var w=C.instanceConfig.complete;C.instanceConfig.complete=function(K){A(w)&&w(K,C.file,C.inputElem),g()},u.parse(C.file,C.instanceConfig)}}function g(){x.splice(0,1),j()}}),l&&(a.onmessage=function(o){o=o.data,u.WORKER_ID===void 0&&o&&(u.WORKER_ID=o.workerId),typeof o.input=="string"?a.postMessage({workerId:u.WORKER_ID,results:u.parse(o.input,o.config),finished:!0}):(a.File&&o.input instanceof File||o.input instanceof Object)&&(o=u.parse(o.input,o.config))&&a.postMessage({workerId:u.WORKER_ID,results:o,finished:!0})}),(y.prototype=Object.create(p.prototype)).constructor=y,(f.prototype=Object.create(p.prototype)).constructor=f,(b.prototype=Object.create(b.prototype)).constructor=b,(N.prototype=Object.create(p.prototype)).constructor=N,u})}(pt)),pt.exports}var Ti=_i();function Ei({content:t}){const[s,r]=h.useState([]),[a,n]=h.useState([]);return h.useEffect(()=>{Ti.parse(t,{header:!0,skipEmptyLines:!0,complete:i=>{const l=[],d=[];i.data.forEach(m=>{l.push(Object.keys(m)),d.push(Object.values(m))}),r(l[0]),n(d)}})},[t]),e.jsx("div",{className:"overflow-hidden overflow-x-auto rounded-md border",children:e.jsxs(sa,{children:[e.jsx(ra,{className:"bg-theme-surface-tertiary",children:e.jsx(as,{children:s.map((i,l)=>e.jsx(aa,{className:"text-theme-text-secondary",children:i},l))})}),e.jsx(na,{children:a.map((i,l)=>e.jsx(as,{children:i.map((d,m)=>e.jsx(ia,{className:"bg-theme-surface-primary",children:d},m))},l))})]})})}function Li({artifactVersionId:t,artifactName:s,visualizationIndex:r=0,markdownMode:a="markdown"}){const[n,i]=h.useState(!1),l={index:r},{isVisualizationConfirmed:d,confirmVisualization:m}=br(),u=ot(),{data:p,isError:y,error:f,isPending:b}=Yt({versionId:t,params:l},{retry:!1,enabled:!n});return n?e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("p",{className:"mb-5 text-text-lg text-theme-text-secondary",children:"Loading the visualization cancelled"}),e.jsx(E,{size:"md",onClick:()=>i(!1),children:"Load Visualization"})]})}):y?f.status===501?e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("p",{className:"text-center text-text-lg text-theme-text-secondary",children:["This artifact cannot be visualized because it cannot be loaded from the artifact store. This might happen if your ZenML server does not have the artifact stores dependencies installed or if the server is not authenticated to access it. For more information, see our"," ",e.jsx("a",{className:"link",rel:"noopener noreferrer",target:"_blank",href:"https://docs.zenml.io/stacks/stack-components/artifact-stores/custom",children:"docs"})]})}):e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:f.message})})}):b?e.jsxs("div",{className:"flex flex-col items-center gap-7 py-12",children:[e.jsx(Nt,{}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"mb-5 text-display-xs",children:"Loading Visualization"}),e.jsx(E,{onClick:()=>{u.cancelQueries({queryKey:vr({versionId:t})}),i(!0)},intent:"secondary",size:"md",children:"Cancel"})]})]}):d(r)?e.jsxs("div",{children:[p.type==="image"&&e.jsx(bi,{content:p.value}),p.type==="html"&&e.jsx(yi,{content:p.value}),p.type==="markdown"&&e.jsx(Si,{content:p.value,markdownMode:a}),p.type==="csv"&&e.jsx(Ei,{content:p.value}),p.type==="json"&&e.jsx(vi,{content:p.value})]}):e.jsx(Ri,{artifactVersionId:t,visualizationIndex:r,artifactName:s,confirmVisualization:()=>m(r),...p})}function Ri({artifactName:t,confirmVisualization:s,artifactVersionId:r,visualizationIndex:a}){return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-8",children:[e.jsx(Kt,{children:"This preview may contain harmful code. Only proceed if you trust the source. Loading content from untrusted sources can pose risks. If unsure, avoid loading."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(E,{size:"md",onClick:()=>s(),children:"Load Preview"}),e.jsx(Nr,{artifactVersionId:r,visualizationIndex:a,artifactName:t})]})]})}function Oi({setIndex:t,visualizations:s,index:r}){const[a,n]=h.useState(!1);return e.jsxs(ks,{open:a,onOpenChange:n,children:[e.jsx(_s,{asChild:!0,children:e.jsxs(E,{intent:"secondary",emphasis:"subtle",className:"flex items-center gap-0.5 bg-theme-surface-primary",size:"md",children:[s[r].body?.uri.split("/").pop(),e.jsx(Oe,{width:24,height:24,className:"fill-text-primary shrink-0"})]})}),e.jsx(Ts,{className:"px-0",align:"start",children:e.jsxs(Es,{defaultValue:r.toString(),className:"rounded-sharp",children:[e.jsx(Ls,{className:"m-0",placeholder:"Search visualizations...",children:e.jsx(At,{className:"w-full",inputSize:"sm"})}),e.jsxs(Rs,{children:[e.jsx(Os,{children:"No visualization found."}),e.jsx(Ds,{className:"max-h-[300px] overflow-y-auto",children:s.map((i,l)=>{const d=i.body?.uri.split("/").pop();return e.jsxs(Ps,{keywords:[d??""],className:"group data-[selected=true]:rounded-sharp",value:l.toString(),onSelect:()=>{t(l),n(!1)},children:[l===r?e.jsx(Xs,{width:16,height:16,className:"shrink-0 fill-theme-text-tertiary group-data-[selected=true]:fill-theme-text-brand"}):e.jsx(lt,{width:16,height:16,className:"shrink-0 fill-theme-text-tertiary group-data-[selected=true]:fill-theme-text-brand"}),d]},i.id)})})]})]})})]})}function Di({artifactVersionId:t}){const[s,r]=h.useState(0),{isVisualizationConfirmed:a}=br(),[n,i]=h.useState("markdown"),{data:l,isPending:d,isError:m,error:u}=et({versionId:t}),{data:p,isSuccess:y}=Yt({versionId:t,params:{index:s}},{retry:!1,enabled:a(s)});if(m)return e.jsx(le,{icon:e.jsx(yt,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:u.message})})});if(d)return e.jsx(S,{className:"h-[300px] w-full"});const f=l.metadata?.visualizations||[];return f.length<1?e.jsx(le,{icon:e.jsx(yt,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2 text-display-xs font-semibold",children:"No visualizations found"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"There are no visualizations available for this artifact version."})]})}):e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:`flex gap-1 ${f.length>1?"justify-between":"justify-end"}`,children:[f.length>1&&e.jsx(Oi,{setIndex:r,visualizations:f,index:s}),e.jsxs("div",{className:"flex items-center gap-1",children:[a(s)&&y&&p.type==="markdown"&&e.jsx(E,{intent:"secondary",emphasis:"subtle",size:"md",className:"flex items-center gap-1 bg-theme-surface-primary",onClick:()=>i(b=>b==="markdown"?"raw":"markdown"),children:n==="raw"?"Markdown":"Raw"}),a(s)&&e.jsx(Nr,{artifactName:l.body?.artifact.name||"artifact",artifactVersionId:t,visualizationIndex:s})]})]}),e.jsx(Li,{artifactName:l.body?.artifact.name||"artifact",visualizationIndex:s,artifactVersionId:t,markdownMode:n})]})}function Pi({error:t}){return e.jsx(le,{icon:e.jsx(yt,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2 text-display-xs font-semibold",children:"Something went wrong"}),e.jsx("p",{className:"text-lg text-theme-text-secondary",children:t.message})]})})}function zi({artifactVersionId:t}){const{data:s}=et({versionId:t}),r=s?.body?.version;return e.jsxs("div",{children:[e.jsx(Wt,{}),e.jsxs("div",{className:"border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[s?e.jsx("p",{className:"mb-0.5 text-text-sm text-theme-text-secondary",children:t}):e.jsx(S,{className:"w-9"}),s?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Jt,{artifactType:s.body?.type||"BaseArtifact",className:"h-5 w-5 fill-theme-surface-strong"}),e.jsx("h2",{className:"text-display-xs font-semibold",children:s.body?.artifact.name}),e.jsx(ft,{color:r?"light-purple":"light-grey",rounded:!1,children:r||"None"})]}):e.jsx(S,{className:"h-6 w-7"})]}),e.jsx("div",{className:"p-5",children:e.jsx(si,{children:e.jsxs(It,{defaultValue:"overview",children:[e.jsxs(Ht,{children:[e.jsxs(ce,{className:"flex items-center gap-2 text-text-md",value:"overview",children:[e.jsx(de,{icon:qe}),e.jsx("span",{children:"Overview"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"metadata",children:[e.jsx(de,{icon:qt}),e.jsx("span",{children:"Metadata"})]}),e.jsxs(ce,{className:"flex items-center gap-2 text-text-md",value:"visualization",children:[e.jsx(de,{icon:yt}),e.jsx("span",{children:"Visualization"})]})]}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"overview",children:e.jsx(fi,{artifactVersionId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"metadata",children:e.jsx(gi,{artifactVersionId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"visualization",children:e.jsx(Ut,{FallbackComponent:Pi,children:e.jsx(Di,{artifactVersionId:t})})})]})})})]})}function Ai({runId:t}){const s=te({runId:t});if(s.isPending)return e.jsx(S,{className:"h-6 w-[200px]"});if(s.isError)return null;const r=s.data,a=r.name,n=r.body?.status,i=r.body?.index;return e.jsxs("div",{className:"flex items-center gap-1 overflow-hidden border-b border-b-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsx(wt,{className:`h-5 w-5 shrink-0 ${vt(n)}`}),e.jsx("p",{className:"min-w-0 truncate text-display-xs font-semibold",children:e.jsx(gt,{name:a,index:i})}),e.jsx(ge,{className:"h-5 w-5 shrink-0",status:n})]})}function Mi({runId:t}){const[s,r]=h.useState("overview");return e.jsxs("div",{children:[e.jsx(Wt,{children:e.jsx(Vi,{runId:t})}),e.jsx(Ai,{runId:t}),e.jsx("div",{className:"p-5",children:e.jsx(pr,{runId:t,selectedTab:s,handleTabChage:r})})]})}function Ii(){return e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"mb-2 text-display-xs font-semibold",children:"Error loading run sheet"})})})}function Vi({runId:t}){return e.jsx(E,{asChild:!0,className:"flex aspect-square items-center justify-center p-0",intent:"secondary",emphasis:"minimal",children:e.jsx(ct,{to:Be.projects.runs.detail(t),children:e.jsx(Js,{className:"h-5 w-5 fill-neutral-500"})})})}function Fi(){const t=document.querySelector(".error-highlight-line");t&&t.scrollIntoView({behavior:"smooth"})}function $i({stepId:t}){const{data:s,isPending:r,isError:a,error:n}=Ue({stepId:t});if(a)return e.jsx(Pe,{err:n});if(r)return e.jsx(S,{className:"h-[300px] w-full"});const i=s?.metadata?.exception_info?.traceback;return e.jsxs("div",{className:"flex flex-col gap-5",children:[i&&e.jsx(Ee,{initialOpen:!0,title:e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-5 w-5 fill-theme-text-error"})," Error"]}),contentClassName:"border-t border-error-200",className:"border border-error-200",headerClassName:"flex justify-between",headerChildren:e.jsxs(E,{className:"whitespace-nowrap",onClick:Fi,intent:"danger",emphasis:"subtle",children:["Go to error",e.jsx(nt,{className:"h-5 w-5 -rotate-90 fill-error-700"})]}),children:e.jsx("div",{className:"whitespace-pre-wrap font-mono text-text-md",children:i})}),e.jsx(Ee,{initialOpen:!0,title:"Code",children:e.jsx(we,{fullWidth:!0,highlightCode:!0,wrap:!0,code:s?.metadata?.source_code||"",exceptionCodeLine:s?.metadata?.exception_info?.step_code_line??void 0})})]})}function Bi({stepId:t}){const{data:s,isPending:r,isError:a,error:n}=Ue({stepId:t}),{runId:i}=Ie(),{data:l}=te({runId:i},{throwOnError:!0,enabled:!!i}),{data:d}=Qs({buildId:l?.resources?.build?.id},{enabled:!!l?.resources?.build?.id}),m=s?.name,p=(()=>{const f=d?.metadata?.images;if(!f)return null;if(m){for(const b in f)if(b.startsWith(`${m}.`))return b;if(f[m])return m}return f.orchestrator?"orchestrator":null})(),y=p&&d?.metadata?.images?.[p];return a?e.jsx(Pe,{err:n}):r?e.jsxs("div",{className:"space-y-5",children:[e.jsx(S,{className:"h-[200]"}),e.jsx(S,{className:"h-[200px]"}),e.jsx(S,{className:"h-[200px]"})]}):e.jsxs("div",{className:"space-y-5",children:[e.jsx(he,{isInitialOpen:!0,data:s.metadata?.config?.parameters,title:"Parameters"}),y?e.jsx(Ws,{data:y}):null,e.jsx(qi,{id:s.id}),e.jsx(he,{isInitialOpen:!0,title:"Resources",data:s.metadata?.config.settings?.resources||{}}),e.jsx(he,{isInitialOpen:!0,title:"Cache Policy",sortKeysAlphabetically:!1,data:s.metadata?.config.cache_policy}),e.jsx(he,{isInitialOpen:!0,title:"Retry",data:s.metadata?.config.retry??void 0}),e.jsx(he,{isInitialOpen:!0,title:"Substitutions",data:s.metadata?.config.substitutions}),e.jsx(he,{isInitialOpen:!0,title:"Extra",data:s.metadata?.config.extra})]})}function qi({id:t}){return e.jsxs(Ee,{initialOpen:!0,title:"Code",children:[e.jsx("h2",{className:"mb-2 text-text-md text-theme-text-secondary",children:"Get config programmatically"}),e.jsx(we,{fullWidth:!0,highlightCode:!0,wrap:!0,code:Gs(t)})]})}function tt(t,s){return["initializing","running"].includes(t)&&s==="failed"}function Hi({stepStatus:t,isStatusUnknown:s}){function r(){return e.jsxs(Ke,{color:Ct(s?"unknown":t),rounded:!0,emphasis:"subtle",className:"flex w-fit items-center gap-1 capitalize",children:[e.jsx(ge,{className:"fill-current",status:s?"unknown":t}),s?"Unknown - Last reported: "+t:t]})}return s?e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{className:"z-10 cursor-default",children:e.jsx(r,{})}),e.jsxs(Y,{className:"text-center",children:["Last reported as ",e.jsx("b",{children:t})," but current status unknown due to pipeline failure.",e.jsx("br",{}),"Communication may be lost."]})]})}):e.jsx(r,{})}function Ui({stepId:t,runId:s}){const{data:r,isError:a,isPending:n,error:i}=Ue({stepId:t}),{data:l}=te({runId:s}),d=l?.resources?.code_reference?.body?.code_repository;if(a)return e.jsx(Pe,{err:i});if(n)return e.jsx(S,{className:"h-[300px] w-full"});const m=r.metadata?.config?.enable_artifact_metadata,u=r.metadata?.config?.enable_artifact_visualization,p=tt(r.body?.status??"running",l?.body?.status??"running"),y=l?.resources?.pipeline;return e.jsx(Ee,{initialOpen:!0,title:"Details",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsx(R,{label:"Id",value:e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[r.id,e.jsx(Te,{copyText:r.id})]})}),e.jsx(R,{label:"Status",value:e.jsx("div",{className:"flex items-center gap-0.5 overflow-x-auto",children:e.jsx(Hi,{stepStatus:r.body?.status??"running",isStatusUnknown:p})})}),l?e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Pipeline",value:y?e.jsx(Qt,{pipelineId:y.id,pipelineName:y.name}):"Not available"}),e.jsx(be,{children:e.jsxs("div",{className:"flex items-center space-x-0.5 truncate",children:[e.jsx("span",{className:"truncate",children:"Repository/Commit"}),e.jsx(ae,{children:e.jsxs(G,{children:[e.jsxs(J,{className:"cursor-default",children:[e.jsx(qe,{className:"h-3 w-3 fill-theme-text-secondary"}),e.jsx("span",{className:"sr-only",children:"Info"})]}),e.jsx(Y,{className:"w-full max-w-md whitespace-normal",children:"Git hash of code repository. Only set if pipeline was run in a clean git repository connected to your ZenML server."})]})})]})}),e.jsx(ve,{className:"h-auto",children:l.resources?.code_reference?e.jsx(er,{repositoryId:d?.id,commit:l.resources.code_reference.body?.commit}):"Not available"}),e.jsx(be,{className:l.metadata?.code_path?"col-span-3":"",children:e.jsxs("div",{className:"flex items-center space-x-0.5 truncate",children:[e.jsx("span",{children:"Code Path"}),e.jsx(ae,{children:e.jsxs(G,{children:[e.jsxs(J,{className:"cursor-default",children:[e.jsx(qe,{className:"h-3 w-3 fill-theme-text-secondary"}),e.jsx("span",{className:"sr-only",children:"Info"})]}),e.jsx(Y,{className:"w-full max-w-md whitespace-normal",children:"Path to where code was uploaded in the artifact store. Only set on a pipeline with a non-local orchestrator and if Repository/Commit is not set"})]})})]})}),e.jsx(ve,{className:l.metadata?.code_path?"col-span-3 h-auto":"",children:l.metadata?.code_path?e.jsx(we,{className:"overflow-hidden",code:l.metadata.code_path}):"Not available"})]}):e.jsx(S,{className:"h-6 w-full"}),e.jsx(R,{label:"Cache key",value:e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[r.metadata?.cache_key,e.jsx(Te,{copyText:r.metadata?.cache_key})]})}),r.resources?.user?e.jsx(R,{label:"Author",value:e.jsx("div",{className:"inline-flex items-center gap-1",children:e.jsx(Mt,{avatarUrl:r.resources.user.body?.avatar_url??void 0,username:r.resources.user.name,isServiceAccount:!!r.resources.user.body?.is_service_account})})}):"Not available",e.jsx(R,{label:"Start Time",value:r.body?.start_time?e.jsx($e,{dateString:r.body?.start_time}):"Not available"}),e.jsx(R,{label:"End Time",value:r.body?.end_time?e.jsx($e,{dateString:r.body?.end_time}):"Not available"}),e.jsx(R,{label:"Duration",value:As(r.body?.start_time||"",r.body?.end_time||"")}),e.jsx(R,{label:"Artifact metadata",value:e.jsx(ft,{size:"sm",color:m?"green":"grey",children:m?"Enable":"Disabled"})}),e.jsx(R,{label:"Artifact visualization",value:e.jsx(ft,{size:"sm",color:u?"green":"grey",children:u?"Enable":"Disabled"})})]})})}function Ki({className:t}){const{runId:s}=Ie(),{data:r,isPending:a,isError:n}=te({runId:s},{throwOnError:!0}),i=r?.metadata?.run_metadata?.orchestrator_url,l=r?.metadata?.run_metadata?.orchestrator_logs_url,d=r?.metadata?.orchestrator_run_id;return n?e.jsx("p",{children:"Failed to fetch Orchestrator Card"}):a?e.jsx(S,{className:"h-[150px] w-full"}):e.jsx(Ee,{className:t,initialOpen:!0,title:"Orchestrator",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-[10px] gap-y-2 md:grid-cols-3 md:gap-y-4",children:[e.jsx(R,{label:"Orchestrator URL",value:i&&Fe(i)?e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("a",{className:"truncate underline transition-all duration-200 hover:decoration-transparent",rel:"noopener noreferrer",target:"_blank",href:i,children:i}),e.jsx(Te,{copyText:i})]}):"Not available"}),e.jsx(R,{label:"Orchestrator Logs",value:l&&Fe(l)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xr,{}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("a",{className:"truncate text-theme-text-brand underline transition-all duration-200 hover:decoration-transparent",rel:"noopener noreferrer",target:"_blank",href:l,children:l}),e.jsx(Te,{copyText:l})]})]}):"Not available"}),e.jsx(R,{label:"Orchestrator Run ID",value:d?e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[d,e.jsx(Te,{copyText:d})]}):"Not available"})]})})}function Qi({stepId:t,queries:s}){return["logs",t,s]}async function Wi({stepId:t,queries:s}){const r=it(s).toString(),a=Le(Re.steps.logs(t)+(r?`?${r}`:"")),n=await Ae(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok){const i=await n.json().then(l=>Array.isArray(l.detail)?l.detail[1]:l.detail).catch(()=>`Error while fetching logs for step ${t}`);throw new Me({status:n.status,statusText:n.statusText,message:i})}return n.json()}function Zi(t,s){return De({queryKey:Qi(t),queryFn:()=>Wi(t),...s})}function Gi({stepId:t}){const{data:s,isError:r,isPending:a}=Ue({stepId:t});if(a)return e.jsx(S,{className:"h-[200px] w-full"});if(r)return e.jsx("p",{children:"Error loading logs"});const i=s.resources?.log_collection?.map(l=>l.body?.source).filter(l=>l!=null&&l!==void 0)??[];return i.length<1?e.jsx(Xe,{title:"This step has no logs",subtitle:"It looks like there are no logs associated with this step"}):e.jsx(Ji,{sources:i,stepId:t})}function Ji({sources:t,stepId:s}){const r=t.includes("step")?"step":t[0],[a,n]=h.useState(r);return e.jsxs("section",{className:"space-y-5",children:[t.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-theme-text-secondary",children:"Logs source:"}),t.length>1?e.jsx(mr,{sources:t,selectedSource:a,setSelectedSource:n}):e.jsx("span",{className:"font-semibold capitalize",children:a})]}),e.jsx(Yi,{selectedSource:a,stepId:s})]})}function Yi({selectedSource:t,stepId:s}){const r=Zi({stepId:s,queries:{source:t}}),a=h.useMemo(()=>r.data?or(r.data):[],[r.data]);return r.isPending?e.jsx(hr,{}):r.isError?e.jsx(Pe,{err:r.error}):r.data.length===0?e.jsx(Xe,{title:"This step has no logs",subtitle:"It looks like there are no logs associated with this step"}):e.jsx("div",{className:"h-full w-full",children:e.jsx(ur,{logs:a,reloadLogs:()=>r.refetch()})})}function Xi({stepId:t}){const{data:s,isPending:r,isError:a,error:n}=Ue({stepId:t});return r?e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx(S,{className:"h-9 w-full"}),e.jsx(S,{className:"h-9 w-full"})]}):a?e.jsx(Pe,{err:n}):!s.metadata?.run_metadata||Object.keys(s.metadata.run_metadata).length===0?e.jsx(le,{icon:e.jsx(lt,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-2 text-display-xs font-semibold",children:"No metadata found"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"There are no metadata available for this step."})]})}):e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx(Gt,{metadata:s.metadata.run_metadata}),e.jsx(Zt,{metadata:s.metadata.run_metadata})]})}function el({stepId:t}){const{runId:s}=Ie(),r=te({runId:s}),a=Ue({stepId:t});if(r.isPending||a.isPending)return e.jsx(S,{className:"h-[250px] w-full"});if(r.isError||a.isError)return e.jsx("p",{children:"Something went wrong fetching the run"});const n=r.data?.resources?.stack?.id,i=a.data.metadata?.config.settings||{};return n?e.jsx(tl,{objectConfig:i,stackId:n}):e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"No Stack"}),e.jsx("p",{className:"text-text-lg text-theme-text-secondary",children:"There is no stack associated with this run."})]})})}function tl({stackId:t,objectConfig:s}){const{data:r,isError:a,isPending:n}=sr({stackId:t});return n?e.jsx(S,{className:"h-[250px] w-full"}):a?e.jsx("p",{children:"Failed to fetch Stack"}):e.jsx(tr,{stack:r,objectConfig:s})}function sl({stepId:t}){const{runId:s}=Ie(),r=Ue({stepId:t}),a=te({runId:s});if(r.isPending||a.isPending)return e.jsx(S,{className:"h-6 w-[200px]"});if(r.error||a.error)return null;const n=r.data.body?.status,i=a.data.body?.status,l=tt(n??"running",i??"running");return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`rounded-sm p-0.5 ${l?"bg-blue-50":$s(n)}`,children:e.jsx(ge,{status:l?"unknown":n,className:"h-4 w-4 shrink-0"})}),e.jsx("h2",{className:"text-display-xs font-semibold",children:r.data.name}),e.jsx(ft,{size:"sm",className:"capitalize",color:la(l?"unknown":n),children:l?`Unknown - Last reported: ${n}`:n||"None"})]})}function rl({stepId:t}){const{runId:s}=Ie();return e.jsxs("div",{children:[e.jsx(Wt,{}),e.jsx("div",{className:"flex justify-between border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:e.jsx(sl,{stepId:t})}),e.jsx("div",{className:"p-5",children:e.jsxs(It,{defaultValue:"overview",children:[e.jsxs(Ht,{children:[e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"overview",children:[e.jsx(de,{icon:qe}),e.jsx("span",{children:"Overview"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"stack",children:[e.jsx(de,{icon:Ms}),e.jsx("span",{children:"Stack"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"code",children:[e.jsx(de,{icon:Ks}),e.jsx("span",{children:"Code"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"logs",children:[e.jsx(de,{icon:dt}),e.jsx("span",{children:"Logs"})]}),e.jsxs(ce,{className:"flex items-center gap-2 truncate text-text-md",value:"config",children:[e.jsx(de,{icon:lr}),e.jsx("span",{children:"Configuration"})]}),e.jsxs(ce,{className:"flex items-center gap-2 text-text-md",value:"metadata",children:[e.jsx(de,{icon:qt}),e.jsx("span",{children:"Metadata"})]})]}),e.jsxs(ue,{className:"m-0 mt-5 space-y-5 border-0 bg-transparent p-0",value:"overview",children:[e.jsx(Ui,{runId:s,stepId:t}),e.jsx(Ki,{})]}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"stack",children:e.jsx(el,{stepId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"code",children:e.jsx($i,{stepId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"logs",children:e.jsx(Gi,{stepId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"config",children:e.jsx(Bi,{stepId:t})}),e.jsx(ue,{className:"m-0 mt-5 border-0 bg-transparent p-0",value:"metadata",children:e.jsx(Xi,{stepId:t})})]})})]})}function Cr(){const{sheetState:t,closeSheet:s}=He(),r=Ra(),{addSelectedNodes:a}=r.getState();function n(l){l||(setTimeout(()=>{a([])},100),s())}function i(){return`run-resizable-${t.lastContent?.type}-sheet`}return e.jsx(oa,{open:t.isOpen,onOpenChange:n,children:e.jsxs(za,{className:"overflow-y-auto",autoSaveId:i(),children:[t.lastContent?.type==="step"&&e.jsx(rl,{stepId:t.lastContent.id}),t.lastContent?.type==="artifact"&&e.jsx(zi,{artifactVersionId:t.lastContent.id}),t.lastContent?.type==="triggered_run"&&e.jsx(Ut,{fallbackRender:Ii,children:e.jsx(Mi,{runId:t.lastContent.id})})]})})}function al({data:t}){const s=t.runStatus==="failed",r=t.runStatus==="completed",a=t.runStatus==="stopped";return e.jsx(ut,{children:e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex h-[50px] min-w-0 max-w-[300px] items-center justify-center gap-1 rounded-rounded border border-primary-100 bg-primary-25 p-1 opacity-50",children:[e.jsx("div",{className:"rounded-rounded bg-primary-50 p-0.5",children:s?e.jsx(kt,{className:"h-4 w-4 shrink-0 fill-primary-400"}):e.jsx(ge,{status:r?"completed":a?"stopped":"running",className:"h-4 w-4 fill-primary-400"})}),e.jsx("p",{className:"truncate text-text-sm",children:t.node_name})]})}),e.jsx(Y,{className:"z-20 max-w-xs text-center",children:s?e.jsx(e.Fragment,{children:"This artifact was not generated because of an upstream error"}):a?e.jsx(e.Fragment,{children:"This artifact was not created because the run was stopped"}):e.jsx(e.Fragment,{children:"This artifact is not generated yet. It will not be created if the are upstream errors."})})]})})})}function nl({data:t}){const s=t.runStatus==="failed",r=t.runStatus==="completed",a=t.runStatus==="stopped";return e.jsx(ut,{children:e.jsx(ae,{children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex h-[50px] max-w-[300px] items-center gap-1 rounded-md border border-theme-border-moderate bg-theme-surface-primary p-1 pr-2 opacity-50",children:[e.jsx("div",{className:`rounded-sm ${s?"bg-blue-50":"bg-warning-50"} p-0.5`,children:s?e.jsx(kt,{className:"h-4 w-4 shrink-0 fill-blue-500"}):e.jsx(ge,{status:r?"completed":a?"stopped":"running",className:"h-4 w-4 fill-theme-text-warning"})}),e.jsx("p",{className:"truncate",children:t.node_name})]})}),e.jsx(Y,{className:"z-20 max-w-xs text-center",children:s?e.jsx(e.Fragment,{children:"This step will never start because of an upstream error"}):a?e.jsx(e.Fragment,{children:"This step was not executed because the run was stopped"}):e.jsxs(e.Fragment,{children:["This is a future step with pending execution.",e.jsx("br",{}),"It may not run if there are upstream errors."]})})]})})})}function il({data:t,selected:s}){const{openStepSheet:r}=He(),a=t.status==="failed";function n(){r(t.node_id)}const i=tt(t.status,t.runStatus);return e.jsx(ut,{children:e.jsxs("button",{onClick:n,"data-failed":a,"data-selected":!!s,className:Bs("group max-h-[80px] max-w-[300px] overflow-hidden rounded-md border bg-theme-surface-primary transition-all duration-200 hover:shadow-md data-[selected=true]:shadow-md",{"border-theme-border-moderate hover:border-neutral-400 data-[selected=true]:border-theme-border-bold":!a,"border-error-200":a}),children:[e.jsxs("div",{className:"flex flex-1 items-center gap-1 py-1 pl-1 pr-2",children:[e.jsx("div",{className:`rounded-sm p-0.5 ${$s(i?"unknown":t.status)}`,children:e.jsx(ge,{status:i?"unknown":t.status,className:"h-4 w-4 shrink-0"})}),e.jsx("p",{className:"truncate font-semibold",children:t.node_name}),e.jsxs(fr,{className:"h-4 w-4 shrink-0 rounded-sm hover:bg-theme-surface-secondary active:bg-neutral-300",code:Gs(t.node_id),type:"step",children:[e.jsx(zt,{className:"h-3 w-3 fill-theme-text-tertiary"}),e.jsx("div",{className:"sr-only",children:"Copy code to load step"})]})]}),e.jsx("div",{"data-failed":a,className:"flex flex-1 justify-end border-t border-theme-border-moderate bg-theme-surface-tertiary px-2 py-0.5 text-text-xs text-theme-text-secondary data-[failed=true]:border-error-200 data-[failed=true]:bg-error-50 data-[failed=true]:text-theme-text-error",children:a?"Execution failed":t.duration===void 0||t.duration===null?"N/A":Ft(t.duration)})]})})}const ll=h.memo(il);function ol({data:t,selected:s}){const{openTriggeredRunSheet:r}=He(),a=t.status==="failed";function n(){r(t.node_id)}const i=tt(t.status,t.runStatus);return e.jsx(ut,{children:e.jsx("button",{onClick:n,"data-failed":a,"data-selected":!!s,className:Bs("group h-[60px] max-w-[300px] overflow-hidden rounded-md border bg-theme-surface-primary transition-all duration-200 hover:shadow-md data-[selected=true]:shadow-md",{"border-theme-border-moderate hover:border-neutral-400 data-[selected=true]:border-theme-border-bold":!a,"border-error-200":a}),children:e.jsxs("div",{className:"flex h-full items-center gap-1 py-1 pl-1 pr-2 text-text-sm",children:[e.jsx(wt,{className:`h-4 w-4 shrink-0 ${vt(t.status)}`}),e.jsxs("div",{className:"truncate",children:[e.jsx("p",{className:"truncate font-semibold",children:t.node_name}),e.jsx("p",{className:"text-left text-theme-text-secondary",children:a?"Execution failed":t.duration===void 0||t.duration===null?"N/A":Ft(t.duration)})]}),e.jsx(ge,{status:i?"unknown":t.status,className:"h-4 w-4 shrink-0"})]})})})}const cl=h.memo(ol);function wr({activeView:t,setActiveView:s}){return e.jsx(ae,{children:e.jsx(Tr,{className:"w-fit overflow-hidden rounded-md border border-theme-border-moderate bg-theme-surface-primary",value:t,onValueChange:r=>s(r),children:e.jsxs(Er,{className:"flex items-center",children:[e.jsxs(G,{children:[e.jsx(ss,{asChild:!0,value:"dag",children:e.jsx(J,{asChild:!0,children:e.jsxs(Lt,{"data-state-active":t==="dag",view:"dag",activeView:t,children:[e.jsx(ca,{className:"size-4 group-data-[state=active]:fill-theme-text-negative"}),e.jsx("span",{className:"sr-only",children:"DAG"})]})})}),e.jsx(Y,{children:"DAG View"})]}),e.jsxs(G,{children:[e.jsx(ss,{asChild:!0,value:"timeline",children:e.jsx(J,{asChild:!0,children:e.jsxs(Lt,{"data-state-active":t==="timeline",view:"timeline",activeView:t,children:[e.jsx(Aa,{className:"size-4 group-data-[state=active]:fill-theme-text-negative"}),e.jsx("span",{className:"sr-only",children:"Timeline"})]})})}),e.jsx(Y,{children:"Timeline View"})]})]})})})}const Lt=h.forwardRef(({view:t,activeView:s,...r},a)=>e.jsx(E,{...r,ref:a,intent:s===t?"primary":"secondary",emphasis:s===t?"bold":"subtle",className:"group flex aspect-square size-7 items-center justify-center rounded-sharp border-none",children:r.children}));Lt.displayName="ButtonTrigger";const dl=300,ul=50,hl=70,ml=60,xl=50;function pl(t){switch(t){case"step":return hl;case"triggered_run":return ml;case"artifact":return ul;case"previewStep":case"previewArtifact":return xl}}const fl=new Ma({workerUrl:Ia});async function gl(t,s){if(!t||!s||t.length<1)return{nodes:[],edges:[]};const r=t.map(d=>({id:d.id,width:dl,height:pl(d.type||"step")})).sort((d,m)=>d.id.localeCompare(m.id)),a=s.map(d=>({id:bl(d),sources:[d.source],targets:[d.target]})).sort((d,m)=>d.id.localeCompare(m.id)),n={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.direction":"DOWN","elk.layered.alignSiblings":"true","elk.spacing.nodeNode":"25","elk.layered.spacing.nodeNodeBetweenLayers":"60","elk.layered.spacing.edgeNodeBetweenLayers":"40","elk.layered.spacing.edgeEdgeBetweenLayers":"20","elk.layered.nodePlacement.strategy":"BRANDES_KOEPF","elk.layered.crossingMinimization.strategy":"LAYER_SWEEP","elk.layered.edgeRouting":"POLYLINE","elk.layered.nodePlacement.bk.fixedAlignment":"BALANCED","elk.layered.mergeEdges":"true","elk.layered.considerModelOrder.strategy":"PREFER_INPUT","elk.edgeRouting":"ORTHOGONAL","elk.separateConnectedComponents":"false"},children:r,edges:a},i=await fl.layout(n);return{nodes:t.map(d=>{const m=i.children?.find(u=>u.id===d.id);return{...d,style:{pointerEvents:"none"},position:{x:m?.x??0,y:m?.y??0}}}),edges:jl(yl(i.edges))}}function jl(t){const s=new Map;for(const r of t){const a=r.id;s.has(a)||s.set(a,{...r,style:{strokeWidth:2}})}return Array.from(s.values())}function yl(t){return t.map(s=>{const r={id:s.id,source:s.sources[0],target:s.targets[0],type:"smoothstep"};if(s.sections&&s.sections.length>0){const a=s.sections[0],n=[{x:a.startPoint.x,y:a.startPoint.y}];a.bendPoints&&a.bendPoints.forEach(i=>{n.push({x:i.x,y:i.y})}),n.push({x:a.endPoint.x,y:a.endPoint.y}),r.type="elk",r.data={points:n}}return r})}function bl(t){return`${t.source}-${t.target}`}function Xt(t){return t.type==="step"}function vl(t){return t.type==="triggered_run"}function Nl(t){return t.type==="artifact"}function ht(t){return!t.id}function Sr(t){return t.filter(Xt).filter(s=>!ht(s))}function kr(t){return t.filter(Nl).filter(s=>!ht(s))}function _r(t){return t.filter(vl).filter(s=>!ht(s))}function Cl(t){return t.filter(ht)}function wl(t){return t.filter(ht).filter(Xt)}function Sl(t,s){const r=kl(t,s),a=_l(t,s),n=Tl(t,s);return[...r,...a,...n]}function kl(t,s){return[...Sr(t),..._r(t)].map(a=>{const n=a.metadata;return{id:a.node_id,type:a.type,data:{...n,node_id:a.id,node_name:a.name,runStatus:s}}})}function _l(t,s){return kr(t).map(a=>{const n=a.metadata;return{id:a.node_id,type:"artifact",data:{...n,artifact_id:a.id,artifact_name:a.name,runStatus:s}}})}function Tl(t,s){return Cl(t).map(a=>{const n=Xt(a);return{id:a.node_id,type:n?"previewStep":"previewArtifact",data:{node_name:a.name,runStatus:s}}})}function El(t){const[s,r]=h.useState(!0),[a,n]=h.useState(null),[i,l,d]=Oa([]),[m,u,p]=Da([]),y=h.useMemo(()=>Sl(t.nodes,t.status),[t.nodes,t.status]),f=h.useMemo(()=>t.edges,[t.edges]),b=h.useCallback(async()=>{if(!(y.length<1))try{const{nodes:N,edges:M}=await gl(y,f),O=N.reduce((I,se)=>se.position.y<I.position.y||se.position.y===I.position.y&&se.position.x<I.position.x?se:I);n(O),l(N),u(M)}catch(N){console.error("Layout calculation failed:",N)}finally{r(!1)}},[y,f,l,u]);return h.useLayoutEffect(()=>{b()},[b]),{nodes:i,edges:m,onNodesChange:d,onEdgesChange:p,initialRender:s,topMostNode:a,shouldFitView:Ll(i)}}function Ll(t){const s=t.length;if(s===0||s<=10)return!0;if(s>40)return!1;if(t.length>0){const r=t.map(l=>l.position.x),a=Math.min(...r);return Math.max(...r)-a<=2e3}return!0}const Rl={elk:ti},Ol={step:ll,artifact:Wn,previewStep:nl,previewArtifact:al,triggered_run:cl};function Dl({dagData:t,refetchHandler:s,setActiveView:r}){const{nodes:a,edges:n,onNodesChange:i,onEdgesChange:l,initialRender:d,topMostNode:m,shouldFitView:u}=El(t);return t.nodes.length===0?e.jsx(le,{icon:e.jsx(Cs,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold",children:"No steps to display"}),e.jsx("p",{className:"text-base text-neutral-500",children:"There are no steps to display for this run."})]})}):d?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx(Nt,{}),e.jsx("div",{className:"mt-4 flex flex-col items-center",children:e.jsx("p",{className:"mb-5 text-display-xs",children:"Calculating DAG Visualization"})})]}):e.jsxs(jr,{children:[e.jsx(Pa,{minZoom:-2,connectOnClick:!1,nodesDraggable:!1,nodesConnectable:!1,edgeTypes:Rl,nodeTypes:Ol,nodes:a,edges:n,edgesFocusable:!1,onlyRenderVisibleElements:!0,multiSelectionKeyCode:null,onNodesChange:i,onEdgesChange:l,fitView:!0,fitViewOptions:u?void 0:m?{nodes:[m],maxZoom:1.2}:void 0,children:e.jsx(Xn,{refetch:s,viewSwitcher:r?e.jsx(wr,{activeView:"dag",setActiveView:r}):null})}),e.jsx(Cr,{})]})}function Pl({open:t,onOpenChange:s,nodeCount:r,threshold:a,onConfirm:n}){const i=()=>{n(),s(!1)};return e.jsx(Pt,{open:t,onOpenChange:s,children:e.jsxs(gs,{className:"p-0",children:[e.jsx(js,{className:"py-2 pl-5 pr-3",children:e.jsx(ys,{className:"text-text-lg font-semibold",children:"Switch to DAG View"})}),e.jsx("div",{className:"border-y border-theme-border-moderate px-5 py-5",children:e.jsxs(bs,{className:"space-y-2",children:[e.jsxs("p",{children:["This pipeline has ",e.jsxs("strong",{children:[r," nodes"]}),", which exceeds the recommended threshold of ",a," nodes for DAG visualization."]}),e.jsx("p",{children:"Rendering a large DAG may impact performance and take longer to load. Do you want to continue?"})]})}),e.jsxs(vs,{className:"flex justify-end gap-3 px-5 py-3",children:[e.jsx(Ns,{asChild:!0,children:e.jsx(E,{intent:"secondary",children:"Cancel"})}),e.jsx(da,{asChild:!0,children:e.jsx(E,{onClick:i,intent:"primary",children:"Continue"})})]})]})})}function zl({title:t,description:s}){return e.jsx("div",{className:"p-3",children:e.jsx(Is,{className:"flex flex-col items-center justify-center space-y-4 p-9",children:e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold text-theme-text-primary",children:t}),e.jsx("p",{className:"text-theme-text-secondary",children:s})]})})})}function Al({onSearch:t,search:s,setActiveView:r,refetchHandler:a}){return e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-3 p-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Fs,{value:s,onChange:t,placeholder:"Search...",className:"w-full max-w-[300px] pl-[36px]"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-1",children:e.jsx(Vs,{className:"size-4 fill-neutral-400"})})]}),e.jsx(wr,{activeView:"timeline",setActiveView:r}),e.jsxs(E,{className:"size-7 bg-theme-surface-primary",onClick:()=>{a()},emphasis:"subtle",intent:"secondary",children:[e.jsx("span",{className:"sr-only",children:"Refresh"}),e.jsx(St,{className:"h-5 w-5 fill-theme-text-primary"})]})]})}function Ml(t){const{openStepSheet:s,sheetState:r}=He(),a=r.lastContent?.id===t&&r.isOpen;function n(){t&&s(t)}return{isSelected:a,handleClick:n}}function Il({earliestStartTime:t,totalTimelineSpanMs:s,startTimeMs:r,duration:a,stepStatus:n}){const i=Math.max(s,1),l=r?(r-t)/i*100:0;let d=a*1e3/i*100;n==="running"&&(d=Math.max(100-l,1));const m=.5;return d<m&&(d=m),{offsetPercentage:l,barWidth:d}}function Vl({duration:t,startTimeMs:s,earliestStartTime:r,stepStatus:a,totalTimelineSpanMs:n}){const{offsetPercentage:i,barWidth:l}=Il({earliestStartTime:r,totalTimelineSpanMs:n,startTimeMs:s,duration:t,stepStatus:a});return e.jsx("div",{className:"rounded relative h-1 w-full overflow-hidden",children:e.jsx("div",{className:`absolute h-full rounded-rounded ${ua(a)}`,style:{left:`${i}%`,width:`${l}%`}})})}const xs=t=>h.createElement("svg",{viewBox:"0 0 30 8",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},h.createElement("path",{d:"M29.3536 4.35355C29.5488 4.15829 29.5488 3.84171 29.3536 3.64645L26.1716 0.464466C25.9763 0.269204 25.6597 0.269204 25.4645 0.464466C25.2692 0.659728 25.2692 0.976311 25.4645 1.17157L28.2929 4L25.4645 6.82843C25.2692 7.02369 25.2692 7.34027 25.4645 7.53553C25.6597 7.7308 25.9763 7.7308 26.1716 7.53553L29.3536 4.35355ZM0 4V4.5H29V4V3.5H0V4Z"}));function ps({artifact:t}){const{openArtifactSheet:s,sheetState:r}=He();function a(){t.id&&s(t.id)}return e.jsxs("button",{"data-selected":r.lastContent?.id===t.id&&r.isOpen,onClick:a,className:"group flex h-6 max-w-[150px] items-center gap-1 rounded-rounded border border-primary-100 bg-primary-25 px-1 transition-all duration-200 hover:border-primary-400 data-[selected=true]:border-primary-500 data-[selected=true]:bg-primary-500",children:[e.jsx("div",{className:"rounded-rounded bg-primary-50 p-0.5 group-data-[selected=true]:bg-white/20",children:e.jsx(Jt,{artifactType:t.metadata.type,className:"size-3 shrink-0 fill-primary-400 group-data-[selected=true]:fill-theme-text-negative"})}),e.jsx("div",{className:"truncate text-text-xs font-semibold text-theme-text-brand group-data-[selected=true]:text-theme-text-negative",children:t.name})]})}function Fl({step:t,runStatus:s}){const{openStepSheet:r,sheetState:a}=He();function n(){t.id&&r(t.id)}const i=tt(t.metadata.status,s);return e.jsxs("button",{"data-selected":a.lastContent?.id===t.id&&a.isOpen,onClick:n,className:"flex h-6 max-w-[150px] items-center gap-1 rounded-md border border-theme-border-moderate px-1 text-text-xs transition-all duration-200 hover:border-neutral-400 hover:shadow-md data-[selected=true]:border-theme-border-bold data-[selected=true]:shadow-md",children:[e.jsx(ge,{status:i?"unknown":t.metadata.status,className:"h-4 w-4 shrink-0"}),e.jsx("div",{className:"truncate font-semibold",children:t.name})]})}function $l({step:t,runStatus:s}){const{openTriggeredRunSheet:r,sheetState:a}=He();function n(){t.id&&r(t.id)}const i=tt(t.metadata.status,s);return e.jsxs("button",{"data-selected":a.lastContent?.id===t.id&&a.isOpen,onClick:n,className:"flex h-6 max-w-[150px] items-center gap-1 overflow-hidden rounded-md border border-theme-border-moderate px-1 text-text-xs transition-all duration-200 hover:border-neutral-400 hover:shadow-md data-[selected=true]:border-theme-border-bold data-[selected=true]:shadow-md",children:[e.jsx(wt,{className:`h-4 w-4 shrink-0 ${vt(t.metadata.status)}`}),e.jsx("div",{className:"truncate font-semibold",children:t.name}),e.jsx(ge,{status:i?"unknown":t.metadata.status,className:"h-4 w-4 shrink-0"})]})}const Bl=h.memo($l);function ql({timelineItem:t,runStatus:s}){const r=t.step,a=t.inputs,n=t.outputs,i=t.triggeredRuns;return e.jsx("div",{className:"overflow-x-auto px-5 py-2",children:e.jsxs("div",{className:"flex items-end gap-2",children:[a.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(xt,{children:["Input Artifacts (",a.length,")"]}),e.jsx("ul",{className:"flex items-center gap-1",children:a.map(l=>e.jsx("li",{children:e.jsx(ps,{artifact:l})},l.node_id))})]}),e.jsx("div",{className:"flex h-6 items-center",children:e.jsx(xs,{className:"w-[30px] shrink-0 fill-neutral-400"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(xt,{children:"Step"}),e.jsx(Fl,{step:r,runStatus:s})]}),(n.length>0||i.length>0)&&e.jsx("div",{className:"flex h-6 items-center",children:e.jsx(xs,{className:"w-[30px] shrink-0 fill-neutral-400"})}),n.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs(xt,{children:["Output Artifacts (",n.length,")"]}),e.jsx("ul",{className:"flex items-center gap-1",children:n.map(l=>e.jsx("li",{children:e.jsx(ps,{artifact:l})},l.node_id))})]}),i.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs(xt,{children:["Triggered Runs (",i.length,")"]}),e.jsx("ul",{className:"flex items-center gap-1",children:i.map(l=>e.jsx("li",{children:e.jsx(Bl,{step:l,runStatus:s})},l.node_id))})]})]})})}function xt({children:t}){return e.jsx("div",{className:"whitespace-nowrap text-text-xs text-theme-text-tertiary",children:t})}function Hl({timelineItem:t,earliestStartTime:s,runStatus:r,totalTimelineSpanMs:a}){const[n,i]=h.useState(!1),l=t.step.id,d=t.step.metadata.duration,m=t.step.name,u=t.step.metadata.status,p=t.inputs.length>0||t.outputs.length>0||t.triggeredRuns.length>0,{isSelected:y,handleClick:f}=Ml(l??void 0);return e.jsxs(Lr,{open:n,onOpenChange:i,className:"group",children:[e.jsxs("div",{"data-selected":y,className:"flex items-center text-text-sm transition-colors duration-200 data-[selected=true]:bg-theme-surface-tertiary group-data-[state=open]:border-b",children:[e.jsx("div",{className:"flex w-full max-w-[240px] items-center gap-1 border-r border-theme-border-moderate px-3 py-1",children:e.jsxs(ae,{children:[p?e.jsx(Rr,{children:e.jsx(Oe,{className:"size-3 rounded-sm fill-neutral-500 transition-transform duration-200 hover:bg-neutral-200 group-data-[state=closed]:-rotate-90"})}):e.jsx("div",{className:"size-3"}),e.jsxs(G,{children:[e.jsx(J,{children:e.jsx(ge,{className:"size-3 shrink-0",status:u})}),e.jsx(Y,{className:"capitalize",side:"right",children:u})]}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs(G,{children:[e.jsx(J,{asChild:!0,children:e.jsx("button",{className:"max-w-full truncate text-left font-semibold",onClick:f,children:m})}),e.jsx(Y,{side:"right",className:"z-10",children:m})]})}),d!==void 0&&e.jsx("div",{className:"text-text-xs text-theme-text-secondary",children:Ft(d)})]})}),e.jsx("div",{className:"min-w-0 flex-1 px-1",children:(d!==void 0||u==="running")&&e.jsx(Vl,{stepStatus:u,duration:d??0,startTimeMs:t.startTimeMs,earliestStartTime:s,totalTimelineSpanMs:a})})]}),e.jsx(Or,{children:e.jsx(ql,{timelineItem:t,runStatus:r})})]})}function Ul(){return e.jsx("div",{className:"flex w-full items-center gap-1 bg-theme-surface-secondary px-3 py-1",children:e.jsx("p",{className:"text-text-xs font-semibold uppercase text-theme-text-tertiary",children:"skipped steps due to failure"})})}function Kl({stepName:t,runStatus:s}){const r=s==="failed",a=s==="completed",n=s==="stopped";return e.jsxs("div",{className:"flex items-center text-text-sm transition-colors duration-200 data-[selected=true]:bg-theme-surface-tertiary group-data-[state=open]:border-b",children:[e.jsxs("div",{className:"flex w-full max-w-[240px] items-center gap-1 border-r border-theme-border-moderate px-3 py-1",children:[e.jsx("div",{className:"size-3"}),r?e.jsx(kt,{className:"h-4 w-4 shrink-0 fill-blue-500/50"}):e.jsx(ge,{status:a?"completed":n?"stopped":"running",className:"h-4 w-4 fill-theme-text-warning"}),e.jsx("div",{className:"flex-1 truncate text-left font-semibold text-theme-text-primary/50",children:t})]}),e.jsx("div",{className:"min-w-0 flex-1 px-1"})]})}function Ql({timelineItems:t,earliestStartTime:s,runStatus:r,totalTimelineSpanMs:a}){const n=h.useRef(null),i=t.length,l=ha({count:i,getScrollElement:()=>n.current,estimateSize:()=>120}),d=l.getVirtualItems();return e.jsx("div",{ref:n,className:"flex-1 overflow-auto p-3 contain-strict",children:e.jsx("div",{style:{height:l.getTotalSize(),width:"100%",position:"relative"},children:e.jsx("div",{className:"divide-y divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate bg-theme-surface-primary",style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${d[0]?.start??0}px)`},children:d.map(m=>{const u=t[m.index],p=u.type;return e.jsxs("div",{"data-index":m.index,ref:l.measureElement,children:[p==="timeline"&&e.jsx(Hl,{runStatus:r,timelineItem:u.item,earliestStartTime:s,totalTimelineSpanMs:a}),p==="separator"&&e.jsx(Ul,{}),p==="placeholder"&&e.jsx(Kl,{stepName:u.item.name,runStatus:r})]},m.key)})})})})}function Wl(t){const[s,r]=h.useState(Date.now()),a=h.useRef(null),n=h.useCallback(()=>{r(Date.now())},[]);return h.useEffect(()=>(t?a.current=setInterval(n,100):a.current&&(clearInterval(a.current),a.current=null),()=>{a.current&&(clearInterval(a.current),a.current=null)}),[t,n]),{currentTime:s}}function Zl(t){const s=t.map(r=>r.startTimeMs).filter(r=>r!==void 0);return s.length>0?Math.min(...s):0}function Gl(t,s){if(t.length===0)return 0;const r=t.map(d=>d.startTimeMs).filter(d=>d!==void 0),a=t.map(d=>d.step.metadata.duration).filter(d=>d!==void 0&&d>0);if(r.length===0&&a.length===0)return 0;if(r.length===0)return Math.max(...a)*1e3;if(a.length===0)return Math.max(...r)-Math.min(...r);const n=Math.min(...r),i=t.filter(d=>d.startTimeMs!==void 0).map(d=>d.step.metadata.duration!==void 0?d.startTimeMs+d.step.metadata.duration*1e3:s!==void 0?s:d.startTimeMs);return(i.length>0?Math.max(...i):Math.max(...r))-n}function Jl({steps:t,artifacts:s,edges:r,rawTriggeredRuns:a}){return t.map(l=>{const d=[],m=[],u=[];r.filter(b=>b.source===l.node_id||b.target===l.node_id).forEach(b=>{if(b.source===l.node_id){const N=s.find(O=>O.node_id===b.target);N&&u.push(N);const M=a.find(O=>O.node_id===b.target);M&&d.push(M)}else{const N=s.find(O=>O.node_id===b.source);N&&m.push(N);const M=a.find(O=>O.node_id===b.source);M&&d.push(M)}});let y;if(l.metadata.start_time)try{y=Ss(l.metadata.start_time).getTime(),isNaN(y)&&(console.warn(`Invalid date format for startTime: ${l.metadata.start_time}`),y=void 0)}catch(b){console.warn(`Failed to parse startTime: ${l.metadata.start_time}`,b),y=void 0}return{triggeredRuns:d,step:l,inputs:m,outputs:u,startTimeMs:y}}).sort((l,d)=>l.startTimeMs===void 0&&d.startTimeMs===void 0?0:l.startTimeMs===void 0?1:d.startTimeMs===void 0?-1:l.startTimeMs-d.startTimeMs)}function Yl(t,s,r){const a=t.nodes,n=t.edges,i=Sr(a),l=kr(a),d=_r(a),m=wl(a),u=Jl({steps:i,artifacts:l,edges:n,rawTriggeredRuns:d}),p=Zl(u);return{totalTimelineSpanMs:Gl(u,s?r:void 0),timelineItems:u,earliestStartTime:p,placeholderSteps:m}}function Xl(t,s){return t.length===0?{title:"No steps available",description:"This pipeline run doesn't contain any steps to display."}:{title:"No steps found",description:`No steps found that match the search "${s}".`}}function eo(t,s){return t.filter(r=>{if(!s.trim())return!0;if(r.type==="separator")return!1;const a=s.toLowerCase();if(r.type==="timeline"){const n=r.item;return!!(n.step.name.toLowerCase().includes(a)||n.inputs.some(i=>i.name.toLowerCase().includes(a))||n.outputs.some(i=>i.name.toLowerCase().includes(a)))}return r.type==="placeholder"?!!r.item.name.toLowerCase().includes(a):!1})}function to({timelineItems:t,runStatus:s,placeholderSteps:r}){const a=[];return t.forEach(n=>{a.push({type:"timeline",item:n})}),s==="failed"&&(r.length>0&&a.push({type:"separator"}),r.forEach(n=>{a.push({type:"placeholder",item:n})})),a}function so({dagData:t,setActiveView:s,refetchHandler:r}){const[a,n]=h.useState(""),i=t.status==="running",{currentTime:l}=Wl(i),{timelineItems:d,earliestStartTime:m,totalTimelineSpanMs:u,placeholderSteps:p}=Yl(t,i,l),y=to({timelineItems:d,runStatus:t.status,placeholderSteps:p}),f=eo(y,a);return e.jsxs(jr,{children:[e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(Al,{onSearch:n,search:a,refetchHandler:r,setActiveView:s}),f.length>0?e.jsx(Ql,{runStatus:t.status,timelineItems:f,earliestStartTime:m,totalTimelineSpanMs:u}):e.jsx(zl,{...Xl(d,a)})]}),e.jsx(Cr,{})]})}function ro({runId:t}){return["runs",t,"dag"]}async function ao({runId:t}){const s=Le(Re.runs.dag(t)),r=await Ae(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(r.status===404&&Vt(),!r.ok)throw new Me({message:`Error while fetching pipeline run ${t}`,status:r.status,statusText:r.statusText});return r.json()}function no(t,s){return De({queryKey:ro(t),queryFn:()=>ao(t),...s})}const Et=500;function io(t){const[s,r]=h.useState(null),[a,n]=h.useState(!1),[i,l]=h.useState(!1),d=h.useRef(null),m=h.useMemo(()=>["runs",t],[t]),u=ot(),p=no({runId:t},{refetchInterval:I=>I.state.data?.status==="running"||I.state.data?.status==="initializing"?3e3:!1}),y=h.useMemo(()=>p.data?p.data.nodes.length>Et?"timeline":"dag":"timeline",[p.data]),f=s??y,b=p.data?.nodes.length??0,N=b>Et,M=I=>{if(I==="dag"&&N&&!i){n(!0);return}r(I)},O=()=>{l(!0),r("dag")};return h.useEffect(()=>{if(p.data){const I=p.data.status;d.current!==null&&d.current!==I&&u.invalidateQueries({queryKey:m}),d.current=I}},[p.data,u,t,m]),{dagQuery:p,activeView:f,setActiveView:M,showDagConfirmation:a,setShowDagConfirmation:n,confirmDagView:O,nodeCount:b,threshold:Et}}function lo({runId:t}){const{dagQuery:s,activeView:r,setActiveView:a,showDagConfirmation:n,setShowDagConfirmation:i,confirmDagView:l,nodeCount:d,threshold:m}=io(t);if(s.isError)return e.jsx(le,{icon:e.jsx(Ne,{className:"h-[120px] w-[120px] fill-neutral-300"}),children:e.jsx("p",{className:"text-center",children:"There was an error loading the DAG visualization."})});if(s.isPending)return e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx(Nt,{}),e.jsx("div",{className:"mt-4 flex flex-col items-center",children:e.jsx("p",{className:"mb-5 text-display-xs",children:"Loading Run Visualization"})})]});const u=s.data;if(r==="dag")return e.jsx(Dl,{dagData:u,refetchHandler:()=>s.refetch(),setActiveView:a});if(r==="timeline")return e.jsxs(e.Fragment,{children:[e.jsx(so,{dagData:u,setActiveView:a,refetchHandler:()=>s.refetch()}),e.jsx(Pl,{open:n,onOpenChange:i,nodeCount:d,threshold:m,onConfirm:l})]})}function ic(){const{runId:t}=Ie(),s=h.useRef(null),[r,a]=h.useState(!1);function n(){s.current?.collapse()}function i(){const l=s.current;l&&l.expand()}return e.jsxs("div",{className:"flex h-full flex-1 flex-col overflow-hidden",children:[e.jsx(sn,{}),e.jsxs(Va,{direction:"horizontal",className:"relative",children:[e.jsxs(ls,{minSize:25,defaultSize:50,children:[e.jsx(lo,{runId:t}),e.jsx(Hn,{children:e.jsx(Un,{isCollapsed:r,handlePanelToggle:i})})]}),e.jsx(Fa,{className:"w-[1px] bg-theme-border-moderate transition-colors duration-200 data-[resize-handle-state=drag]:bg-theme-border-bold data-[resize-handle-state=hover]:bg-theme-border-bold"}),e.jsxs(ls,{collapsible:!0,ref:s,className:"!overflow-y-auto",minSize:25,defaultSize:50,onCollapse:()=>a(!0),onExpand:()=>a(!1),children:[e.jsx($n,{handlePanelToggle:n}),e.jsx(Bn,{})]})]})]})}export{ic as default};
