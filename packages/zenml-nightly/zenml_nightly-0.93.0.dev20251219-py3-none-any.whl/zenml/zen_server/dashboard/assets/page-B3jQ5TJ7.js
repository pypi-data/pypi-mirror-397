import{j as e,aG as b,aC as B,aD as H,aB as q}from"./@radix-DGuLZ9Nd.js";import{a as d}from"./@monaco-editor-CuNQBT0l.js";import{a as p,C as U,z as h,u as V,t as Q,F as Z}from"./@zod-2qqdh1cM.js";import{P as G,a as v,b as K}from"./react-resizable-panels.browser-0v9wo-oN.js";import{C as $}from"./ComponentIcon-D2oU0Tt4.js";import{Y as J,Z as Y,_ as W,ar as X,a0 as ee,bn as O,D as P,aI as m,ao as te,B as x,as as se,bq as re,br as ne,bk as ae,bl as oe,bm as ie,ce,bH as le,I as R,aV as de,at as me,s as pe,aJ as ue,aK as he,S as xe,r as E,w as fe,x as ge}from"./index-DHfBZI1k.js";import{k as ke,l as je,h as be}from"./@tanstack-B6Lqf40n.js";import{s as ve,R as ye,a as Ne,u as Se}from"./create-stack-Db1JEBLs.js";import{S as we}from"./flavor-select-BtkjlzG7.js";import{C as Ce}from"./configuration-form-B3W7D9Ji.js";import{s as j}from"./constants-Dj_C1ZPH.js";import{L as Le,c as ze}from"./@react-router-edahAHd8.js";import{s as Te}from"./index-DeaVGGBZ.js";import{s as _e}from"./sharedSchema-CDIogSW5.js";import"./@elkjs-CmhuJAjY.js";import"./bar-chart-square-check-BAWR96En.js";import"./layout-BBB8hotd.js";import"./transform-DsIiQtL0.js";import"./@reactflow-BVD3Tc7O.js";import"./index-B_OPt8Ha.js";import"./form-CN5IZ7o5.js";import"./plus-BjxzjZ9E.js";import"./trash-Dp8wQrEE.js";import"./check-Dbdrcavu.js";import"./CodeSnippet-DWvTxFp3.js";import"./file-text-B8km-r-t.js";import"./stack-detail-query-B8BVRHRf.js";import"./index.es-C5KVyOUc.js";const y={helpLink:"https://docs.zenml.io/stacks/stack-components/orchestrators",description:"An orchestrator is a special kind of backend that manages the running of each step of the pipeline. Orchestrators administer the actual pipeline runs. By default, ZenML initializes your repository with an orchestrator that runs everything on your local machine."},N={helpLink:"https://docs.zenml.io/stacks/stack-components/artifact-stores",description:"The Artifact Store is a central component in any MLOps stack. As the name suggests, it acts as a data persistence layer where artifacts (e.g. datasets, models) ingested or generated by the machine learning pipelines are stored."},S={helpLink:"https://docs.zenml.io/stacks/stack-components/container-registries",description:"Container registry is used to store container images that are built to run machine learning pipelines in remote environments. Containerization of the pipeline code creates a portable environment that allows code to run in an isolated manner."},w={description:"Step operators allow you to run individual steps in a custom environment different from the default one used by your active orchestrator.",helpLink:"https://docs.zenml.io/stacks/stack-components/step-operators"},C={description:"Model deployers are stack components responsible for online model serving. They are responsible for deploying models to a remote server. Model deployers also act as a registry for models that are served with ZenML.",helpLink:"https://docs.zenml.io/stacks/stack-components/model-deployers"},L={description:"ZenML supports connecting to a Redis-backed Feast feature store as a stack component integration.",helpLink:"https://docs.zenml.io/stacks/stack-components/feature-stores"},z={description:"Experiment trackers let you track your ML experiments by logging the parameters and allowing you to compare between different runs.",helpLink:"https://docs.zenml.io/stacks/stack-components/experiment-trackers"},T={description:"Alerters allow you to send messages to chat services (like Slack, Discord, Mattermost, etc.) from within your pipelines. This is useful to immediately get notified when failures happen, for general monitoring/reporting, and also for building human-in-the-loop ML.",helpLink:"https://docs.zenml.io/stacks/stack-components/alerters"},_={description:"Annotators are a stack component that enables the use of data annotation as part of your ZenML stack and pipelines.",helpLink:"https://docs.zenml.io/stacks/stack-components/annotators"},F={description:"Data Validators used in ZenML pipelines usually generate data profiles and data quality check reports that are versioned and stored in the Artifact Store and can be retrieved and visualized later.",helpLink:"https://docs.zenml.io/stacks/stack-components/data-validators"},M={description:"The image builder is an essential part of most remote MLOps stacks. It is used to build container images such that your machine-learning pipelines and steps can be executed in remote environments.",helpLink:"https://docs.zenml.io/stacks/stack-components/image-builders"},I={description:"Model registries are centralized storage solutions for managing and tracking machine learning models across various stages of development and deployment.",helpLink:"https://docs.zenml.io/stacks/stack-components/model-registries"},D={description:"Deployers transform ML pipelines into long-running HTTP services for real-time, on-demand execution through API endpoints.",helpLink:"https://docs.zenml.io/stacks/stack-components/deployers"},A={description:"Log stores are responsible for storing the logs of the pipeline runs.",helpLink:"https://docs.zenml.io/stacks/stack-components/log-stores"};function Fe({type:t}){const{description:s,link:r}=Me(t);return e.jsx(J,{children:e.jsxs(Y,{delayDuration:200,children:[e.jsxs(W,{children:[e.jsx(X,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"}),e.jsxs("div",{className:"sr-only",children:["Info for ",t]})]}),e.jsxs(ee,{align:"start",side:"bottom",className:"flex max-w-xl flex-col gap-2 bg-theme-surface-primary p-5 text-text-sm text-theme-text-primary",children:[e.jsx("p",{children:s}),e.jsx("a",{className:"link mt-2 text-primary-400",target:"_blank",href:r,children:"Learn more"})]})]})})}function Me(t){switch(t){case"orchestrator":return{description:y.description,link:y.helpLink};case"alerter":return{description:T.description,link:T.helpLink};case"annotator":return{description:_.description,link:_.helpLink};case"artifact_store":return{description:N.description,link:N.helpLink};case"container_registry":return{description:S.description,link:S.helpLink};case"data_validator":return{description:F.description,link:F.helpLink};case"experiment_tracker":return{description:z.description,link:z.helpLink};case"feature_store":return{description:L.description,link:L.helpLink};case"image_builder":return{description:M.description,link:M.helpLink};case"model_deployer":return{description:C.description,link:C.helpLink};case"model_registry":return{description:I.description,link:I.helpLink};case"step_operator":return{description:w.description,link:w.helpLink};case"deployer":return{description:D.description,link:D.helpLink};case"log_store":return{description:A.description,link:A.helpLink}}}function Ie({type:t,setSelectedFlavor:s}){return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsxs(P,{children:["Select ",m(t)," Flavor"]})}),e.jsx(te,{viewportClassName:"max-h-[70vh]",children:e.jsx("div",{className:"p-5",children:e.jsx(we,{setSelectedFlavor:s,type:t})})})]})}function De({name:t,id:s,backHandler:r,type:a,successHandler:o}){const i=d.useId();return e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-full",children:e.jsxs("div",{className:"flex w-0 flex-1 items-center gap-2",children:[e.jsxs(x,{intent:"secondary",emphasis:"subtle",className:"flex aspect-square size-6 items-center justify-center",onClick:()=>r(),children:[e.jsx(se,{className:"size-5 shrink-0"}),e.jsx("span",{className:"sr-only",children:"Go step back"})]}),e.jsxs(P,{className:"truncate",children:["Configure your ",m(t)," ",m(a)]})]})}),e.jsx(Ce,{useMaxHeight:!0,flavorId:s,formId:i,successHandler:o,FooterComponent:Ae})]})}function Ae({formId:t,isPending:s}){return e.jsx(re,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{asChild:!0,children:e.jsx(x,{size:"md",intent:"secondary",children:"Cancel"})}),e.jsxs(x,{size:"md",disabled:s,type:"submit",form:t,children:[s&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),"Register Component"]})]})})}function $e({type:t}){const[s,r]=d.useState(!1),[a,o]=d.useState(0),[i,c]=d.useState(null);async function n(l){r(l),await ve(100),l||(o(0),c(null))}function f(l){c({id:l.id,name:l.name,logoUrl:l.body?.logo_url??void 0}),o(g=>g+1)}function u(){o(0),c(null)}return e.jsxs(ae,{open:s,onOpenChange:l=>n(l),children:[e.jsx(oe,{asChild:!0,children:e.jsxs("button",{className:"w-full rounded-md border border-dashed border-neutral-300 bg-theme-surface-tertiary py-5 text-theme-text-secondary",children:["New ",m(t)]})}),e.jsxs(ie,{className:"w-full sm:max-w-[640px] md:max-w-3xl xl:max-w-[1080px]",children:[a===0&&e.jsx(Ie,{setSelectedFlavor:f,type:t}),a===1&&!!i&&e.jsx(De,{successHandler:()=>n(!1),backHandler:u,...i,type:t})]})]})}function Oe(){return e.jsxs(e.Fragment,{children:[j.map(t=>e.jsx(b,{className:"space-y-5 p-5",value:t,children:e.jsx(Ee,{type:t})},t)),e.jsx(b,{className:"h-full",value:"",children:e.jsx("div",{className:"flex h-full w-full items-center justify-center text-theme-text-tertiary",children:"Select a category to add a new component"})})]})}function Pe({type:t,search:s}){const r=ke({...de.componentListInfinite({sort_by:"desc:updated",type:t,...s?{name:`contains:${s}`}:{}})}),{control:a,watch:o,setValue:i}=p();return r.isError?e.jsx("p",{children:"Error while fetching Components"}):r.isPending?e.jsx("div",{className:"flex w-full flex-1 items-center justify-center",children:e.jsx(me,{})}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("ul",{className:"space-y-1",children:r.data.pages.map(c=>c.items.map(n=>e.jsx("li",{children:e.jsx(U,{name:`components.${t}.id`,control:a,render:({field:{onChange:f,...u}})=>e.jsxs(ye,{className:"justify-between bg-theme-surface-primary font-medium","data-state":o(`components.${t}.id`)===n.id?"selected":"unselected",htmlFor:n.id,children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(Ne,{...u,id:n.id,type:"radio",value:n.id,onChange:l=>{i(`components.${t}.name`,n.name),i(`components.${t}.logoUrl`,n.body?.logo_url||""),f(l)},checked:o(`components.${t}.id`)===n.id,name:t}),e.jsx("img",{alt:"flavor icon",src:pe(n.body?.logo_url||""),width:24,height:24}),e.jsxs("div",{className:"min-w-0 truncate",children:[e.jsx("div",{className:"truncate font-semibold",children:n.name}),e.jsx("div",{className:"truncate text-text-xs text-theme-text-secondary",children:n.id.split("-")[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-text-sm",children:[n.resources?.user&&e.jsx(ue,{avatarUrl:n.resources.user.body?.avatar_url??void 0,username:n.resources.user.name,isServiceAccount:!!n.resources.user.body?.is_service_account}),n.body?.updated&&e.jsx("div",{className:"whitespace-nowrap text-theme-text-secondary",children:e.jsx(he,{short:!0,dateString:n.body.updated})})]})]})})},n.id)))}),e.jsx($e,{type:t}),r.hasNextPage&&e.jsx(x,{onClick:()=>r.fetchNextPage(),type:"button",size:"md",intent:"secondary",emphasis:"subtle",className:"flex w-full items-center justify-center bg-theme-surface-primary",children:e.jsxs("div",{className:"flex items-center gap-1",children:[r.isFetchingNextPage&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),"Load more"]})})]})}function Re({type:t}){return e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-5 w-5 fill-primary-400",type:t}),e.jsx("h2",{className:"text-text-lg font-semibold",children:m(t)}),e.jsx(Fe,{type:t})]}),e.jsxs("p",{className:"text-theme-text-secondary",children:["Select a existing ",ce(t)," from your server:"]})]})}function Ee({type:t}){const[s,r]=d.useState(""),{watch:a,setValue:o}=p(),i=a(`components.${t}`);return d.useEffect(()=>{i&&!i.id&&o(`components.${t}`,null)},[i,o,t]),e.jsxs(e.Fragment,{children:[e.jsx(Re,{type:t}),e.jsx(Be,{search:s,setSearch:r}),e.jsx(Pe,{search:s,type:t})]})}function Be({setSearch:t,search:s}){const[r,a]=d.useState(s),o=d.useCallback(le(t,500),[]);d.useEffect(()=>()=>{o.cancel()},[o]);function i(c){a(c),o(c)}return e.jsx(R,{value:r,onChange:c=>i(c.target.value),placeholder:"Search..."})}function He({type:t}){const{watch:s,formState:{errors:r}}=p(),a=s(`components.${t}`),o=a&&a.id;return e.jsx("div",{"data-error":!o&&r.components&&r.components[t]?"true":"false","data-filled":o?"true":"false",className:"flex h-[110px] flex-col items-center justify-center space-y-2 truncate whitespace-nowrap rounded-md border border-theme-border-moderate bg-theme-surface-secondary py-5 text-center text-text-sm text-theme-text-secondary transition-all duration-150 hover:bg-theme-surface-primary hover:shadow-sm data-[error=true]:border-theme-text-error data-[filled=true]:border-success-400 data-[filled=true]:bg-theme-surface-primary data-[state=active]:bg-theme-surface-primary group-data-[state=active]/trigger:bg-theme-surface-primary group-data-[state=active]/trigger:shadow-md data-[error=false]:data-[filled=false]:group-data-[state=active]/trigger:border-theme-border-bold",children:o?e.jsx(qe,{type:t}):e.jsx(Ue,{type:t})})}function qe({type:t}){const{watch:s}=p(),r=s(`components.${t}`);return r&&r.id?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-text-sm",children:[e.jsx("img",{width:24,height:24,src:r.logoUrl,alt:`Icon of ${r.name}`}),e.jsxs("div",{className:"space-y-0.25",children:[e.jsx("div",{className:"text-theme-text-primary",children:r.name}),e.jsx("div",{className:"text-text-xs text-theme-text-tertiary",children:m(t)})]})]}):null}function Ue({type:t}){return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-5 w-5 shrink-0 fill-theme-text-tertiary group-data-[state=active]/trigger:fill-theme-surface-strong",type:t}),e.jsx("span",{children:m(t)})]})}function Ve(){return e.jsxs("div",{className:"flex h-full flex-col justify-between space-y-5",children:[e.jsxs("div",{className:"space-y-5 p-5",children:[e.jsx(Ge,{}),e.jsx(Qe,{})]}),e.jsx(Ze,{})]})}function Qe(){const{watch:t,resetField:s}=p();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-text-lg font-semibold",children:"Add Components"}),e.jsxs("p",{className:"text-theme-text-secondary",children:["All stacks have at minimum an orchestrator and an artifact store."," ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://docs.zenml.io/stacks#stack-components-guide",className:"link text-primary-400",children:"Learn more"})]})]}),e.jsx(B,{children:e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:j.map(r=>e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"group/trigger w-full",value:r,children:e.jsx(He,{type:r})}),t(`components.${r}.id`)&&e.jsx("button",{type:"button",onClick:a=>{a.preventDefault(),s(`components.${r}`)},className:"absolute right-[-12px] top-[-12px] flex aspect-square h-[28px] w-[28px] items-center justify-center rounded-rounded bg-theme-surface-primary",children:e.jsx(xe,{className:"h-5 w-5 shrink-0 fill-success-400"})})]},r))})})]})}function Ze(){const{formState:{isSubmitting:t}}=p(),s=!!je();return e.jsxs("div",{className:"flex items-center justify-end space-x-2 border-t border-theme-border-moderate p-5",children:[e.jsx(x,{asChild:!0,intent:"secondary",size:"md",children:e.jsx(Le,{to:E.stacks.create.index,children:"Cancel"})}),e.jsxs(x,{className:"flex items-center gap-1",disabled:t||s,size:"md",children:[(s||t)&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),"Register Stack"]})]})}function Ge(){const{register:t,formState:{errors:s}}=p();return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-text-sm",htmlFor:"stack-name",children:"Stack Name"}),e.jsx(R,{id:"stack-name",className:`${s.stackName?"border-red-500":""} w-full`,placeholder:"zenml-stack",...t("stackName")}),e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"The stack name must be unique and cannot match an existing stack."}),s.stackName&&e.jsx("p",{className:"text-text-xs text-red-500",children:s.stackName.message?.toString()})]})}const k=h.object({id:h.string().trim().min(1),name:h.string().trim().min(1),logoUrl:h.string().trim().min(1)}),Ke=j.reduce((t,s)=>(t[s]=k.nullable(),t),{}),Je=h.object({stackName:_e,components:h.object({...Ke,orchestrator:k,artifact_store:k})});function Ye(){const{toast:t}=fe(),s=ze(),r=be(),a=Se({onSuccess:async()=>{r.invalidateQueries({queryKey:Te.all}),s(E.stacks.overview)},onError:c=>{t({status:"error",emphasis:"subtle",icon:e.jsx(ge,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:c.message,rounded:!0})}});function o(c){const n=Object.entries(c.components).reduce((u,[l,g])=>(g&&(u[l]=[g.id]),u),{}),f={name:c.stackName,components:n};a.mutate({payload:f})}const i=V({resolver:Q(Je),defaultValues:{components:{alerter:null,orchestrator:{},annotator:null,artifact_store:{},container_registry:null,data_validator:null,experiment_tracker:null,feature_store:null,model_registry:null,image_builder:null,model_deployer:null,step_operator:null,deployer:null,log_store:null},stackName:""}});return{createManualStack:o,form:i}}function Ct(){const[t,s]=d.useState(""),{createManualStack:r,form:a}=Ye();return e.jsx(Z,{...a,children:e.jsx(q,{value:t,onValueChange:s,className:"flex-1 overflow-hidden",children:e.jsx("form",{onSubmit:a.handleSubmit(r),className:"h-full",children:e.jsxs(G,{direction:"horizontal",className:"h-full !flex-col md:!flex-row",children:[e.jsx(v,{className:"!overflow-y-auto",defaultSize:50,minSize:33,children:e.jsx(Oe,{})}),e.jsx(K,{className:"w-[1px] bg-theme-border-moderate transition-colors duration-200 data-[resize-handle-state=drag]:bg-theme-border-bold data-[resize-handle-state=hover]:bg-theme-border-bold"}),e.jsx(v,{className:"!overflow-y-auto bg-theme-surface-primary",defaultSize:50,minSize:33,children:e.jsx(Ve,{})})]})})})})}export{Ct as default};
