import{j as e}from"./@radix-DGuLZ9Nd.js";import{S as C}from"./plus-BjxzjZ9E.js";import{S as y}from"./refresh-DNxZUtB4.js";import{S as w}from"./SearchField-DS1lx7M6.js";import{ai as p,B as m,r as o,e as h,a4 as D,J as v,N,O as b,Q as P,R as k,U as A,V as x,b8 as T,a1 as f,b9 as R,T as _,a2 as B,aU as I,ba as F,aJ as E,aK as L}from"./index-DHfBZI1k.js";import{b as g}from"./@tanstack-B6Lqf40n.js";import{L as i,f as O}from"./@react-router-edahAHd8.js";import{B as U}from"./button-group-basic-yoHwvvhG.js";import{P as Q}from"./Pagination-2lWLXiuP.js";import{z as l}from"./@zod-2qqdh1cM.js";import{D as M}from"./deployment-status-tag-CFG_a1MF.js";import{P as z}from"./pipeline-link-A-4bNAsN.js";import{A as G}from"./action-cell-Biol8Lia.js";import{S as q}from"./trash-Dp8wQrEE.js";import{D as H,a as J}from"./DeleteAlertDialog-DdUiWXzk.js";import{c as K}from"./helper-BOgrUHnZ.js";import{u as V}from"./update-snapshot-CNfSyM1s.js";import{u as $}from"./bulk-delete-qYbQtEY6.js";import{a as W}from"./@monaco-editor-CuNQBT0l.js";const{ContextProvider:ye,useContext:c}=K();function j(){const{setRowSelection:t}=c(),{mutateAsync:s}=V();async function n(a){await s({snapshotId:a,payload:{name:!1}})}return $({deleteFn:n,queryKeyToInvalidate:p.all,setRowSelection:t})}function X(){const{selectedRowCount:t,selectedRowIDs:s}=c(),{bulkDelete:n}=j();async function a(){await n(s)}return e.jsx(U,{itemName:"Pipeline Snapshot",selectedItemCount:t,onDeleteSelected:a})}function we({params:t,displayCreateButton:s=!1}){const{refetch:n}=g({...p.list(t),throwOnError:!0}),{selectedRowCount:a}=c();return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1",children:[a?e.jsx(X,{}):e.jsx(w,{searchParams:t}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(m,{className:"bg-theme-surface-primary",intent:"primary",emphasis:"subtle",size:"md",onClick:()=>n(),children:[e.jsx(y,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),s&&e.jsx(m,{className:"whitespace-nowrap",asChild:!0,size:"md",children:e.jsxs(i,{to:o.projects.snapshots.create,children:[e.jsx(C,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"Create Snapshot"})]})})]})]})}function De({params:t,columns:s}){const{rowSelection:n,setRowSelection:a}=c(),r=g({...p.list(t),throwOnError:!0});if(r.isPending)return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(h,{className:"h-[500px] w-full"})}),e.jsx(h,{className:"h-[36px] w-[300px]"})]});if(r.isError)return e.jsx("p",{children:"Error fetching snapshots"});const d=r.data;return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(D,{columns:s,data:d.items,rowSelection:n,onRowSelectionChange:a,getRowId:S=>S.id})}),d.total_pages>1&&e.jsx(Q,{searchParams:t,paginate:d})]})}const u=1,Y=l.object({page:l.coerce.number().min(u).optional().default(u).catch(u),name:l.string().optional(),operator:l.enum(["and","or"]).optional()});function ve(){const[t]=O(),{page:s,name:n,operator:a}=Y.parse({page:t.get("page")||void 0,name:t.get("name")||void 0});return{page:s,name:n,logical_operator:a}}function Z({deleteHandler:t}){return e.jsx(H,{title:"Delete Pipeline Snapshots",handleDelete:t,children:e.jsxs(J,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}function ee({deleteHandler:t,open:s,setOpen:n}){return e.jsx(v,{open:s,onOpenChange:n,children:e.jsx(Z,{deleteHandler:t})})}function te({snapshotId:t}){const[s,n]=W.useState(!1),{bulkDelete:a}=j();async function r(){await a([t]),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(ee,{deleteHandler:r,open:s,setOpen:n}),e.jsxs(N,{children:[e.jsx(b,{asChild:!0,children:e.jsx(P,{children:e.jsx("span",{className:"sr-only",children:"Open pipeline snapshot actions"})})}),e.jsx(k,{align:"end",sideOffset:7,children:e.jsxs(A,{onClick:()=>n(!0),className:"cursor-pointer space-x-2",children:[e.jsx(q,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})})]})]})}function Ne(){return{id:"check",header:({table:t})=>e.jsx(x,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),meta:{width:"1%"},cell:({row:t})=>e.jsx(x,{id:t.id,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler(),className:"h-3 w-3"})}}function be(){return{id:"name",header:"Snapshot",accessorFn:t=>t.name,cell:({row:t})=>{const s=t.original.name,n=t.original.id;return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 shrink-0 fill-primary-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{to:o.projects.snapshots.detail.overview(n),className:"grid grid-cols-1 items-center gap-1",children:e.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:s??"Unnamed"})}),e.jsx(f,{copyText:s??""})]}),e.jsxs(i,{to:o.projects.snapshots.detail.overview(n),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:R(n)}),e.jsx(f,{copyText:n})]})]})]})}}}function Pe(){return{id:"deployment",header:"Deployment",accessorFn:t=>t.resources?.deployment?.id,cell:({row:t})=>{const s=t.original.resources?.deployment,n=s?.body?.status,a=s?.id;return!n||!a?null:e.jsx(i,{to:o.projects.deployments.detail.overview(a),children:e.jsx(M,{status:n})})}}}function ke(){return{id:"pipeline",header:"Pipeline",accessorFn:t=>t.resources?.pipeline?.name,cell:({row:t})=>{const s=t.original.resources?.pipeline;return s?e.jsx(z,{pipelineId:s.id,pipelineName:s.name}):null}}}function Ae(){return{id:"latest-run",header:"Latest Run",accessorFn:t=>t.resources?.latest_triggered_run_id,cell:({row:t})=>{const s=t.original.resources?.latest_run_id,n=t.original.resources?.latest_run_status;return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(i,{to:o.projects.runs.detail(s),children:e.jsxs(_,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:B(n),children:[e.jsx(I,{className:`h-3 w-3 ${F(n)}`}),s?.split("-")[0]]})})}}}function Te(){return{id:"latest-run-author",header:"Latest Run Author",accessorFn:t=>t.resources?.latest_run_author,cell:({row:t})=>{const s=t.original.resources?.user;return s?e.jsx(E,{username:s.name,isServiceAccount:!!s.body?.is_service_account,avatarUrl:s.body?.avatar_url??void 0}):null}}}function Re(){return{id:"created",header:"Created at",accessorFn:t=>({date:t.body?.created}),cell:({getValue:t})=>{const{date:s}=t();return e.jsx(L,{dateString:s})}}}function _e(){return{id:"admin_actions",header:void 0,accessorFn:t=>t.id,cell:({row:t})=>{const s=t.original.id;return e.jsx(G,{children:e.jsx(te,{snapshotId:s})})}}}export{De as P,we as S,be as a,Pe as b,Ne as c,Ae as d,Te as e,Re as f,_e as g,ye as h,ke as i,ve as u};
