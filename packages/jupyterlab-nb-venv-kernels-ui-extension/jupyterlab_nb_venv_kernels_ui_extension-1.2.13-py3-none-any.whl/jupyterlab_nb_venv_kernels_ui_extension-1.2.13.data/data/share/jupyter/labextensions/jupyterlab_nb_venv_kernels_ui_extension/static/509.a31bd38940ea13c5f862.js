"use strict";(self.webpackChunkjupyterlab_nb_venv_kernels_ui_extension=self.webpackChunkjupyterlab_nb_venv_kernels_ui_extension||[]).push([[509],{509:(e,n,t)=>{t.r(n),t.d(n,{default:()=>C});var r=t(780),o=t(366),a=t(690),s=t(827),i=t(907),l=t(292),c=t(247);const u="launcher:show-kernel-in-file-browser",d="launcher:open-terminal-at-kernel",v="launcher:unregister-venv-kernel",m="launcher:remove-venv-environment",h="nb_venv_kernels:refresh";let w=null,g=!1;async function p(e){const n=i.ServerConnection.makeSettings(),t=l.URLExt.join(n.baseUrl,"api","kernel-path",encodeURIComponent(e));try{const e=await i.ServerConnection.makeRequest(t,{},n);if(!e.ok){const n=await e.json();return console.warn(`Failed to get kernel path: ${n.error}`),null}return await e.json()}catch(e){return console.error("Error fetching kernel path:",e),null}}async function b(e){const n=await async function(){const e=i.ServerConnection.makeSettings(),n=l.URLExt.join(e.baseUrl,"nb-venv-kernels","environments");try{const t=await i.ServerConnection.makeRequest(n,{},e);return t.ok?await t.json():(console.warn("nb_venv_kernels API not available"),null)}catch(e){return console.debug("nb_venv_kernels extension not installed:",e),null}}();if(!n)return null;for(const t of n.environments){if("conda"===t.type)continue;const n=t.name||"",r=t.custom_name||"";if(n&&e.includes(n)||r&&e.includes(r))return t}return null}async function f(e){const n=i.ServerConnection.makeSettings(),t=l.URLExt.join(n.baseUrl,"nb-venv-kernels","unregister");try{const r=await i.ServerConnection.makeRequest(t,{method:"POST",body:JSON.stringify({path:e})},n),o=await r.json();return r.ok?{success:!0,message:o.message}:{success:!1,error:o.error||"Failed to unregister kernel"}}catch(e){return console.error("Error unregistering kernel:",e),{success:!1,error:`Network error: ${e}`}}}function k(e,n){const t=e.replace(/\/+$/,""),r=function(e,n){if(!e.startsWith("~"))return e;const t=n.match(/^(\/(?:home|Users)\/[^/]+)/);if(!t)return e;const r=t[1];return"~"===e?r:e.startsWith("~/")?r+e.slice(1):e}(n,e).replace(/\/+$/,"");if(t===r)return"";const o=r+"/";return t.startsWith(o)?t.slice(o.length):null}const C={id:"jupyterlab_nb_venv_kernels_ui_extension:plugin",description:"Right-click kernel launcher cards to navigate file browser to kernel's location or open terminal there",autoStart:!0,requires:[r.IDefaultFileBrowser],optional:[o.ILauncher,a.ITerminalTracker],activate:(e,n,t,r)=>{console.log("JupyterLab extension jupyterlab_nb_venv_kernels_ui_extension is activated!");const{commands:o}=e,a=l.PageConfig.getOption("serverRoot");document.addEventListener("contextmenu",e=>{const n=e.target;n&&n.closest(".jp-LauncherCard")&&(w=function(e){const n=e.closest(".jp-LauncherCard");if(!n)return null;const t=n.querySelector(".jp-LauncherCard-label");return t&&t.textContent?t.textContent.trim():n.title?n.title:null}(n))},!0),async function(){const e=i.ServerConnection.makeSettings(),n=l.URLExt.join(e.baseUrl,"nb-venv-kernels","environments");try{return(await i.ServerConnection.makeRequest(n,{},e)).ok}catch(e){return console.debug("nb_venv_kernels extension not installed:",e),!1}}().then(e=>{g=e,e&&console.log("nb_venv_kernels extension detected - unregister feature enabled")}),o.addCommand(u,{label:"Show in File Browser",caption:"Navigate file browser to kernel's directory",isEnabled:()=>null!==w,execute:async()=>{if(!w)return void await(0,s.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await p(w);if(!e)return void await(0,s.showErrorMessage)("Kernel Not Found",`Could not find path information for kernel "${w}".`);const t=e.env_path||e.resource_dir,r=k(t,a),o=null===r?"":r;try{const e=""===o?"/":"/"+o;await n.model.cd(e)}catch(e){console.error("Failed to navigate file browser:",e),await(0,s.showErrorMessage)("Navigation Error",`Failed to navigate to: ${t}\nError: ${e}`)}}}),o.addCommand(d,{label:"Open Terminal at Location",caption:"Open a terminal at the kernel's directory",isEnabled:()=>null!==w&&null!==r,execute:async()=>{if(!w)return void await(0,s.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await p(w);if(!e)return void await(0,s.showErrorMessage)("Kernel Not Found",`Could not find path information for kernel "${w}".`);const n=e.env_path||e.resource_dir,t=k(n,a),r=null===t?"":t;try{await o.execute("terminal:create-new",{cwd:r})}catch(e){console.error("Failed to open terminal:",e),await(0,s.showErrorMessage)("Terminal Error",`Failed to open terminal at: ${n}\nError: ${e}`)}}}),o.addCommand(v,{label:"Unregister Kernel",caption:"Remove this kernel from nb_venv_kernels registry",isEnabled:()=>null!==w&&g,isVisible:()=>g,execute:async()=>{if(!w)return void await(0,s.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await b(w);if(!e)return void await(0,s.showErrorMessage)("Cannot Unregister",`"${w}" is not managed by nb_venv_kernels.`);const n=await f(e.path);if(n.success){console.log(`Kernel unregistered: ${e.path}`),await o.execute(h).catch(()=>{});const n=new c.Widget,t=document.createElement("p");t.textContent=`Successfully unregistered "${e.name}" (${e.path}).`;const r=document.createElement("p");r.textContent=`To re-register, run: nb_venv_kernels register ${e.path}`,n.node.appendChild(t),n.node.appendChild(r),await(0,s.showDialog)({title:"Kernel Unregistered",body:n,buttons:[s.Dialog.okButton()]})}else await(0,s.showErrorMessage)("Unregister Failed",`Failed to unregister kernel: ${n.error}`)}}),o.addCommand(m,{label:"Remove Environment (dangerous)",caption:"Physically remove the .venv folder containing this environment",isEnabled:()=>null!==w&&g,isVisible:()=>g,execute:async()=>{if(!w)return void await(0,s.showErrorMessage)("No Kernel Selected","Could not determine which kernel was selected.");const e=await b(w);if(!e)return void await(0,s.showErrorMessage)("Cannot Remove",`"${w}" is not managed by nb_venv_kernels.`);if(!(n=e.path).includes("/.venv")&&!n.includes("\\.venv")){const n=new c.Widget,t=document.createElement("p");t.textContent=`"${e.name}" is not a local .venv environment.`;const r=document.createElement("p");return r.textContent="Only local environments (with .venv in their path) can be removed.",n.node.appendChild(t),n.node.appendChild(r),void await(0,s.showDialog)({title:"Cannot Remove",body:n,buttons:[s.Dialog.okButton()]})}var n;const t=new c.Widget,r=document.createElement("p");r.textContent=`Are you sure you want to permanently remove virtual environment "${e.name}"?`;const u=document.createElement("p");u.textContent=`This will delete: ${e.path}`;const d=document.createElement("p");if(d.style.fontWeight="bold",d.textContent="This action cannot be undone!",t.node.appendChild(r),t.node.appendChild(u),t.node.appendChild(d),!(await(0,s.showDialog)({title:"Remove Environment",body:t,buttons:[s.Dialog.cancelButton(),s.Dialog.warnButton({label:"Remove"})]})).button.accept)return;const v=await f(e.path);if(!v.success)return void await(0,s.showErrorMessage)("Remove Failed",`Failed to unregister kernel before removal: ${v.error}`);const m=await async function(e,n){const t=i.ServerConnection.makeSettings();let r=null;if(e.startsWith("/")){if(r=k(e,n),null===r){if(console.debug(`Path conversion failed: dirPath="${e}", serverRoot="${n}"`),!n||"~"===n||""===n){const n=e.match(/^\/(?:home|Users)\/[^/]+\/(.+)$/);n&&(r=n[1],console.debug(`Using home-relative fallback path: ${r}`))}if(null===r)return{success:!1,error:`Environment path "${e}" is outside the workspace (root: "${n}") and cannot be removed.`}}}else r=e,console.debug(`Path is already relative: ${r}`);const o=l.URLExt.join(t.baseUrl,"api","contents",r);try{const e=await i.ServerConnection.makeRequest(o,{method:"DELETE"},t);if(!e.ok){const n=await e.text();return{success:!1,error:`Server error: ${e.status} ${n}`}}return{success:!0}}catch(e){return console.error("Error removing directory:",e),{success:!1,error:`Network error: ${e}`}}}(e.path,a);m.success?(console.log(`Environment removed: ${e.path}`),await o.execute(h).catch(()=>{}),await(0,s.showErrorMessage)("Environment Removed",`Successfully removed "${e.name}" (${e.path}).`)):await(0,s.showErrorMessage)("Remove Failed",`Kernel was unregistered but failed to remove directory: ${m.error}`)}}),console.log(`Commands registered: ${u}, ${d}, ${v}, ${m}`)}}}}]);