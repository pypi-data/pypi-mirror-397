Metadata-Version: 2.4
Name: logica-desvios
Version: 0.3.0
Summary: Circuit Breaker inteligente com Machine Learning adaptativo
Home-page: https://github.com/WSS13Framework/curso-automacao-linux-resiliente-limpo
Author: Marcos Sea
Author-email: Marcos Sea <socramsea@hotmail.com>
Maintainer-email: Marcos Sea <socramsea@hotmail.com>
License: MIT
Project-URL: Homepage, https://github.com/socramsea/logica-desvios
Project-URL: Documentation, https://github.com/socramsea/logica-desvios#readme
Project-URL: Repository, https://github.com/socramsea/logica-desvios
Project-URL: Issues, https://github.com/socramsea/logica-desvios/issues
Project-URL: Changelog, https://github.com/socramsea/logica-desvios/blob/main/CHANGELOG.md
Keywords: circuit-breaker,resilience,machine-learning,adaptive,fault-tolerance,microservices,reliability
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Operating System :: OS Independent
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pandas>=1.0.0
Requires-Dist: numpy>=1.18.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-cov>=2.0; extra == "dev"
Requires-Dist: black>=21.0; extra == "dev"
Requires-Dist: flake8>=3.9; extra == "dev"
Requires-Dist: mypy>=0.900; extra == "dev"
Requires-Dist: twine>=4.0; extra == "dev"
Provides-Extra: ml
Requires-Dist: scikit-learn>=0.24.0; extra == "ml"
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-python

# üõ°Ô∏è L√≥gica dos Desvios

> Circuit Breaker inteligente com Machine Learning adaptativo para Python

[![PyPI version](https://badge.fury.io/py/logica-desvios.svg)](https://pypi.org/project/logica-desvios/)
[![Python 3.7+](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

---

## üìã √çndice

- [Sobre](#-sobre)
- [Caracter√≠sticas](#-caracter√≠sticas)
- [Instala√ß√£o](#-instala√ß√£o)
- [Uso R√°pido](#-uso-r√°pido)
- [Exemplos](#-exemplos)
- [Documenta√ß√£o](#-documenta√ß√£o)
- [Contribuindo](#-contribuindo)
- [Licen√ßa](#-licen√ßa)

---

## üéØ Sobre

**L√≥gica dos Desvios** √© uma biblioteca Python que implementa o padr√£o Circuit Breaker com capacidades de **Machine Learning** para adapta√ß√£o autom√°tica de par√¢metros.

Diferente dos circuit breakers tradicionais com threshold e timeout fixos, este sistema **aprende** com o hist√≥rico de opera√ß√µes e **ajusta dinamicamente** seus par√¢metros para maximizar a resili√™ncia.

### Por que usar?

- ‚úÖ **Adaptativo**: Ajusta threshold (2-10) e timeout (5-300s) automaticamente
- ‚úÖ **Inteligente**: Usa ML para predizer falhas e tempos de recupera√ß√£o
- ‚úÖ **Resiliente**: Recupera√ß√£o gradual baseada em sucessos consecutivos
- ‚úÖ **Observ√°vel**: An√°lise de padr√µes hist√≥ricos e tend√™ncias
- ‚úÖ **Alertas**: Sistema de notifica√ß√µes por severidade (CRITICAL/SEVERE/WARNING)
- ‚úÖ **Persistente**: Estado e hist√≥rico salvos em disco
- ‚úÖ **Bil√≠ngue**: Suporta nomes em ingl√™s e portugu√™s

---

## ‚ú® Caracter√≠sticas

### Circuit Breaker Tradicional

- Estados: `CLOSED`, `OPEN`, `HALF_OPEN`
- Prote√ß√£o contra falhas em cascata
- Timeout configur√°vel
- Persist√™ncia de estado

### + Machine Learning

- An√°lise de padr√µes hist√≥ricos
- Predi√ß√£o de probabilidade de falha
- Predi√ß√£o de tempo de recupera√ß√£o
- Detec√ß√£o de tend√™ncias (melhorando/degradando/est√°vel)
- An√°lise de padr√µes hor√°rios

### + Adapta√ß√£o Inteligente

- **Threshold din√¢mico**: Ajusta entre 2-10 baseado em taxa de falha
- **Timeout din√¢mico**: Ajusta entre 5-300s baseado em predi√ß√µes
- **Recupera√ß√£o gradual**: Aumenta threshold ap√≥s 5 sucessos consecutivos
- **Limites de seguran√ßa**: Nunca permite valores inseguros
- **Backoff exponencial**: Em situa√ß√µes de instabilidade severa

---

## üì¶ Instala√ß√£o

```bash
pip install logica-desvios
```

### Requisitos

- Python >= 3.7
- pandas >= 1.0.0
- numpy >= 1.18.0

---

## üöÄ Uso R√°pido

### Exemplo B√°sico

```python
from logica_desvios import AdaptiveCircuitBreakerAgent

# 1. Cria o agente
agent = AdaptiveCircuitBreakerAgent(
    name="meu_servico",
    initial_failure_threshold=3,
    initial_reset_timeout=60
)

# 2. Inicia aprendizado adaptativo (opcional mas recomendado)
agent.start_adaptive_learning()

# 3. Protege sua fun√ß√£o
@agent.protect
def chamar_api_externa():
    # Sua opera√ß√£o que pode falhar
    response = requests.get("https://api.example.com/data")
    return response.json()

# 4. Usa normalmente
try:
    dados = chamar_api_externa()
    print(f"Sucesso: {dados}")
except CircuitBreakerOpenException:
    print("Servi√ßo temporariamente indispon√≠vel")
except Exception as e:
    print(f"Erro: {e}")

# 5. Para o aprendizado quando terminar
agent.stop_adaptive_learning()
```

### Exemplo em Portugu√™s

```python
from logica_desvios import AgenteInteligente, CircuitBreakerAbertoException

agente = AgenteInteligente(name="backup_system")
agente.start_adaptive_learning()

@agente.protect
def fazer_backup(arquivo):
    # L√≥gica de backup
    return salvar_arquivo(arquivo)

try:
    fazer_backup("database.sql")
except CircuitBreakerAbertoException:
    print("Sistema de backup temporariamente desabilitado")
```

---

## üìö Exemplos

### Caso 1: API Externa Inst√°vel

```python
from logica_desvios import AdaptiveCircuitBreakerAgent
import requests

agent = AdaptiveCircuitBreakerAgent(name="api_weather")
agent.start_adaptive_learning()

@agent.protect
def buscar_previsao(cidade):
    response = requests.get(f"https://api.weather.com/{cidade}", timeout=5)
    return response.json()

# Sistema aprende e adapta automaticamente
for cidade in ["sao-paulo", "rio", "brasilia"]:
    try:
        previsao = buscar_previsao(cidade)
        print(f"{cidade}: {previsao['temp']}¬∞C")
    except Exception as e:
        print(f"{cidade}: Falha - {e}")
```

### Caso 2: Backup Autom√°tico Resiliente

```python
from logica_desvios import AdaptiveCircuitBreakerAgent

backup_agent = AdaptiveCircuitBreakerAgent(
    name="backup_system",
    initial_failure_threshold=2,
    initial_reset_timeout=30
)

@backup_agent.protect
def backup_database(db_name):
    # Comando de backup
    os.system(f"pg_dump {db_name} > backup_{db_name}.sql")
    return True

# Executa backups di√°rios
for db in ["users", "orders", "products"]:
    try:
        backup_database(db)
        print(f"‚úÖ Backup de {db} conclu√≠do")
    except Exception as e:
        print(f"‚ùå Backup de {db} falhou: {e}")
        # Sistema automaticamente ajusta estrat√©gia
```

### Caso 3: M√∫ltiplos Microservi√ßos

```python
from logica_desvios import AdaptiveCircuitBreakerAgent

# Um agente para cada servi√ßo
auth_agent = AdaptiveCircuitBreakerAgent(name="auth_service")
payment_agent = AdaptiveCircuitBreakerAgent(name="payment_service")
email_agent = AdaptiveCircuitBreakerAgent(name="email_service")

@auth_agent.protect
def autenticar(user): ...

@payment_agent.protect
def processar_pagamento(valor): ...

@email_agent.protect
def enviar_confirmacao(email): ...

# Cada servi√ßo tem seu pr√≥prio comportamento adaptativo
```

---

## üìñ Documenta√ß√£o

### API Principal

#### `AdaptiveCircuitBreakerAgent`

```python
agent = AdaptiveCircuitBreakerAgent(
    name: str,                          # Nome √∫nico do agente
    initial_failure_threshold: int = 3, # Falhas antes de abrir (ser√° adaptado)
    initial_reset_timeout: int = 60,    # Segundos antes de testar (ser√° adaptado)
    decision_interval_seconds: int = 15 # Intervalo de decis√£o ML
)
```

**M√©todos:**

- `start_adaptive_learning()`: Inicia loop de ML
- `stop_adaptive_learning()`: Para loop de ML
- `protect(func)`: Decorador para proteger fun√ß√µes
- `get_stats()`: Retorna estat√≠sticas completas

### Estados do Circuit Breaker

- **CLOSED** (`FECHADO`): Opera√ß√£o normal, todas as requisi√ß√µes passam
- **OPEN** (`ABERTO`): Bloqueando requisi√ß√µes (servi√ßo falhou)
- **HALF_OPEN** (`MEIO_ABERTO`): Testando recupera√ß√£o

### Exce√ß√µes

- `CircuitBreakerOpenException`: Levantada quando CB est√° OPEN

### Aliases em Portugu√™s

```python
from logica_desvios import (
    AgenteInteligente,              # = AdaptiveCircuitBreakerAgent
    AgenteCircuitBreaker,           # = CircuitBreakerAgent
    AdaptadorML,                    # = MLAdapter
    TomadorDecisao,                 # = DecisionMaker
    CircuitBreakerAbertoException,  # = CircuitBreakerOpenException
    FECHADO, ABERTO, MEIO_ABERTO    # = CLOSED, OPEN, HALF_OPEN
)
```

---

## üîß Configura√ß√£o Avan√ßada

### Ajuste Fino de Par√¢metros

```python
from logica_desvios import AdaptiveCircuitBreakerAgent

agent = AdaptiveCircuitBreakerAgent(
    name="api_critical",
    initial_failure_threshold=5,      # Mais tolerante
    initial_reset_timeout=120,        # Espera mais antes de testar
    decision_interval_seconds=10      # Decis√µes mais frequentes
)
```

### Acessando Componentes Individuais

```python
# Acessar o MLAdapter
ml_insights = agent.ml_adapter.analyze_patterns()
print(f"Taxa de falha: {ml_insights['failure_rate']}")

# Acessar o Circuit Breaker
cb_state = agent.circuit_breaker.get_state()
print(f"Estado: {cb_state}")

# Acessar estat√≠sticas
stats = agent.get_stats()
print(f"Threshold atual: {stats['failure_threshold']}")
```

---

## üìä M√©tricas e Monitoramento

```python
stats = agent.get_stats()

print(f"""
Estado: {stats['state']}
Threshold: {stats['failure_threshold']}
Timeout: {stats['reset_timeout']}s
Taxa de falha: {stats['failure_rate']*100:.1f}%
Opera√ß√µes totais: {stats['total_operations']}
Sucessos: {stats['total_successes']}
Falhas: {stats['total_failures']}
""")
```

---

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Por favor:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

---

## üìù Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

---

## üë§ Autor

**Marcos Sea**

- GitHub: [https://github.com/WSS13Framework](https://github.com/WSS13Framework/curso-automacao-linux-resiliente-limpo)
- PyPI: [logica-desvios](https://pypi.org/project/logica-desvios/)

---

## üôè Agradecimentos

- Inspirado pelo padr√£o Circuit Breaker do livro "Release It!" de Michael T. Nygard
- Baseado em conceitos de Machine Learning e sistemas adaptativos
- Comunidade Python por ferramentas incr√≠veis

---

## üìà Roadmap

- [ ] Suporte a Redis para estado compartilhado
- [ ] Integra√ß√£o com Prometheus/Grafana
- [ ] Dashboard web em tempo real
- [ ] Modelos ML mais sofisticados (Random Forest, LSTM)
- [ ] Suporte a m√∫ltiplos backends de persist√™ncia
- [ ] Integra√ß√£o com sistemas de notifica√ß√£o (Slack, Telegram, Email)

---

**‚≠ê Se este projeto foi √∫til, considere dar uma estrela no GitHub!**
