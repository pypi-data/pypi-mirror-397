Metadata-Version: 2.4
Name: easy-start-hikvision
Version: 0.1.0
Summary: A Python package for Hikvision integration, easy to start
Home-page: https://gitee.com/guolei19850528/easy_start_hikvision
Author: guolei
Author-email: 174000902@qq.com
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.6
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: httpx>=0.26.0
Requires-Dist: pydantic>=2.0.0
Requires-Dist: diskcache>=5.6.1
Requires-Dist: redis>=4.5.4
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# easy-start-hikvision

一个用于海康威视 ISecureCenter 平台集成的 Python 包，提供简洁易用的 API 接口。

## 项目概述

`easy-start-hikvision` 是一个专为海康威视 ISecureCenter 平台设计的 Python 集成包，提供了与平台 API 交互的便捷方式。该包支持同步和异步请求模式，自动处理签名生成和请求验证，让开发者能够轻松实现与海康威视 ISecureCenter 平台的各种功能集成。

## 功能特点

- 支持同步和异步请求方式
- 自动生成 HMAC-SHA256 签名，确保 API 调用安全
- 统一的错误处理和响应解析
- 简洁易用的 API 接口设计
- 支持自定义 HTTP 客户端配置
- 适用于海康威视 ISecureCenter 平台的各种 API 接口

## 安装方法

使用 pip 安装：

```bash
pip install easy-start-hikvision
```

或者从源码安装：

```bash
git clone https://gitee.com/guolei19850528/easy_start_hikvision.git
cd easy_start_hikvision
pip install -e .
```

## 依赖项

- httpx>=0.26.0 - 用于发送 HTTP 请求
- pydantic>=2.0.0 - 用于数据验证和序列化
- diskcache>=5.6.1 - 用于本地缓存
- redis>=4.5.4 - 用于分布式缓存

## 快速开始

### 同步方式

```python
from easy_start_hikvision.isc import ISecureCenter

# 初始化客户端
isc = ISecureCenter(
    host="https://your-hikvision-server:port",
    ak="your-access-key",
    sk="your-secret-key"
)

# 发送请求
state, response_json, response = isc.request(
    url="/artemis/api/resource/v1/park/parkList",
    json={
        "pageNo": 1,
        "pageSize": 100
    }
)

# 处理响应
if state:
    print("请求成功")
    print("响应数据:", response_json)
else:
    print("请求失败")
    print("错误信息:", response_json)
```

### 异步方式

```python
import asyncio
from easy_start_hikvision.isc import ISecureCenter

async def main():
    # 初始化客户端
    isc = ISecureCenter(
        host="https://your-hikvision-server:port",
        ak="your-access-key",
        sk="your-secret-key"
    )

    # 发送异步请求
    state, response_json, response = await isc.async_request(
        url="/artemis/api/resource/v1/park/parkList",
        json={
            "pageNo": 1,
            "pageSize": 100
        }
    )

    # 处理响应
    if state:
        print("请求成功")
        print("响应数据:", response_json)
    else:
        print("请求失败")
        print("错误信息:", response_json)

# 运行异步函数
asyncio.run(main())
```

## API 文档

### ISecureCenter 类

#### 初始化参数

- `host` (str): ISecureCenter 平台服务器地址（例如：https://your-hikvision-server:port）
- `ak` (str): 访问密钥 Access Key
- `sk` (str): 密钥 Secret Key

#### 方法

##### `timestamp()`

生成当前时间戳（毫秒）。

返回:
- `int`: 当前时间戳（毫秒）

##### `nonce()`

生成随机的 UUID 字符串。

返回:
- `str`: 随机的 UUID 字符串（无连字符）

##### `signature(string: str = "")`

生成请求签名。

参数:
- `string` (str): 需要签名的字符串

返回:
- `str`: 生成的签名（Base64 编码的 HMAC-SHA256 哈希值）

##### `headers(method: str = "POST", path: str = "", headers: dict = {})`

生成请求头。

参数:
- `method` (str): HTTP 请求方法，默认 POST
- `path` (str): 请求路径
- `headers` (dict): 额外的请求头

返回:
- `dict`: 完整的请求头字典

##### `client(**kwargs)`

创建同步 HTTP 客户端。

参数:
- `**kwargs`: 传递给 `httpx.Client` 的额外参数

返回:
- `httpx.Client`: 配置好的同步 HTTP 客户端

##### `async_client(**kwargs)`

创建异步 HTTP 客户端。

参数:
- `**kwargs`: 传递给 `httpx.AsyncClient` 的额外参数

返回:
- `httpx.AsyncClient`: 配置好的异步 HTTP 客户端

##### `request(client: httpx.Client = None, **kwargs)`

发送同步 API 请求。

参数:
- `client` (httpx.Client): 可选的 HTTP 客户端，如果不提供则创建新客户端
- `**kwargs`: 传递给 `client.request` 的额外参数

返回:
- `tuple`: (请求是否成功, 响应 JSON 数据, 原始响应对象)

##### `async_request(client: httpx.AsyncClient = None, **kwargs)`

发送异步 API 请求。

参数:
- `client` (httpx.AsyncClient): 可选的异步 HTTP 客户端，如果不提供则创建新客户端
- `**kwargs`: 传递给 `client.request` 的额外参数

返回:
- `tuple`: (请求是否成功, 响应 JSON 数据, 原始响应对象)

## 测试

运行测试用例：

```bash
python -m unittest tests/test_isc.py
```

## 项目结构
