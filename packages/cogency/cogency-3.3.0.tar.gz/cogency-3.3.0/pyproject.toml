[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "cogency"
version = "3.3.0"
description = "Streaming agents"
authors = [{name = "Tyson Chan", email = "tyson.chan@proton.me"}]
readme = "README.md"
license = "Apache-2.0"
requires-python = ">=3.11,<3.13"
keywords = ["ai", "agents", "reasoning", "react", "memory", "tools", "tracing", "cognition", "streaming"]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Intended Audience :: Developers",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "License :: OSI Approved :: Apache Software License",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
]
dependencies = [
    "python-dotenv>=1.0.0",
    "openai>=1.107.1",
    "trafilatura>=2.0.0",
    "ddgs>=9.5.2",
    "google-genai>=1.36.0",
    "anthropic>=0.67.0",
    "tiktoken>=0.11.0",
    "typer>=0.17.4",
    "websockets==15.0.0",
    "google-api-core>=2.11.0",
]

[project.urls]
homepage = "https://github.com/iteebz/cogency"
repository = "https://github.com/iteebz/cogency"

[project.scripts]
evals = "evals.__main__:main"

[dependency-groups]
dev = [
    "ruff>=0.13.0",
    "pytest>=8.4.1",
    "pytest-asyncio>=1.1.0",
    "pytest-timeout>=2.4.0",
    "pytest-cov>=7.0.0",
    "pyright>=1.1.407",
]

[tool.hatch.build.targets.wheel]
packages = ["src/cogency"]



[tool.ruff]
line-length = 100
target-version = "py311"
exclude = ["evonotes"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"

[tool.ruff.lint]
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # pyflakes
    "I",      # isort
    "N",      # pep8-naming
    "UP",     # pyupgrade
    "B",      # flake8-bugbear
    "C4",     # flake8-comprehensions
    "C90",    # mccabe (cyclomatic complexity)
    "SIM",    # flake8-simplify
    "RET",    # flake8-return
    "S",      # flake8-bandit (security)
    "PTH",    # flake8-use-pathlib
    "PERF",   # perflint
    "RUF",    # ruff-specific
    "TCH",    # type-checking imports
    "TID",    # tidy imports
    "PIE",    # misc lints
    "T20",    # flake8-print
    "FLY",    # flynt (f-strings)
    "FURB",   # refurb (modern python)
]
ignore = [
    "SIM108",   # ternary not always clearer
    "SIM115",   # context manager not always clearer
    "SIM117",   # multiple with statements
    "E501",     # line length (formatter handles)
    "N802",     # tools are PascalCase by design
    "N812",     # A alias for assertions is intentional
    "RET505",   # unnecessary else after return
    "RET506",   # unnecessary else after raise
    "PERF401",  # async list comprehensions are less readable
    "S311",     # random for load balancing doesn't need crypto
    "S603",     # subprocess calls are validated via security module
]

[tool.ruff.lint.per-file-ignores]
"src/**/*.py" = []
"src/cogency/core/security.py" = ["RUF001", "RUF003"]
"src/cogency/lib/sqlite.py" = ["S608"]
"src/cogency/context/conversation.py" = ["S112"]
"evals/**/*.py" = ["S101", "T20", "E402", "C901"]
"tests/**/*.py" = ["S101", "T20", "S108", "RUF012", "RUF043", "SIM117", "PTH123", "C901"]


[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
pythonpath = ["src"]
filterwarnings = [
    "ignore::DeprecationWarning:starlette.*",
    "ignore::PendingDeprecationWarning:starlette.*",
    "ignore:Using fallback UUID7:DeprecationWarning",
]
addopts = [
    "--strict-markers",
    "--strict-config", 
    "-ra"  # Show short test summary for all except passed
]
markers = [
    "asyncio: Async tests using pytest-asyncio",
    "unit: Unit tests (can run in parallel)",
    "integration: Integration tests (may need isolation)", 
    "contract: API contract validation tests",
    "schema: Schema validation tests",
    "slow: Slow tests that should run last",
    "timeout: Test timeout marker for pytest-timeout"
]

[tool.pytest_asyncio]
asyncio_mode = "auto"

[tool.pyright]
pythonVersion = "3.12"
include = ["src"]
typeCheckingMode = "strict"
reportUnnecessaryTypeIgnoreComment = true
reportDeprecated = true
reportPrivateUsage = false
reportConstantRedefinition = true
reportIncompatibleMethodOverride = true
reportIncompatibleVariableOverride = true
reportDuplicateImport = true  # catches shadowed imports that ruff F811 misses

[tool.coverage.run]
source = ["src/cogency"]