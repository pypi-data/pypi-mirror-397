import{U as le,a as ce,g as oe,r as i,j as e,c as v,C as he,A as de,B as H,F as E,R as pe,b as k,L as P,d as L,M as $,e as K,f as Z,S as fe,P as Q,h as Y,u as ee,i as je,k as Ne,l as ge,I as ve,m as Ce,n as W,o as h,p as se,q as Se,s as we,t as be,v as _e,w as q,x as X,y as te,z as ae,D as Ee}from"./index-D7c71Ncp.js";import{u as Te}from"./use-post-add-user-DcUHAOql.js";import ne from"./eye-BGqdGvP5.js";import ie from"./eye-off-KDImmRkJ.js";const Ue=r=>{const{mutate:l}=le();return l(["useDeleteUsers"],async({user_id:p})=>(await ce.delete(`${oe("USERS")}/${p}`)).data,r)},ye=r=>{const{mutate:l}=le();async function c({skip:p,limit:C}){const a=await ce.get(`${oe("USERS")}/?skip=${p}&limit=${C}`);return a.status===200?a.data:[]}return l(["useGetUsers"],c,r)},me=i.forwardRef(({className:r,...l},c)=>e.jsx("div",{className:"",children:e.jsx("table",{ref:c,className:v("w-full caption-bottom text-sm",r),...l})}));me.displayName="Table";const ue=i.forwardRef(({className:r,...l},c)=>e.jsx("thead",{ref:c,className:v("[&_tr]:border-b",r),...l}));ue.displayName="TableHeader";const xe=i.forwardRef(({className:r,...l},c)=>e.jsx("tbody",{ref:c,className:v("[&_tr:last-child]:border-0",r),...l}));xe.displayName="TableBody";const Re=i.forwardRef(({className:r,...l},c)=>e.jsx("tfoot",{ref:c,className:v("bg-primary font-medium text-primary-foreground",r),...l}));Re.displayName="TableFooter";const J=i.forwardRef(({className:r,...l},c)=>e.jsx("tr",{ref:c,className:v("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...l}));J.displayName="TableRow";const N=i.forwardRef(({className:r,...l},c)=>e.jsx("th",{ref:c,className:v("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...l}));N.displayName="TableHead";const g=i.forwardRef(({className:r,...l},c)=>e.jsx("td",{ref:c,className:v("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...l}));g.displayName="TableCell";const Ae=i.forwardRef(({className:r,...l},c)=>e.jsx("caption",{ref:c,className:v("mt-4 text-sm text-muted-foreground",r),...l}));Ae.displayName="TableCaption";function re({title:r,titleHeader:l,cancelText:c,confirmationText:b,children:p,icon:C,data:a,index:S,onConfirm:z,asChild:G}){const[f,O]=i.useState(!1),[u,M]=i.useState(!1),[d,T]=i.useState(!1),[m,U]=i.useState((a==null?void 0:a.password)??""),[w,_]=i.useState((a==null?void 0:a.username)??""),[j,F]=i.useState((a==null?void 0:a.password)??""),[x,y]=i.useState((a==null?void 0:a.is_active)??!1),[R,A]=i.useState((a==null?void 0:a.is_superuser)??!1),[B,V]=i.useState(he),{userData:D}=i.useContext(de);function s({target:{name:t,value:o}}){V(I=>({...I,[t]:o}))}i.useEffect(()=>{d&&(a?(_(a.username),y(a.is_active),A(a.is_superuser),s({target:{name:"username",value:w}}),s({target:{name:"is_active",value:x}}),s({target:{name:"is_superuser",value:R}})):n())},[d]);function n(){U(""),_(""),F(""),y(!1),A(!1)}return e.jsxs(H,{size:"medium-h-full",open:d,setOpen:T,children:[e.jsx(H.Trigger,{asChild:G,children:p}),e.jsxs(H.Header,{description:l,children:[e.jsx("span",{className:"pr-2",children:r}),e.jsx(E,{name:C,className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(H.Content,{children:e.jsxs(pe,{onSubmit:t=>{if(m!==j){t.preventDefault();return}n(),z(1,B),T(!1),t.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs(k,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(P,{className:"data-[invalid]:label-invalid",children:["Username"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx(L,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{s({target:{name:"username",value:t}}),_(t)},value:w,className:"primary-input",required:!0,placeholder:"Username"})}),e.jsx($,{match:"valueMissing",className:"field-invalid",children:"Please enter your username"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs(k,{name:"password",serverInvalid:m!=j,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(P,{className:"data-[invalid]:label-invalid flex",children:["Password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),f&&e.jsx(ne,{onClick:()=>O(!f),className:"h-5 cursor-pointer",strokeWidth:1.5}),!f&&e.jsx(ie,{onClick:()=>O(!f),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(L,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{s({target:{name:"password",value:t}}),U(t)},value:m,className:"primary-input",required:!a,type:f?"text":"password"})}),e.jsx($,{className:"field-invalid",match:"valueMissing",children:"Please enter a password"}),m!=j&&e.jsx($,{className:"field-invalid",children:"Passwords do not match"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs(k,{name:"confirmpassword",serverInvalid:m!=j,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(P,{className:"data-[invalid]:label-invalid flex",children:["Confirm password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),u&&e.jsx(ne,{onClick:()=>M(!u),className:"h-5 cursor-pointer",strokeWidth:1.5}),!u&&e.jsx(ie,{onClick:()=>M(!u),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(L,{asChild:!0,children:e.jsx("input",{onChange:t=>{F(t.target.value)},value:j,className:"primary-input",required:!a,type:u?"text":"password"})}),e.jsx($,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(k,{name:"is_active",children:e.jsxs("div",{children:[e.jsx(P,{className:"data-[invalid]:label-invalid mr-3",children:"Active"}),e.jsx(L,{asChild:!0,children:e.jsx(K,{value:x,checked:x,id:"is_active",className:"relative top-0.5",onCheckedChange:t=>{s({target:{name:"is_active",value:t}}),y(t)}})})]})}),(D==null?void 0:D.is_superuser)&&e.jsx(k,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx(P,{className:"data-[invalid]:label-invalid mr-3",children:"Superuser"}),e.jsx(L,{asChild:!0,children:e.jsx(K,{checked:R,value:R,id:"is_superuser",className:"relative top-0.5",onCheckedChange:t=>{s({target:{name:"is_superuser",value:t}}),A(t)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(Z,{variant:"outline",onClick:()=>{T(!1)},className:"mr-3",children:c}),e.jsx(fe,{asChild:!0,children:e.jsx(Z,{className:"mt-8",children:b})})]})]})})]})}function Le(){const[r,l]=i.useState(""),[c,b]=i.useState(Q),[p,C]=i.useState(Y),a=ee(s=>s.setSuccessData),S=ee(s=>s.setErrorData),{userData:z}=i.useContext(de),[G,f]=i.useState(0),{mutate:O}=Ue(),{mutate:u}=je(),{mutate:M}=Te(),d=i.useRef([]);i.useEffect(()=>{setTimeout(()=>{j()},500)},[]);const[T,m]=i.useState(d.current),{mutate:U,isPending:w,isIdle:_}=ye({});function j(){U({skip:c*(p-1),limit:c},{onSuccess:s=>{f(s.total_count),d.current=s.users,m(s.users)},onError:()=>{}})}function F(s,n){b(n),C(s),U({skip:n*(s-1),limit:n},{onSuccess:t=>{f(t.total_count),d.current=t.users,m(t.users)}})}function x(){C(Y),b(Q),j()}function y(s){if(l(s),s==="")m(d.current);else{const n=d.current.filter(t=>t.username.toLowerCase().includes(s.toLowerCase()));m(n)}}function R(s){O({user_id:s.id},{onSuccess:()=>{x(),a({title:_e})},onError:n=>{S({title:be,list:[n.response.data.detail]})}})}function A(s,n){u({user_id:s,user:n},{onSuccess:()=>{x(),a({title:X})},onError:t=>{S({title:q,list:[t.response.data.detail]})}})}function B(s,n,t){const o=te.cloneDeep(t);o.is_active=!s,u({user_id:n,user:o},{onSuccess:()=>{x(),a({title:X})},onError:I=>{S({title:q,list:[I.response.data.detail]})}})}function V(s,n,t){const o=te.cloneDeep(t);o.is_superuser=!s,u({user_id:n,user:o},{onSuccess:()=>{x(),a({title:X})},onError:I=>{S({title:q,list:[I.response.data.detail]})}})}function D(s){M(s,{onSuccess:n=>{u({user_id:n.id,user:{is_active:s.is_active,is_superuser:s.is_superuser}},{onSuccess:()=>{x(),a({title:Ee})},onError:t=>{S({title:ae,list:[t.response.data.detail]})}})},onError:n=>{S({title:ae,list:[n.response.data.detail]})}})}return e.jsx(e.Fragment,{children:z&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(E,{name:"Shield",className:"w-6"}),Ne]})}),e.jsx("span",{className:"admin-page-description-text",children:ge}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(ve,{placeholder:"Search Username",value:r,onChange:s=>y(s.target.value)}),r.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{l(""),m(d.current)},children:e.jsx(E,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(E,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(re,{title:"New User",titleHeader:"Add a new user",cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",onConfirm:(s,n)=>{D(n)},asChild:!0,children:e.jsx(Z,{variant:"primary",children:"New User"})})})]}),w||_?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(Ce,{remSize:12})}):d.current.length===0&&!_?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"No users registered."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-fit overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(w?" border-0":""),children:e.jsxs(me,{className:"table-fixed outline-1",children:[e.jsx(ue,{className:w?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(J,{children:[e.jsx(N,{className:"h-10",children:"Id"}),e.jsx(N,{className:"h-10",children:"Username"}),e.jsx(N,{className:"h-10",children:"Active"}),e.jsx(N,{className:"h-10",children:"Superuser"}),e.jsx(N,{className:"h-10",children:"Created At"}),e.jsx(N,{className:"h-10",children:"Updated At"}),e.jsx(N,{className:"h-10 w-[100px] text-right"})]})}),!w&&e.jsx(xe,{children:T.map((s,n)=>e.jsxs(J,{children:[e.jsx(g,{className:"truncate py-2 font-medium",children:e.jsx(W,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(g,{className:"truncate py-2",children:e.jsx(W,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(g,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:n,onConfirm:(t,o)=>{B(o.is_active,o.id,o)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(se,{checked:s.is_active})})})]})}),e.jsx(g,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:n,onConfirm:(t,o)=>{V(o.is_superuser,o.id,o)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(se,{checked:s.is_superuser})})})]})}),e.jsx(g,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(g,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(g,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(re,{title:"Edit",titleHeader:`${s.id}`,cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",data:s,index:n,onConfirm:(t,o)=>{A(s.id,o)},children:e.jsx(W,{content:"Edit",side:"top",children:e.jsx(E,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(h,{size:"x-small",title:"Delete",titleHeader:"Delete User",modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Delete",icon:"UserMinus2",data:s,index:n,onConfirm:(t,o)=>{R(o)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you sure you want to delete this user? This action cannot be undone."})}),e.jsx(h.Trigger,{children:e.jsx(E,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},n))})]})}),e.jsx(Se,{pageIndex:p,pageSize:c,totalRowsCount:G,paginate:F,rowsCount:we})]})]})})}export{Le as default};
