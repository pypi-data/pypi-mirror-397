# Version Management

## Single Source of Truth

The canonical version for jBOM is stored in **`src/jbom/__version__.py`**. All other locations must reference or be updated to match this version.

## Version Locations

### Primary (Single Source of Truth)
- **`src/jbom/__version__.py`** - Contains `__version__` and `__version_info__`
  - Format: `"MAJOR.MINOR.PATCH"` (e.g., `"1.0.2"`)

### Secondary (Must Stay in Sync)
- **`pyproject.toml`** - Line 7: `version = "X.Y.Z"`
- **`README.md`** - Line 152: `jBOM vX.Y.Z —`
- **`CHANGELOG.md`** - Top version header (but may be ahead for unreleased versions)

### Automated (Generated by Tools)
- **`src/jbom/__init__.py`** - Imports from `__version__.py`
- **CLI `--version` flag** - Imports from `__version__.py`

## Updating the Version

When bumping the version, update these files in order:

1. **`src/jbom/__version__.py`**
   ```python
   __version__ = "X.Y.Z"
   __version_info__ = (X, Y, Z)
   ```

2. **`pyproject.toml`**
   ```toml
   version = "X.Y.Z"
   ```

3. **`README.md`**
   ```markdown
   jBOM vX.Y.Z — Stable release with...
   ```

4. **`CHANGELOG.md`**
   - Add new version section at top
   - Document changes under appropriate categories

## Verification Script

Check version consistency across all files:

```bash
# Extract versions from each file
VERSION_PY=$(grep "^__version__" src/jbom/__version__.py | cut -d'"' -f2)
VERSION_TOML=$(grep "^version" pyproject.toml | head -1 | cut -d'"' -f2)
VERSION_README=$(grep "^jBOM v" README.md | head -1 | sed 's/jBOM v\([0-9.]*\).*/\1/')

echo "Version in __version__.py: $VERSION_PY"
echo "Version in pyproject.toml: $VERSION_TOML"
echo "Version in README.md:      $VERSION_README"

if [ "$VERSION_PY" = "$VERSION_TOML" ] && [ "$VERSION_PY" = "$VERSION_README" ]; then
    echo "✅ All versions match!"
else
    echo "❌ Version mismatch detected!"
    exit 1
fi
```

Save as `scripts/check-version.sh` and run before releases.

## Semantic Versioning

jBOM follows [Semantic Versioning 2.0.0](https://semver.org/):

- **MAJOR** (X.0.0) - Incompatible API changes, breaking changes
- **MINOR** (0.X.0) - New features, backward-compatible
- **PATCH** (0.0.X) - Bug fixes, backward-compatible

## Release Process

1. Update version in all required files
2. Run version check script
3. Update CHANGELOG.md with release notes
4. Commit: `git commit -m "Bump version to X.Y.Z"`
5. Tag: `git tag -a vX.Y.Z -m "Release vX.Y.Z"`
6. Push: `git push && git push --tags`

## Automation (Future)

Consider using tools like:
- **bump2version** / **bumpversion** - Automatic version bumping
- **semantic-release** - Automated versioning based on commit messages
- **Pre-commit hooks** - Verify version consistency before commits
- **CI checks** - Fail builds if versions don't match

## Current Status

As of 2025-12-15:
- **Current version**: 2.1.0
- **All files in sync**: ✅
- **CLI `--version` flag**: Implemented
- **Git tags**: v2.0.0 exists (semantic-release)
- **CHANGELOG**: Shows v2.0.0 (last released version)

## Notes on Semantic Release

This project uses semantic-release for automated versioning. The semantic-release tool:
- Analyzes commit messages to determine version bumps
- Updates CHANGELOG.md automatically
- Creates git tags (e.g., v2.0.0)
- Should update version files via `version_variable` in .releaserc.toml

If semantic-release is used, version bumps may happen automatically. Manual version updates should be coordinated with the semantic-release configuration.
