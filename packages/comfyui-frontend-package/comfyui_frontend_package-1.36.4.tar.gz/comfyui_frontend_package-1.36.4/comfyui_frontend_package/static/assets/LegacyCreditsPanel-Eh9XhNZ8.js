var G=Object.defineProperty;var i=(m,h)=>G(m,"name",{value:h,configurable:!0});import{h as J,a as K,ae as F,e as Q,af as T,s as E,r as R,b as j,I as W}from"./vendor-primevue-RJTR6wkG.js";import{a4 as M,bf as X,bg as O,p as Y,a1 as Z,q as ee,a3 as te,B as se,o as ae,dj as oe,dk as ie}from"./index-xLwXl4ov.js";import{r as $,w as V,ci as H,bq as z,E as L,k as re,c as C,d as p,p as P,A as r,br as t,q as y,h as q,t as n,e as c,s as I,l as ne,u as le}from"./vendor-other-yzRpIrj2.js";import{u as ce}from"./vendor-vue-ByIfjd1d.js";import"./vendor-xterm-CWYFmgbN.js";import"./vendor-three-b7sMVVQK.js";import"./vendor-tiptap-DcddbIvp.js";var B=(m=>(m.CREDIT_ADDED="credit_added",m.ACCOUNT_CREATED="account_created",m.API_USAGE_STARTED="api_usage_started",m.API_USAGE_COMPLETED="api_usage_completed",m))(B||{});const N=H.create({baseURL:O(),headers:{"Content-Type":"application/json"}}),de=i(()=>{const m=$(!1),h=$(null),{d:x}=ce();V(()=>O(),e=>{N.defaults.baseURL=e});const A=i((e,a,_)=>{if(X(e))return;let u;if(!H.isAxiosError(e))u=`${a} failed: ${e instanceof Error?e.message:String(e)}`;else{const o=e,v=o.response?.status;v&&_?.[v]?u=_[v]:u=o.response?.data?.message??`${a} failed with status ${v}`}h.value=u},"handleRequestError"),f=i(async(e,a)=>{const{errorContext:_,routeSpecificErrors:u}=a;m.value=!0,h.value=null;try{return(await e()).data}catch(o){return A(o,_,u),null}finally{m.value=!1}},"executeRequest");function d(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}i(d,"formatEventType");function l(e){const a=new Date(e);return x(a,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}i(l,"formatDate");function w(e){return e.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}i(w,"formatJsonKey");function b(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}i(b,"formatJsonValue");function S(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}i(S,"getEventSeverity");function k(e){const{amount:a,api_name:_,model:u,...o}=e.params||{};return Object.keys(o).length>0}i(k,"hasAdditionalInfo");function U(e){const{...a}=e.params||{};return Object.entries(a).map(([_,u])=>{const o=w(_),v=b(u);return`<strong>${o}:</strong> ${v}`}).join("<br>")}i(U,"getTooltipContent");function s(e){return e?(e/100).toFixed(2):"0.00"}i(s,"formatAmount");async function g({page:e=1,limit:a=10}={}){const _="Fetching customer events",u={400:"Invalid input, object invalid",404:"Not found"},o=await M().getAuthHeader();return o?await f(()=>N.get("/customers/events",{params:{page:e,limit:a},headers:o}),{errorContext:_,routeSpecificErrors:u}):(h.value="Authentication header is missing",null)}return i(g,"getMyEvents"),{isLoading:m,error:h,getMyEvents:g,formatEventType:d,getEventSeverity:S,formatAmount:s,hasAdditionalInfo:k,formatDate:l,formatJsonKey:w,formatJsonValue:b,getTooltipContent:U}},"useCustomerEventsService"),ue={key:0,class:"flex items-center justify-center p-8"},pe={key:1,class:"p-4"},me={class:"event-details"},fe={key:0,class:"font-semibold text-green-500"},ve={key:1},he={key:2,class:"flex flex-col gap-1"},ge={class:"font-semibold"},_e={class:"text-sm text-smoke-400"},ye=z({__name:"UsageLogsTable",setup(m,{expose:h}){const x=$([]),A=$(!0),f=$(null),d=de(),l=$({page:1,limit:7,total:0,totalPages:0}),w=L(()=>(l.value.page-1)*l.value.limit),b=L(()=>{const s=new Map;return x.value.forEach(g=>{d.hasAdditionalInfo(g)&&g.event_id&&s.set(g.event_id,d.getTooltipContent(g))}),s}),S=i(async()=>{A.value=!0,f.value=null;try{const s=await d.getMyEvents({page:l.value.page,limit:l.value.limit});s?(s.events&&(x.value=s.events),s.page&&(l.value.page=s.page),s.limit&&(l.value.limit=s.limit),s.total&&(l.value.total=s.total),s.totalPages&&(l.value.totalPages=s.totalPages),Y()?.checkForCompletedTopup(s.events)):f.value=d.error.value||"Failed to load events"}catch(s){f.value=s instanceof Error?s.message:"Unknown error",console.error("Error loading events:",s)}finally{A.value=!1}},"loadEvents"),k=i(s=>{l.value.page=s.page+1,S().catch(g=>{console.error("Error loading events:",g)})},"onPageChange");return h({refresh:i(async()=>{l.value.page=1,await S()},"refresh")}),(s,g)=>{const e=re("tooltip");return p(),C("div",null,[A.value?(p(),C("div",ue,[r(t(J))])):f.value?(p(),C("div",pe,[r(t(K),{severity:"error",closable:!1},{default:y(()=>[q(n(f.value),1)]),_:1})])):(p(),P(t(F),{key:2,value:x.value,paginator:!0,rows:l.value.limit,"total-records":l.value.total,first:w.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:k},{default:y(()=>[r(t(T),{field:"event_type",header:s.$t("credits.eventType")},{body:y(({data:a})=>[r(t(Q),{value:t(d).formatEventType(a.event_type),severity:t(d).getEventSeverity(a.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),r(t(T),{field:"details",header:s.$t("credits.details")},{body:y(({data:a})=>[c("div",me,[a.event_type===t(B).CREDIT_ADDED?(p(),C("div",fe,n(s.$t("credits.added"))+" $"+n(t(d).formatAmount(a.params?.amount)),1)):a.event_type===t(B).ACCOUNT_CREATED?(p(),C("div",ve,n(s.$t("credits.accountInitialized")),1)):a.event_type===t(B).API_USAGE_COMPLETED?(p(),C("div",he,[c("div",ge,n(a.params?.api_name||"API"),1),c("div",_e,n(s.$t("credits.model"))+": "+n(a.params?.model||"-"),1)])):I("",!0)])]),_:1},8,["header"]),r(t(T),{field:"createdAt",header:s.$t("credits.time")},{body:y(({data:a})=>[q(n(t(d).formatDate(a.createdAt)),1)]),_:1},8,["header"]),r(t(T),{field:"params",header:s.$t("credits.additionalInfo")},{body:y(({data:a})=>[t(d).hasAdditionalInfo(a)?ne((p(),P(t(E),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[e,{escape:!1,value:b.value.get(a.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):I("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),be={class:"flex h-full flex-col"},Ce={class:"mb-2 text-2xl font-bold"},$e={class:"flex flex-col gap-2"},xe={class:"text-sm font-medium text-muted"},Ae={class:"flex items-center justify-between"},ke={class:"flex flex-row items-center"},Ee={key:1,class:"text-xs text-muted"},we={class:"flex items-center justify-between"},Se={key:0,class:"grow"},De={class:"text-sm font-medium"},Te={class:"text-xs text-muted"},Pe={class:"flex flex-row gap-2"},Fe=z({__name:"LegacyCreditsPanel",setup(m){const{buildDocsUrl:h,docsPaths:x}=Z(),A=ee(),f=M(),d=te(),l=se(),{isActiveSubscription:w}=ae(),b=L(()=>f.loading),S=L(()=>f.isFetchingBalance),k=$(null),U=L(()=>f.lastBalanceUpdateTime?f.lastBalanceUpdateTime.toLocaleString():"");V(()=>f.lastBalanceUpdateTime,(o,v)=>{o&&o!==v&&k.value&&k.value.refresh()});const s=i(()=>{A.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),g=i(async()=>{await d.accessBillingPortal()},"handleCreditsHistoryClick"),e=i(async()=>{await l.execute("Comfy.ContactSupport")},"handleMessageSupport"),a=i(()=>{window.open(h("/tutorials/api-nodes/faq",{includeLocale:!0}),"_blank")},"handleFaqClick"),_=i(()=>{window.open(h(x.partnerNodesPricing,{includeLocale:!0}),"_blank")},"handleOpenPartnerNodesInfo"),u=$([]);return(o,v)=>(p(),P(t(W),{value:"Credits",class:"credits-container h-full"},{default:y(()=>[c("div",be,[c("h2",Ce,n(o.$t("credits.credits")),1),r(t(R)),c("div",$e,[c("h3",xe,n(o.$t("credits.yourCreditBalance")),1),c("div",Ae,[r(oe,{"text-class":"text-3xl font-bold"}),b.value?(p(),P(t(j),{key:0,width:"2rem",height:"2rem"})):t(w)?(p(),P(t(E),{key:1,label:o.$t("credits.purchaseCredits"),loading:b.value,onClick:s},null,8,["label","loading"])):I("",!0)]),c("div",ke,[S.value?(p(),P(t(j),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):U.value?(p(),C("div",Ee,n(o.$t("credits.lastUpdated"))+": "+n(U.value),1)):I("",!0),r(t(E),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:v[0]||(v[0]=()=>t(d).fetchBalance())})])]),c("div",we,[c("h3",null,n(o.$t("credits.activity")),1),r(t(E),{label:o.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:b.value,onClick:g},null,8,["label","loading"])]),u.value.length>0?(p(),C("div",Se,[r(t(F),{value:u.value,"show-headers":!1},{default:y(()=>[r(t(T),{field:"title",header:o.$t("g.name")},{body:y(({data:D})=>[c("div",De,n(D.title),1),c("div",Te,n(D.timestamp),1)]),_:1},8,["header"]),r(t(T),{field:"amount",header:o.$t("g.amount")},{body:y(({data:D})=>[c("div",{class:le(["text-center text-base font-medium",D.isPositive?"text-sky-500":"text-red-400"])},n(D.isPositive?"+":"-")+"$"+n(t(ie)(D.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):I("",!0),r(t(R)),r(ye,{ref_key:"usageLogsTableRef",ref:k},null,512),c("div",Pe,[r(t(E),{label:o.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:a},null,8,["label"]),r(t(E),{label:o.$t("subscription.partnerNodesCredits"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:_},null,8,["label"]),r(t(E),{label:o.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:e},null,8,["label"])])])]),_:1}))}});export{Fe as default};
//# sourceMappingURL=LegacyCreditsPanel-Eh9XhNZ8.js.map
