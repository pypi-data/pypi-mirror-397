var pe=Object.defineProperty;var g=(t,e)=>pe(t,"name",{value:e,configurable:!0});import{c as $,j as fe,t as B,h as oe,O as me,a as ve,Y as ge,cw as ye}from"./index-DkaQAqNW.js";import{E as c,bs as I,cV as T,cW as z,c as f,p as F,q,A as j,bq as h,m as _,d as x,e as M,t as W,u as C,s as P,dm as G,r as D,l as ae,d5 as be,F as ee,z as te,i as we,k as he,h as Se,dd as ke,w as J,bu as Me,et as xe,bd as $e}from"./vendor-other-BuYjBaXg.js";import{g as Ue,l as se}from"./vendor-primevue-D1bWBpUY.js";import"./vendor-xterm-DV1MVhAx.js";import{f as ne,P as ie}from"./widgetPropFilter-CygYoMQt.js";import{W as re}from"./index-CHUUoCKV.js";import{_ as de}from"./WidgetLayoutField.vue_vue_type_script_setup_true_lang-DgS9TBkm.js";import{a as Ce,c as ze}from"./LazyImage.vue_vue_type_script_setup_true_lang-DmJcjIvV.js";function ue(t={}){return c(()=>({appendTo:"self",...t}))}g(ue,"useTransformCompatOverlayProps");const Oe=I({__name:"WidgetSelectDefault",props:T({widget:{}},{modelValue:{default(t){return t.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,i=z(t,"modelValue"),b=ue(),n=c(()=>{const s=e.widget.options;return s?.values&&Array.isArray(s.values)?s.values:[]}),y=c(()=>!!i.value&&!n.value.includes(i.value)),p=c(()=>({...ne(e.widget.options,ie),...b.value,...y.value?{placeholder:`${i.value}`}:{}}));return(s,u)=>(f(),F(de,{widget:s.widget},{default:q(()=>[j(h(Ue),_({modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=m=>i.value=m),invalid:y.value,filter:n.value.length>4,"auto-filter-focus":n.value.length>4,options:n.value},p.value,{class:h($)(h(re),"w-full text-xs"),"aria-label":s.widget.name,size:"small",pt:{option:"text-xs",dropdown:"w-8",label:"truncate min-w-[4ch]",overlay:"w-fit min-w-full"},"data-capture-wheel":"true"}),null,16,["modelValue","invalid","filter","auto-filter-focus","options","class","aria-label"])]),_:1},8,["widget"]))}}),Ae={class:"min-w-0 flex-1 px-1 py-2 text-left truncate"},Ve={key:0},De={key:1},Ie=["multiple","disabled","accept"],Qe=I({__name:"FormDropdownInput",props:{isOpen:{type:Boolean,default:!1},placeholder:{default:"Select..."},files:{},items:{},selected:{},maxSelectable:{},uploadable:{type:Boolean},disabled:{type:Boolean},accept:{}},emits:["select-click","file-change"],setup(t,{emit:e}){const i=t,b=e,n=c(()=>i.items.filter(p=>i.selected.has(p.id))),y=c(()=>$("border-0 bg-component-node-widget-background outline-none text-text-secondary",i.disabled?"cursor-not-allowed":"hover:bg-component-node-widget-background-hovered cursor-pointer",n.value.length>0&&"text-text-primary"));return(p,s)=>(f(),x("div",{class:C(h($)(h(re),"flex text-base leading-none",{"opacity-50 cursor-not-allowed !outline-zinc-300/10":p.disabled}))},[M("button",{class:C(h($)(y.value,"flex justify-between items-center flex-1 min-w-0 h-8",{"rounded-l-lg":p.uploadable,"rounded-lg":!p.uploadable})),onClick:s[0]||(s[0]=u=>b("select-click",u))},[M("span",Ae,[n.value.length?(f(),x("span",De,W(n.value.map(u=>u.label??u.name).join(", ")),1)):(f(),x("span",Ve,W(p.placeholder),1))]),M("i",{class:C(["icon-[lucide--chevron-down]",h($)("mr-2 size-4 transition-transform duration-200 flex-shrink-0 text-component-node-foreground-secondary",p.isOpen&&"rotate-180")])},null,2)],2),p.uploadable?(f(),x("label",{key:0,class:C(h($)(y.value,"relative","size-8 flex justify-center items-center border-l rounded-r-lg border-zinc-300/10"))},[s[2]||(s[2]=M("i",{class:"icon-[lucide--folder-search] size-4"},null,-1)),M("input",{type:"file",class:"absolute inset-0 -z-1 opacity-0",multiple:p.maxSelectable>1,disabled:p.disabled,accept:p.accept,onChange:s[1]||(s[1]=u=>b("file-change",u))},null,40,Ie)],2)):P("",!0)],2))}}),Te={class:"text-secondary flex gap-2 px-4"},Fe={key:0,class:"mr-2 icon-[lucide--loader-circle] size-4 animate-spin"},Pe={key:1,class:"mr-2 icon-[lucide--search] size-4"},Le=["placeholder"],Be={key:0,class:"absolute top-[-2px] left-[-2px] size-2 rounded-full bg-component-node-widget-background-highlighted"},je=["onClick"],Re={key:0,class:"icon-[lucide--check] size-4"},K="bg-transparent border-0 outline-0 ring-0 text-left",le="size-6 flex justify-center items-center rounded-sm cursor-pointer transition-all duration-150 hover:scale-108 hover:text-base-foreground active:scale-95",We=I({__name:"FormDropdownMenuActions",props:T({isQuerying:{type:Boolean},sortOptions:{}},{layoutMode:{},layoutModeModifiers:{},searchQuery:{},searchQueryModifiers:{},sortSelected:{},sortSelectedModifiers:{}}),emits:["update:layoutMode","update:searchQuery","update:sortSelected"],setup(t){const e=z(t,"layoutMode"),i=z(t,"searchQuery"),b=z(t,"sortSelected"),n=$("h-8 bg-zinc-500/20 rounded-lg outline outline-1 outline-offset-[-1px] outline-node-component-border transition-all duration-150"),y=G("sortPopoverRef"),p=G("sortTriggerRef"),s=D(!1);function u(r){!y.value||!p.value||(s.value=!s.value,y.value.toggle(r,p.value))}g(u,"toggleSortPopover");function m(){s.value=!1,y.value?.hide()}g(m,"closeSortPopover");function o(r){b.value=r.id,m()}return g(o,"handleSortSelected"),(r,v)=>(f(),x("div",Te,[M("label",{class:C(h($)(h(n),"flex-1 flex px-2 items-center text-base leading-none cursor-text",i.value?.trim()!==""?"text-base-foreground":"","hover:outline-component-node-widget-background-highlighted/80","focus-within:outline-component-node-widget-background-highlighted/80"))},[r.isQuerying?(f(),x("i",Fe)):(f(),x("i",Pe)),ae(M("input",{"onUpdate:modelValue":v[0]||(v[0]=k=>i.value=k),type:"text",class:C(K),placeholder:r.$t("g.search")},null,8,Le),[[be,i.value]])],2),M("button",{ref_key:"sortTriggerRef",ref:p,class:C(h($)(K,h(n),"relative w-8 flex justify-center items-center cursor-pointer","hover:outline-component-node-widget-background-highlighted","active:!scale-95")),onClick:u},[b.value!=="default"?(f(),x("div",Be)):P("",!0),v[4]||(v[4]=M("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1))],2),j(h(se),{ref_key:"sortPopoverRef",ref:y,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:v[1]||(v[1]=k=>s.value=!1)},{default:q(()=>[M("div",{class:C(h($)("flex flex-col gap-2 p-2 min-w-32","bg-component-node-background","rounded-lg outline outline-offset-[-1px] outline-component-node-border"))},[(f(!0),x(ee,null,te(r.sortOptions,k=>(f(),x("button",{key:k.name,class:C(h($)(K,"flex justify-between items-center h-6 cursor-pointer","hover:!text-blue-500")),onClick:g(O=>o(k),"onClick")},[M("span",null,W(k.name),1),b.value===k.id?(f(),x("i",Re)):P("",!0)],10,je))),128))],2)]),_:1},512),M("div",{class:C(h($)(h(n),"flex justify-center items-center p-1 gap-1 hover:outline-component-node-widget-background-highlighted"))},[M("button",{class:C(h($)(K,le,e.value==="list"?"bg-neutral-500/50 text-base-foreground":"")),onClick:v[2]||(v[2]=k=>e.value="list")},v[5]||(v[5]=[M("i",{class:"icon-[lucide--list] size-4"},null,-1)]),2),M("button",{class:C(h($)(K,le,e.value==="grid"?"bg-neutral-500/50 text-base-foreground":"")),onClick:v[3]||(v[3]=k=>e.value="grid")},v[6]||(v[6]=[M("i",{class:"icon-[lucide--layout-grid] size-4"},null,-1)]),2)],2)]))}}),Ke={class:"text-secondary mb-4 flex gap-1 px-4 justify-start"},qe=["disabled","onClick"],Ee=I({__name:"FormDropdownMenuFilter",props:T({filterOptions:{}},{filterSelected:{},filterSelectedModifiers:{}}),emits:["update:filterSelected"],setup(t){const e=z(t,"filterSelected"),{isUploadButtonEnabled:i,showUploadDialog:b}=Ce(),n=c(()=>t.filterOptions.length===1);return(y,p)=>(f(),x("div",Ke,[(f(!0),x(ee,null,te(y.filterOptions,s=>(f(),x("button",{key:s.id,type:"button",disabled:n.value,class:C(h($)("px-4 py-2 rounded-md inline-flex justify-center items-center select-none appearance-none border-0 text-base-foreground",!n.value&&"transition-all duration-150 hover:text-base-foreground hover:bg-interface-menu-component-surface-hovered cursor-pointer active:scale-95",!n.value&&e.value===s.id?"!bg-interface-menu-component-surface-selected text-base-foreground":"bg-transparent")),onClick:g(u=>e.value=s.id,"onClick")},W(s.name),11,qe))),128)),h(i)&&n.value?(f(),F(fe,{key:0,label:y.$t("g.import"),class:"ml-auto text-base-foreground hover:bg-node-component-widget-input-surface",type:"transparent",onClick:h(b)},{icon:q(()=>p[0]||(p[0]=[M("i",{class:"icon-[lucide--folder-input]"},null,-1)])),_:1},8,["label","onClick"])):P("",!0)]))}}),ce=Symbol("assetKind"),He={key:0,class:"absolute top-1 left-1 size-4 rounded-full border-1 border-base-foreground bg-primary-background"},Ne=["src"],Xe={key:3,class:"size-full bg-gradient-to-tr from-blue-400 via-teal-500 to-green-400"},Ye={class:"text-secondary block text-xs"},Ze=I({__name:"FormDropdownMenuItem",props:{index:{},selected:{type:Boolean},mediaSrc:{},name:{},label:{},metadata:{},layout:{}},emits:["click","mediaLoad"],setup(t,{emit:e}){const i=t,b=e,n=D(null),y=we(ce),p=c(()=>y?.value==="video");function s(){b("click",i.index)}g(s,"handleClick");function u(o){if(b("mediaLoad",o),!o.target||!(o.target instanceof HTMLImageElement))return;const r=o.target;r.naturalWidth&&r.naturalHeight&&(n.value=`${r.naturalWidth} x ${r.naturalHeight}`)}g(u,"handleImageLoad");function m(o){if(b("mediaLoad",o),!o.target||!(o.target instanceof HTMLVideoElement))return;const r=o.target;r.videoWidth&&r.videoHeight&&(n.value=`${r.videoWidth} x ${r.videoHeight}`)}return g(m,"handleVideoLoad"),(o,r)=>{const v=he("tooltip");return f(),x("div",{class:C(h($)("flex gap-1 select-none group/item cursor-pointer bg-component-node-widget-background","transition-all duration-150",{"flex-col text-center":o.layout==="grid","flex-row text-left max-h-16 rounded-lg hover:scale-102 active:scale-98":o.layout==="list","flex-row text-left hover:bg-component-node-widget-background-hovered rounded-lg":o.layout==="list-small","ring-2 ring-component-node-widget-background-highlighted":o.layout==="list"&&o.selected})),onClick:s},[o.layout!=="list-small"?(f(),x("div",{key:0,class:C(h($)("relative","w-full aspect-square overflow-hidden outline-1 outline-offset-[-1px] outline-interface-stroke","transition-all duration-150",{"min-w-16 max-w-16 rounded-l-lg":o.layout==="list","rounded-sm group-hover/item:scale-108 group-active/item:scale-95":o.layout==="grid","ring-2 ring-component-node-widget-background-highlighted":o.layout==="grid"&&o.selected}))},[o.selected?(f(),x("div",He,r[0]||(r[0]=[M("i",{class:"icon-[lucide--check] size-3 translate-y-[-0.5px] text-base-foreground bold"},null,-1)]))):P("",!0),o.mediaSrc&&p.value?(f(),x("video",{key:1,src:o.mediaSrc,class:"size-full object-cover",preload:"metadata",muted:"",onLoadeddata:m},null,40,Ne)):o.mediaSrc?(f(),F(ze,{key:2,src:o.mediaSrc,alt:o.name,"image-class":"size-full object-cover",onLoad:u},null,8,["src","alt"])):(f(),x("div",Xe))],2)):P("",!0),M("div",{class:C(h($)("flex gap-1",{"flex-col":o.layout==="grid","flex-col px-4 py-1 w-full justify-center min-w-0":o.layout==="list","flex-row p-2 items-center justify-between w-full":o.layout==="list-small"}))},[ae((f(),x("span",{class:C(h($)("block text-xs line-clamp-2 break-words overflow-hidden","transition-colors duration-150",!!o.selected&&"text-base-foreground"))},[Se(W(o.label??o.name),1)],2)),[[v,o.layout==="grid"?o.label??o.name:void 0]]),M("span",Ye,W(o.metadata||n.value),1)],2)],2)}}}),Ge={class:"flex max-h-[640px] w-103 flex-col rounded-lg bg-component-node-background pt-4 outline outline-offset-[-1px] outline-node-component-border"},Je={class:"relative flex h-full mt-2 overflow-y-scroll"},_e={key:0,class:"absolute inset-0 flex items-center justify-center"},et=["title"],tt=I({__name:"FormDropdownMenu",props:T({items:{},isSelected:{type:Function},isQuerying:{type:Boolean},filterOptions:{},sortOptions:{}},{filterSelected:{},filterSelectedModifiers:{},layoutMode:{},layoutModeModifiers:{},sortSelected:{},sortSelectedModifiers:{},searchQuery:{},searchQueryModifiers:{}}),emits:T(["item-click"],["update:filterSelected","update:layoutMode","update:sortSelected","update:searchQuery"]),setup(t,{emit:e}){const i=e,b=z(t,"filterSelected"),n=z(t,"layoutMode"),y=z(t,"sortSelected"),p=z(t,"searchQuery");return(s,u)=>(f(),x("div",Ge,[s.filterOptions.length>0?(f(),F(Ee,{key:0,"filter-selected":b.value,"onUpdate:filterSelected":u[0]||(u[0]=m=>b.value=m),"filter-options":s.filterOptions},null,8,["filter-selected","filter-options"])):P("",!0),j(We,{"layout-mode":n.value,"onUpdate:layoutMode":u[1]||(u[1]=m=>n.value=m),"sort-selected":y.value,"onUpdate:sortSelected":u[2]||(u[2]=m=>y.value=m),"search-query":p.value,"onUpdate:searchQuery":u[3]||(u[3]=m=>p.value=m),"sort-options":s.sortOptions,"is-querying":s.isQuerying},null,8,["layout-mode","sort-selected","search-query","sort-options","is-querying"]),M("div",Je,[M("div",{class:C(h($)("h-full max-h-full grid gap-x-2 gap-y-4 overflow-y-auto px-4 pt-4 pb-4 w-full",{"grid-cols-4":n.value==="grid","grid-cols-1 gap-y-2":n.value==="list","grid-cols-1 gap-y-1":n.value==="list-small"}))},[u[4]||(u[4]=M("div",{class:"pointer-events-none absolute inset-x-3 top-0 z-10 h-5"},null,-1)),s.items.length===0?(f(),x("div",_e,[M("i",{title:s.$t("g.noItems"),class:"icon-[lucide--circle-off] size-30 text-zinc-500/20"},null,8,et)])):P("",!0),(f(!0),x(ee,null,te(s.items,(m,o)=>(f(),F(Ze,{key:m.id,index:o,selected:s.isSelected(m,o),"media-src":m.mediaSrc,name:m.name,label:m.label,metadata:m.metadata,layout:n.value,onClick:g(r=>i("item-click",m,o),"onClick")},null,8,["index","selected","media-src","name","label","metadata","layout","onClick"]))),128))],2)])]))}});async function lt(t,e){if(t.trim()==="")return e;const i=t.trim().toLowerCase().split(" ");return e.filter(b=>{const n=b.name.toLowerCase();return i.every(y=>n.includes(y))})}g(lt,"defaultSearcher");function ot(){return[{name:"Default",id:"default",sorter:g(({items:t})=>t.slice(),"sorter")},{name:"A-Z",id:"a-z",sorter:g(({items:t})=>t.slice().sort((e,i)=>e.name.localeCompare(i.name)),"sorter")}]}g(ot,"getDefaultSortOptions");const at=I({__name:"FormDropdown",props:T({items:{},placeholder:{default:B("widgets.uploadSelect.placeholder")},multiple:{type:[Boolean,Number],default:!1},uploadable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},accept:{},filterOptions:{default:g(()=>[],"default")},sortOptions:{default:g(()=>ot(),"default")},isSelected:{type:Function,default:g((t,e,i)=>t.has(e.id),"default")},searcher:{type:Function,default:lt}},{selected:{default:new Set},selectedModifiers:{},filterSelected:{default:""},filterSelectedModifiers:{},sortSelected:{default:"default"},sortSelectedModifiers:{},layoutMode:{default:"grid"},layoutModeModifiers:{},files:{default:[]},filesModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:selected","update:filterSelected","update:sortSelected","update:layoutMode","update:files","update:searchQuery"],setup(t){const e=t,i=z(t,"selected"),b=z(t,"filterSelected"),n=z(t,"sortSelected"),y=z(t,"layoutMode"),p=z(t,"files"),s=z(t,"searchQuery"),u=ke(s,700,{maxWait:700}),m=D(!1),o=oe(),r=D(),v=G("triggerRef"),k=D(!1),O=c(()=>e.multiple===!0?1/0:typeof e.multiple=="number"?e.multiple:1),L=D([]);J(s,S=>{m.value=S!==u.value}),J([u,()=>e.items],(S,w,l)=>{let a=!1,d;l(()=>{a=!0,d?.()}),e.searcher(u.value,e.items,U=>d=U).then(U=>{a||(L.value=U)}).finally(()=>{a||(m.value=!1)})},{immediate:!0});const A=c(()=>e.sortOptions.find(w=>w.id==="default")?.sorter||(({items:w})=>w.slice())),Q=c(()=>n.value==="default"?A.value:e.sortOptions.find(w=>w.id===n.value)?.sorter||A.value),E=c(()=>Q.value({items:L.value})||[]);function H(S,w){return e.isSelected?.(i.value,S,w)??!1}g(H,"internalIsSelected");const N=g(S=>{e.disabled||r.value&&v.value&&(r.value.toggle(S,v.value),k.value=!k.value)},"toggleDropdown"),X=g(()=>{r.value&&(r.value.hide(),k.value=!1)},"closeDropdown");function Y(S){if(e.disabled)return;const w=S.target;w.files&&(p.value=Array.from(w.files)),w.value=""}g(Y,"handleFileChange");function Z(S,w){if(e.disabled)return;const l=i.value;if(H(S,w))l.delete(S.id);else if(l.size<O.value)l.add(S.id);else if(O.value===1)l.clear(),l.add(S.id);else{o.addAlert("Maximum selection limit reached");return}i.value=new Set(l),O.value===1&&X()}return g(Z,"handleSelection"),(S,w)=>(f(),x("div",{ref_key:"triggerRef",ref:v},[j(Qe,{files:p.value,"is-open":k.value,placeholder:S.placeholder,items:S.items,"max-selectable":O.value,selected:i.value,uploadable:S.uploadable,disabled:S.disabled,accept:S.accept,onSelectClick:N,onFileChange:Y},null,8,["files","is-open","placeholder","items","max-selectable","selected","uploadable","disabled","accept"]),j(h(se),{ref_key:"popoverRef",ref:r,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:w[4]||(w[4]=l=>k.value=!1)},{default:q(()=>[j(tt,{"filter-selected":b.value,"onUpdate:filterSelected":w[0]||(w[0]=l=>b.value=l),"layout-mode":y.value,"onUpdate:layoutMode":w[1]||(w[1]=l=>y.value=l),"sort-selected":n.value,"onUpdate:sortSelected":w[2]||(w[2]=l=>n.value=l),"search-query":s.value,"onUpdate:searchQuery":w[3]||(w[3]=l=>s.value=l),"filter-options":S.filterOptions,"sort-options":S.sortOptions,disabled:S.disabled,"is-querying":m.value,items:E.value,"is-selected":H,"max-selectable":O.value,onClose:X,onItemClick:Z},null,8,["filter-selected","layout-mode","sort-selected","search-query","filter-options","sort-options","disabled","is-querying","items","max-selectable"])]),_:1},512)],512))}});function st(t){return{category:c(()=>{}),assets:c(()=>[]),dropdownItems:c(()=>[]),isLoading:c(()=>!1),error:c(()=>null)}}g(st,"useAssetWidgetData");const nt=I({__name:"WidgetSelectDropdown",props:T({widget:{},nodeType:{},assetKind:{},allowUpload:{type:Boolean},uploadFolder:{},isAssetMode:{type:Boolean},defaultLayoutMode:{}},{modelValue:{default(t){return t.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t;Me(ce,c(()=>e.assetKind));const i=z(t,"modelValue"),b=oe(),n=me(),y=ue(),p=c(()=>({...ne(e.widget.options,ie),...y.value})),u=g(()=>e.isAssetMode&&e.nodeType?st($e(()=>e.nodeType)):null,"getAssetData")(),m=D("all"),o=c(()=>{if(e.isAssetMode){const l=u?.category.value??"All";return[{id:"all",name:xe(l)}]}return[{id:"all",name:"All"},{id:"inputs",name:"Inputs"},{id:"outputs",name:"Outputs"}]}),r=D(new Set);function v(l){const a=e.widget.options?.getOptionLabel;if(!a)return l;try{return a(l)}catch(d){return console.error("Failed to map value:",d),l}}g(v,"getDisplayLabel");const k=c(()=>{const l=e.widget.options?.values||[];return Array.isArray(l)?l.map((a,d)=>({id:`input-${d}`,mediaSrc:w(a,"input"),name:a,label:v(a),metadata:""})):[]}),O=c(()=>{if(!["image","video"].includes(e.assetKind??""))return[];const l=new Set;return n.historyTasks.forEach(a=>{a.flatOutputs.forEach(d=>{const U=e.assetKind==="image"&&d.mediaType==="images"||e.assetKind==="video"&&d.mediaType==="video";if(d.type==="output"&&U){const R=`${d.subfolder?`${d.subfolder}/${d.filename}`:d.filename} [output]`;l.add(R)}})}),Array.from(l).map(a=>({id:`output-${a}`,mediaSrc:w(a.replace(" [output]",""),"output"),name:a,label:v(a),metadata:""}))}),L=c(()=>e.isAssetMode&&u?u.dropdownItems.value:[...k.value,...O.value]),A=c(()=>{if(e.isAssetMode)return L.value;switch(m.value){case"inputs":return k.value;case"outputs":return O.value;case"all":default:return L.value}}),Q=c(()=>{const l=e.widget.options;if(l?.placeholder)return l.placeholder;switch(e.assetKind){case"image":return B("widgets.uploadSelect.placeholderImage");case"video":return B("widgets.uploadSelect.placeholderVideo");case"audio":return B("widgets.uploadSelect.placeholderAudio");case"model":return B("widgets.uploadSelect.placeholderModel");case"unknown":return B("widgets.uploadSelect.placeholderUnknown")}return B("widgets.uploadSelect.placeholder")}),E=c(()=>e.isAssetMode?!1:e.allowUpload===!0),H=c(()=>{switch(e.assetKind){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";default:return}}),N=D(e.defaultLayoutMode??"grid");J([i,A],([l,a])=>{if(l===void 0){r.value.clear();return}const d=A.value.find(U=>U.name===l);d&&(r.value.clear(),r.value.add(d.id))},{immediate:!0});function X(l){let a;if(l.size>0&&(a=l.values().next().value),a==null){i.value=void 0;return}const d=A.value.find(U=>U.id===a)?.name;if(!d){i.value=void 0;return}i.value=d}g(X,"updateSelectedItems");const Y=g(async(l,a=!1,d={})=>{const U=new FormData;U.append("image",l),a&&U.append("subfolder","pasted"),d.type&&U.append("type",d.type);const V=await ve.fetchApi("/upload/image",{method:"POST",body:U});if(V.status!==200)return b.addAlert(V.status+" - "+V.statusText),null;const R=await V.json();return(d.type==="input"||!d.type&&!a)&&await ge().updateInputs(),R.subfolder?`${R.subfolder}/${R.name}`:R.name},"uploadFile"),Z=g(async l=>{const a=e.uploadFolder??"input",d=l.map(V=>Y(V,!1,{type:a}));return(await Promise.all(d)).filter(V=>V!==null)},"uploadFiles");async function S(l){if(!(!l||l.length===0))try{const a=await Z(l);if(a.length===0){b.addAlert("File upload failed");return}e.widget.options?.values&&a.forEach(d=>{const U=e.widget.options.values;U.includes(d)||U.push(d)}),i.value=a[0],e.widget.callback&&e.widget.callback(a[0])}catch(a){console.error("Upload error:",a),b.addAlert(`Upload failed: ${a}`)}}g(S,"handleFilesUpdate");function w(l,a="input"){return["image","video"].includes(e.assetKind??"")?`/api/view?filename=${encodeURIComponent(l)}&type=${a}`:""}return g(w,"getMediaUrl"),(l,a)=>(f(),F(de,{widget:l.widget},{default:q(()=>[j(at,_({selected:r.value,"onUpdate:selected":a[0]||(a[0]=d=>r.value=d),"filter-selected":m.value,"onUpdate:filterSelected":a[1]||(a[1]=d=>m.value=d),"layout-mode":N.value,"onUpdate:layoutMode":a[2]||(a[2]=d=>N.value=d),items:A.value,placeholder:Q.value,multiple:!1,uploadable:E.value,accept:H.value,"filter-options":o.value},p.value,{class:"w-full","onUpdate:selected":X,"onUpdate:files":S}),null,16,["selected","filter-selected","layout-mode","items","placeholder","uploadable","accept","filter-options"])]),_:1},8,["widget"]))}}),yt=I({__name:"WidgetSelect",props:T({widget:{},nodeType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,i=z(t,"modelValue"),b=c(()=>{if(e.widget.spec&&ye(e.widget.spec))return e.widget.spec}),n=c(()=>{const r=b.value;if(!r)return{kind:"unknown",allowUpload:!1,folder:void 0};const{image_upload:v,animated_image_upload:k,video_upload:O,image_folder:L,audio_upload:A}=r;let Q="unknown";return O?Q="video":v||k?Q="image":A&&(Q="audio"),{kind:Q,allowUpload:v===!0||k===!0||O===!0||A===!0,folder:L}}),y=c(()=>!1),p=c(()=>n.value.kind),s=c(()=>y.value||p.value!=="unknown"),u=c(()=>n.value.allowUpload),m=c(()=>n.value.folder??"input"),o=c(()=>y.value?"list":"grid");return(r,v)=>s.value?(f(),F(nt,_({key:0},e,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=k=>i.value=k),"asset-kind":p.value,"allow-upload":u.value,"upload-folder":m.value,"is-asset-mode":y.value,"default-layout-mode":o.value}),null,16,["modelValue","asset-kind","allow-upload","upload-folder","is-asset-mode","default-layout-mode"])):(f(),F(Oe,{key:1,modelValue:i.value,"onUpdate:modelValue":v[1]||(v[1]=k=>i.value=k),widget:r.widget},null,8,["modelValue","widget"]))}});export{yt as _};
//# sourceMappingURL=WidgetSelect.vue_vue_type_script_setup_true_lang-DWS0J8kv.js.map
