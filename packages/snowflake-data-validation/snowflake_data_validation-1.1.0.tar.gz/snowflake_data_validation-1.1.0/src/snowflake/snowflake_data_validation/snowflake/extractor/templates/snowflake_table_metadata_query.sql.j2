WITH rc_cte AS (
    SELECT COUNT(*) AS ROW_COUNT FROM {{ fully_qualified_name }} {% if has_where_clause %} WHERE {{ where_clause }} {% endif %} LIMIT 1
)

SELECT
    C.COLUMN_NAME as COLUMN_VALIDATED,
    C.ORDINAL_POSITION AS ORDINAL_POSITION,
    C.DATA_TYPE AS DATA_TYPE,
    C.CHARACTER_MAXIMUM_LENGTH AS CHARACTER_MAXIMUM_LENGTH,
    CASE
        -- 53 represents the standard IEEE 754 double-precision floating-point precision in bits,
        -- which is Snowflake's internal representation for FLOAT types.
        WHEN C.DATA_TYPE = 'FLOAT' THEN 53
        ELSE C.NUMERIC_PRECISION
    END AS NUMERIC_PRECISION,
    C.NUMERIC_SCALE AS NUMERIC_SCALE,
    C.IS_NULLABLE AS IS_NULLABLE,
    rc.ROW_COUNT
FROM {{ object_database }}.INFORMATION_SCHEMA.COLUMNS C
CROSS JOIN rc_cte rc
WHERE C.TABLE_NAME = '{{ object_name }}'
AND C.TABLE_SCHEMA = '{{ object_schema }}'
AND C.TABLE_CATALOG = '{{ object_database }}'
{% if columns %}
    AND C.COLUMN_NAME IN (
        {% for column in columns %}
            '{{ column }}'{% if not loop.last %}, {% endif %}
        {% endfor %}
    )
{% endif %}
