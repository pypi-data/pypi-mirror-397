WITH rc_cte AS (
        SELECT COUNT(*) AS ROW_COUNT FROM {{ fully_qualified_name }} {% if has_where_clause %} WHERE {{ where_clause }} {% endif %}
)
    SELECT
        UPPER(C.COLUMN_NAME) AS COLUMN_VALIDATED,
        C.ORDINAL_POSITION AS ORDINAL_POSITION,
        UPPER(C.DATA_TYPE) AS DATA_TYPE,
        CASE
            WHEN C.DATA_TYPE IN ('binary varying', 'varbyte', 'varbinary', 'binary') THEN NULL
            ELSE C.CHARACTER_MAXIMUM_LENGTH
        END AS CHARACTER_MAXIMUM_LENGTH,
        CASE
            WHEN C.DATA_TYPE IN ('real', 'float4', 'float', 'double precision', 'float8') THEN -1
            ELSE C.NUMERIC_PRECISION
        END AS NUMERIC_PRECISION,
        C.NUMERIC_SCALE AS NUMERIC_SCALE,
        C.IS_NULLABLE AS IS_NULLABLE,
        rc.ROW_COUNT
   FROM SVV_COLUMNS C
CROSS JOIN rc_cte rc
WHERE C.TABLE_NAME = '{{ object_name | lower }}'
AND C.TABLE_SCHEMA = '{{ object_schema }}'
{% if columns %}
    AND UPPER(C.COLUMN_NAME) IN (
    {% for column in columns %}
        '{{ column }}'{% if not loop.last %}, {% endif %}
        {% endfor %}
    )
{% endif %}
