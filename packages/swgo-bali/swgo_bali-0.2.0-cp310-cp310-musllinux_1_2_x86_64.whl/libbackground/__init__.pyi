# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.

from enum import IntEnum

__all__ = [
	"Metadata",
	"Background",
	"MetadataVector",
	"DoubleVector",
	"PEListVector",
]


class Metadata:
	"""Event metadata for a simulated air shower.

	Attributes
	----------
	uid : int
		Unique ID of the shower.
	primary : Metadata.Primary
		Type of primary particle (gamma = 1, proton = 14).
	energy : float
		Energy of the primary particle in GeV.
	x : float
		X position of the shower core in meters.
	y : float
		Y position of the shower core in meters.
	theta : float
		Zenith angle of the shower in radians.
	phi : float
		Azimuth angle of the shower in radians.
	time : float
		Arrival time of the shower in seconds.
	"""

	class Primary(IntEnum):
		"""Primary particle type enum.
		"""

		GAMMA = 1
		PROTON = 14

	uid: int
	primary: "Metadata.Primary"
	energy: float
	x: float
	y: float
	theta: float
	phi: float
	time: float

	def __init__(self) -> None: ...

	def __repr__(self) -> str: ...


# Type aliases for the vector bindings exposed by the module
MetadataVector = list[Metadata]
DoubleVector = list[list[float]]
PEListVector = list[tuple[int, list[float]]]


class Background:
	"""The main interface of the background library.
	Can be initialized from a settings file.
	On initialization all generators are initialized and cached models are loaded.

	Parameters
	----------
	settings : str
		Path of the settings file.

	Raises
	------
	RuntimeError
		If an IO error occurs or if model/generator initialization throws.
	"""
	def __init__(self, settings: str) -> None: ...

	def next_chunk(self, time_span: float) -> PEListVector:
		"""Generates a chunk of background.

		Every call will give the chunk that immediately follows the previously returned chunk.
		The returned vector contains pairs of channel IDs and vectors of photo electron times.
		The vectors of p.e. times are guaranteed to be sorted and non-empty.

		Parameters
		----------
		time_span : float
			Time span of the chunk in seconds.

		Returns
		-------
		list of tuple
			A sorted list of (channel_id, p_e_times) where p_e_times is a sorted list of photo electron times in seconds.

		Raises
		------
		IndexError
			If no more background is available.
		"""
		...

	def seek(self, time: float) -> None:
		"""Sets the start time of the next call to `next_chunk()`.

		Parameters
		----------
		time : float
			Absolute start time in seconds.

		Returns
		-------
		None
		"""
		...

	def generate_metadata(self, begin: float, end: float) -> MetadataVector:
		"""Generates metadata for the photo electron lists generated by `next_chunk()`.

		Only the metadata in the given interval is generated.
		For all time intervals that can be sampled with `next_chunk()` the result is well defined.

		Parameters
		----------
		begin : float
			Begin of interval of interest in seconds.
		end : float
			End of interval of interest in seconds.

		Returns
		-------
		list of Metadata
			A list of event metadata.

		Raises
		------
		RuntimeError
			If an IO error occurs.

		IndexError
			If begin or end are outside the sampling interval.
		"""
		...


