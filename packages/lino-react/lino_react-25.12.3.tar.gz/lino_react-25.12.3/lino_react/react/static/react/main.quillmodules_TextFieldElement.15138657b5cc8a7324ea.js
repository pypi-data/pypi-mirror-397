"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[6301],{723:function(e,t,l){var a,n=this&&this.__createBinding||(Object.create?function(e,t,l,a){void 0===a&&(a=l);var n=Object.getOwnPropertyDescriptor(t,l);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[l]}}),Object.defineProperty(e,a,n)}:function(e,t,l,a){void 0===a&&(a=l),e[a]=t[l]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var t=[];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(t[t.length]=l);return t},a(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var l=a(e),o=0;o<l.length;o++)"default"!==l[o]&&n(t,e,l[o]);return r(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.quillMention=t.imageHandler=t.overrideImageButtonHandler=t.changeDelta=t.quillLoad=t.tableContextMenuProps=t.Delta=t.name=void 0,t.QuillEditor=k,t.name="quillmodules",l(1882);const i=s(l(6540)),u=s(l(5556)),c=o(l(5743));Object.defineProperty(t,"Delta",{enumerable:!0,get:function(){return c.Delta}});const d=s(l(3503)),m=l(7421),f=s(l(1244)),p=s(l(537)),h=s(l(194)),b=s(l(3117)),g=l(5548),E=l(6606);l(5065);const v=c.default.import("modules/table"),N=c.default.import("formats/table"),A=c.default.import("formats/table-row"),q=c.default.import("formats/table-container"),w=c.default.import("formats/table-body");class y extends N{static create(e){let t;return"string"==typeof e||null==e?t=super.create(e):(t=super.create(e.row),e.class&&t.setAttribute("class",e.class)),t}static formats(e,t){const l={};if(l.row=super.formats(e,t),e.hasAttribute("class")){const t=e.getAttribute("class");t&&t.length&&(l.class=t)}return l}formats(){return{[y.blotName]:y.formats(this.domNode,this.scroll)}}format(e,t){if(e===y.blotName){if("string"==typeof t)throw new Error("TableCell.format: string value is not supported, use an object { row?: string, class?: string }");"object"==typeof t&&null!=t&&(t.row&&super.format(e,t.row),t.class&&t.class.length?this.domNode.setAttribute("class",t.class):this.domNode.hasAttribute("class")&&this.domNode.removeAttribute("class"))}else super.format(e,t)}}class x extends A{static create(e){const t=super.create();return e&&e.length&&t.setAttribute("class",e),t}static formats(e){if(e.hasAttribute("class"))return e.getAttribute("class")}formats(){return{[x.blotName]:x.formats(this.domNode)}}format(e,t){e===x.blotName?t&&t.length?this.domNode.setAttribute("class",t):this.domNode.removeAttribute("class"):super.format(e,t)}checkMerge(){if(f.default.prototype.checkMerge.call(this)&&null!=this.next.children.head){const e=this.children.head.formats(),t=this.children.tail.formats(),l=this.next.children.head.formats(),a=this.next.children.tail.formats();return e.table.row===t.table.row&&e.table.row===l.table.row&&e.table.row===a.table.row}return!1}optimize(...e){f.default.prototype.optimize.call(this,...e),this.children.forEach(e=>{var t,l;if(null==e.next)return;const a=e.formats(),n=e.next.formats();if((null===(t=a[y.blotName])||void 0===t?void 0:t.row)!==(null===(l=n[y.blotName])||void 0===l?void 0:l.row)){const t=this.splitAfter(e);t&&t.optimize(),this.prev&&this.prev.optimize()}})}}class C extends q{static create(e){const t=super.create(e);return e&&e.length&&t.setAttribute("class",e),t}static formats(e){if(e.hasAttribute("class"))return e.getAttribute("class")}formats(){return{[C.blotName]:C.formats(this.domNode)}}format(e,t){e===C.blotName?t&&t.length?this.domNode.setAttribute("class",t):this.domNode.removeAttribute("class"):super.format(e,t)}balanceCells(){const e=this.descendants(x),t=e.reduce((e,t)=>Math.max(t.children.length,e),0);e.forEach(e=>{new Array(t-e.children.length).fill(0).forEach(()=>{let t=null;null!=e.children.head&&(t=y.formats(e.children.head.domNode,this.scroll));const l=this.scroll.create(y.blotName,t);e.appendChild(l),l.optimize()})})}insertColumn(e){const[t]=this.descendant(w);null!=t&&null!=t.children.head&&t.children.forEach(t=>{const l=t.children.at(e),a=y.formats(l.domNode,l.scroll),n=this.scroll.create(y.blotName,a);t.insertBefore(n,l)})}insertRow(e){const[t]=this.descendant(w);if(null==t||null==t.children.head)return;const l=(0,m.tableId)(),a=t.children.head,n=a&&a.domNode?a.domNode.getAttribute("class"):void 0;let r;n&&n.length&&(r=n);const o=this.scroll.create(x.blotName,r);t.children.head.children.forEach(()=>{const e=a.children.head,t=e&&e.domNode?e.domNode.getAttribute("class"):void 0,n=this.scroll.create(y.blotName,{row:l,class:t||void 0});o.appendChild(n)});const s=t.children.at(e);t.insertBefore(o,s)}}c.default.register("modules/imageDropAndPaste",p.default),c.default.register("modules/blotFormatter2",h.default),c.default.register({"blots/mention":g.MentionBlot,"modules/mention":g.Mention}),c.default.register("modules/htmlEditButton",b.default),c.default.register("modules/table",class extends v{insertTable(e,t){const l=this.quill.getSelection();if(null==l)return;const a=new Array(e).fill(0).reduce(e=>{const l=new Array(t).fill("\n").join("");return e.insert(l,{table:{row:(0,m.tableId)()}})},(new c.Delta).retain(l.index));this.quill.updateContents(a,c.default.sources.USER),this.quill.setSelection(l.index,c.default.sources.SILENT),this.balanceTables()}}),c.default.register("formats/table-row",x),c.default.register("formats/table",y),c.default.register("formats/table-container",C);const P=p.default.ImageData;let R;const _=R={AbortController:Promise.resolve().then(()=>o(l(5568))),prContextMenu:Promise.resolve().then(()=>o(l(3181))),prUtils:Promise.resolve().then(()=>o(l(4881))),queryString:Promise.resolve().then(()=>o(l(8091))),i18n:Promise.resolve().then(()=>o(l(2292))),u:Promise.resolve().then(()=>o(l(1367)))};(0,E.RegisterImportPool)(R);t.tableContextMenuProps=({i18n:e,quillRef:t,c:l})=>{const a=()=>(t.current.focus(),t.current.getModule("table"));return{model:[{command:()=>{a().insertColumnLeft()},icon:i.default.createElement("span",null,"Â â­°Â "),label:e.t("Insert column left")},{command:()=>{a().insertColumnRight()},icon:i.default.createElement("span",null,"Â â­²Â "),label:e.t("Insert column right")},{command:()=>{a().insertRowAbove()},icon:i.default.createElement("span",null,"Â â­±Â "),label:e.t("Insert row above")},{command:()=>{a().insertRowBelow()},icon:i.default.createElement("span",null,"Â â­³Â "),label:e.t("Insert row below")},{command:()=>{a().deleteColumn()},icon:"pi pi-delete-left",label:e.t("Delete column")},{command:()=>{a().deleteRow()},icon:"pi pi-eraser",label:e.t("Delete row")},{command:()=>{a().deleteTable()},icon:"pi pi-trash",label:e.t("Delete table")},{command:()=>{const n=t.current,[r,o,s]=a().getTable(),i=l,u=e.t("TABLE class"),c=e.t("TR class"),d=e.t("TD class"),m=e.t("Apply to all rows"),f=e.t("Apply to all cells"),p=e.t("Apply to all cells of this row"),h=e.t("Manage classes"),b=e.t("Apply");i.APP.dialogFactory.createParamDialog(i,{[u]:{default:r.domNode.getAttribute("class")||"",react_name:"CharFieldElement"},[c]:{default:o.domNode.getAttribute("class")||"",react_name:"CharFieldElement"},[m]:{default:!1,react_name:"BooleanFieldElement"},[d]:{default:s.domNode.getAttribute("class")||"",react_name:"CharFieldElement"},[p]:{default:!1,react_name:"BooleanFieldElement"},[f]:{default:!1,react_name:"BooleanFieldElement"}},h,e=>{const t=e[u].split(",").filter(e=>!!e).join(" ").trim();n.formatLine(n.getIndex(r),1,C.blotName,t);const l=(e,t)=>{n.formatLine(n.getIndex(t),1,x.blotName,e)},a=e[c].split(",").filter(e=>!!e).join(" ").trim();let i;if(l(a,o),e[m]){for(i=o.prev;null!==i;)l(a,i),i=i.prev;for(i=o.next;null!==i;)l(a,i),i=i.next}const h=e[f];let b;const g=e[d].split(",").filter(e=>!!e).join(" ").trim();if(n.formatLine(n.getIndex(s),1,y.blotName,{class:g}),h||e[p]){for(b=s.prev;null!==b;)n.formatLine(n.getIndex(b),1,y.blotName,{class:g}),b=b.prev;for(b=s.next;null!==b;)n.formatLine(n.getIndex(b),1,y.blotName,{class:g}),b=b.next}if(h){for(i=o.prev;null!==i;){if(b=i.children.head,null!==b.prev)throw new Error("Programming error, row.children.head returned cell with prev item");for(;null!==b;)n.formatLine(n.getIndex(b),1,y.blotName,{class:g}),b=b.next;i=i.prev}for(i=o.next;null!==i;){if(b=i.children.head,null!==b.prev)throw new Error("Programming error, row.children.head returned cell with prev item");for(;null!==b;)n.formatLine(n.getIndex(b),1,y.blotName,{class:g}),b=b.next;i=i.next}}return n.emitter.emit("text-change"),!0},b)},icon:i.default.createElement("span",null,"Â ðŸ„¿Â "),label:e.t("Properties")}]}};const I=({plain:e,quillRef:t,elementRef:l})=>e?null:e=>{const a=t.current.getModule("table"),[n]=a.getTable();null!==n&&(e.preventDefault(),l.current.show(e))};t.quillLoad=(e,t)=>{};const L=({signal:e,i18n:l,props:a,quillRef:n})=>{const{c:r}=a,o=`l-ql-toolbar-${a.parent.props.elem.name}`,s={toolbar:`#${o}`,mention:(0,t.quillMention)({silentFetch:r.actionHandler.silentFetch,signal:e,mentionValues:r.mentionValues}),blotFormatter2:{debug:!0,resize:{useRelativeSize:!0},video:{registerBackspaceFix:!1}},table:!0};a.showHeader&&(s.htmlEditButton={msg:l.t('Edit HTML here, when you click "OK" the quill editor\'s contents will be replaced'),prependSelector:"div#raw-editor-container",okText:l.t("Ok"),cancelText:l.t("Cancel"),buttonTitle:l.t("Show HTML source")}),a.c.APP.state.site_data.installed_plugins.includes("uploads")&&(s.imageDropAndPaste={handler:(0,t.imageHandler)(n)}),s.keyboard={bindings:{home:{key:"Home",shiftKey:null,handler:function(e,t){const l=n.current,[a]=l.getLine(e.index);if(a&&"LI"===a.domNode.tagName){if(t.event.shiftKey){const t=a.offset(l.scroll);l.setSelection(t,e.index-t,"user")}else l.setSelection(a.offset(l.scroll),0,"user");return!1}return!0}}}},a.plain&&(s.keyboard.bindings["list autofill"]=!1),a.showHeader||delete s.toolbar;return{modules:s,meta:{toolbarID:o}}};t.changeDelta=({quillRef:e,parent:t,prUtils:l,plain:a})=>(n,r,o)=>{const s=e.current,i=s.container.children[0];let u=i?i.innerHTML:null;const d=s.getText();if("<p><br></p>"===u&&(u=null),o===c.default.sources.API){const m=s.container.children[0],f=document.createElement("div");if(f.innerHTML=t.getValue()||"",l.DomHandler.isEqualElement(m,f))return}if(u){const p=document.createElement("div");function h(e){if(e.nodeType===Node.ELEMENT_NODE){const t=Array.from(e.attributes);t.sort((e,t)=>e.name.localeCompare(t.name));for(let l=0;l<t.length;l++)e.removeAttribute(t[l].name);for(let l=0;l<t.length;l++)e.setAttribute(t[l].name,t[l].value)}for(let t=0;t<e.childNodes.length;t++)h(e.childNodes[t])}p.innerHTML=u,h(p),u=p.innerHTML}((e,t,l)=>{const a=l.textValue.slice(0,-1),n=(t?a:l.htmlValue)||"";e.update({[e.dataKey]:n})})(t,a,{htmlValue:u,textValue:d,delta:n,source:o})};t.overrideImageButtonHandler=e=>{e.current.getModule("toolbar").addHandler("image",l=>{if(l){const l=document.createElement("input");l.setAttribute("type","file"),l.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),l.classList.add("ql-image"),l.addEventListener("change",a=>{const n=a.target.files;let r;if(n.length>0){r=n[0];const a=r.type,o=new FileReader;o.onload=n=>{const o=n.target.result;(0,t.imageHandler)(e)(o,a,new P(o,a,r.name)),l.value=""},o.readAsDataURL(r)}}),l.click()}})};t.imageHandler=e=>(t,l,a)=>{const n=e.current;let r=(n.getSelection()||{}).index;(void 0===r||r<0)&&(r=n.getLength()),n.insertEmbed(r,"image",t);const o=n.getLeaf(r)[0];o.domNode.setAttribute("width","100%"),o.domNode.setAttribute("height","auto")};t.quillMention=({silentFetch:e,signal:t,mentionValues:l})=>({allowedChars:/^[A-Za-z0-9\s]*$/,mentionDenotationChars:window.App.state.site_data.suggestors,source:function(a,n,r){if(0===a.length){const e=l[r];n(e,a)}else R.resolve(["queryString"]).then(({queryString:l})=>{e({path:`suggestions?${l.default.stringify({query:a,trigger:r})}`,signal:t}).then(e=>n(e.suggestions,a))})},listItemClass:"ql-mention-list-item",mentionContainerClass:"ql-mention-list-container",mentionListClass:"ql-mention-list",dataAttributes:["value","link","title","denotationChar"]});const M=i.default.createElement(i.default.Fragment,null,i.default.createElement("span",{className:"ql-formats"},i.default.createElement("select",{className:"ql-header",defaultValue:"0"},i.default.createElement("option",{value:"1"},"Header 1"),i.default.createElement("option",{value:"2"},"Header 2"),i.default.createElement("option",{value:"3"},"Header 3"),i.default.createElement("option",{value:"4"},"Header 4"),i.default.createElement("option",{value:"0"},"Normal")),i.default.createElement("select",{className:"ql-font"},i.default.createElement("option",{defaultValue:"true"}),i.default.createElement("option",{value:"serif"}),i.default.createElement("option",{value:"monospace"}))),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("select",{className:"ql-size"},i.default.createElement("option",{value:"small"}),i.default.createElement("option",{defaultValue:"true"}),i.default.createElement("option",{value:"large"}),i.default.createElement("option",{value:"huge"}))),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("button",{className:"ql-script",value:"sub"}),i.default.createElement("button",{className:"ql-script",value:"super"})),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("button",{type:"button",className:"ql-bold","aria-label":"Bold"}),i.default.createElement("button",{type:"button",className:"ql-italic","aria-label":"Italic"}),i.default.createElement("button",{type:"button",className:"ql-underline","aria-label":"Underline"})),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("select",{className:"ql-color"}),i.default.createElement("select",{className:"ql-background"})),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("button",{type:"button",className:"ql-list",value:"ordered","aria-label":"Ordered List"}),i.default.createElement("button",{type:"button",className:"ql-list",value:"bullet","aria-label":"Unordered List"}),i.default.createElement("select",{className:"ql-align"},i.default.createElement("option",{defaultValue:"true"}),i.default.createElement("option",{value:"center"}),i.default.createElement("option",{value:"right"}),i.default.createElement("option",{value:"justify"}))),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("button",{type:"button",className:"ql-link","aria-label":"Insert Link"}),i.default.createElement("button",{type:"button",className:"ql-image","aria-label":"Insert Image"}),i.default.createElement("button",{type:"button",className:"ql-code-block","aria-label":"Insert Code Block"})),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("button",{type:"button",className:"ql-clean","aria-label":"Remove Styles"}))),D=({quill:e,c:t})=>{const{APP:l}=t,{URLContext:a}=l;let n=(e.getSelection()||{}).index;(void 0===n||n<0)&&(n=e.getLength()),a.actionHandler.runAction({action_full_name:a.actionHandler.findUniqueAction("insert_reference").full_name,actorId:"about.About",response_callback:t=>{t.success&&e.insertText(n,t.message)}})},H=({quillRef:e,c:t})=>t.APP.state.site_data.installed_plugins.includes("memo")?i.default.createElement("span",{className:"ql-formats"},i.default.createElement("button",{type:"button",onClick:()=>D({quill:e.current,c:t}),"aria-label":"Open link dialog"},i.default.createElement("i",{className:"pi pi-link"}))):null,T=({quillRef:e,c:t,i18n:l,u:a})=>i.default.createElement(i.default.Fragment,null,M,H({quillRef:e,c:t}),i.default.createElement("span",{className:"ql-formats"},i.default.createElement("button",{type:"button",onClick:()=>{const n=t,r=l.t("rows x columns"),o=l.t("Rows"),s=l.t("Columns");n.APP.dialogFactory.createParamDialog(n,{[o]:{react_name:"IntegerFieldElement",default:3},[s]:{react_name:"IntegerFieldElement",default:3}},r,t=>{const r=parseInt(t[o]),i=parseInt(t[s]),u=a.isNaN(r);if(u||a.isNaN(i))return n.APP.toast.show({severity:"warn",summary:l.t("Not a number '{{dir}}'",{dir:u?l.t("rows"):l.t("columns")})}),!1;const c=e.current.getModule("table");return e.current.focus(),c.insertTable(r,i),!0})}},i.default.createElement("i",{className:"pi pi-table"}))));function k(e){const l=i.default.useRef(null),a=i.default.useRef(null),n=i.default.useRef(null),r=(0,E.getExReady)(_,["i18n","prContextMenu","u","AbortController","prUtils"],t=>{t.i18n=t.i18n.default,t.AbortController=t.AbortController.default,n.current=new t.AbortController;const{modules:a,meta:r}=L({props:e,signal:n.current.signal,i18n:t.i18n,quillRef:l});t.modules=a,t.meta=r});return i.default.useEffect(()=>()=>{n.current&&n.current.abort()},[]),r.ready?i.default.createElement("div",{onContextMenu:I({plain:e.plain,quillRef:l,elementRef:a}),onKeyDown:t=>{t.ctrlKey&&t.shiftKey&&"KeyL"==t.code&&(t.stopPropagation(),t.preventDefault(),D({quill:l.current,c:e.c}))}},e.showHeader&&i.default.createElement("div",{id:r.meta.toolbarID},e.plain?H({quillRef:l,c:e.c}):T({quillRef:l,c:e.c,i18n:r.i18n,u:r.u}),e.headerExtend),i.default.createElement(d.default,{config:{modules:r.modules,theme:"snow"},defaultValue:e.plain?(new c.Delta).insert(e.value):null,dangerouslySetInnerHTML:e.plain?null:{__html:e.htmlValue},onReady:a=>{l.current=a,e.parent.quill=a,(e.autoFocus||e.parent.leafIndexMatch())&&a.focus(),(0,t.quillLoad)(e.parent,a),!e.showHeader||e.inGrid||e.plain||e.c.APP.state.site_data.installed_plugins.includes("uploads")&&(0,t.overrideImageButtonHandler)(l)},onTextChange:(0,t.changeDelta)({parent:e.parent,plain:e.plain,prUtils:r.prUtils,quillRef:l})}),i.default.createElement(r.prContextMenu.ContextMenu,{...(0,t.tableContextMenuProps)({i18n:r.i18n,quillRef:l,c:e.c}),ref:a}),i.default.createElement("div",{id:"raw-editor-container",onKeyDown:e=>e.stopPropagation()})):null}k.propTypes={value:(e,...t)=>e.plain?u.default.string.isRequired(e,...t):null,htmlValue:(e,...t)=>e.plain?null:u.default.string.isRequired(e,...t),plain:u.default.bool.isRequired,showHeader:u.default.bool.isRequired,c:u.default.object.isRequired,parent:u.default.object.isRequired,inGrid:u.default.bool.isRequired,headerExtend:u.default.node,autoFocus:u.default.bool}},1882:(e,t,l)=>{l.r(t),l.d(t,{default:()=>g});var a=l(5072),n=l.n(a),r=l(7825),o=l.n(r),s=l(7659),i=l.n(s),u=l(5056),c=l.n(u),d=l(540),m=l.n(d),f=l(1113),p=l.n(f),h=l(5969),b={};b.styleTagTransform=p(),b.setAttributes=c(),b.insert=i().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=m();n()(h.A,b);const g=h.A&&h.A.locals?h.A.locals:void 0},5969:(e,t,l)=>{l.d(t,{A:()=>s});var a=l(1354),n=l.n(a),r=l(6314),o=l.n(r)()(n());o.push([e.id,".l-editor .ql-container {\n    font-family: inherit;\n    font-size: inherit;\n}","",{version:3,sources:["webpack://./lino_react/react/components/quillmodules.css"],names:[],mappings:"AAAA;IACI,oBAAoB;IACpB,kBAAkB;AACtB",sourcesContent:[".l-editor .ql-container {\n    font-family: inherit;\n    font-size: inherit;\n}"],sourceRoot:""}]);const s=o}}]);
//# sourceMappingURL=main.quillmodules_TextFieldElement.15138657b5cc8a7324ea.js.map