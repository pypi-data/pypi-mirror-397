# PhysioNet Sepsis Challenge 2019 - PSDL Scenario
# Based on Sepsis-3 clinical criteria
#
# This scenario implements early sepsis detection using:
# - SIRS criteria (HR, Temp, WBC, Resp)
# - SOFA score components (MAP, Lactate, Creatinine)
# - Trend analysis over 6-hour windows

scenario: physionet_sepsis_detection
version: "0.3.0"
name: PhysioNet Sepsis Early Detection
description: |
  Early sepsis detection scenario for PhysioNet Challenge 2019 data.
  Implements SIRS criteria plus organ dysfunction markers.
  Based on Sepsis-3 consensus definitions.
author: PSDL Team
tags:
  - sepsis
  - critical_care
  - physionet
  - challenge_2019

audit:
  intent: "Early sepsis detection using SIRS criteria and organ dysfunction markers"
  rationale: "Early sepsis identification reduces mortality through timely intervention"
  provenance: "Sepsis-3 Consensus Definitions (Singer et al. JAMA 2016), PhysioNet Challenge 2019"

signals:
  # Vital signs
  HR:
    ref: HeartRate
    type: numeric
    unit: bpm
    description: Heart rate

  Temp:
    ref: Temperature
    type: numeric
    unit: celsius
    description: Body temperature

  Resp:
    ref: RespiratoryRate
    type: numeric
    unit: breaths/min
    description: Respiratory rate

  SBP:
    ref: SystolicBP
    type: numeric
    unit: mmHg
    description: Systolic blood pressure

  MAP:
    ref: MeanArterialPressure
    type: numeric
    unit: mmHg
    description: Mean arterial pressure

  SpO2:
    ref: SpO2
    type: numeric
    unit: "%"
    description: Oxygen saturation

  # Lab values
  WBC:
    ref: WBC
    type: numeric
    unit: "10^9/L"
    description: White blood cell count

  Lactate:
    ref: Lactate
    type: numeric
    unit: mmol/L
    description: Serum lactate

  Creatinine:
    ref: Creatinine
    type: numeric
    unit: mg/dL
    description: Serum creatinine

# ── Trends (v0.3: NUMERIC VALUES ONLY) ─────
trends:
  # Current values
  hr_current:
    expr: last(HR)
    type: float
    unit: bpm
    description: "Current heart rate"

  temp_current:
    expr: last(Temp)
    type: float
    unit: celsius
    description: "Current body temperature"

  resp_current:
    expr: last(Resp)
    type: float
    unit: breaths/min
    description: "Current respiratory rate"

  wbc_current:
    expr: last(WBC)
    type: float
    unit: "10^9/L"
    description: "Current WBC count"

  lactate_current:
    expr: last(Lactate)
    type: float
    unit: mmol/L
    description: "Current lactate level"

  map_current:
    expr: last(MAP)
    type: float
    unit: mmHg
    description: "Current mean arterial pressure"

  sbp_current:
    expr: last(SBP)
    type: float
    unit: mmHg
    description: "Current systolic blood pressure"

  # Trending indicators (6-hour window)
  hr_delta_6h:
    expr: delta(HR, 6h)
    type: float
    unit: bpm
    description: "Heart rate change over 6 hours"

  lactate_delta_6h:
    expr: delta(Lactate, 6h)
    type: float
    unit: mmol/L
    description: "Lactate change over 6 hours"

  creatinine_delta_6h:
    expr: delta(Creatinine, 6h)
    type: float
    unit: mg/dL
    description: "Creatinine change over 6 hours"

  sbp_delta_6h:
    expr: delta(SBP, 6h)
    type: float
    unit: mmHg
    description: "SBP change over 6 hours"

# ── Logic (v0.3: ALL COMPARISONS HERE) ─────
logic:
  # SIRS criteria detection
  hr_elevated:
    when: hr_current > 90
    description: "Tachycardia (HR > 90)"

  temp_abnormal:
    when: temp_current > 38.3
    description: "Fever (Temp > 38.3C)"

  temp_low:
    when: temp_current < 36
    description: "Hypothermia (Temp < 36C)"

  resp_elevated:
    when: resp_current > 22
    description: "Tachypnea (RR > 22)"

  wbc_abnormal_high:
    when: wbc_current > 12
    description: "Leukocytosis (WBC > 12)"

  wbc_abnormal_low:
    when: wbc_current < 4
    description: "Leukopenia (WBC < 4)"

  # Sepsis markers
  lactate_elevated:
    when: lactate_current > 2.0
    description: "Elevated lactate (> 2 mmol/L)"

  map_low:
    when: map_current < 65
    description: "Hypotension (MAP < 65)"

  # Trending indicators
  hr_rising:
    when: hr_delta_6h > 20
    description: "Heart rate increasing trend"

  lactate_rising:
    when: lactate_delta_6h > 1.0
    description: "Lactate increasing trend"

  creatinine_rising:
    when: creatinine_delta_6h >= 0.3
    description: "Acute kidney injury (Cr delta >= 0.3)"

  sbp_falling:
    when: sbp_delta_6h < -20
    description: "Blood pressure falling trend"

  # SIRS criteria (2+ of 4)
  sirs_temp:
    when: temp_abnormal OR temp_low
    description: "Temperature criterion for SIRS"

  sirs_wbc:
    when: wbc_abnormal_high OR wbc_abnormal_low
    description: "WBC criterion for SIRS"

  sirs_positive:
    when: (hr_elevated AND resp_elevated) OR (hr_elevated AND sirs_temp) OR (hr_elevated AND sirs_wbc) OR (resp_elevated AND sirs_temp) OR (resp_elevated AND sirs_wbc) OR (sirs_temp AND sirs_wbc)
    severity: medium
    description: "SIRS criteria met (2+ positive)"

  # Organ dysfunction
  organ_dysfunction:
    when: map_low OR creatinine_rising
    severity: high
    description: "Evidence of organ dysfunction"

  # Sepsis alert
  sepsis_suspected:
    when: sirs_positive AND (lactate_elevated OR organ_dysfunction)
    severity: high
    description: "Suspected sepsis - SIRS + organ dysfunction or lactate elevation"
    recommendation: "Initiate sepsis bundle, obtain blood cultures, start empiric antibiotics"

  # Early warning (trending)
  early_warning:
    when: (hr_rising OR lactate_rising) AND sirs_positive
    severity: medium
    description: "Early warning - deteriorating trends with SIRS"
    recommendation: "Increase monitoring frequency, consider sepsis workup"

metadata:
  validation_status: draft
  references:
    - "Singer M, et al. JAMA 2016 - Sepsis-3 Definitions"
    - "PhysioNet Challenge 2019 - Early Prediction of Sepsis from Clinical Data"
