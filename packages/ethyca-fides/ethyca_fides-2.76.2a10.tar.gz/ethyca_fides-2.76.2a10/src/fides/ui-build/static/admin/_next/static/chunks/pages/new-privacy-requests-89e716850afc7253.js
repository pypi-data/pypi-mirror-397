(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9609,9676],{1883:function(e,t,a){var s=a(68267)(function(e,t,a){return e+(a?" ":"")+t.toLowerCase()});e.exports=s},89987:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new-privacy-requests",function(){return a(3367)}])},30952:function(e,t,a){"use strict";a.d(t,{f:function(){return o}});var s=a(24246),l=a(66726),i=a.n(l),n=a(27378),r=a(26917);let o=e=>{let{value:t,onChange:a,placeholder:l,...o}=e,[c,d]=(0,n.useState)(t);(0,n.useEffect)(()=>{d(t||"")},[t]);let u=i()(a,500),g=(0,n.useCallback)(e=>{d(e),u(e)},[]);return(0,s.jsx)(r.Z,{value:c,onChange:g,onClear:()=>{d(""),a("")},placeholder:l,...o})}},58754:function(e,t,a){"use strict";var s=a(24246),l=a(41013),i=a(70788);t.Z=e=>{let{heading:t,breadcrumbItems:a,isSticky:n=!0,children:r,rightContent:o,style:c,...d}=e;return(0,s.jsxs)("div",{...d,style:n?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...c}:{paddingBottom:"24px",...c},children:[(0,s.jsxs)(l.jqI,{justify:"space-between",children:["string"==typeof t?(0,s.jsx)(l.lQT,{className:a||r?"pb-4":void 0,level:1,"data-testid":"page-heading",children:t}):t,o&&(0,s.jsx)("div",{"data-testid":"page-header-right-content",children:o})]}),!!a&&(0,s.jsx)(i.m,{className:r?"pb-4":void 0,items:a,"data-testid":"page-breadcrumb"}),r]})}},45259:function(e,t,a){"use strict";var s=a(24246),l=a(41013);let i={approved:{color:l.tAb.SUCCESS,label:"Approved"},complete:{color:l.tAb.SUCCESS,label:"Completed"},awaiting_email_send:{color:l.tAb.MARBLE,label:"Awaiting Email Send"},denied:{color:l.tAb.WARNING,label:"Denied"},canceled:{color:l.tAb.MARBLE,label:"Canceled"},error:{color:l.tAb.ERROR,label:"Error"},in_processing:{color:l.tAb.CAUTION,label:"In Progress"},paused:{color:l.tAb.MARBLE,label:"Paused"},pending:{color:l.tAb.INFO,label:"New"},identity_unverified:{color:l.tAb.MARBLE,label:"Unverified"},requires_input:{color:l.tAb.MINOS,label:"Requires Input"},requires_manual_finalization:{color:l.tAb.MINOS,label:"Requires Finalization"},duplicate:{color:l.tAb.DEFAULT,label:"Duplicate"}};t.Z=e=>{let{status:t}=e;return(0,s.jsx)(l.j8w,{color:i[t].color,className:"justify-center","data-testid":"request-status-badge",children:i[t].label})}},70788:function(e,t,a){"use strict";a.d(t,{m:function(){return c}});var s=a(24246),l=a(41013),i=a(79894),n=a.n(i),r=a(27378);let{Text:o}=l.AntTypography,c=e=>{let{items:t,...a}=e,i=(0,r.useMemo)(()=>null==t?void 0:t.map((e,a)=>{let i=a===t.length-1,r={...e},c=r.onClick&&!r.href;return("string"==typeof r.title&&(r.title=(0,s.jsx)(o,{style:{color:"inherit",maxWidth:i?void 0:400},ellipsis:!i,id:i?"breadcrumb-current-page":void 0,children:r.title})),c)?r.title=(0,s.jsx)(l.wpx,{type:"text",size:"small",icon:r.icon,onClick:r.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:r.title}):(r.icon&&(r.title=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"anticon align-text-bottom",children:r.icon}),r.title]})),r.href&&r.title&&(r.title=(0,s.jsx)(n(),{href:r.href,className:"ant-breadcrumb-link",children:r.title}),delete r.href)),r}),[t]);return(0,s.jsx)(l.zrq,{items:i,...a})}},42478:function(e,t,a){"use strict";a.d(t,{FU:function(){return c},JE:function(){return l},Ki:function(){return u},SU:function(){return g},W:function(){return p},h9:function(){return i},jc:function(){return s},qt:function(){return o},sn:function(){return d}});let{useGetEmailInviteStatusQuery:s,useGetActiveMessagingProviderQuery:l,useCreateMessagingConfigurationMutation:i,useCreateMessagingConfigurationSecretsMutation:n,useGetMessagingConfigurationDetailsQuery:r,useGetMessagingConfigurationsQuery:o,useGetMessagingConfigurationByKeyQuery:c,useUpdateMessagingConfigurationByKeyMutation:d,useUpdateMessagingConfigurationSecretsByKeyMutation:u,useCreateTestConnectionMessageMutation:g,useDeleteMessagingConfigurationByKeyMutation:p}=a(78780).u.injectEndpoints({endpoints:e=>({getEmailInviteStatus:e.query({query:()=>({url:"/messaging/email-invite/status"}),providesTags:()=>["Email Invite Status"]}),createMessagingConfiguration:e.mutation({query:e=>({url:"messaging/config",method:"POST",body:e}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getActiveMessagingProvider:e.query({queryFn:async(e,t,a,s)=>{let l=await s({url:"messaging/default/active"});return l.error&&404===l.error.status?{data:null}:l},providesTags:["Messaging Config"]}),createMessagingConfigurationSecrets:e.mutation({query:e=>({url:"messaging/default/".concat(e.service_type,"/secret"),method:"PUT",body:e.details}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getMessagingConfigurationDetails:e.query({query:e=>({url:"messaging/default/".concat(e.type)}),providesTags:["Messaging Config"]}),getMessagingConfigurations:e.query({query:()=>({url:"messaging/config"}),providesTags:["Messaging Config"]}),getMessagingConfigurationByKey:e.query({query:e=>({url:"messaging/config/".concat(e.key)}),providesTags:["Messaging Config"]}),createTestConnectionMessage:e.mutation({query:e=>({url:"messaging/test/".concat(e.service_type),method:"POST",body:e.details}),invalidatesTags:["Messaging Config"]}),updateMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"PATCH",body:e.config}),invalidatesTags:["Messaging Config","Configuration Settings"]}),updateMessagingConfigurationSecretsByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key,"/secret"),method:"PUT",body:e.secrets}),invalidatesTags:["Messaging Config","Configuration Settings"]}),deleteMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"DELETE"}),invalidatesTags:["Messaging Config","Configuration Settings"]})})})},59676:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var s=a(24246),l=a(41013),i=a(16134),n=a(27378),r=a(812),o=a(17245),c=a(90867);let d=(0,l.Gpc)((e,t)=>{let{handleBlur:a,subjectRequest:d}=e,u=(0,i.T)(),[g,p]=(0,n.useState)(!1),{errorAlert:m,successAlert:h}=(0,o.VY)(),{errorRequests:f}=(0,i.C)(c.fe),[x]=(0,c.JD)(),[y]=(0,c.Fq)(),v=async()=>{p(!0);let e=await x(f);(0,r.D4)(e)?(u((0,c.uT)({checkAll:!1,errorRequests:[]})),m((0,r.e$)(e.error),"DSR batch automation has failed due to the following:",{duration:null})):(e.data.failed.length>0&&m((0,s.jsxs)(l.xuv,{children:["DSR automation has failed for"," ",(0,s.jsx)(l.xvT,{as:"span",fontWeight:"semibold",children:e.data.failed.length})," ","privacy request(s). Please review the event log for further details."]}),void 0,{containerStyle:{maxWidth:"max-content"},duration:null}),e.data.succeeded.length>0&&h("Privacy request(s) are now being reprocessed.")),p(!1)},j=async()=>{if(!d)return;p(!0);let e=await y(d);(0,r.D4)(e)?m((0,r.e$)(e.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):h("Privacy request is now being reprocessed."),p(!1),a&&a(t)};return(0,s.jsx)(l.wpx,{disabled:g,loading:g,onClick:d?j:v,ref:t,size:"small",icon:(0,s.jsx)(l.AyE,{}),children:"Reprocess"})});var u=a(34090),g=a(55484);let p=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,m=e=>p.test(e),h=(0,l.Gpc)((e,t)=>{let{isRequired:a=!1,...i}=e,{emails:r}=i.form.values,[o,c]=(0,n.useState)(""),d=e=>r.includes(e),u=e=>{e.map(e=>e.trim()).filter(e=>m(e)&&!d(e)).forEach(e=>i.push(e)),c("")};return(0,s.jsxs)(l.NIc,{alignItems:"baseline",display:"inline-flex",isInvalid:!!i.form.errors[i.name],isRequired:a,children:[(0,s.jsx)(l.lXp,{fontSize:"md",htmlFor:"email",children:"Email"}),(0,s.jsxs)(l.gCW,{align:"flex-start",w:"inherit",children:[(0,s.jsx)(l.IIB,{autoComplete:"off",placeholder:"Type or paste email addresses separated by commas and press `Enter` or `Tab`...",onChange:e=>{c(e.target.value)},onKeyDown:e=>{["Enter","Tab",","].includes(e.key)&&(e.preventDefault(),u([o]))},onPaste:e=>{e.preventDefault(),u(e.clipboardData.getData("text").split(","))},ref:t,size:"sm",type:"email",value:o}),(0,s.jsx)(l.J1D,{children:i.form.errors[i.name]}),r.length>0&&(0,s.jsx)(l.Eq9,{spacing:1,mb:3,pt:"8px",children:r.map((e,t)=>(0,s.jsxs)(l.Vp9,{borderRadius:"full",backgroundColor:"primary.400",color:"white",size:"sm",variant:"solid",children:[(0,s.jsx)(l.Sn0,{children:e}),(0,s.jsx)(l.SD9,{onClick:()=>{i.remove(t)}})]},e))})]})]})}),f=g.Ry().shape({emails:g.IX(g.Z_()).when(["notify"],{is:!0,then:()=>g.IX(g.Z_()).min(1,"Must enter at least one valid email").label("Email")}),notify:g.O7(),minErrorCount:g.Rx().required()});var x=()=>{let{isOpen:e,onOpen:t,onClose:a}=(0,l.qY0)(),[i,d]=(0,n.useState)({emails:[],notify:!1,minErrorCount:1}),g=(0,n.useRef)(null),{errorAlert:p,successAlert:m}=(0,o.VY)(),[x,y]=(0,n.useState)(!0),{data:v}=(0,c.tE)(void 0,{skip:x}),[j]=(0,c.SC)(),b=async(e,t)=>{t.setSubmitting(!0);let s=await j({email_addresses:e.emails,notify_after_failures:e.notify?e.minErrorCount:0});(0,r.D4)(s)?p((0,r.e$)(s.error),"Configure alerts and notifications has failed to save due to the following:"):m("Configure alerts and notifications saved successfully."),t.setSubmitting(!1),a()};return(0,n.useEffect)(()=>{e&&y(!1),v&&d({emails:v.email_addresses,notify:0!==v.notify_after_failures,minErrorCount:v.notify_after_failures})},[v,e]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.wpx,{onClick:t,title:"Configure alerts","aria-label":"Configure alerts",icon:(0,s.jsx)(l.Dkj,{})}),(0,s.jsx)(u.J9,{enableReinitialize:!0,initialValues:i,onSubmit:b,validationSchema:f,children:t=>(0,s.jsxs)(l.dys,{isOpen:e,placement:"right",initialFocusRef:g,onClose:()=>{t.resetForm(),a()},size:"lg",children:[(0,s.jsx)(l.P1B,{}),(0,s.jsxs)(l.scA,{color:"gray.900",children:[(0,s.jsx)(l.cCv,{}),(0,s.jsxs)(l.OXI,{color:"gray.900",children:[(0,s.jsx)(l.xvT,{fontSize:"2xl",fontWeight:"normal",mb:4,children:"Configure alerts and notifications"}),(0,s.jsx)(l.xuv,{mt:"26px",children:(0,s.jsx)(l.xvT,{fontSize:"md",fontWeight:"normal",children:"Setup your alerts to send you a notification when there are any processing failures. You can also setup a threshold for connector failures for Fides to notify you after X amount of failures have occurred."})})]}),(0,s.jsx)(l.Ng0,{mt:"20px",children:(0,s.jsxs)(u.l0,{id:"configure-alerts-form",noValidate:!0,children:[(0,s.jsx)(l.xvT,{fontSize:"md",children:"Contact details"}),(0,s.jsxs)(l.gCW,{align:"stretch",gap:"29px",mt:"14px",children:[(0,s.jsx)(l.Ugi,{children:(0,s.jsx)(u.F2,{name:"emails",render:e=>(0,s.jsx)(h,{...e,isRequired:t.values.notify,ref:g})})}),(0,s.jsx)(l.Ugi,{children:(0,s.jsx)(u.gN,{id:"notify",name:"notify",children:e=>{let{field:a}=e;return(0,s.jsxs)(l.NIc,{alignItems:"center",display:"flex",mt:"45px",children:[(0,s.jsx)(l.lXp,{fontSize:"md",mb:"0",children:"Notify me immediately if there are any DSR processing errors"}),(0,s.jsx)(l.rAg,{checked:t.values.notify,onChange:(e,s)=>{a.onChange(s),t.setFieldValue(a.name,e),t.setFieldValue("minErrorCount",1),e||setTimeout(()=>{t.setFieldTouched("emails",!1)},0)}})]})}})})]}),(0,s.jsx)(l.xvT,{color:"#757575",fontSize:"sm",mt:"11px",children:"If selected, then Fides will notify you by your chosen method of communication every time the system encounters a data subject request processing error. You can turn this off anytime and setup a more suitable notification method below if you wish."}),t.values.notify&&(0,s.jsx)(l.Ugi,{mt:"34px",children:(0,s.jsx)(u.gN,{id:"minErrorCount",name:"minErrorCount",children:e=>{let{field:a,meta:i}=e;return(0,s.jsxs)(l.NIc,{alignItems:"center",display:"flex",isInvalid:!!(i.error&&i.touched),isRequired:!0,children:[(0,s.jsx)(l.xvT,{children:"Notify me after"}),(0,s.jsxs)(l.Y2U,{allowMouseWheel:!0,color:"gray.700",defaultValue:t.values.minErrorCount||1,min:1,ml:"8px",mr:"8px",onChange:(e,a)=>{t.setFieldValue("minErrorCount",a)},size:"sm",w:"80px",children:[(0,s.jsx)(l.zuI,{...a}),(0,s.jsxs)(l.FiK,{children:[(0,s.jsx)(l.WQu,{}),(0,s.jsx)(l.Y_d,{})]})]}),(0,s.jsx)(l.xvT,{children:"DSR processing errors "})]})}})})]})}),(0,s.jsx)(l.zeN,{justifyContent:"flex-start",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l.wpx,{onClick:()=>{t.resetForm(),a()},children:"Cancel"}),(0,s.jsx)(l.wpx,{form:"configure-alerts-form",disabled:t.isSubmitting,loading:t.isSubmitting,htmlType:"submit",children:"Save"})]})})]})]})})]})},y=()=>{let{errorRequests:e}=(0,i.C)(c.fe);return(0,s.jsxs)(l.kCb,{gap:4,children:[(null==e?void 0:e.length)>0&&(0,s.jsx)(d,{}),(0,s.jsx)(x,{})]})}},3367:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eh}});var s,l,i,n,r=a(24246),o=a(41013),c=a(27378),d=a(25980),u=a(35287),g=a(58754),p=a(19904),m=a(28686),h=a(59676);let f=e=>{let{selectedIds:t,menuItems:a}=e,s=t.length>0;return(0,r.jsx)(o.S0p,{menu:{items:a},disabled:!s,children:(0,r.jsxs)(o.wpx,{"data-testid":"bulk-actions-btn",disabled:!s,children:["Actions",(0,r.jsx)(o.PJP._ME,{})]})})},x=e=>{let{currentPageKeys:t}=null!=e?e:{},[a,s]=(0,c.useState)([]),l=(0,c.useCallback)(()=>{s([])},[]),i=(0,c.useMemo)(()=>t&&0!==t.length?t.every(e=>a.includes(e))?"checked":a.length>0&&t.some(e=>a.includes(e))?"indeterminate":"unchecked":"unchecked",[t,a]),n=(0,c.useCallback)(e=>{if(t){if(e)s([...new Set([...a,...t])]);else{let e=new Set(t);s(a.filter(t=>!e.has(t)))}}},[a,t]);return{selectedIds:a,setSelectedIds:s,clearSelectedIds:l,checkboxSelectState:i,handleSelectAll:n}},{Text:y}=o.AntTypography,v=e=>{let{selectedIds:t,totalResults:a}=e,s=t.length>0;return(0,r.jsxs)(o.jqI,{gap:8,align:"center",children:[s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y,{strong:!0,"data-testid":"selected-count",children:[t.length," selected"]}),void 0!==a&&(0,r.jsx)(y,{type:"secondary",children:" / "})]}),void 0!==a&&(0,r.jsxs)(y,{type:"secondary","data-testid":"total-results",children:[a," results"]})]})};var j=a(90867),b=a(9270),_=a(79894),C=a.n(_),E=a(86677),q=a(16394),S=a(60240);let T=e=>{var t;let{className:a,currentStatusFilter:s}=e,l=(0,E.useRouter)(),{data:i}=(0,j.R2)({status:[S.q2.DUPLICATE],page:1,size:1}),n=null!==(t=null==i?void 0:i.total)&&void 0!==t?t:0;return(null==s?void 0:s.length)===1&&s[0]===S.q2.DUPLICATE||0===n?null:(0,r.jsx)(C(),{href:{pathname:l.pathname,query:{status:S.q2.DUPLICATE}},passHref:!0,legacyBehavior:!0,children:(0,r.jsxs)(o.wpx,{type:"text","data-testid":"duplicate-requests-button",className:a,children:[n," duplicate"," ",(0,q._6)(n,"request","requests")]})})};(s=i||(i={})).APPROVE="approve",s.DENY="deny",s.DELETE="delete";let A={[S.q2.PENDING]:["approve","deny","delete"],[S.q2.DUPLICATE]:["approve","deny","delete"],[S.q2.IDENTITY_UNVERIFIED]:["delete"],[S.q2.REQUIRES_INPUT]:["delete"],[S.q2.APPROVED]:["delete"],[S.q2.DENIED]:["delete"],[S.q2.IN_PROCESSING]:["delete"],[S.q2.COMPLETE]:["delete"],[S.q2.PAUSED]:["delete"],[S.q2.AWAITING_EMAIL_SEND]:["delete"],[S.q2.REQUIRES_MANUAL_FINALIZATION]:["delete"],[S.q2.CANCELED]:["delete"],[S.q2.ERROR]:["delete"]},w=e=>A[e.status],P=(e,t)=>t.some(t=>w(t).includes(e)),I=e=>{let{form:t}=e;return(0,r.jsx)(o.PPS,{form:t,layout:"vertical",children:(0,r.jsx)(o.PPS.Item,{name:"denialReason",rules:[{required:!0,message:"Please enter a reason for denial"}],children:(0,r.jsx)(o.uFc.TextArea,{placeholder:"Enter reason for denial...",rows:4})})})},D=()=>{let{openFormModal:e}=(0,o.U8S)();return{openDenyPrivacyRequestModal:(0,c.useCallback)(async t=>{let a=await e({title:"Privacy request denial",content:e=>(0,r.jsxs)(o.jqI,{vertical:!0,gap:2,children:[t&&(0,r.jsx)(o.FUI,{children:t}),(0,r.jsx)(o.FUI,{children:"Please enter a reason for denying this privacy request. Please note: this can be seen by the user in their notification email."}),(0,r.jsx)(I,{form:e})]}),okText:"Confirm",cancelText:"Cancel",width:500,centered:!0});return a?null==a?void 0:a.denialReason:null},[e])}},N={[i.APPROVE]:"approved",[i.DENY]:"denied",[i.DELETE]:"deleted"},k={[i.APPROVE]:{title:"Approve privacy requests",verb:"approve"},[i.DENY]:{title:"Privacy request denial",verb:"deny"},[i.DELETE]:{title:"Delete privacy requests",verb:"delete",okType:"danger"}},R=(e,t,a)=>{let s=N[e];return a>0&&t>0?{type:"warning",message:"Successfully ".concat(s," ").concat(t," ").concat((0,q._6)(t,"request","requests"),". ").concat(a," ").concat((0,q._6)(a,"request","requests")," failed.")}:a>0?{type:"error",message:"Failed to ".concat(e," ").concat(a," ").concat((0,q._6)(a,"request","requests"),".")}:{type:"success",message:"Successfully ".concat(s," ").concat(t," privacy ").concat((0,q._6)(t,"request","requests"))}},M=e=>{let{requests:t,selectedIds:a}=e,s=(0,c.useMemo)(()=>t.filter(e=>a.includes(e.id)),[t,a]),l=(0,o.UD8)(),n=(0,o.S37)(),[d]=(0,j.AG)(),[u]=(0,j.ZZ)(),[g]=(0,j.AL)(),{openDenyPrivacyRequestModal:p}=D(),m=(0,c.useCallback)(async e=>{let t;let a=s.length,r=s.filter(t=>w(t).includes(e)),o=r.length;t=o===a?"You are about to ".concat(k[e].verb," ").concat(a," privacy ").concat((0,q._6)(a,"request","requests"),". Are you sure you want to continue?"):"You have selected ".concat(a," ").concat((0,q._6)(a,"request","requests"),", but only ").concat(o," ").concat((0,q._6)(o,"request","requests")," can perform this action. If you continue, the bulk action will only be applied to ").concat(o," ").concat((0,q._6)(o,"request","requests"),".");let c=r.map(e=>e.id);if(e===i.DENY){let a=await p(t);if(!a)return;let s=c.length,i=l.loading("Executing bulk action on ".concat(s," privacy ").concat((0,q._6)(s,"request","requests"),"..."),0),n=await u({request_ids:c,reason:a});if(i(),"error"in n)l.error("Failed to deny requests. Please try again.",5);else if("data"in n){var m,h;let{type:t,message:a}=R(e,(null===(m=n.data.succeeded)||void 0===m?void 0:m.length)||0,(null===(h=n.data.failed)||void 0===h?void 0:h.length)||0);l[t](a,5)}}else n.confirm({title:k[e].title,content:t,okText:"Continue",cancelText:"Cancel",okType:k[e].okType,onOk:async()=>{let t;if(0===c.length)return;let a=c.length,s=l.loading("Executing bulk action on ".concat(a," privacy ").concat((0,q._6)(a,"request","requests"),"..."),0);if(e===i.APPROVE?t=await d({request_ids:c}):e===i.DELETE&&(t=await g({request_ids:c})),s(),t){if("error"in t){let t=e===i.APPROVE?"approve":"delete";l.error("Failed to ".concat(t," requests. Please try again."),5)}else if("data"in t){var n,r;let{type:a,message:s}=R(e,(null===(n=t.data.succeeded)||void 0===n?void 0:n.length)||0,(null===(r=t.data.failed)||void 0===r?void 0:r.length)||0);l[a](s,5)}}}})},[s,p,u,d,g,l,n]);return{bulkActionMenuItems:(0,c.useMemo)(()=>{let e=P(i.APPROVE,s),t=P(i.DENY,s),a=P(i.DELETE,s);return[{key:i.APPROVE,label:"Approve",icon:(0,r.jsx)(o.PJP.MCw,{}),onClick:()=>m(i.APPROVE),disabled:!e},{key:i.DENY,label:"Deny",icon:(0,r.jsx)(o.PJP.x8P,{}),onClick:()=>m(i.DENY),disabled:!t},{type:"divider"},{key:i.DELETE,label:"Delete",icon:(0,r.jsx)(o.PJP.ZNm,{}),danger:!0,onClick:()=>m(i.DELETE),disabled:!a}]},[s,m])}};var O=a(40431),F=a(71784),L=a(90449),U=e=>{let{pagination:t}=e,a=[...F.MP.keys()],[s,l]=(0,O.XI)({search:O.Oi.withOptions({throttleMs:300}),from:O.Oi,to:O.Oi,status:(0,O.S$)((0,O.jx)(a)),action_type:(0,O.S$)((0,O.jx)(Object.values(S.Us))),location:O.Oi,custom_privacy_request_fields:L.Pp},{history:"push"}),[i,n]=(0,O.XI)({sort_field:O.Oi,sort_direction:(0,O.jx)(Object.values(S.AV))},{history:"push"}),r=(0,c.useMemo)(()=>({fuzzy_search_str:s.search,from:s.from,to:s.to,status:s.status,action_type:s.action_type,location:s.location,custom_privacy_request_fields:(0,L.$u)(s.custom_privacy_request_fields),sort_field:i.sort_field,sort_direction:i.sort_direction}),[s.search,s.from,s.to,s.status,s.action_type,s.location,s.custom_privacy_request_fields,i.sort_field,i.sort_direction]),{resetPagination:o}=t;return(0,c.useEffect)(()=>{o()},[r,o]),{filters:s,setFilters:l,sortState:i,setSortState:n,filterQueryParams:r}},Y=a(19785),V=a.n(Y),z=a(65567),Z=a.n(z),W=a(98855),K=a(27693),B=a.n(K);let J=[S.q2.COMPLETE,S.q2.CANCELED,S.q2.DENIED,S.q2.IDENTITY_UNVERIFIED],X=e=>{let{status:t,daysLeft:a,timeframe:s=45}=e;if(null!=a&&null!=s&&!J.includes(t)){let e=100*a/s<25?o.tAb.ERROR:o.tAb.DEFAULT;return(0,r.jsx)("div",{children:(0,r.jsx)(o.j8w,{color:e,bordered:!1,children:(0,r.jsx)(o.esZ,{title:(0,q.p6)(B()().add(a,"day").toDate()),children:(0,r.jsxs)(r.Fragment,{children:[a," days left"]})})})})}return null};var G=a(77830),Q=a(45259);let $=e=>{var t;let{privacyRequest:a,primaryIdentity:s}=e,l=(0,E.useRouter)();return(0,r.jsxs)(o.jqI,{gap:12,wrap:!0,align:"center",children:[(0,r.jsx)("div",{className:"flex min-w-[100px] gap-2",children:(0,r.jsx)(o.AntTypography.Title,{level:3,children:(0,r.jsx)(o.AntTypography.Link,{href:"/privacy-requests/".concat(a.id),variant:"primary",onClick:e=>{e.preventDefault(),l.push({pathname:G.ld,query:{id:a.id}})},children:null!==(t=null==s?void 0:s.value)&&void 0!==t?t:"Unknown identity"})})}),(0,r.jsx)(Q.Z,{status:a.status}),a.policy.rules&&(0,r.jsx)(o.jqI,{gap:4,children:a.policy.rules.map(e=>(0,r.jsx)(o.j8w,{children:F.rE.get(e.action_type)},e.action_type))}),(0,r.jsx)(o.KS1,{contentToCopy:a.id,children:(0,r.jsx)(o.AntTypography.Text,{type:"secondary",children:a.id})})]})};var H=a(1883),ee=a.n(H);let et=e=>{var t;let{label:a,children:s,copyValue:l}=e,i=(0,r.jsx)(o.lKn,{ellipsis:{tooltip:!0},className:"!max-w-60",children:s});return(0,r.jsxs)(o.jqI,{gap:"small",wrap:!0,children:[(0,r.jsxs)(o.lKn,{type:"secondary",children:[a,":"]}),l?(0,r.jsx)(o.KS1,{contentToCopy:l,copyText:"Copy ".concat(ee()(null!==(t=null==a?void 0:a.toString())&&void 0!==t?t:"")),children:i}):i]})};var ea=a(51980);let es=e=>{let{createdAt:t}=e;return t?(0,r.jsx)(et,{label:"Received",children:(0,r.jsx)(o.lKn,{type:"secondary",children:(0,r.jsx)(o.esZ,{title:(0,q.p6)(new Date(t)),children:(0,q.G8)((0,ea.B)(new Date(t),new Date,{addSuffix:!0}))})})}):null},el=e=>{let{item:t,checkbox:a}=e,s=(0,L.o8)(t.identity),l=(0,L.Ub)(t.identity,s),i=(0,L.aP)(t.custom_privacy_request_fields),n=l.length>0||i.length>0||!!t.location,c=t.location?(()=>{try{return(0,o.QCN)(t.location)}catch(e){return}})():void 0;return(0,r.jsxs)(o.krs.Item,{children:[(0,r.jsx)("div",{className:"pr-4",children:a}),(0,r.jsxs)(o.jqI,{vertical:!0,gap:"small",className:"grow pr-8",children:[(0,r.jsx)($,{privacyRequest:t,primaryIdentity:s}),(0,r.jsxs)(o.jqI,{vertical:!0,gap:"small",wrap:!0,children:[(0,r.jsxs)(o.jqI,{gap:"small",wrap:!0,children:[(0,r.jsx)(et,{label:"Policy",children:t.policy.name}),(0,r.jsx)(et,{label:"Source",children:t.source})]}),n&&(0,r.jsxs)(o.jqI,{wrap:!0,className:"gap-x-3 gap-y-2",children:[t.location&&(0,r.jsx)(et,{label:"Location",children:c?(0,o.c1K)({isoEntry:c,showFlag:!0}):t.location},"location"),l.map(e=>(0,r.jsx)(et,{label:e.label,copyValue:e.value,children:e.value},e.key)),i.map(e=>{let t=V()(e.value)?e.value.join(" - "):Z()(e.value);return(0,r.jsx)(et,{label:e.label,copyValue:t,children:t},e.key)})]})]})]}),(0,r.jsxs)("div",{className:"flex shrink-0 flex-col items-end gap-2 pr-2 2xl:flex-row 2xl:gap-4",children:[(0,r.jsx)(X,{daysLeft:t.days_left,status:t.status,timeframe:t.policy.execution_timeframe}),(0,r.jsx)(es,{createdAt:t.created_at})]}),(0,r.jsx)(o.jqI,{className:"min-w-[90px]",align:"center",justify:"end",gap:"small",children:(0,r.jsx)(W.q,{subjectRequest:t},"other-actions")})]})};var ei=a(30952);(l=n||(n={})).CREATED_AT_ASC="created_at-asc",l.DAYS_LEFT_ASC="days_left-asc",l.CREATED_AT_DESC="created_at-desc",l.DAYS_LEFT_DESC="days_left-desc";let en=[{label:"Time received (newest)",value:"created_at-desc"},{label:"Time received (oldest)",value:"created_at-asc"},{label:"Days left (shortest)",value:"days_left-asc"},{label:"Days left (longest)",value:"days_left-desc"}],er={"created_at-asc":{sort_field:"created_at",sort_direction:S.AV.ASC},"created_at-desc":{sort_field:"created_at",sort_direction:S.AV.DESC},"days_left-asc":{sort_field:"due_date",sort_direction:S.AV.ASC},"days_left-desc":{sort_field:"due_date",sort_direction:S.AV.DESC}};var eo=e=>{let{sortState:t,setSortState:a}=e,s=Object.values(n).find(e=>{let a=er[e];return a.sort_field===t.sort_field&&a.sort_direction===t.sort_direction}),{sort_direction:l}=t;return(0,r.jsx)(o.WPr,{"aria-label":"Sort requests",options:en,value:s,onChange:e=>a(er[e]),placeholder:"Sort by...",className:"w-64",prefix:l===S.AV.ASC?(0,r.jsx)(o.PJP.cgs,{}):(0,r.jsx)(o.PJP.Vh7,{})})};let ec=e=>{let{fieldName:t,fieldDefinition:a,value:s,onChange:l}=e,{label:i,field_type:n,options:c}=a;if("location"===n||"multiselect"===n)return null;if("select"===n){var d;let e=null!==(d=null==c?void 0:c.map(e=>({label:e,value:e})))&&void 0!==d?d:[];return(0,r.jsx)(o.WPr,{placeholder:i,options:e,value:s||void 0,onChange:e=>{l(e||null)},allowClear:!0,"data-testid":"custom-field-filter-".concat(t),"aria-label":i,className:"w-44"})}return(0,r.jsx)(o.uFc,{placeholder:i,value:s||"",onChange:e=>l(e.target.value||null),allowClear:!0,"data-testid":"custom-field-filter-".concat(t),"aria-label":i,className:"w-44"})},ed=e=>{let{filters:t,setFilters:a,sortState:s,setSortState:l}=e,{data:i}=(0,j.xv)(),n=(0,c.useMemo)(()=>(0,L.V1)(null==i?void 0:i.actions),[null==i?void 0:i.actions]),d=(e,s)=>{let l=Object.fromEntries(Object.entries({...t.custom_privacy_request_fields||{},[e]:s}).filter(e=>{let[,t]=e;return null!==t}));a({custom_privacy_request_fields:Object.keys(l).length>0?l:null})},u=e=>(0,r.jsxs)("span",{children:["+ ",e.length]});return(0,r.jsxs)(o.jqI,{gap:"small",align:"center",justify:"flex-start",wrap:!0,children:[(0,r.jsx)(ei.f,{placeholder:"Request ID or identity value",value:t.search||"",onChange:e=>a({search:e||null}),variant:"compact","data-testid":"privacy-request-search"}),(0,r.jsx)(o.cv2.RangePicker,{format:"YYYY-MM-DD",value:t.from&&t.to?[B()(t.from),B()(t.to)]:null,onChange:e=>{let[t,s]=e||[null,null];a({from:null==t?void 0:t.format("YYYY-MM-DD"),to:null==s?void 0:s.format("YYYY-MM-DD")})},placeholder:["From","To"],allowClear:!0,"data-testid":"date-range-filter","aria-label":"Date range",className:"w-60"}),(0,r.jsx)(o.WPr,{mode:"multiple",placeholder:"Status",options:F.I3,value:t.status||[],onChange:e=>{a({status:e.length>0?e:null})},allowClear:!0,maxTagCount:"responsive","data-testid":"request-status-filter","aria-label":"Status",className:"w-44",maxTagPlaceholder:u}),(0,r.jsx)(o.WPr,{mode:"multiple",placeholder:"Request type",options:F.kN,value:t.action_type||[],onChange:e=>{a({action_type:e.length>0?e:null})},allowClear:!0,maxTagCount:"responsive","data-testid":"request-action-type-filter","aria-label":"Request type",className:"w-44",maxTagPlaceholder:u}),(0,r.jsx)(o.AOh,{placeholder:"Location",value:t.location||null,onChange:e=>{a({location:null!=e?e:null})},allowClear:!0,"data-testid":"request-location-filter","aria-label":"Location",className:"w-44",popupMatchSelectWidth:300,includeCountryOnlyOptions:!0}),Object.entries(n).map(e=>{var a,s;let[l,i]=e;return(0,r.jsx)(ec,{fieldName:l,fieldDefinition:i,value:null!==(s=null===(a=t.custom_privacy_request_fields)||void 0===a?void 0:a[l])&&void 0!==s?s:null,onChange:e=>d(l,e)},l)}),(0,r.jsx)(eo,{sortState:s,setSortState:l})]})},eu=()=>{let e=(0,b.S)(),{filterQueryParams:t,filters:a,setFilters:s,sortState:l,setSortState:i}=U({pagination:e}),n=(0,o.UD8)(),{data:d,isLoading:u,isFetching:g,refetch:p}=(0,j.R2)({...t,page:e.pageIndex,size:e.pageSize}),{items:m,total:h}=(0,c.useMemo)(()=>{let e=d||{items:[],total:0,pages:0},t=e.items.map(e=>({...e,key:e.id}));return{...e,items:t}},[d]),{selectedIds:y,setSelectedIds:_,clearSelectedIds:C,checkboxSelectState:E,handleSelectAll:q}=x({currentPageKeys:m.map(e=>e.id)});(0,c.useEffect)(()=>{C()},[m,C]);let[S]=(0,j.YO)(),A=async()=>{let e;try{await S(t)}catch(t){e=t instanceof Error?t.message:"Unknown error occurred"}e&&n.error(e,5e3)},{bulkActionMenuItems:w}=M({requests:m,selectedIds:y});return(0,r.jsxs)("div",{children:[(0,r.jsx)(o.jqI,{gap:"small",align:"center",className:"mb-4",children:(0,r.jsx)(ed,{filters:a,setFilters:s,sortState:l,setSortState:i})}),(0,r.jsxs)(o.jqI,{gap:"small",align:"center",justify:"space-between",className:"mb-2",children:[(0,r.jsxs)(o.jqI,{align:"center",gap:"small",children:[(0,r.jsx)(o.E_O,{id:"select-all",checked:"checked"===E,indeterminate:"indeterminate"===E,onChange:e=>q(e.target.checked)}),(0,r.jsx)("label",{htmlFor:"select-all",className:"cursor-pointer",children:"Select all"}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)(v,{selectedIds:y,totalResults:null!=h?h:0})})]}),(0,r.jsxs)(o.jqI,{align:"center",gap:"small",children:[(0,r.jsx)(T,{className:"ml-3",currentStatusFilter:a.status}),(0,r.jsx)(f,{selectedIds:y,menuItems:w}),(0,r.jsx)(o.wpx,{"aria-label":"Reload","data-testid":"reload-btn",icon:(0,r.jsx)(o.PJP.CQM,{}),onClick:()=>p()}),(0,r.jsx)(o.wpx,{"aria-label":"Export report","data-testid":"export-btn",icon:(0,r.jsx)(o.PJP.UWx,{}),onClick:A})]})]}),u?(0,r.jsx)("div",{className:"p-2",children:(0,r.jsx)(o.krs,{dataSource:Array(25).fill({}),renderItem:()=>(0,r.jsx)(o.krs.Item,{children:(0,r.jsx)(o.N_L,{})})})}):(0,r.jsxs)(o.jqI,{vertical:!0,gap:"middle",children:[(0,r.jsx)(o.ZJQ,{spinning:g,children:(0,r.jsx)(o.krs,{dataSource:m,rowSelection:{selectedRowKeys:y,onChange:_},renderItem:(e,t,a)=>(0,r.jsx)(el,{item:e,checkbox:a})})}),(0,r.jsx)(o.B7X,{...e.paginationProps,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items"),total:null!=h?h:0,align:"start"})]})]})};var eg=a(88152),ep=a(72281),em=a(86291),eh=()=>{let{processing:e}=(0,eg.Y)(),{plus:t}=(0,d.hz)(),{activeTab:a,handleTabChange:s,availableTabs:l}=(0,ep.d)();(0,c.useEffect)(()=>{e()},[e]);let i=(0,c.useMemo)(()=>{let e=[];return l.request&&e.push({key:ep.G.REQUEST,label:"Request",children:(0,r.jsx)(eu,{})}),l.manualTask&&e.push({key:ep.G.MANUAL_TASK,label:"Manual tasks",children:(0,r.jsx)(m.m,{})}),e},[l.manualTask,l.request]);return(0,r.jsxs)(u.Z,{title:"Privacy Requests",mainProps:{minWidth:"784px",overflowY:"scroll"},fullHeight:!0,children:[(0,r.jsx)(g.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests"}],rightContent:(0,r.jsxs)(o.vyj,{children:[t&&(0,r.jsx)(p.ZP,{scopes:[S.Sh.PRIVACY_REQUEST_CREATE],children:(0,r.jsx)(em.Z,{})}),(0,r.jsx)(h.default,{})]}),"data-testid":"privacy-requests"}),(0,r.jsx)(o.A5g,{activeKey:a,onChange:s,items:i})]})}}},function(e){e.O(0,[431,3024,7245,3655,7654,2888,9774,179],function(){return e(e.s=89987)}),_N_E=e.O()}]);