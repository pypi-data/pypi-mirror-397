(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1617],{54543:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/systems/configure/[id]/test-datasets",function(){return s(14083)}])},18225:function(e,t,s){"use strict";var i=s(24246),n=s(41013);t.Z=e=>{let{alignment:t="center",...s}=e;return(0,i.jsx)(n.kCb,{boxSize:"full",align:"center",justify:t,children:(0,i.jsx)(n.$jN,{color:"primary",...s})})}},77213:function(e,t,s){"use strict";s.d(t,{Z:function(){return h}});var i=s(24246),n=s(41013),r=s(88038),a=s.n(r),l=s(86677);s(27378);var o=s(25980),d=s(90867),c=s(42478),u=s(77830),f=()=>{let e=(0,l.useRouter)();return(0,i.jsx)(n.xuv,{bg:"gray.50",border:"1px solid",borderColor:"blue.400",borderRadius:"md",justifyContent:"space-between",p:5,mb:5,mt:5,children:(0,i.jsxs)(n.xuv,{children:[(0,i.jsxs)(n.Kqy,{direction:{base:"column",sm:"row"},justifyContent:"space-between",children:[(0,i.jsx)(n.xvT,{fontWeight:"semibold",children:"Configure your storage and messaging provider"}),(0,i.jsx)(n.wpx,{onClick:()=>{e.push(u.AD)},children:"Configure"})]}),(0,i.jsxs)(n.xvT,{children:["Before Fides can process your privacy requests we need two simple steps to configure your storage and email client."," "]})]})})},h=e=>{let{children:t,title:s,padded:r=!0,mainProps:u}=e,h=(0,o.hz)(),m=(0,l.useRouter)(),y="/privacy-requests"===m.pathname||"/datastore-connection"===m.pathname,p=!(h.flags.messagingConfiguration&&y),{data:v}=(0,c.JE)(void 0,{skip:p}),{data:x}=(0,d.PW)(void 0,{skip:p}),g=h.flags.messagingConfiguration&&(!v||!x)&&y;return(0,i.jsxs)(n.kCb,{"data-testid":s,direction:"column",h:"100vh",children:[(0,i.jsxs)(a(),{children:[(0,i.jsxs)("title",{children:["Fides Admin UI - ",s]}),(0,i.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsxs)(n.kCb,{as:"main",direction:"column",py:r?6:0,px:r?10:0,h:r?"calc(100% - 48px)":"full",flex:1,minWidth:0,overflow:"auto",...u,children:[g?(0,i.jsx)(f,{}):null,t]})]})}},41207:function(e,t,s){"use strict";s.d(t,{F:function(){return a},M:function(){return r}});var i=s(76649),n=s(65218);let r=s.n(n)()(()=>s.e(7088).then(s.bind(s,57088)).then(e=>e.default),{loadableGenerated:{webpack:()=>[57088]},ssr:!1}),a=e=>(0,i.Ln)({name:"string"},e)&&"YAMLException"===e.name},86398:function(e,t,s){"use strict";s.d(t,{j:function(){return i}});let{useGetPoliciesQuery:i}=s(78780).u.injectEndpoints({endpoints:e=>({getPolicies:e.query({query:()=>({url:"/dsr/policy"}),providesTags:()=>["Policies"]})})})},14083:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return P}});var i=s(24246),n=s(41013),r=s(86677),a=s(18225),l=s(77213),o=s(77830),d=s(58754),c=s(1315),u=s(66527),f=s(27378),h=s(16134),m=s(88340),y=s(812),p=s(46628),v=s(41207),x=s(41966),g=s(94725),j=s(88124);let b=e=>Array.isArray(e)?e.map(e=>b(e)).filter(e=>null!==e):e&&"object"==typeof e?Object.fromEntries(Object.entries(e).map(e=>{let[t,s]=e;return[t,b(s)]}).filter(e=>{let[,t]=e;return null!==t})):e,_=e=>{if(Array.isArray(e)){let t=e[0];if(!t)return"";let s=t.msg||"",i=t.loc?" (".concat(t.loc,")"):"";return"".concat(s).concat(i)}return e};var k=e=>{let{connectionKey:t}=e,s=(0,n.pmc)(),r=(0,h.T)(),[a]=(0,x.TG)(),[l,o]=(0,f.useState)(""),d=(0,h.C)(j.fD),c=(0,h.C)(j.lR),{data:k,isLoading:w,refetch:T}=(0,g.Eg)(t,{skip:!t}),{data:C,refetch:S}=(0,g.tW)({connectionKey:t,datasetKey:(null==d?void 0:d.fides_key)||"",policyKey:c},{skip:!t||!(null==d?void 0:d.fides_key)||!c});(0,f.useEffect)(()=>{C&&r((0,j.x0)(C.reachable))},[C,r]);let E=(0,f.useMemo)(()=>((null==k?void 0:k.items)||[]).map(e=>({value:e.fides_key,label:e.fides_key})),[null==k?void 0:k.items]);(0,f.useEffect)(()=>{if((null==k?void 0:k.items.length)&&(!d||!k.items.find(e=>e.fides_key===d.fides_key))){let e=k.items[0];r((0,j.w7)(e))}},[k,d,r]),(0,f.useEffect)(()=>{(null==d?void 0:d.ctl_dataset)&&o(u.ZP.dump(b(null==d?void 0:d.ctl_dataset)))},[d]),(0,f.useEffect)(()=>{c&&(null==d?void 0:d.fides_key)&&t&&S()},[c,null==d?void 0:d.fides_key,t,S]),(0,f.useEffect)(()=>{C&&r((0,j.x0)(C.reachable))},[C,r]);let R=async e=>{let t=null==k?void 0:k.items.find(t=>t.fides_key===e);t&&r((0,j.w7)(t))},q=async()=>{let e;if(!d)return;try{e=u.ZP.load(l)}catch(e){s((0,p.Vo)("YAML Parsing Error: ".concat(e instanceof u._L?"".concat(e.reason," ").concat(e.mark?"at line ".concat(e.mark.line):""):"Invalid YAML format")));return}let t=await a(e);if((0,y.D4)(t)){s((0,p.Vo)((0,y.e$)(t.error)));return}r((0,j.w7)({fides_key:d.fides_key,ctl_dataset:t.data})),s((0,p.t5)("Successfully modified dataset")),await T(),await S()},N=async()=>{try{let{data:e}=await T(),t=null==e?void 0:e.items.find(e=>e.fides_key===(null==d?void 0:d.fides_key));(null==t?void 0:t.ctl_dataset)&&o(u.ZP.dump(b(t.ctl_dataset))),s((0,p.t5)("Successfully refreshed datasets"))}catch(e){s((0,p.Vo)((0,y.e$)(e)))}};return(0,i.jsxs)(n.gCW,{alignItems:"stretch",flex:"1",maxWidth:"70vw",maxHeight:"100vh",children:[(0,i.jsxs)(n.X6q,{as:"h3",size:"sm",display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsxs)(n.Ugi,{children:[(0,i.jsx)(n.xvT,{children:"Edit dataset: "}),(0,i.jsx)(n.WPr,{id:"format","aria-label":"Select a dataset","data-testid":"export-format-select",value:(null==d?void 0:d.fides_key)||"",options:E,onChange:R,className:"w-64"}),(0,i.jsx)(m.Z,{copyText:l})]}),(0,i.jsxs)(n.Ugi,{spacing:2,children:[(0,i.jsx)(n.esZ,{title:"Refresh to load the latest data from the database. This will overwrite any unsaved local changes.",placement:"top",children:(0,i.jsx)(n.wpx,{htmlType:"submit",size:"small","data-testid":"refresh-btn",onClick:N,loading:w,children:"Refresh"})}),(0,i.jsx)(n.esZ,{title:"Save your changes to update the dataset in the database.",placement:"top",children:(0,i.jsx)(n.wpx,{htmlType:"submit",size:"small",onClick:q,children:"Save"})})]})]}),(0,i.jsx)(n.Kqy,{border:"1px solid",borderColor:"gray.200",borderRadius:"md",justifyContent:"space-between",py:4,pr:4,"data-testid":"empty-state",flex:"1 1 auto",minHeight:"200px",children:(0,i.jsx)(v.M,{defaultLanguage:"yaml",value:l,height:"100%",onChange:e=>o(e||""),onMount:()=>{},options:{fontFamily:"Menlo",fontSize:13,minimap:{enabled:!1},readOnly:!1,hideCursorInOverviewRuler:!0,overviewRulerBorder:!1,scrollBeyondLastLine:!1},theme:"light"})}),C&&(0,i.jsx)(n.Kqy,{backgroundColor:(null==C?void 0:C.reachable)?"green.50":"red.50",border:"1px solid",borderColor:(null==C?void 0:C.reachable)?"green.500":"red.500",borderRadius:"md",p:2,flexShrink:0,mt:2,children:(0,i.jsx)(n.Ugi,{alignItems:"center",children:(0,i.jsxs)(n.Ugi,{flex:"1",children:[(null==C?void 0:C.reachable)?(0,i.jsx)(n.StI,{}):(0,i.jsx)(n.f9v,{}),(0,i.jsx)(n.xvT,{fontSize:"sm",whiteSpace:"pre-wrap",children:(null==C?void 0:C.reachable)?"Dataset is reachable":"Dataset is not reachable. ".concat(_(null==C?void 0:C.details))})]})})})]})},w=s(54458),T=s(16125),C=s(99716);let S=e=>{let t=new Date(e);return(0,w.WU)(t,"yyyy-MM-dd HH:mm:ss.SSS")},E=e=>{switch(e){case"ERROR":return"red.500";case"WARNING":return"orange.500";case"INFO":return"blue.500";default:return"gray.500"}},R=(0,f.memo)(e=>{let{log:t}=e;return(0,i.jsxs)(n.xuv,{as:"pre",margin:0,fontSize:"xs",fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word",children:[(0,i.jsx)(n.xvT,{as:"span",color:"green.500",children:S(t.timestamp)}),(0,i.jsx)(n.xvT,{as:"span",children:" | "}),(0,i.jsx)(n.xvT,{as:"span",color:E(t.level),children:t.level.padEnd(8)}),(0,i.jsx)(n.xvT,{as:"span",children:" | "}),(0,i.jsx)(n.xvT,{as:"span",color:"cyan.500",children:t.module_info}),(0,i.jsx)(n.xvT,{as:"span",children:" - "}),(0,i.jsx)(n.xvT,{as:"span",color:"ERROR"===t.level||"WARNING"===t.level?E(t.level):"gray.800",children:t.message})]})});R.displayName="LogLine";var q=(0,f.memo)(()=>{let e=(0,h.T)(),t=(0,f.useRef)(null),s=(0,T.v9)(j.HN),r=(0,T.v9)(j.pz),{data:a}=(0,C.fV)({privacy_request_id:s},{skip:!s,pollingInterval:1e3});(0,f.useEffect)(()=>{a&&e((0,j.Hy)(a))},[a,e]);let l=(0,f.useCallback)(()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)},[]);(0,f.useEffect)(()=>{l()},[r,l]);let o=(0,f.useMemo)(()=>(null==r?void 0:r.map(e=>"".concat(S(e.timestamp)," | ").concat(e.level," | ").concat(e.module_info," - ").concat(e.message)).join("\n"))||"",[r]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.X6q,{as:"h3",size:"sm",display:"flex",alignItems:"center",justifyContent:"space-between",children:(0,i.jsxs)(n.Ugi,{children:[(0,i.jsx)(n.xvT,{children:"Test logs"}),(0,i.jsx)(m.Z,{copyText:o})]})}),(0,i.jsx)(n.xuv,{ref:t,height:"200px",overflowY:"auto",borderWidth:1,borderColor:"gray.200",borderRadius:"md",p:2,children:null==r?void 0:r.map(e=>(0,i.jsx)(R,{log:e},"".concat(e.timestamp,"-").concat(e.module_info,"-").concat(e.message)))})]})}),N=s(46238),I=s(86398),O=s(60240),z=s(31883),D=e=>{let{connectionKey:t}=e,s=(0,n.pmc)(),r=(0,h.T)(),[a]=(0,g.s7)(),l=(0,T.v9)(j.fD),o=(0,T.v9)(j.YS),d=(0,T.v9)(j.Af),c=(0,T.v9)(j.zn),u=(0,T.v9)(j.lR),v=(0,T.v9)(j.M_),x=(0,T.v9)(j.HN),[b,_]=(0,f.useState)("{}");(0,f.useEffect)(()=>{l&&_(JSON.stringify(c,null,2))},[l,c]);let{data:k,error:w}=(0,C.Z2)({privacy_request_id:x},{skip:!x||!(null==l?void 0:l.fides_key),pollingInterval:2e3}),{refetch:S}=(0,C.fV)({privacy_request_id:x},{skip:!x}),{refetch:E}=(0,g.I1)({connectionKey:t,datasetKey:(null==l?void 0:l.fides_key)||""},{skip:!t||!(null==l?void 0:l.fides_key),refetchOnMountOrArgChange:!0}),{data:R}=(0,I.j)(),q=(0,f.useMemo)(()=>((null==R?void 0:R.items)||[]).filter(e=>{var t;return null===(t=e.rules)||void 0===t?void 0:t.some(e=>"access"===e.action_type)}).map(e=>({value:e.key,label:e.name})),[null==R?void 0:R.items]);(0,f.useEffect)(()=>{let e=null==l?void 0:l.fides_key;t&&e&&E().then(t=>{t.data&&(null==l?void 0:l.fides_key)===e&&r((0,j.qD)({datasetKey:e,values:t.data}))})},[l,t,r,E]),(0,f.useEffect)(()=>{let e=null==l?void 0:l.fides_key;if(w&&"status"in w&&404===w.status){r((0,j.hT)()),s((0,p.Vo)("Test run failed"));return}if(!k||k.privacy_request_id!==x||!e)return;let t={datasetKey:e,values:JSON.stringify(k,null,2)};k.status===O.q2.COMPLETE?v&&S().then(()=>{r((0,j.EO)(t)),r((0,j.hT)()),s((0,p.t5)("Test run completed successfully"))}):k.status===O.q2.ERROR&&S().then(()=>{r((0,j.EO)(t)),r((0,j.hT)()),s((0,p.Vo)("Test run failed"))})},[k,w,x,l,v,r,s,S]);let D=(0,f.useMemo)(()=>u&&(null==R?void 0:R.items)?u:null,[u,null==R?void 0:R.items]),M=async()=>{if((null==l?void 0:l.fides_key)&&u)try{let e;try{e=JSON.parse(b)}catch(e){s((0,p.Vo)("Invalid JSON in test input"));return}r((0,j.Vh)(l.fides_key)),s((0,p.t5)("Test run started"));let i=await a({connection_key:t,dataset_key:l.fides_key,identities:e,policy_key:u});(0,z.D4)(i)?(s((0,p.Vo)((0,y.e$)(i.error))),r((0,j.hT)())):"data"in i?r((0,j.eY)(i.data.privacy_request_id)):(r((0,j.hT)()),s((0,p.Vo)("No privacy request ID in response")))}catch(e){r((0,j.hT)()),s((0,p.Vo)("Failed to start test run"))}};return(0,i.jsxs)(n.gCW,{alignItems:"stretch",flex:"1",maxWidth:"70vw",minHeight:"0",children:[(0,i.jsxs)(n.X6q,{as:"h3",size:"sm",display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsxs)(n.Ugi,{children:[(0,i.jsx)(n.xvT,{children:"Test inputs"}),(0,i.jsx)(m.Z,{copyText:b})]}),(0,i.jsxs)(n.Ugi,{children:[(0,i.jsx)(n.WPr,{id:"policy","aria-label":"Policy selector","data-testid":"policy-select",placeholder:"Select policy",value:D,options:q,onChange:e=>{r((0,j.kF)(e))},className:"w-64"}),(0,i.jsx)(n.wpx,{htmlType:"submit",size:"small",type:"primary","data-testid":"run-btn",onClick:v?()=>{r((0,j.qU)()),s((0,p.t5)("Test manually stopped by user"))}:M,disabled:!u||!o,children:v?"Stop":"Run"}),(0,i.jsx)(N.b,{label:v?"Stop the currently running test":"Run a test access request using the provided test input data and the selected access policy"})]})]}),(0,i.jsx)(n.gxH,{size:"sm",focusBorderColor:"primary.600",color:"gray.800",isDisabled:v,height:"100%",value:b,onChange:e=>{let t=e.target.value;_(t);try{let e=JSON.parse(t);l&&r((0,j.qD)({datasetKey:l.fides_key,values:e}))}catch(e){}}}),(0,i.jsxs)(n.X6q,{as:"h3",size:"sm",children:["Test results ",(0,i.jsx)(m.Z,{copyText:d})]}),(0,i.jsx)(n.gxH,{isReadOnly:!0,size:"sm",focusBorderColor:"primary.600",color:"gray.800",isDisabled:!1,height:"100%",value:d})]})};let M=e=>e.id?Array.isArray(e.id)?e.id[0]:e.id:"";var P=()=>{var e;let t=M((0,r.useRouter)().query),{data:s,isLoading:u}=(0,c.rn)(t,{skip:!t}),f=(null==s?void 0:null===(e=s.connection_configs)||void 0===e?void 0:e.key)||"";return u?(0,i.jsx)(l.Z,{title:"Systems",children:(0,i.jsx)(a.Z,{})}):(0,i.jsxs)(l.Z,{title:"System inventory",mainProps:{height:"100vh",display:"flex",flexDirection:"column"},children:[(0,i.jsx)(d.Z,{heading:"System inventory",breadcrumbItems:[{title:"System inventory",href:o.So},{title:(null==s?void 0:s.name)||"",href:"/systems/configure/".concat(t,"#integrations")},{title:"Test datasets"}]}),(0,i.jsxs)(n.gCW,{alignItems:"stretch",flex:"1",minHeight:"0",spacing:"4",padding:"0",children:[(0,i.jsxs)(n.Ugi,{alignItems:"stretch",flex:"1",minHeight:"0",spacing:"4",maxHeight:"60vh",children:[(0,i.jsx)(k,{connectionKey:f}),(0,i.jsx)(D,{connectionKey:f})]}),(0,i.jsx)(n.xuv,{flex:"0 0 auto",children:(0,i.jsx)(q,{})})]})]})}},31883:function(e,t,s){"use strict";s.d(t,{Bw:function(){return i.Bw},D4:function(){return i.D4}});var i=s(19043)}},function(e){e.O(0,[6527,1840,2888,9774,179],function(){return e(e.s=54543)}),_N_E=e.O()}]);