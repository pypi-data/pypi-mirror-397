"""Pydantic models for API requests and responses."""

from typing import List, Dict, Any, Optional
from pydantic import BaseModel, Field


# Session-based flow models
class StartSessionResponse(BaseModel):
    """Response model for starting a diagnostic session."""
    session_id: str = Field(..., description="Unique session ID")
    question: Dict[str, Any] = Field(..., description="First question to answer")
    progress: int = Field(..., description="Current progress (0-based, e.g., 0 means first question)")
    total_questions: int = Field(..., description="Total number of questions")


class AnswerRequest(BaseModel):
    """Request model for submitting an answer."""
    session_id: str = Field(..., description="Session ID from start endpoint")
    question_id: int = Field(..., ge=0, description="Question ID being answered")
    answer: str = Field(..., min_length=1, description="User's answer to the question")


class AnswerResponse(BaseModel):
    """Response model after submitting an answer."""
    next_question: Optional[Dict[str, Any]] = Field(None, description="Next question to answer (null if complete)")
    progress: int = Field(..., description="Current progress (number of questions answered)")
    total_questions: int = Field(..., description="Total number of questions")
    is_complete: bool = Field(..., description="Whether all questions have been answered")


class FinishRequest(BaseModel):
    """Request model for finishing a diagnostic session."""
    session_id: str = Field(..., description="Session ID to finish")


class DiagnosticResult(BaseModel):
    """Model for diagnostic test result."""
    score: int = Field(..., ge=0, le=200, description="Diagnostic score (0-200)")
    level: str = Field(..., description="Readiness level: 'Ready to Start', 'Think More', or 'Hold On'")
    analysis: str = Field(..., description="Detailed analysis of the responses")
    advice: List[str] = Field(..., description="Personalized advice based on answers")
    next_steps: List[str] = Field(..., description="Recommended next steps")
    strengths: List[str] = Field(default_factory=list, description="Identified strengths")
    concerns: List[str] = Field(default_factory=list, description="Identified concerns")
    is_ai_generated: bool = Field(default=True, description="Whether this result was generated by AI")


class DiagnosticResultResponse(BaseModel):
    """Response model for diagnostic result."""
    result: DiagnosticResult
    test_id: str = Field(..., description="Unique test ID for this diagnostic session")

