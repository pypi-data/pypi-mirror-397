version: '3.4'
services:
    devcontainer:
        build:
            context: ..
            dockerfile: .devcontainer/Dockerfile
            args:
                USER: ${USER}
        cap_add:
            - SYS_PTRACE
        security_opt:
            - seccomp:unconfined
        user: ${USER}
        tty: true
        environment:
            WORKSPACE_FOLDER: /workspace
        working_dir: /workspace
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - ..:/workspace:cached
            - cache:/home/${USER}/.cache
            - ${HOME}/.netrc:/home/${USER}/.netrc:ro
            - ${HOME}/.ssh/:/home/${USER}/.ssh:ro
            - .vscode-server/extensions/:/root/.vscode-server/extensions/
            - .vscode-server/extensionsCache/:/root/.vscode-server/extensionsCache/
            - /dev/:/dev/
volumes:
    cache:
        name: cache-${USER}
