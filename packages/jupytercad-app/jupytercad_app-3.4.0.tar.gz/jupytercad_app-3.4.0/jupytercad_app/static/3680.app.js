"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[3680],{23680(e,t,s){s.r(t),s.d(t,{IJupyterYWidgetManager:()=>_,JupyterYDoc:()=>n,JupyterYModel:()=>d,default:()=>F,notebookRenderer:()=>f,yWidgetManager:()=>D});var i=s(68211),r=s(30427),o=s(58919);class d{constructor(e){this._isDisposed=!1,this._ready=new i.PromiseDelegate,this._disposed=new r.Signal(this),this._yModelName=e.ymodel_name,this.initialize(e).then(()=>{this._ready.resolve()})}get yModelName(){return this._yModelName}get sharedModel(){return this._sharedModel}get ydoc(){return this._ydoc}set sharedModel(e){this._sharedModel=e}set ydoc(e){this._ydoc=e}get sharedAttrsChanged(){return this.sharedModel.attrsChanged}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get ready(){return this._ready.promise}async initialize(e){this.ydoc=this.ydocFactory(e),this.sharedModel=new n(e,this._ydoc)}ydocFactory(e){return new o.Doc}dispose(){this._isDisposed||(this._isDisposed=!0,this._sharedModel.dispose(),this._disposed.emit(),r.Signal.clearData(this))}addAttr(e,t){this.sharedModel.setAttr(e,t)}removeAttr(e){this.sharedModel.removeAttr(e)}}class n{constructor(e,t){this._attrsObserver=e=>{this._attrsChanged.emit(e.keys)},this._attrsChanged=new r.Signal(this),this._isDisposed=!1,this._disposed=new r.Signal(this),this._commMetadata=e,this._ydoc=t,e.create_ydoc&&(this._attrs=this._ydoc.getMap("_attrs"),this._attrs.observe(this._attrsObserver))}get commMetadata(){return this._commMetadata}get ydoc(){return this._ydoc}get attrs(){return this._attrs?i.JSONExt.deepCopy(this._attrs.toJSON()):null}get attrsChanged(){return this._attrsChanged}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}dispose(){var e;this._isDisposed||(null===(e=this._attrs)||void 0===e||e.unobserve(this._attrsObserver),this._disposed.emit(),r.Signal.clearData(this),this._isDisposed=!0)}getAttr(e){var t;return null===(t=this._attrs)||void 0===t?void 0:t.get(e)}setAttr(e,t){var s;null===(s=this._attrs)||void 0===s||s.set(e,t)}removeAttr(e){var t;(null===(t=this._attrs)||void 0===t?void 0:t.has(e))&&this._attrs.delete(e)}}var a=s(5514),c=s(63068),h=s(40488);class l{constructor(e){this._isDisposed=!1,this._widgetManager=e.widgetManager,this._kernelId=e.kernelId}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0)}getYModel(e){if(this._kernelId)return this._widgetManager.getWidgetModel(this._kernelId,e)}createYWidget(e,t){if(this._kernelId){const s=this._widgetManager.getWidgetModel(this._kernelId,e);if(s){const e=this._widgetManager.getWidgetFactory(s.yModelName);if(e)return new e(s,t)}}}}const _=new i.Token("yjs-widgets:IJupyterYWidgetManager","A manager of Yjs-based Jupyter widgets.");var g=s(80281);class y extends g.Widget{constructor(e){super(),this._modelFactory=e.modelFactory,this._mimeType=e.mimeType,this.addClass("mimerenderer-jupyterywidget")}dispose(){var e,t,s;this.isDisposed||(null===(t=null===(e=this._ywidget)||void 0===e?void 0:e.dispose)||void 0===t||t.call(e),null===(s=this._yModel)||void 0===s||s.dispose(),super.dispose())}async renderModel(e){const t=e.data[this._mimeType].model_id;this._yModel=this._modelFactory.getYModel(t),this._yModel&&(await this._yModel.ready,this._ywidget=this._modelFactory.createYWidget(t,this.node))}}var u,p,m=s(19326),M=s(96214),v=s(79870);!function(e){e[e.SYNC=0]="SYNC",e[e.AWARENESS=1]="AWARENESS"}(u||(u={}));class w{constructor(e){this._onMsg=e=>{if(e.buffers){const t=e.buffers[0],s=new Uint8Array(ArrayBuffer.isView(t)?t.buffer:t),i=p.readMessage(this,s,!0);M.Bw(i)>1&&this._sendOverComm(M.Fo(i))}},this._updateHandler=(e,t)=>{const s=M.xv();M.zd(s,u.SYNC),v.f7(s,e),this._sendOverComm(M.Fo(s))},this._isDisposed=!1,this._comm=e.comm,this._ydoc=e.ydoc,this._ydoc.on("update",this._updateHandler),this._connect()}get doc(){return this._ydoc}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e)}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._comm.close(),this._isDisposed=!0)}_connect(){this._sync(),this._comm.onMsg=this._onMsg}_sync(){const e=M.xv();M.zd(e,u.SYNC),v.ue(e,this._ydoc),this._sendOverComm(M.Fo(e))}_sendOverComm(e){this._comm.send({},void 0,[e.buffer])}}!function(e){function t(e,t,s,i){M.zd(e,u.SYNC);const r=v.VU(t,e,s.doc,s);i&&r===v.Zg&&!s.synced&&(v.nh(e,s.doc),s.synced=!0)}e.syncMessageHandler=t,e.readMessage=function(e,s,i){const r=m.$C(s),o=M.xv();return m.cw(r)===u.SYNC?t(o,r,e,i):console.error("Unable to compute message"),o}}(p||(p={}));class C{constructor(){this._registry=new Map,this._yModelFactories=new Map,this._yWidgetFactories=new Map}registerKernel(e){const t=this._yModelFactories,s=new k({kernel:e,yModelFactories:t});this._registry.set(e.id,s)}unregisterKernel(e){e&&this._registry.delete(e)}registerWidget(e,t,s){this._yModelFactories.set(e,t),this._yWidgetFactories.set(e,s)}getWidgetModel(e,t){var s;return null===(s=this._registry.get(e))||void 0===s?void 0:s.getModel(t)}getWidgetFactory(e){return this._yWidgetFactories.get(e)}}class k{constructor(e){this._handle_comm_open=async(e,t)=>{const s=new(this._yModelFactories.get(t.metadata.ymodel_name))(t.metadata);await s.ready,new w({comm:e,ydoc:s.sharedModel.ydoc}),this._yModels.set(e.commId,s)},this._yModels=new Map;const{kernel:t,yModelFactories:s}=e;this._yModelFactories=s,t.registerCommTarget("ywidget",this._handle_comm_open)}getModel(e){return this._yModels.get(e)}}const f={id:"jupyterywidget:notebookRenderer",autoStart:!0,requires:[h.IRenderMimeRegistry,c.INotebookTracker,_],activate:(e,t,s,i)=>{const r={safe:!0,mimeTypes:["application/vnd.jupyter.ywidget-view+json"],createRenderer:e=>{var t,r,o;const d=null===(o=null===(r=null===(t=s.currentWidget)||void 0===t?void 0:t.sessionContext.session)||void 0===r?void 0:r.kernel)||void 0===o?void 0:o.id,n=e.mimeType,a=new l({kernelId:d,widgetManager:i});return new y({mimeType:n,modelFactory:a})}};t.addFactory(r,-100)}},D={id:"yjs-widgets:yWidgetManagerPlugin",autoStart:!0,requires:[],optional:[c.INotebookTracker,a.IConsoleTracker],provides:_,activate:(e,t,s)=>{const i=new C,r=(e,t)=>{const{newValue:s,oldValue:r}=t;s&&(i.unregisterKernel(null==r?void 0:r.id),i.registerKernel(s),s.disposed.connect(()=>{i.unregisterKernel(s.id)}))};return[t,s].forEach(e=>{e&&e.widgetAdded.connect(async(e,t)=>{t.sessionContext.kernelChanged.connect(r),t.disposed.connect(()=>{t.sessionContext.kernelChanged.disconnect(r)})})}),i}},F=[f,D]},79870(e,t,s){s.d(t,{VU:()=>_,Zg:()=>d,f7:()=>h,nh:()=>a,ue:()=>n});var i=s(96214),r=s(19326),o=s(58919);const d=1,n=(e,t)=>{i.zd(e,0);const s=o.encodeStateVector(t);i.Gu(e,s)},a=(e,t,s)=>{i.zd(e,d),i.Gu(e,o.encodeStateAsUpdate(t,s))},c=(e,t,s,i)=>{try{o.applyUpdate(t,r.bo(e),s)}catch(e){null!=i&&i(e),console.error("Caught error while handling a Yjs update",e)}},h=(e,t)=>{i.zd(e,2),i.Gu(e,t)},l=c,_=(e,t,s,i,o)=>{const n=r.cw(e);switch(n){case 0:((e,t,s)=>{a(t,s,r.bo(e))})(e,t,s);break;case d:c(e,s,i,o);break;case 2:l(e,s,i,o);break;default:throw new Error("Unknown message type")}return n}}}]);