[build-system]
requires = ["hatchling>=1.24.0"]
build-backend = "hatchling.build"

[project]
name = "kytchen-rlm"
version = "1.0.0"
description = "Kytchen RLM - Recursive Language Models with BYOLLM pantry storage + sandboxed prep + sauce (audit trail)"
readme = "README.md"
license = { file = "LICENSE" }
requires-python = ">=3.10"
authors = [
  { name = "Shannon Labs" }
]

dependencies = [
  "httpx>=0.27.0",
]

[project.optional-dependencies]
# Optional token counting
openai_tokens = ["tiktoken>=0.7.0"]
# Optional YAML config
yaml = ["PyYAML>=6.0"]
# Optional nicer logging
rich = ["rich>=13.0.0"]
# Optional MCP server
mcp = ["mcp>=1.0.0"]
# Optional CLI with full features
cli = [
    "typer[all]>=0.12.0",
    "python-dotenv>=1.0.0",
    "keyring>=25.0.0",
    "questionary>=2.0.0",
    "rich>=13.0.0",
]
# Optional exporters for sauce packs (PDF/MD)
exporters = [
    "markdown>=3.5.0",     # MD to HTML conversion
]
# PDF export (choice of backend)
pdf = [
    "weasyprint>=60.0",    # Full-featured PDF (requires system deps)
]
pdf-simple = [
    "fpdf2>=2.7.0",        # Simple PDF (pure Python, no deps)
]
# Optional Kytchen Cloud API (FastAPI)
api = [
    "fastapi>=0.110.0",
    "uvicorn>=0.27.0",
    "sqlalchemy[asyncio]>=2.0.0",
    "asyncpg>=0.29.0",
    "python-multipart>=0.0.9",  # For file uploads
    "minio>=7.2.0",
    "stripe>=7.0.0",  # Billing
    "sentry-sdk[fastapi]>=2.0.0",  # Error tracking
]

# Optional file format converters
converters = [
    "pypdf>=4.0",
    "python-docx>=1.0",
    "openpyxl>=3.1",
]

# Optional OCR support
ocr = [
    "pytesseract>=0.3",
    "pillow>=10.0",
]

# Optional E2B sandbox (production-grade isolation)
e2b = [
    "e2b-code-interpreter>=0.0.11",
]

# Development dependencies
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "mypy>=1.8.0",
]

[project.urls]
Homepage = "https://kytchen.dev"
Repository = "https://github.com/shannon-labs/kytchen"

[project.scripts]
# New CLI (Typer-based)
kytchen-cli = "kytchen.cli.main:cli_main"       # Main CLI entry point

# MCP entry points
kytchen-mcp-cloud = "kytchen.mcp.cloud_client:main"       # Thin client (Kytchen Cloud)
kytchen-local = "kytchen.mcp.local_server:main" # Thick client (offline/dev)
kytchen-mcp-local = "kytchen.mcp.local_server:main"
kytchen-mcp = "kytchen.mcp.server:main"

# Legacy installer (deprecated, kept for backward compatibility)
kytchen-rlm = "kytchen.cli:main"

# OpenAPI export (requires [api] extras)
kytchen-openapi = "kytchen.scripts.export_openapi:main"

[tool.hatch.build.targets.wheel]
packages = ["kytchen"]

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
asyncio_default_fixture_loop_scope = "function"

[tool.mypy]
python_version = "3.10"
warn_return_any = true
warn_unused_ignores = true
ignore_missing_imports = true
