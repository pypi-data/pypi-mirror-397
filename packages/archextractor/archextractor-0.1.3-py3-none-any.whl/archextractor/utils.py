from rich import print
import re

# “系统/工具自动生成”的常见垃圾文件规则
IGNORE_FILE_REGEXES = [
    # MacOS 系统与 Finder 元数据
    r"(^|/)__MACOSX(/|$)",  # macOS 资源目录，存储 macOS 的资源分叉/扩展属性（在 Finder 创建或复制到非 HFS+/APFS 卷时生成，常见），可整目录忽略
    r"(^|/)\.DS_Store$",  # Finder 缩略图/目录视图缓存文件
    r"(^|/)\._[^/]+$",  # AppleDouble 侧车文件（资源分叉/扩展属性），如 ._filename.png
    r"(^|/)Icon[\r]?$",  # 自定义图标文件（文件名包含回车字符：Icon\r，很少见）
    r"(^|/)\.Spotlight-V100(/|$)",  # Spotlight 索引目录
    r"(^|/)\.Trashes(/|$)",  # 回收站目录
    r"(^|/)\.fseventsd(/|$)",  # 文件系统事件日志
    r"(^|/)\.TemporaryItems(/|$)",  # 临时项目
    r"(^|/)\.DocumentRevisions-V100(/|$)",  # 文稿版本数据库
    r"(^|/)\.VolumeIcon\.icns$",  # 卷图标文件
    r"(^|/)\.AppleDouble(/|$)",  # 旧式 Apple 元数据（很少见）
    r"(^|/)\.AppleDesktop(/|$)",  # 旧式 Apple 桌面元数据（很少见）
    r"(^|/)\.AppleDB(/|$)",  # 旧式 Apple 数据库（很少见）
    r"(^|/).+\.icloud$",  # iCloud 占位符（未完全下载的文件）
    # tar/pax 派生条目（不是实际内容，仅元数据占位）
    r"(^|/)PaxHeader/[^/]+$",  # POSIX PAX 扩展头（为长文件名、时间戳精度、ACL、xattr 等附加元数据）伪路径（常见）
    r"(^|/)pax_global_header$",  # POSIX PAX 全局头条目
    r"(^|/)gnu_longlink$",  # GNU tar 长链接占位符（为长文件名服务）
    # Windows 系统元数据
    r"(^|/)Thumbs\.db$",  # 缩略图缓存
    r"(^|/)EHthumbs\.db$",  # 增强缩略图缓存
    r"(^|/)desktop\.ini$",  # 目录视图配置
    r"(^|/)\$RECYCLE\.BIN(/|$)",  # 回收站目录
    r"(^|/)System Volume Information(/|$)",  # 卷系统信息目录
    r"(^|/)~\$.*\.(docx|xlsx|pptx)$",  # Office 临时锁文件（以 ~$ 开头）
    # Linux/Unix 常见垃圾/元数据
    r"(^|/)\.Trash(-\d+)?(/|$)",  # GNOME/KDE 垃圾桶（可带 UID）
    r"(^|/)\.nfs[^/]*$",  # NFS 删除残留占位文件
    r"(^|/)\.directory$",  # KDE 目录元数据
    r"(^|/)~lock\..*#$",  # LibreOffice 锁文件
    r"(^|/)\.fuse_hidden[^/]*$",  # FUSE 挂载残留隐藏文件
    # 编辑器/工具临时文件（按需启用）
    r"(^|/)\..*\.swp$",  # Vim 交换文件
    r"(^|/)\..*\.swo$",  # Vim 交换文件
    r"(^|/).*~$",  # 常见编辑器备份（以 ~ 结尾）
    r"(^|/)#.*#$",  # Emacs 自动保存（#name#）
]
IGNORE_FILE_PATTERN = [re.compile(p) for p in IGNORE_FILE_REGEXES]


def is_auto_generated(path: str) -> bool:
    """
    Check if the file is auto generated by the system or tool

    Args:
        path (str): The path to check

    Returns:
        bool: True if the file is auto generated by the system or tool, False otherwise
    """
    # 将路径统一为 / 分隔，便于跨平台匹配
    norm = path.replace("\\", "/")
    return any(r.search(norm) for r in IGNORE_FILE_PATTERN)


if __name__ == "__main__":
    # 快速验证（前三个应为 True，最后一个为 False）
    samples = [
        "._a13.Brian Sum",
        "a13.Brian Sum/._Brian Sum.7z",
        "a13.Brian Sum/PaxHeader/Brian Sum.7z",
        "a13.Brian Sum/Brian Sum.7z",
    ]
    print({s: is_auto_generated(s) for s in samples})
