[tox]
envlist =
    style
    test

[testenv:py3-int]
# index-url is passed by default, trusted-host is not
# optionally allow trusted-host to be passed
passenv = *
# must supply this as uppercase as otherwise tests fail if proxy is set
setenv =
    NO_PROXY=localhost

deps =
    -rrequirements.txt
    -rrequirements_tests.txt
    pytest
    pytest-cov

commands =
    pytest --cov=azul_metastore --cov-report=xml:.tox/py3-int/coverage.xml --junitxml=.tox/py3-int/test-results.xml tests/


[testenv:style]
# linting checks don't need the package or dependencies installed as they scan the source tree
skip_install = true

# index-url is passed by default, trusted-host is not
# optionally allow trusted-host to be passed
passenv = PIP_TRUSTED_HOST

# must supply this as uppercase as otherwise tests fail if proxy is set
setenv =
    NO_PROXY=localhost

deps =
    toml
    isort[pyproject]
    bandit
    black
    flake8
    flake8-bugbear
    flake8-docstrings

commands =
    isort -c .
    black . --check
    flake8 .
    bandit -r azul_bedrock

[testenv:test]
# index-url is passed by default, trusted-host is not
# optionally allow trusted-host to be passed
passenv = 
    PIP_TRUSTED_HOST
    FILE_MANAGER_VIRUSTOTAL_API_KEY
    FILE_MANAGER_AZURE_STORAGE_ACCESS_KEY
    FILE_MANAGER_AZURE_STORAGE_ACCOUNT_ADDRESS
    FILE_MANAGER_FILE_CACHE_DIR

# must supply this as uppercase as otherwise tests fail if proxy is set
setenv =
    NO_PROXY=localhost

deps =
    toml
    pytest
    pytest-cov
    -rrequirements_tests.txt

commands =
    pytest --cov=azul_bedrock --cov-report=xml:.tox/.work_env/coverage.xml --junitxml=.tox/.work_env/test-results.xml tests/unit/

[flake8]
ignore = B008,C901,D104,D107,E800,W503,E203,B042
exclude = .*,__pycache__,build,dist,tests,test
max-complexity = 10
max-line-length = 119
docstring-convention=google
