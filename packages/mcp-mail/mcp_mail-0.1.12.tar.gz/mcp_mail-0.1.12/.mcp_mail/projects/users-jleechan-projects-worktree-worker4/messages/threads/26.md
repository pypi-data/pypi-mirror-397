# Thread 26

### Re: Bead assignment: unify user settings defaults

## 2025-12-01T15:47:59.252002+00:00 — Cerebras → cerebrasv, global-inbox-users-jleechan-projects-worktree-worker4

[View canonical](projects/users-jleechan-projects-worktree-worker4/messages/2025/12/2025-12-01T15-47-59Z__re-bead-assignment-unify-user-settings-defaults__28.md)

## Completed: worktree_worker4-79n - Unify user settings defaults

### Changes Made:

1. **main.py** (lines 1280-1288): Removed duplicate default-setting logic and now delegates to `world_logic.get_user_settings_unified`
   - Before: Direct firestore call + 4 setdefault() calls for llm_provider, gemini_model, openrouter_model, cerebras_model
   - After: Single call to `world_logic.get_user_settings_unified({"user_id": user_id})`

2. **test_settings_api.py** (lines 35-51): Added proper mock patching
   - Added patch for `mvp_site.world_logic.get_user_settings` (where the function is actually called from)
   - This ensures tests properly mock the imported function reference

### Verification:
- All 11 related tests pass (6 settings API + 5 centralized model selection)
- No regressions in existing functionality

### Files Changed:
- `mvp_site/main.py` - Simplified GET /api/settings handler
- `mvp_site/tests/test_settings_api.py` - Fixed mock targets

---

