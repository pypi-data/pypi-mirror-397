{
  "type": "function",
  "function": {
    "name": "query_database",
    "description": "Execute SQL queries against a PostgreSQL database to retrieve, filter, and analyze data. This powerful function provides direct access to your database, allowing you to run SELECT statements to extract information, apply complex WHERE clauses for filtering, join multiple tables together, aggregate data with GROUP BY, sort results, and limit the number of rows returned. Perfect for business intelligence, data analysis, reporting, and any scenario where you need to access structured data from your database. The function supports all standard SQL syntax including subqueries, window functions, CTEs (Common Table Expressions), and advanced filtering. Results are returned as JSON objects with column names as keys and values appropriately typed (strings, numbers, booleans, dates, etc.). You can query any table or view in the database that your user account has permission to access.",
    "parameters": {
      "type": "object",
      "properties": {
        "sql": {
          "type": "string",
          "description": "The SQL SELECT query to execute against the database. Must be a valid PostgreSQL SELECT statement. You can include WHERE clauses for filtering (e.g., 'WHERE status = active AND created_at > 2024-01-01'), JOIN clauses to combine data from multiple tables (INNER JOIN, LEFT JOIN, RIGHT JOIN, FULL OUTER JOIN), ORDER BY to sort results, GROUP BY with aggregate functions (COUNT, SUM, AVG, MIN, MAX), LIMIT and OFFSET for pagination, subqueries for complex logic, and CTEs for better query organization. The query should be properly formatted and syntactically correct. Always use single quotes for string literals and follow PostgreSQL naming conventions. Be careful with NULL handling and data type conversions."
        },
        "database": {
          "type": "string",
          "description": "The name of the database to query. This should match exactly the database name configured in your PostgreSQL server. Common database names in our system include 'production', 'staging', 'analytics', 'warehouse', 'crm', 'ecommerce', etc. Make sure you have the appropriate permissions to access this database. If not specified, defaults to the user's default database."
        },
        "timeout": {
          "type": "integer",
          "description": "Maximum time in seconds to wait for the query to complete before timing out. Useful for preventing long-running queries from blocking your application. If the query takes longer than this timeout, it will be automatically cancelled and an error will be returned. Recommended values: 5 seconds for simple lookups, 30 seconds for complex analytical queries, 60 seconds for heavy aggregations or large table scans. Default is 30 seconds if not specified."
        },
        "max_rows": {
          "type": "integer",
          "description": "Maximum number of rows to return from the query results. This acts as a safety limit to prevent accidentally returning millions of rows that could overwhelm your application or network. The LIMIT clause in your SQL query will be overridden if it exceeds this value. Recommended: 100 rows for UI display, 1000 rows for reports, 10000 rows for data exports. Default is 1000 if not specified."
        }
      },
      "required": ["sql"]
    }
  }
}
